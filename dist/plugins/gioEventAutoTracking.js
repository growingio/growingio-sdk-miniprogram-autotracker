var t=function(){return t=Object.assign||function(t){for(var e,n=1,a=arguments.length;a>n;n++)for(var i in e=arguments[n])({}).hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var e,n=/^\d{1,10}$/,a=/^_[0-9a-z]+/,i=/^_n_[0-9]+$/,r={name:"gioEventAutoTracking",method:function(r){var o=this;this.growingIO=r,this.main=function(t,n){var a,i,r=o.growingIO,l=r.vdsConfig,d=r.platformConfig,g=r.plugins,v=r.emitter,u=r.trackingId;if(!(!l.autotrack||!n||e.get(t,"currentTarget.dataset.growingIgnore")||e.get(t,"target.dataset.growingIgnore")||!e.get(t,"target.dataset.growingTrack")&&"autoplay"===e.get(t,"detail.source")||t.type===(null===(a=o.prevEvent)||void 0===a?void 0:a.type)&&10>Math.abs(Number(t.timeStamp)-Number(null===(i=o.prevEvent)||void 0===i?void 0:i.timeStamp))||l.taro&&["eh"].includes(n))){o.prevEvent=t,l.uniVue&&(n=null==g?void 0:g.gioUniAppAdapter.getHandlerName(n,t)),l.debug&&console.log("Action：",t.type,Date.now()),v.emit("ON_COMPOSE_BEFORE",{event:n,params:null!=t?t:{}});var s=d.listeners.actions;s.click.includes(t.type)?o.buildClickEvent(u,t,n):s.change.includes(t.type)&&o.buildChangeEvent(u,t,n)}},this.getNodeXpath=function(t,e){var n,r,l,d=o.growingIO,g=d.gioPlatform,v=d.vdsConfig,u=(t.currentTarget||t.target).id;return(!u||"swan"===g&&a.test(u)||(r=(n=v.taro).Current,l=n.createComponent,n&&r&&!l&&i.test(u)))&&(u=""),"".concat(u,"#").concat(e)},this.buildClickEvent=function(a,i,r){var l,d,g,v,u=o.getNodeXpath(i,r);if(u){var s=o.growingIO.dataStore,c=s.eventContextBuilder,p=s.eventInterceptor,h=i.currentTarget||i.target,m=void 0;if(e.has(null==h?void 0:h.dataset,"index")&&""!==(null===(l=null==h?void 0:h.dataset)||void 0===l?void 0:l.index)){var f=e.toString(h.dataset.index);n.test(f)&&f-0>0&&2147483647>f-0?m=+f:(v="".concat(h.dataset.index,"，index标记应为 大于 0 且小于 2147483647 的整数！"),"warn",console.log("%c[GrowingIO]：".concat(v),"color: #F59E0B"))}p(t({eventType:"VIEW_CLICK",element:[{xpath:u,index:m,textValue:null===(d=null==h?void 0:h.dataset)||void 0===d?void 0:d.title,hyperlink:null===(g=null==h?void 0:h.dataset)||void 0===g?void 0:g.src}]},c(a)))}},this.buildTabClickEvent=function(n,a){var i=o.growingIO.dataStore,r=i.eventContextBuilder;(0,i.eventInterceptor)(t({eventType:"VIEW_CLICK",element:[{xpath:"#onTabItemTap",textValue:a.text,index:a.index+1,hyperlink:e.toString(a.pagePath)}]},r(n)))},this.buildChangeEvent=function(n,a,i){var r,l,d=o.getNodeXpath(a,i);if(d){var g=o.growingIO.dataStore,v=g.eventContextBuilder,u=g.eventInterceptor,s=a.currentTarget||a.target,c=t({eventType:"VIEW_CHANGE",element:{xpath:d}},v(n)),p=e.get(a,"detail.value")||e.get(a,"target.attr.value");((null===(r=null==s?void 0:s.dataset)||void 0===r?void 0:r.growingTrack)||(null===(l=null==s?void 0:s.dataset)||void 0===l?void 0:l.growingtrack))&&(e.isNil(p)||(c.element.textValue=e.toString(p))),c.element=[c.element],u(c)}},e=this.growingIO.utils,this.prevEvent={}}};export{r as default};
