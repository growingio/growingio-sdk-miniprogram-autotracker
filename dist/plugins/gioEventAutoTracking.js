var t,e=function(){return e=Object.assign||function(t){for(var e,n=1,i=arguments.length;i>n;n++)for(var a in e=arguments[n])({}).hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},e.apply(this,arguments)},n={name:"gioEventAutoTracking",method:function(n){var i=this;this.growingIO=n,this.main=function(e,n){var a,r,o=i.growingIO,l=o.vdsConfig,d=o.platformConfig,g=o.plugins,v=o.emitter;if(!(!l.autotrack||!n||t.get(e,"currentTarget.dataset.growingIgnore")||t.get(e,"target.dataset.growingIgnore")||!t.get(e,"target.dataset.growingTrack")&&"autoplay"===t.get(e,"detail.source")||e.type===(null===(a=i.prevEvent)||void 0===a?void 0:a.type)&&10>Math.abs(Number(e.timeStamp)-Number(null===(r=i.prevEvent)||void 0===r?void 0:r.timeStamp))||l.taro&&["eh"].includes(n))){i.prevEvent=e,l.uniVue&&(n=null==g?void 0:g.gioUniAppAdapter.getHandlerName(n,e)),l.debug&&console.log("Action：",e.type,Date.now()),v.emit("onComposeBefore",{event:n,params:null!=e?e:{}});var u=d.listeners.actions;u.click.includes(e.type)?i.buildClickEvent(e,n):u.change.includes(e.type)&&i.buildChangeEvent(e,n)}},this.getNodeXpath=function(t,e){var n,a,r,o=i.growingIO,l=o.gioPlatform,d=o.vdsConfig,g=(t.currentTarget||t.target).id;return(!g||"swan"===l&&/^_[0-9a-f]+/.test(g)||(a=(n=d.taro).Current,r=n.createComponent,n&&a&&!r&&/^_n_[0-9]+$/.test(g)))&&(g=""),g+"#"+e},this.buildClickEvent=function(n,a){var r,o,l,d,g=i.getNodeXpath(n,a);if(g){var v=i.growingIO.dataStore,u=v.eventContextBuilder,s=v.eventInterceptor,c=n.currentTarget||n.target,p=void 0;if(t.has(null==c?void 0:c.dataset,"index")&&""!==(null===(r=null==c?void 0:c.dataset)||void 0===r?void 0:r.index)){var h=t.toString(c.dataset.index);/^\d{1,10}$/.test(h)&&h-0>0&&2147483647>h-0?p=+h:(d=c.dataset.index+"，index标记应为 大于 0 且小于 2147483647 的整数！",console.log("%c[GrowingIO]："+d,"color: #F59E0B"))}s(e({eventType:"VIEW_CLICK",element:[{xpath:g,index:p,textValue:null===(o=null==c?void 0:c.dataset)||void 0===o?void 0:o.title,hyperlink:null===(l=null==c?void 0:c.dataset)||void 0===l?void 0:l.src}]},u()))}},this.buildTabClickEvent=function(n){var a=i.growingIO.dataStore,r=a.eventContextBuilder;(0,a.eventInterceptor)(e({eventType:"VIEW_CLICK",element:[{xpath:"#onTabItemTap",textValue:n.text,index:n.index+1,hyperlink:t.toString(n.pagePath)}]},r()))},this.buildChangeEvent=function(n,a){var r,o,l=i.getNodeXpath(n,a);if(l){var d=i.growingIO.dataStore,g=d.eventContextBuilder,v=d.eventInterceptor,u=n.currentTarget||n.target,s=e({eventType:"VIEW_CHANGE",element:{xpath:l}},g()),c=t.get(n,"detail.value")||t.get(n,"target.attr.value");((null===(r=null==u?void 0:u.dataset)||void 0===r?void 0:r.growingTrack)||(null===(o=null==u?void 0:u.dataset)||void 0===o?void 0:o.growingtrack))&&(t.isNil(c)||(s.element.textValue=t.toString(c))),s.element=[s.element],v(s)}},t=this.growingIO.utils,this.prevEvent={}}};export default n;
