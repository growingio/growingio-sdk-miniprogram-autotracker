var n=function(){return n=Object.assign||function(n){for(var r,t=1,i=arguments.length;i>t;t++)for(var e in r=arguments[t])({}).hasOwnProperty.call(r,e)&&(n[e]=r[e]);return n},n.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var r=function(n){return"[object Object]"==={}.toString.call(n)&&!function(n){return["undefined","null"].includes(i(n))}(n)},t=function(n,e){if(!r(n))return!1;try{if("string"===i(e))return delete n[e];if("array"===i(e))return e.map((function(r){return delete n[r]}));"object"===i(e)&&e.constructor===RegExp&&function(n){return r(n)?Object.keys(n):[]}(n).forEach((function(r){e.test(r)&&t(n,r)}))}catch(n){return!1}},i=function(n){return{}.toString.call(n).slice(8,-1).toLowerCase()},e=function(n){try{return n()}catch(n){return}},o=function(){var n;return null!==(n=e((function(){return $global})))&&void 0!==n?n:global},a=function(r){var a=this;this.growingIO=r,this.getTrackerType=function(n,r){return r.trackingId&&r.trackingId!==n?0:1},this.rewriteDataStore=function(){a.growingIO.dataStore.getTrackerVds=function(r){if(a.growingIO.trackingId===r){var i=n({},a.growingIO.vdsConfig);return t(i,"subInstance"),a.growingIO.plugins.gioTaobaoAdapter||t(i,"tbConfig"),i}return a.growingIO.subInstance[r]?n({},a.growingIO.subInstance[r]):void 0},a.growingIO.dataStore.initTrackerOptions=function(n){var r,i=a.growingIO.dataStore.initOptions(n),e=a.getTrackerType(n.trackingId,a.growingIO);return i.trackingId=n.trackingId,e?(a.growingIO.trackingId=n.trackingId,a.growingIO.vdsConfig=i,o().vdsConfig=i):(t(i,["autotrack","debug","forceLogin","keepAlive","originalSource","performance","pluginMode","taro","taroVue","tbConfig","uniVue"]),a.growingIO.subInstance[n.trackingId]=i,(null===(r=o().vdsConfig)||void 0===r?void 0:r.subInstance)||(o().vdsConfig.subInstance={}),o().vdsConfig.subInstance[n.trackingId]=i),i},a.growingIO.dataStore.initTrackerHooker=function(n){var r,t;if(a.getTrackerType(n.trackingId,a.growingIO)){var i=a.growingIO,e=i.platformConfig,o=i.inPlugin,g=i.minipInstance,c=i.plugins,u=i.dataStore,s=n.uniVue,I=n.taro;s||I||(e.canHook=!0),o&&!["tbp","jdp"].includes(g.platform)||u.eventHooks.initEventHooks(),s&&(null===(r=null==c?void 0:c.gioUniAppAdapter)||void 0===r||r.main()),I&&(null===(t=null==c?void 0:c.gioTaroAdapter)||void 0===t||t.main())}};var r=a.growingIO.dataStore.eventConverter,g=a;a.growingIO.dataStore.eventConverter=function(){for(var o=this,a=[],c=0;arguments.length>c;c++)a[c]=arguments[c];var u=a[0];if("CUSTOM"===u.eventType){var s=[u.trackingId];e((function(){u["&&sendTo"].forEach((function(n){"string"===i(n)&&g.growingIO.dataStore.getTrackerVds(n)&&!s.includes(n)&&s.push(n)}))})),t(u,"&&sendTo"),s.forEach((function(t){var i=g.growingIO.dataStore.eventContextBuilder;r.call(o,n(n({},u),i(t)))}))}else r.call(this,u)}},this.onSendBefore=function(n){var r=n.eventsQueue,t=n.requestData;n.trackingId!==a.growingIO.trackingId&&a.growingIO.uploader.sendEvent(r,t)},this.subTrackingIds=[],this.growingIO.emitter.on("ON_SDK_INITIALIZE_BEFORE",(function(){a.growingIO.trackingId||a.rewriteDataStore(),a.growingIO.subInstance||(a.growingIO.subInstance={})})),this.growingIO.emitter.on("OPTION_INITIALIZED",(function(n){var r=n.trackingId;a.growingIO.trackingId&&a.growingIO.trackingId!==r&&a.subTrackingIds.push(r)}))},g={name:"gioMultipleInstances",method:a};export{a as GioMultipleInstances,g as default};
