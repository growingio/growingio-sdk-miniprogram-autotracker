import e from"@system.app";import t from"@system.device";import n from"@system.fetch";import r from"@system.image";import i from"@system.network";import o from"@system.router";import a from"@system.share";import u from"@system.storage";var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)},c=function(){return c=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},c.apply(this,arguments)};function l(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((r=r.apply(e,t||[])).next())}))}function g(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}function d(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var f=/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/,p=function(e){return["undefined","null"].includes(B(e))},v=function(e){return"string"===B(e)},h=function(e){return"number"===B(e)},m=function(e){return"boolean"===B(e)},I=function(e){return"[object Object]"==={}.toString.call(e)&&!p(e)},y=function(e){return["function","asyncfunction"].includes(B(e))},S=function(e){return Array.isArray(e)&&"array"===B(e)},w=function(e){return"date"===B(e)},O=function(e){try{return Array.from(e)[0]}catch(e){return}},_=function(e){try{var t=Array.from(e);return t[t.length-1]}catch(e){return}},P=function(e,t){return void 0===t&&(t=1),S(e)&&h(t)?e.slice(t>0?t:1,e.length):e},k=function(e,t){if(void 0===t&&(t=!1),S(e)){for(var n=0,r=[],i=0,o=e;i<o.length;i++){var a=o[i];a&&!R(a)&&(r[n++]=a),t&&0===a&&(r[n++]=a)}return r}return e},b=function(e,t){if(S(e)){var n=e.findIndex(t);return 0>n?void 0:e[n]}},T=function(e){return p(e)?"":"".concat(e)},E=function(e,t){return"string"===B(e)?e.split(t):e},C=function(e){if(v(e)){var t=E(e,"");return"".concat(O(t).toLowerCase()).concat(P(t).join(""))}return e},A=function(e,t){return v(e)||(e=T(e)),e.slice(0,t.length)===t},x={}.hasOwnProperty,q=function(e,t){return!p(e)&&x.call(e,t)},N=function(e){return I(e)?Object.keys(e):[]},U=function(e,t){N(e).forEach((function(n){return t(e[n],n)}))},D=function(e,t){var n=N(e);return!(!I(e)||!I(t)||n.length!==N(t).length||n.map((function(n,r){return I(e[n])?D(e[n],t[n]):e[n]===t[n]})).includes(!1))},K=function(e,t,n){var r=e;return I(e)?(t.split(".").forEach((function(e){r=r?r[e]:n})),r):n},L=function(e,t){if(!I(e))return!1;try{if("string"===B(t))return delete e[t];if("array"===B(t))return t.map((function(t){return delete e[t]}));"object"===B(t)&&t.constructor===RegExp&&N(e).forEach((function(n){t.test(n)&&L(e,n)}))}catch(e){return!1}},H=function(e,t,n,r){var i;void 0===t&&(t=250);var o=0;return"boolean"!==B(n)&&(r=e,e=n,n=void 0),function(){for(var a=[],u=0;arguments.length>u;u++)a[u]=arguments[u];var s=this,c=Date.now()-o;function l(){o=Date.now(),e.apply(s,a)}r&&!i&&l(),i&&clearTimeout(i),void 0===r&&c>t?l():!0!==n&&(i=setTimeout(r?function(){i=void 0}:l,void 0===r?t-c:t))}},R=function(e){return S(e)?0===e.length:I(e)?0===N(e).length:!e},B=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},F=function(e){function t(e){return 10>e?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())},j=Object.freeze({__proto__:null,isNil:p,isString:v,isNaN:function(e){return"NaN"===T(Number(e))},isNumber:h,isBoolean:m,isObject:I,isRegExp:function(e){return"[object RegExp]"==={}.toString.call(e)},isFunction:y,isArray:S,isDate:w,fixed:function(e,t){return h(e)?Number(e.toFixed(h(t)?t:2)):v(e)&&"NaN"!==T(Number(e))?Number(Number(e).toFixed(h(t)?t:2)):e},head:O,last:_,drop:P,dropWhile:function(e,t){return S(e)?e.filter((function(e){return!t(e)})):e},compact:k,find:b,isEqualArray:function(e,t){return!(!S(e)||!S(t)||e.length!==t.length)&&e.every((function(e,n){return e===t[n]}))},toString:T,split:E,lowerFirst:C,upperFirst:function(e){if(v(e)){var t=E(e,"");return"".concat(O(t).toUpperCase()).concat(P(t).join(""))}return e},startsWith:A,endsWith:function(e,t){var n=e.length,r=n;r>n&&(r=n);var i=r;return(r-=t.length)>=0&&e.slice(r,i)===t},hasOwnProperty:x,has:q,keys:N,forEach:U,isEqual:D,get:K,unset:L,throttle:H,isEmpty:R,typeOf:B,formatDate:F}),V=function(e,t){console.log("%c[GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},M=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),V("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},G=function(e){try{return e()}catch(e){return}},Q=function(e,t){if(y(e))try{e(t)}catch(e){V("回调执行失败！".concat(e),"error")}},$=function(e){return v(e)?e.trim().substring(0,100):e},z=function(e,t){return v(e)&&!R(e)&&e.match(f)?t():(V("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},W=function(e){return p(e)||N(e).forEach((function(t){y(e[t])?e[t]=G((function(){return e[t]()})):I(e[t])?L(e,t):S(e[t])||(e[t]=T(e[t]))})),e},J=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},Y=function(e){return e.pixelRatio?Math.round(e.screenHeight*e.pixelRatio):e.screenHeight},Z=function(e){return e.pixelRatio?Math.round(e.screenWidth*e.pixelRatio):e.screenWidth},X=function(e,t){if(e){var n=e.toLowerCase();return-1!==n.indexOf("android")?"".concat(t,"-Android"):-1!==n.indexOf("ios")?"".concat(t,"-iOS"):-1!==n.indexOf("harmonyos")||-1!==n.indexOf("ohos")?"".concat(t,"-HarmonyOS"):"".concat(t,"-").concat(e)}},ee=function(e){if(v(e)){var t=e.indexOf("?");return-1!==t?[e.substring(0,t),e.substring(t+1)]:[e,""]}return["",""]},te=function(e){return v(e)?e.startsWith("/")?e:"/".concat(e):""},ne=function(e){return G((function(){switch(e){case"wx":return wx;case"my":case"tb":return my;case"swan":return swan;case"tt":return tt;case"qq":return qq;case"ks":return ks;case"jd":return jd;case"xhs":return xhs;default:var t=void 0;return t||(t=G((function(){return xhs}))),t||(t=G((function(){return swan}))),t||(t=G((function(){return my}))),t||(t=G((function(){return tt}))),t||(t=G((function(){return qq}))),t||(t=G((function(){return ks}))),t||(t=G((function(){return jd}))),t||(t=G((function(){return wx}))),t}}))},re=function(e){return G((function(){switch(e){case"wx":return __wxConfig;case"swan":return appConfig;case"tt":return G((function(){return __ttConfig}))||(null===global||void 0===global?void 0:global.TMAConfig)||(null===globalThis||void 0===globalThis?void 0:globalThis.TMAConfig);case"qq":return __qqConfig;case"ks":return __ksConfig;case"jd":return __jdConfig;case"xhs":return null!==__MP_APP_JSON_MIGRATION__&&void 0!==__MP_APP_JSON_MIGRATION__?__MP_APP_JSON_MIGRATION__:__MP_APP_JSON__;default:return}}))},ie=function(e){return G((function(){switch(e){case"wx":case"qq":return __wxAppCode__;case"tt":return __allConfig__;case"ks":return __module__;case"jd":return __jdAppCode__;default:return}}))},oe=function(){var e;return!e&&G((function(){return xhs}))&&(e="xhs"),!e&&G((function(){return swan}))&&(e="swan"),!e&&G((function(){return tt}))&&(e="tt"),!e&&G((function(){return qq}))&&(e="qq"),!e&&G((function(){return my.tb}))&&(e="tb"),!e&&G((function(){return my}))&&(e="my"),!e&&G((function(){return ks}))&&(e="ks"),!e&&G((function(){return jd}))&&(e="jd"),!e&&G((function(){return wx}))&&(e="wx"),e||b(N(global),(function(e){return T(e).toLowerCase().includes("quickapp")}))&&(e="quickapp"),e},ae=function(){var e;return null!==(e=G((function(){var e;return null!==(e=G((function(){var e;return null!==(e=G((function(){return $global})))&&void 0!==e?e:global})))&&void 0!==e?e:window})))&&void 0!==e?e:globalThis},ue=function(e){var t={};return I(e)&&(L(e,"&&sendTo"),U(e,(function(e,n){var r=T(n).slice(0,100);I(e)?t[r]=ue(e):S(e)?(t[r]=k(e.slice(0,100),!0),t[r]=t[r].join("||").slice(0,1e3)):w(e)?t[r]=F(e):t[r]=p(e)?"":T(e).slice(0,1e3)}))),t},se=function(e,t){var n=function(){return t.map((function(t){return e.getStorageSync(t)}))};try{return e.minip.canIUse("batchGetStorageSync")?e.minip.batchGetStorageSync(t):n()}catch(e){return n()}},ce=function(e,t){var n=function(){return t.map((function(t){var n=t.key,r=t.value;return e.setStorageSync(n,r)}))};try{return e.minip.canIUse("batchSetStorageSync")?e.minip.batchSetStorageSync(t):n()}catch(e){return n()}},le=function(e){return N(e||{}).map((function(t){return t?"".concat(t,"=").concat(p(e[t])?"":e[t]):""})).join("&")},ge=function(e){(A(e,"?")||A(e,"&"))&&(e=e.slice(1,e.length));var t={};return e.split("&").forEach((function(e){var n=e.split("=");n[0]&&(t[n[0]]=n[1])})),t},de=function(e){var t;return v(e)?null!==(t=G((function(){return JSON.parse(e)})))&&void 0!==t?t:{}:null!=e?e:{}},fe=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var n={},r=de(t);return N(r).forEach((function(e){"gdpCircleRoomCollectUrl"!==e&&["string","number","boolean"].includes(B(r[e]))&&(n[e]=r[e])})),L(e,"gdpCircleRoomCollectUrl"),Object.assign({},n,e)},pe=Object.freeze({__proto__:null,consoleText:V,callError:M,niceTry:G,niceCallback:Q,limitString:$,eventNameValidate:z,getDynamicAttributes:W,guid:J,getScreenHeight:Y,getScreenWidth:Z,getOS:X,compareVersion:function(e,t){void 0===e&&(e=""),void 0===t&&(t="");for(var n=function(e){return e.replace(/\s+/g,"")},r=function(e){return e.replace(/[vV]/g,"")},i=n(r(e)),o=n(r(t)),a=i.split("."),u=o.split("."),s=0;3>s;s++){var c=Number(a[s]),l=Number(u[s]);if(c>l)return 1;if(l>c)return-1;if(!isNaN(c)&&isNaN(l))return 1;if(isNaN(c)&&!isNaN(l))return-1}return 0},getVueVersion:function(e){if(e){var t=Number(O(E(e.version,".")));return Number.isNaN(t)?0:t}return 0},splitPath:ee,normalPath:te,isTaro3:function(e){var t=e.Current,n=e.createComponent;return!(!e||!t||n)},getPlainMinip:ne,getPlainConfig:re,getPlainAppCode:ie,getPlainPlatform:oe,getSubKeys:function(e){return N(e).filter((function(e){return e.indexOf("__sub")>-1&&e.indexOf("gio__")>-1})).sort()},getAppInst:function(){var e=G((function(){return getApp({allowDefault:!0})}));return e||(e=ae()),e},getGlobal:ae,limitObject:ue,batchGetStorageSync:se,batchSetStorageSync:ce,qsStringify:le,qsParse:ge,hashCode:function(e,t){void 0===t&&(t=!1);var n=0;if(R(e)||"boolean"==typeof e)return n;for(var r=0;r<e.length;)n=(n<<5)-n+e.charCodeAt(r),n|=0,r++;return t?Math.abs(n):n},getExtraData:de,getLaunchQuery:fe}),ve=function(e){return(v(e)&&e.length>0||h(e)&&e>0)&&!["-","null","undefined"].includes(e)},he={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},idMapping:{type:"boolean",default:!1},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},ignoreFields:{type:"array",default:[]},impressionScale:{type:"number",default:0},pluginMode:{type:"boolean",default:!1},originalSource:{type:"boolean",default:!0},keepAlive:{type:"number",default:5},performance:{type:"object",default:{monitor:!0,exception:!0}},serverUrl:{type:"string",default:"https://napi.growingio.com"},sessionExpires:{type:"number",default:-1},requestTimeout:{type:"number",default:5e3},taro:{type:["object","module"],default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloud:void 0,cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},trackPage:{type:"boolean",default:!0},uniVue:{type:["object","function"],default:!1},uploadInterval:{type:"number",default:1e3},version:{type:"string",default:"1.0.0"}},me=["clearGeneralProps","clearPageAttributes","clearTrackTimer","clearUserId","getABTest","getGioInfo","getOption","identify","removeTimer","sendPage","sendVisit","setGeneralProps","setLocation","setOption","setPageAttributes","setUserAttributes","setUserId","track","trackTimerEnd","trackTimerPause","trackTimerResume","trackTimerStart"],Ie=d(d(["init","registerPlugins"],["getPlugins","getDeviceId","updateImpression"],!0),me,!0),ye={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式",serverUrl:"数据上报服务地址"},Se=["enableDebug","setAutotrack","setDataCollect","setTrackerHost","setTrackerScheme","setConfig","collectImp","setPlatformProfile","getLocation"],we=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],Oe=d(d([],we,!0),["appChannel","language","platformVersion"],!1),_e={gsid:"_growing_gsid_",originalSource:"_gdp_original_source_",userId:"_growing_userId_",userKey:"_growing_userKey_",gioId:"_growing_gioId_",plugin_gsid:"_growing_plugin_gsid_",plugin_originalSource:"_gdp_plugin_original_source_",plugin_userId:"_growing_plugin_userId_",plugin_userKey:"_growing_plugin_userKey_",plugin_gioId:"_growing_plugin_gioId_"},Pe="MINIP_LIFECYCLE",ke="ON_COMMIT_REQUEST",be="ON_COMPOSE_AFTER",Te="ON_COMPOSE_BEFORE",Ee="ON_ERROR",Ce="ON_INSTALL",Ae="ON_SEND_AFTER",xe="ON_SEND_BEFORE",qe="OPTION_CHANGE",Ne="OPTION_INITIALIZED",Ue="SDK_INITIALIZED",De="SESSIONID_UPDATE",Ke=function(e){var t=this;this.growingIO=e,this.main=function(e,n,r){void 0===r&&(r=!0),e||(e=t.growingIO.trackingId);var i=t.growingIO,o=i.sdkVersion,a=i.platformConfig,u=i.minipInstance,s=i.userStore,l=i.dataStore,g=i.dataStore,d=g.scene,f=g.eventHooks.currentPage,p=g.generalProps,v=l.getTrackerVds(e),h=v.version,m=v.dataSourceId,I=v.appId,y=v.idMapping,S=v.ignoreFields,w=l.locationData[e],O=u.systemInfo,_=void 0===O?{}:O,P=u.network,k=void 0===P?{}:P,b=_.brand,T=_.model,E=_.platform,C=_.language,A=f.getPagePath(),x={appChannel:"scn:".concat(d||"NA"),appVersion:h,dataSourceId:m,deviceBrand:b,deviceId:s.getUid(),deviceModel:T,deviceType:X(E,a.name),domain:I,language:C,latitude:null==w?void 0:w.latitude,longitude:null==w?void 0:w.longitude,networkState:(null==k?void 0:k.networkType)||(null==k?void 0:k.type)||(null==k?void 0:k.subtype),operatingSystem:X(E,a.name),path:A,platform:a.platform,platformVersion:a.name+(_.version?" ".concat(_.version):""),query:A?f.getPageQuery():"",screenHeight:Y(_),screenWidth:Z(_),sdkVersion:o,sessionId:s.getSessionId(e),title:f.getPageTitle(),timestamp:Date.now(),timezoneOffset:(new Date).getTimezoneOffset(),userId:s.getUserId(e)};return y&&(x.userKey=s.getUserKey(e)),r&&!R(p[e])&&(x.attributes=c({},p[e])),R(x.attributes)||(x.attributes=ue(W(c({},x.attributes)))),R(S)||S.forEach((function(e){L(x,e)})),R(n)?c(c({},x),{trackingId:e}):c(c(c({},x),n),{trackingId:e})}},Le=function(e){var t=this;this.growingIO=e,this.enterParams={},this.main=function(e,n){var r,i,o=Date.now(),a=t.growingIO,u=a.emitter,s=a.userStore,l=a.vdsConfig,g=a.platformConfig,d=a.uploader,f=a.dataStore,p=a.minipInstance,v=a.dataStore,h=v.trackersExecute,m=v.shareOut,I=v.lastCloseTime,y=v.saveStorageInfo,S=v.setOriginalSource;u.emit(Pe,{event:"App ".concat(e),timestamp:o,params:null!==(r=n[0])&&void 0!==r?r:{}}),l.debug&&console.log("App:",e,o);var w=g.listeners.app;switch(u.emit(Te,{event:"App ".concat(e),params:null!==(i=n[0])&&void 0!==i?i:{}}),e){case w.appLaunch:t.enterParams=c({},n[0]);break;case w.appCreate:case w.appShow:var O=t.enterParamsParse(n[0]),_=O.path,P=O.query,k=O.referralPage;!m&&l.originalSource&&_&&h((function(e){S(e,{path:_,query:P,referralPage:k})})),I?(Date.now()-I>60*l.keepAlive*1e3||f.lastScene&&f.scene!==f.lastScene)&&h((function(e){s.setSessionId(e)})):h((function(e){f.lastVisitEvent[e]={path:_,query:P,referralPage:k},t.buildVisitEvent(e,{path:_,query:P,referralPage:k})})),p.setNetworkStatusListener();break;case w.appClose:f.lastScene=f.scene,f.lastCloseTime=Date.now(),y(),s.saveUserInfo(),h((function(e){t.buildCloseEvent(e),l.forceLogin||d.initiateRequest(e,!0)}))}},this.enterParamsParse=function(e){var n;void 0===e&&(e={});var r=t.growingIO,i=r.gioPlatform,o=r.minipInstance,a=r.dataStore,u="",s="",c="";if("quickapp"!==i&&o.minip.canIUse("getEnterOptionsSync")){var l=o.minip.getEnterOptionsSync()||{},g=l.path,d=l.query,f=l.scene,p=l.referrerInfo;u=g||e.path,s=d||e.query,c=(null==p?void 0:p.appId)||(null===(n=null==e?void 0:e.referrerInfo)||void 0===n?void 0:n.appId)||"",a.scene=f||e.scene,L(d,"gdpCircleRoomCollectUrl"),s=R(null==p?void 0:p.extraData)?le(s):le(fe(s,p.extraData))}else g=e.path,d=e.query,p=e.referrerInfo,u=g,s=le(d),c=(null==p?void 0:p.appId)||"",t.parseScene(e);return{path:u,query:s,referralPage:c}},this.parseScene=function(e){var n,r,i=t.growingIO,o=i.minipInstance,a=i.gioPlatform,u=i.dataStore;if("quickapp"===a){var s=o.getAppSource(),c=s.extra,l=s.type;r=(null==c?void 0:c.scene)||l}else R(e)||((null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.wxShoppingListScene)?r=e.query.wxShoppingListScene:(null==e?void 0:e.scene)?r=e.scene:u.scene="NA");u.scene=r},this.buildVisitEvent=function(e,n){var r=t.growingIO,i=r.dataStore,o=i.getOriginalSource,a=i.eventContextBuilder,u=i.eventInterceptor,s=r.vdsConfig,l=o(e),g=(null==n?void 0:n.query)||"",d=c({eventType:"VISIT"},a(e,{}));!R(n)&&n.path&&(d.path=n.path||"",d.query="string"===B(g)?g:le(g),n.referralPage&&(d.referralPage=n.referralPage)),s.originalSource&&!R(l)&&(d=c(c({},d),l)),u(d)},this.buildCloseEvent=function(e){var n=t.growingIO.dataStore,r=n.eventContextBuilder;(0,n.eventInterceptor)(c({eventType:"APP_CLOSED"},r(e)))}},He=function(){function e(e){var t=this;this.growingIO=e,this.lifeBeforeShow=!0,this.getPagePath=function(){var e,n,r,i=t.growingIO,o=i.minipInstance,a=i.inPlugin,u=i.dataStore,s=i.trackingId,c=o.getCurrentPath();if(a){var l=u.getTrackerVds(s);return c||"/插件".concat(l.appId)}return c||(null===(e=u.eventHooks.appEffects.enterParams)||void 0===e?void 0:e.path)||(null===(n=u.lastPageEvent[s])||void 0===n?void 0:n.path)||(null===(r=u.lastVisitEvent[s])||void 0===r?void 0:r.path)},this.getPageQuery=function(){var e,n,r,i,o,a,u=t.growingIO,s=u.minipInstance,c=u.dataStore,l=u.trackingId,g=s.getCurrentPage(),d=s.getCurrentPath(),f=c.eventHooks.appEffects.enterParams,p=void 0===f?{}:f;if(!d)return p.path?t.qsQuery(fe(null==p?void 0:p.query,null===(r=null==p?void 0:p.referrerInfo)||void 0===r?void 0:r.extraData)):(null===(i=c.lastPageEvent[l])||void 0===i?void 0:i.path)?null===(o=c.lastPageEvent[l])||void 0===o?void 0:o.query:null===(a=c.lastVisitEvent[l])||void 0===a?void 0:a.query;var v=null!==(e=g.options)&&void 0!==e?e:g.$taroParams;return R(v)?R(t.queryOptions[d])?d===p.path?t.qsQuery(fe(null==p?void 0:p.query,null===(n=null==p?void 0:p.referrerInfo)||void 0===n?void 0:n.extraData)):void 0:t.qsQuery(t.queryOptions[d]):(L(v,["$taroTimestamp","gdpCircleRoomCollectUrl"]),t.qsQuery(v))},this.getPageTitle=function(e){var n=t.growingIO,r=n.minipInstance,i=n.inPlugin,o=n.dataStore,a=r.getCurrentPath(),u=t.configuredTitle[a]||r.getPageTitle(r.getCurrentPage());if(i){var s=o.getTrackerVds(e||t.growingIO.trackingId);return u||"/插件".concat(s.appId).concat(a?"_"+_(a.split("/")):"")}return u},this.qsQuery=function(e){void 0===e&&(e={});var t=c({},e);return L(t,"wxShoppingListScene"),le(t)},this.getReferralPage=function(e){var n,r,i,o=t.growingIO,a=o.minipInstance,u=o.dataStore,s=u.lastPageEvent,c=u.scene,l=u.eventHooks;return(null===(n=s[e])||void 0===n?void 0:n.path)||(null===(i=null===(r=l.appEffects.enterParams)||void 0===r?void 0:r.referrerInfo)||void 0===i?void 0:i.appId)||(c?"scn:".concat(a.scnPrefix).concat(c):null)},this.updateShareResult=function(e,n){void 0===n&&(n=!0);var r=t.buildShareQuery(e),i=r[0],o=r[1];return(n||q(e,"path"))&&(e.path=te(i+(o?"?".concat(o):""))),(n||q(e,"query"))&&(e.query=o),e},this.eventSetPageProps=function(e,n){var r=G((function(){return t.pageProps[e][t.getPagePath()]}));return R(r)?n.attributes:ue(W(c(c({},n.attributes),r)))},this.queryOptions={},this.configuredTitle={},this.pageProps={}}return e.prototype.buildShareQuery=function(e){var t,n,r=ee(null!==(t=e.path)&&void 0!==t?t:""),i=e.path||this.getPagePath(),o={},a=q(e,"path");if(q(e,"query"))o=ge(null!==(n=e.query)&&void 0!==n?n:"")||{};else if(a)o=ge(_(r))||{};else{var u=this.growingIO.minipInstance.getCurrentPage();o=c({},u.options||this.queryOptions[u.route]||{}),k(N(o)).forEach((function(e){e.toLowerCase().startsWith("utm_")&&L(o,e)}))}return[i,le(o)]},e}(),Re=function(e){var t=this;this.growingIO=e,this.main=function(e,n,r){var i,o,a=Date.now(),u=t.growingIO,s=u.emitter,l=u.minipInstance,g=u.plugins,d=u.vdsConfig,f=u.platformConfig,p=u.dataStore,v=p.getTrackerVds,h=p.getOriginalSource,m=p.setOriginalSource,I=p.trackersExecute,S=p.eventHooks,w=p.toggleShareOut,O=p.buildAppMessageEvent,_=p.buildTimelineEvent,P=p.buildAddFavorites,k=S.currentPage;if(!t.prevEvent[n]||Date.now()-Number(t.prevEvent[n])>=50){e||(e=l.getCurrentPage()),e.route||(e.route=l.getCurrentPath(e));var b=e.route||e.uri||e.__route__||(null===(i=null==e?void 0:e.$page)||void 0===i?void 0:i.fullPath)||"";s.emit(Pe,{event:"Page ".concat(n),timestamp:a,params:{page:e,args:r[0]}}),d.debug&&console.log("Page:",b,"#",n,a),t.prevEvent[n]=Date.now();var T=f.listeners.page;switch(s.emit(Te,{page:e,event:"Page ".concat(n),params:{page:e,args:r[0]}}),k.lastLifecycle=k.currentLifecycle,k.currentLifecycle=n,n){case T.pageLoad:k.queryOptions[b]=K(e,"options")||K(e,"__displayReporter.query")||K(e,"$page.query")||K(e,"$wx.__displayReporter.query")||K(e,"$taroParams")||r[0]||{},L(k.queryOptions[b],["$taroTimestamp","gdpCircleRoomCollectUrl"]);break;case T.pageShow:I((function(e){var n=h(e);R(n)||n.path!==b||m(e,c(c({},n),{title:k.getPageTitle()})),v(e).trackPage&&t.buildPageEvent(e)})),w(!1);break;case T.pageHide:case T.pageUnload:break;case T.shareChat:case T.shareApp:w(!0),I((function(e){v(e).followShare&&O(e,r)}));break;case T.shareTime:"xhsp"===l.platform&&w(!0),I((function(e){v(e).followShare&&_(e,r)}));break;case T.addFavorites:I((function(e){v(e).followShare&&P(e,r)}));break;case T.tabTap:var E=null===(o=null==g?void 0:g.gioEventAutoTracking)||void 0===o?void 0:o.buildTabClickEvent;d.autotrack&&E&&y(E)&&E(t.growingIO.trackingId,r[0])}k.lastLifecycle=k.currentLifecycle,k.currentLifecycle="".concat(n,"End"),["onHideEnd","onUnloadEnd"].includes(k.currentLifecycle)&&(k.lifeBeforeShow=!0),"onShowEnd"===k.currentLifecycle&&(k.lifeBeforeShow=!1)}},this.buildPageEvent=function(e,n){var r=t.growingIO.dataStore,i=r.eventContextBuilder,o=r.eventInterceptor,a=r.eventHooks.currentPage,u=c({eventType:"PAGE",referralPage:a.getReferralPage(e)},i(e));u.attributes=a.eventSetPageProps(e,u),!R(n)&&n.title&&(u.title=n.title),o(u)},this.prevEvent={}},Be=function(e){var t,n=this;this.growingIO=e,this.isNormalFc=function(e,t){return y(t)&&"constructor"!==e},this.objectTraverse=function(e,t){Object.getOwnPropertyNames(e).forEach((function(n){return t(n,e)})),q(e,"methods")&&Object.getOwnPropertyNames(e.methods).forEach((function(n){e[n]||t(n,e.methods)})),q(e,"lifetimes")&&Object.getOwnPropertyNames(e.lifetimes).forEach((function(n){e[n]||t(n,e.lifetimes)})),q(e,"pageLifetimes")&&Object.getOwnPropertyNames(e.pageLifetimes).forEach((function(n){e[n]||t(n,e.pageLifetimes)}))},this.supLifeFcs=function(e,t){S(n["".concat(t,"Handlers")])&&n["".concat(t,"Handlers")].forEach((function(t){y(e[t])||["onShareAppMessage","onShareTimeline"].includes(t)||(e[t]=function(){})}))},this.lifeFcEffectsFn=function(e,t,r,i,o){void 0===o&&(o=void 0);var a="array"===B(t)?[].slice.call(t):[];return R(o)||a.push(o),n["def".concat(r,"Cbs")][i].apply(e,a),n.growingIO.emitter.emit(Pe,{event:"".concat(r," ").concat(i,"End"),timestamp:Date.now(),params:{instance:e,arguments:Array.from(a)}}),o},this.lifeFcEffects=function(e,t,r){var i=n;return function(){for(var n,o,a,u=this,s=[],l=0;arguments.length>l;l++)s[l]=arguments[l];if(i.shareEventTypes.includes(e)){var g=null!==(n=t.apply(this,s))&&void 0!==n?n:{};if(!i.growingIO.vdsConfig.followShare)return g;var d="promise"===B(g),f="promise"===B(g.promise),p=q(g,"_result")&&q(g,"_state");if(d||f||p){var v=function(t){void 0===t&&(t={});try{var n=c(c({},g),t),o=i.currentPage.updateShareResult(n);i.lifeFcEffectsFn(u,s,r,e,o)}catch(e){V(e,"error")}};d&&Promise.race([g,new Promise((function(e){setTimeout((function(){e({})}),3e3)}))]).then(v).catch((function(e){return V(e,"error")})),f&&Promise.race([g.promise,new Promise((function(e){setTimeout((function(){e({})}),3e3)}))]).then(v).catch((function(e){return V(e,"error")})),p&&(null===(o=i.growingIO.minipInstance)||void 0===o||o.handleSharePromise(g,v)),a=i.currentPage.updateShareResult(g,!1)}else a=i.currentPage.updateShareResult(g),i.lifeFcEffectsFn(this,s,r,e,a)}else i.lifeFcEffectsFn(this,s,r,e),a=t.apply(this,s);return a}},this.customFcEffects=function(e,t){var r=n;return function(){for(var n,i,o=[],a=0;arguments.length>a;a++)o[a]=arguments[a];if(r.growingIO.vdsConfig.autotrack&&r.growingIO.plugins.gioEventAutoTracking)try{var u=o[0]||{};q(u,"type")&&((null==u?void 0:u.currentTarget)||(null==u?void 0:u.target))||(u=o[o.length-1]),((null==u?void 0:u.currentTarget)||(null==u?void 0:u.target))&&r.actionEventTypes.includes(u.type)&&(y(r.actionEffects)||(r.actionEffects=(null===(i=null===(n=r.growingIO.plugins)||void 0===n?void 0:n.gioEventAutoTracking)||void 0===i?void 0:i.main)||function(){}),null==r||r.actionEffects(u,e))}catch(e){V(e,"error")}return t.apply(this,o)}},this.appApplyProxy=function(e,t){return n.appHandlers.includes(e)?n.lifeFcEffects(e,t,"App"):n.customFcEffects(e,t)},this.pageApplyProxy=function(e,t){return n.pageHandlers.includes(e)?n.lifeFcEffects(e,t,"Page"):n.customFcEffects(e,t)},this.appOverriding=function(e){return n.setAppEffectCbs(),n.supLifeFcs(e,"app"),n.objectTraverse(e,(function(e,t){n.isNormalFc(e,t[e])&&(t[e]=n.appApplyProxy(e,t[e]))})),e},this.pageOverriding=function(e){return n.setPageEffectCbs(),n.supLifeFcs(e,"page"),n.objectTraverse(e,(function(e,t){n.isNormalFc(e,t[e])&&(t[e]=n.pageApplyProxy(e,t[e]))})),e},this.componentOverriding=function(e){return n.setPageEffectCbs(),e.methods||(e.methods={}),n.supLifeFcs(n.growingIO.inPlugin?e:e.methods,"page"),n.objectTraverse(n.growingIO.inPlugin?e:e.methods,(function(e,t){n.isNormalFc(e,t[e])&&(t[e]=n.pageApplyProxy(e,t[e]))})),e},this.setAppEffectCbs=function(){var e=n;n.appHandlers.forEach((function(t){n.defAppCbs[t]=function(){for(var n=[],r=0;arguments.length>r;r++)n[r]=arguments[r];e.appEffects.main(t,n)}}))},this.setPageEffectCbs=function(){var e=n;n.pageHandlers.forEach((function(t){n.defPageCbs[t]=function(){for(var n=[],r=0;arguments.length>r;r++)n[r]=arguments[r];e.pageEffects.main(this,t,n)}}))},this.growingApp=function(e){return y(n.originalApp)?n.originalApp(n.appOverriding(e)):n.appOverriding(e)},this.growingPage=function(e){return y(n.originalPage)?n.originalPage(n.pageOverriding(e)):n.pageOverriding(e)},this.growingComponent=function(e){return y(n.originalComponent)?n.originalComponent(n.componentOverriding(e)):n.componentOverriding(e)},this.growingBehavior=function(e){return y(n.originalBehavior)?n.originalBehavior(n.componentOverriding(e)):n.componentOverriding(e)},this.nativeGrowing=function(e){void 0===e&&(e=["App","Page","Component","Behavior"]);var t=n,r=n.growingIO.platformConfig.hooks;if(e.includes("App"))try{r.App&&!n.appHooked&&(App=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.originalApp(t.appOverriding(e[0]))},n.appHooked=!0)}catch(e){}if(e.includes("Page"))try{r.Page&&!n.pageHooked&&(Page=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.originalPage(t.pageOverriding(e[0]))},n.pageHooked=!0)}catch(e){}if(e.includes("Component"))try{r.Component&&!n.componentHooked&&(Component=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.originalComponent(t.componentOverriding(e[0]))},n.componentHooked=!0)}catch(e){}if(e.includes("Behavior"))try{r.Behavior&&!n.behaviorHooked&&(Behavior=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.originalBehavior(t.componentOverriding(e[0]))},n.behaviorHooked=!0)}catch(e){}},this.initOriginalValue=function(){n.setAppEffectCbs(),n.setPageEffectCbs(),n.originalApp=G((function(){return App||global.App})),n.originalPage=G((function(){return Page||global.Page})),n.originalComponent=G((function(){return Component||global.Component})),n.originalBehavior=G((function(){return Behavior||global.Behavior}))},this.initEventHooks=function(){var e=n,t=n.growingIO,r=t.platformConfig,i=t.gioPlatform;n.initOriginalValue(),r.canHook?(n.nativeGrowing(),ae().GioApp=G((function(){return null!==App&&void 0!==App?App:n.originalApp})),ae().GioPage=G((function(){return null!==Page&&void 0!==Page?Page:n.originalPage})),ae().GioComponent=G((function(){return null!==Component&&void 0!==Component?Component:n.originalComponent})),ae().GioBehavior=G((function(){return null!==Behavior&&void 0!==Behavior?Behavior:n.originalBehavior}))):"quickapp"===i&&(ae().GioApp=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.appOverriding(t[0])},ae().GioPage=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.pageOverriding(t[0])},ae().GioComponent=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.pageOverriding(t[0])})};var r=null===(t=this.growingIO)||void 0===t?void 0:t.platformConfig;this.defAppCbs={},this.defPageCbs={},this.appHandlers=r.appHandlers,this.pageHandlers=r.pageHandlers,this.shareEventTypes=r.shareEventTypes,this.actionEventTypes=r.actionEventTypes,this.appEffects=new Le(this.growingIO),this.pageEffects=new Re(this.growingIO),this.currentPage=new He(this.growingIO)},Fe=function(){function e(e){var t,n,r=this;this.growingIO=e,this.ALLOW_SETTING_KEYS=N(he),this.getStorageKey=function(e,t){var n=r.growingIO.inPlugin;return"".concat(e===r.growingIO.trackingId?"":e).concat(_e[n?"plugin_"+t:t])},this.getGsid=function(e){var t=Number(r._gsid[e]);return Number.isNaN(t)||t>=1e9||1>t?(r.setGsid(e,1),1):t},this.setGsid=function(e,t){var n=Number(t);(Number.isNaN(n)||n>=1e9||1>n)&&(n=1),r._gsid[e]=n,10>r._gsid[e]-r._stid[e]||r.saveStorageInfo()},this.initStorageInfo=function(e){var t=r.growingIO.minipInstance,n=t.getStorageSync(r.getStorageKey(e,"gsid")),i=Number(n);(Number.isNaN(i)||i>=1e9||1>i)&&(i=1),r._gsid[e]=i,r._stid[e]=i,i!==n&&t.setStorageSync(r.getStorageKey(e,"gsid"),i)},this.saveStorageInfo=function(){var e=r.growingIO.minipInstance;r._stid=c({},r._gsid),ce(e,r.initializedTrackingIds.map((function(e){return{key:r.getStorageKey(e,"gsid"),value:r._gsid[e]}})))},this.setOriginalSource=function(e,t){r.growingIO.minipInstance.setStorageSync(r.getStorageKey(e,"originalSource"),JSON.stringify(t))},this.getOriginalSource=function(e){var t,n=r.growingIO.minipInstance;return null!==(t=G((function(){return JSON.parse(n.getStorageSync(r.getStorageKey(e,"originalSource")))})))&&void 0!==t?t:{}},this.getTrackerVds=function(e){return r.growingIO.trackingId===e?c({},r.growingIO.vdsConfig):void 0},this.initTrackerOptions=function(e){var t=r.initOptions(e);return t.trackingId=e.trackingId,r.growingIO.trackingId=e.trackingId,r.growingIO.vdsConfig=t,t},this.initTrackerHooker=function(e){var t,n,i=r.growingIO,o=i.platformConfig,a=i.inPlugin,u=i.minipInstance,s=i.plugins,c=e.uniVue,l=e.taro;c||l||"quickapp"===u.platform||(o.canHook=!0),!a||["tbp","jdp"].includes(u.platform)?r.eventHooks.initEventHooks():r.eventHooks.initOriginalValue(),c&&(null===(t=null==s?void 0:s.gioUniAppAdapter)||void 0===t||t.main()),l&&(null===(n=null==s?void 0:s.gioTaroAdapter)||void 0===n||n.main())},this.initOptions=function(e){var t,n,i,o,a,u,s=e.projectId,l=e.dataSourceId,g=e.appId,d=e.trackingId,f={};return r.ALLOW_SETTING_KEYS.forEach((function(t){var n=he[t].type;(S(n)?n.includes(B(e[t])):B(e[t])===he[t].type)?"ignoreFields"===t?f.ignoreFields=e.ignoreFields.filter((function(e){return we.includes(e)})):"extraParams"===t?f.extraParams=e.extraParams.filter((function(e){return Oe.includes(e)})):(f[t]=e[t],["dataCollect","autotrack"].includes(t)&&!f[t]&&V("已关闭".concat(ye[t]),"info")):f[t]=he[t].default})),f.uploadInterval=Math.round(f.uploadInterval),(Number.isNaN(f.uploadInterval)||0>f.uploadInterval||f.uploadInterval>3e3)&&(f.uploadInterval=1e3),f.enableIdMapping&&!f.idMapping&&(f.idMapping=!0,f.idMapping||r.growingIO.userStore.setUserKey(d,"")),L(f,"enableIdMapping"),f.pluginMode&&(r.growingIO.inPlugin=!0),!isNaN(Number(f.requestTimeout))&&f.requestTimeout>0||(f.requestTimeout=5e3),(0>f.impressionScale||f.impressionScale>1)&&(f.impressionScale=0),(0>f.keepAlive||f.keepAlive>1440)&&(f.keepAlive=5),(1>f.sessionExpires||f.sessionExpires>1440)&&(f.sessionExpires=-1),c(c({},f),{projectId:s,dataSourceId:l,appId:g,trackingId:d,performance:{monitor:null===(n=null===(t=f.performance)||void 0===t?void 0:t.monitor)||void 0===n||n,exception:null===(o=null===(i=f.performance)||void 0===i?void 0:i.exception)||void 0===o||o,network:null!==(u=null===(a=f.performance)||void 0===a?void 0:a.network)&&void 0!==u&&u}})},this.setOption=function(e,t,n){var i,o,a=r.growingIO,u=a.userStore,s=a.emitter,l=r.getTrackerVds(e),g=v(t)&&r.ALLOW_SETTING_KEYS.includes(t),d=g&&typeof n===(null===(o=he[t])||void 0===o?void 0:o.type);if(g&&d){var f=c({},l);return r.updateVdsConfig(e,c(c({},l),((i={})[t]=n,i))),"dataCollect"===t&&f.dataCollect!==n&&n&&u.setSessionId(e),s.emit(qe,{optionName:t,optionValue:n}),!0}return M("setOption > ".concat(t)),!1},this.getOption=function(e,t){var n=r.getTrackerVds(e);return t&&q(r.growingIO.vdsConfig,t)?q(n,t)?n[t]:r.growingIO.vdsConfig[t]:R(t)?n:void M("getOption > ".concat(t))},this.updateVdsConfig=function(e,t){e===r.growingIO.trackingId?(r.growingIO.vdsConfig=c(c({},r.growingIO.vdsConfig),t),ae().vdsConfig=r.growingIO.vdsConfig):(r.growingIO.subInstance[e]=c(c({},r.growingIO.subInstance[e]),t),ae().vdsConfig.subInstance[e]=r.growingIO.subInstance[e])},this.toggleShareOut=function(e){m(e)?r.shareOut=e:r.shareOut=!r.shareOut},this.sendVisit=function(e,t){r.eventHooks.appEffects.buildVisitEvent(e,t)},this.sendPage=function(e,t){r.eventHooks.pageEffects.buildPageEvent(e,t)},this.eventConverter=function(e){var t=r.growingIO,n=t.dataStore,i=t.uploader;if(r.getTrackerVds(e.trackingId).dataCollect){["LOGIN_USER_ATTRIBUTES","APP_CLOSED"].includes(e.eventType)||(e.eventSequenceId=n.getGsid(e.trackingId),n.setGsid(e.trackingId,e.eventSequenceId+1));var o={};U(e,(function(e,t){var n;if("element"===t){var r=null!==(n=O(e))&&void 0!==n?n:{};U(r,(function(e,t){R(e)&&0!==e||(o[t]=e)}))}else R(e)&&0!==e||(o[t]=e)})),r.growingIO.emitter.emit(be,{composedEvent:o}),i.commitRequest(c(c({},o),{requestId:J()}))}},this.eventRefactor=function(e){var t,n,i=c(c({},e),r.eventContextBuilder(e.trackingId,{path:e.path,query:e.query,timestamp:e.timestamp}));return i.attributes=c(c({},null!==(t=i.attributes)&&void 0!==t?t:{}),null!==(n=e.attributes)&&void 0!==n?n:{}),i},this.eventInterceptor=function(e){var t=r.growingIO.minipInstance,n=t.systemInfo,i=t.network;R(n)||R(i)?r.interceptEvents.push(e):R(r.interceptEvents)?r.eventConverter(e):(d(d([],r.interceptEvents,!0),[e],!1).forEach((function(e){r.eventConverter(r.eventRefactor(e))})),r.interceptEvents=[])},this.eventReleaseInspector=function(){var e=r.growingIO.minipInstance,t=e.systemInfo,n=e.network;t&&n&&!R(r.interceptEvents)&&(d([],r.interceptEvents,!0).forEach((function(e){r.eventConverter(r.eventRefactor(e))})),r.interceptEvents=[])},this.buildAppMessageEvent=function(e,t){var n,i,o,a=t[0];2>t.length?1===t.length&&(o=a):o=t[1];var u=r.growingIO.dataStore,s=u.eventContextBuilder,l=u.eventInterceptor,g=((null==o?void 0:o.path)||"").split("?"),d=c({eventType:"CUSTOM",eventName:"$mp_on_share"},s(e));d.attributes=ue(c(c(c({},null!==(n=d.attributes)&&void 0!==n?n:{}),{$from:null==a?void 0:a.from,$target:null===(i=null==a?void 0:a.target)||void 0===i?void 0:i.id,$share_title:null==o?void 0:o.title,$share_path:O(g),$share_query:g[1]}),null==o?void 0:o.attributes)),l(d)},this.buildTimelineEvent=function(e,t){var n,i,o,a=t[0];2>t.length?1===t.length&&(o=a):o=t[1];var u=r.growingIO.dataStore,s=u.eventContextBuilder,l=u.eventInterceptor,g=((null==o?void 0:o.path)||"").split("?"),d=c({eventType:"CUSTOM",eventName:"$mp_share_timeline"},s(e));d.attributes=ue(c(c(c({},null!==(n=d.attributes)&&void 0!==n?n:{}),{$target:null===(i=null==a?void 0:a.target)||void 0===i?void 0:i.id,$share_title:null==o?void 0:o.title,$share_path:O(g),$share_query:g[1]}),null==o?void 0:o.attributes)),l(d)},this.buildAddFavorites=function(e,t){var n,i,o=t[0];2>t.length?1===t.length&&(i=o):i=t[1];var a=r.growingIO.dataStore,u=a.eventContextBuilder,s=a.eventInterceptor,l=((null==i?void 0:i.path)||"").split("?"),g=c({eventType:"CUSTOM",eventName:"$mp_add_favorites"},u(e));g.attributes=ue(c(c({},null!==(n=g.attributes)&&void 0!==n?n:{}),{$share_title:null==i?void 0:i.title,$share_path:O(l),$share_query:l[1]})),s(g)},this.trackersExecute=function(e){r.initializedTrackingIds.forEach((function(t){"function"===B(e)&&e(t)}))},this.initializedTrackingIds=[],this.eventContextBuilder=new Ke(this.growingIO).main,this.eventHooks=new Be(this.growingIO),this.shareOut=!1,this._gsid={},this._stid={},this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.generalProps={},this.trackTimers={},this.interceptEvents=[];var i=this.growingIO,o=i.emitter,a=i.minipInstance;o.on(Ue,(function(e){var t=e.trackingId;r.initializedTrackingIds.push(t),r.initStorageInfo(t)})),o.on(ke,(function(e){var t=e.eventData,n=e.trackingId;"VISIT"===t.eventType&&(r.lastVisitEvent[n]=t),"PAGE"===t.eventType&&(r.lastPageEvent[n]=t)})),y(null===(t=a.minip)||void 0===t?void 0:t.onAppHide)&&a.minip.onAppHide((function(){r.trackersExecute((function(e){var t=r.trackTimers[e];U(t,(function(e){e.start&&(e.leng=e.leng+(+Date.now()-e.start))}))}))})),y(null===(n=a.minip)||void 0===n?void 0:n.onAppShow)&&a.minip.onAppShow((function(){r.trackersExecute((function(e){var t=r.trackTimers[e];U(t,(function(e){e.start&&(e.start=+Date.now())}))}))})),o.on(qe,(function(e){var t=e.optionName,n=e.optionValue;"dataCollect"===t&&!1===n&&r.trackersExecute((function(e){r.growingIO.clearTrackTimer(e)}))})),this.growingIO.emitter.on(De,(function(e){var t=e.oldSessionId,n=e.trackingId;if(t){var i=r.eventHooks.currentPage,o=i.getPagePath,a=i.getPageQuery,u=o(),s=a();if(u)r.sendVisit(n,{path:u,query:s});else{var c=r.lastPageEvent[n];r.sendVisit(n,{path:c.path,query:c.query})}r.eventHooks.currentPage.lifeBeforeShow||r.sendPage(n)}}))}return Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},set:function(e){var t=this._scene;this._scene=e,t!==this._scene&&this.growingIO.emitter.emit("SCENE_UPDATE",{newScene:e,oldScene:t})},enumerable:!1,configurable:!0}),e}(),je={name:"QuickApp",platform:"quickapp",scnPrefix:"quickapp_",appHandlers:["onCreate","onShow","onHide","onDestroy","onError"],pageHandlers:["onInit","onReady","onShow","onHide","onDestroy","onMenuPress","onShareAppMessage"],actionEventTypes:["click","longpress","blur","change"],canHook:!1,hooks:{App:!1,Page:!1,Component:!1,Behavior:!1},listeners:{app:{appCreate:"onCreate",appShow:"onShow",appHide:"onHide",appClose:"onDestroy"},page:{pageLoad:"onInit",pageReady:"onReady",pageShow:"onShow",pageHide:"onHide",pageClose:"onDestroy",menuPress:"onMenuPress",tabTap:void 0,shareApp:"onShareAppMessage"},actions:{click:["click","longpress"],change:["blur","change"],submit:[]}}},Ve=function(d){function f(s){var f=d.call(this,s)||this;return f.growingIO=s,f.getAppSource=function(){var t=e.getInfo().source;return f.appSource=t||{},f.appSource},f.navigateTo=function(){},f.switchTab=function(){},f.navigateToMiniProgram=function(){},f.onAppShow=function(){},f.onAppHide=function(){},f.getImageInfo=function(e){var t=e.src,n=e.success,i=e.fail,o=e.complete;return null==r?void 0:r.getImageInfo({uri:t,success:n,fail:i,complete:o})},f.initImpression=function(){},f.initShareAppMessage=function(e){var t=e.platformConfig;try{f.growingIO.shareAppMessage=function(){var n,r=arguments[0];null==a||a.share(r),null===(n=null==e?void 0:e.eventTracking)||void 0===n||n.pageEffects(this,t.listeners.page.shareApp,arguments)}}catch(e){}},f.getCurrentPage=function(){return G((function(){if(null==o?void 0:o.getPages)return _(null==o?void 0:o.getPages())||{}})),{}},f.getCurrentPath=function(){return G((function(){var e;if(null==o?void 0:o.getState)return(null===(e=null==o?void 0:o.getState())||void 0===e?void 0:e.path)||""})),""},f.getPageTitle=function(e){var t,n,r,i,a,u="";try{if(!(u=v(null==e?void 0:e.gioPageTitle)?null==e?void 0:e.gioPageTitle:"")){var s=null!==(a=null===(i=null===(r=null===(n=null===(t=null==e?void 0:e.$app)||void 0===t?void 0:t.$def)||void 0===n?void 0:n.manifast)||void 0===r?void 0:r.display)||void 0===i?void 0:i.pages)&&void 0!==a?a:{},c=null==s?void 0:s[e.route];c&&(u=c.titleBarText)}if(!u){var l=null==o?void 0:o.getState();u=(null==l?void 0:l.name)||""}}catch(e){return""}return $(u)},f.getStorageSync=function(){return""},f.getStorage=function(e){return l(f,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){null==u||u.get({key:e,success:function(e){return t(e)},fail:function(){return t(null)}})}))];case 1:return[2,t.sent()]}}))}))},f.setStorageSync=function(){},f.setStorage=function(e,t){},f.removeStorageSync=function(){},f.removeStorage=function(e){null==u||u.delete({key:e})},f.getNetworkType=function(){return l(f,void 0,void 0,(function(){var e;return g(this,(function(t){switch(t.label){case 0:return e=this,[4,new Promise((function(t){null==i||i.getType({success:function(n){e.network=n,t(n)},fail:function(){return t(null)}})}))];case 1:return[2,t.sent()]}}))}))},f.request=function(e){var t=e.url,r=e.header,i=e.method,o=e.data,a=e.success,u=e.fail,s=e.complete;return null==n?void 0:n.fetch({url:t,header:r,method:i,data:o,success:a,fail:u,complete:s})},f.getSystemInfo=function(){return l(f,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return e=this,[4,new Promise((function(n){null==t||t.getInfo({success:function(t){var r=c(c({},t),{version:t.platformVersionName,platform:t.osType});e.systemInfo=r,n(r)},fail:function(){return n(null)}})}))];case 1:return[2,n.sent()]}}))}))},f.setNetworkStatusListener=function(){i.subscribe({callback:function(e){e.type&&(f.network.networkType=e.type)}})},f.growingIO.emitter.on(Pe,(function(e){switch(e.event){case"App onCreate":f.getNetworkType().then((function(){var e;return null===(e=f.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()})),f.getSystemInfo().then((function(){var e;return null===(e=f.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()}));break;case"App onCreateEnd":f.setStorage=function(e,t){null==u||u.set({key:e,value:t})}}})),f}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(f,d),f}((function(e){var t=this;this.growingIO=e,this.minip=ne("quickapp"),this.hookSetTitle=function(){var e,n=null===(e=t.minip)||void 0===e?void 0:e.setNavigationBarTitle,r=t;n&&Object.defineProperty(t.minip,"setNavigationBarTitle",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(r.growingIO.gioSDKInitialized){var e=r.getCurrentPath(),t=(arguments[0]||{}).title;r.growingIO.dataStore.eventHooks.currentPage.configuredTitle[e]=t}return n.apply(this,arguments)}})},this.navigateTo=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.navigateTo(e)},this.switchTab=function(e){var n;null===(n=t.minip)||void 0===n||n.switchTab(e)},this.navigateToMiniProgram=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.navigateToMiniProgram(e)},this.getImageInfo=function(e){var n,r=e.src,i=e.success,o=e.fail,a=e.complete;return null===(n=t.minip)||void 0===n?void 0:n.getImageInfo({src:r,success:i,fail:o,complete:a})},this.initImpression=function(e){var n,r;null===(r=null===(n=t.growingIO.plugins)||void 0===n?void 0:n.gioImpressionTracking)||void 0===r||r.main(e,"observeAll")},this.getCurrentPage=function(){return G((function(){return _(getCurrentPages())}))||{}},this.getCurrentPath=function(){var e=t.getCurrentPage();return(null==e?void 0:e.route)||(null==e?void 0:e.uri)||(null==e?void 0:e.__route__)||""},this.getPageTitle=function(e){var n,r,i,o,a,u,s,c,l=oe(),g="",d=re(l);"string"===B(d)&&(d=null!==(n=G((function(){return JSON.parse(d)})))&&void 0!==n?n:{});var f,p=(null==e?void 0:e.data)||e.$data||{};if((g=v(null==p?void 0:p.gioPageTitle)?null==p?void 0:p.gioPageTitle:"")||G((function(){var t,n,r=ie(l);r&&(f=r["".concat(e.route,".json")]||{},g=(null==f?void 0:f.navigationBarTitleText)||(null===(n=null===(t=null==f?void 0:f.mod)||void 0===t?void 0:t.exports)||void 0===n?void 0:n.navigationBarTitleText))})),!g&&d){var h=t.growingIO.dataStore.eventHooks.appEffects.enterParams;if(e.route||R(h)||(e.route=h.path||"",g=e.route?t._getTitleFromTabBar(d,e.route):""),!g&&(f=S(d.pages)?null!==(r=d.pages.find((function(t){return t.path===e.route})))&&void 0!==r?r:{}:d.page||{})){var m=f[e.route]||f["".concat(e.route,".html")]||f;g=(null==m?void 0:m.navigationBarTitleText)||(null===(i=null==m?void 0:m.window)||void 0===i?void 0:i.navigationBarTitleText)}g||(g=t._getTitleFromTabBar(d,e.route))}return g||(g=["wx","tt"].includes(l)?null===(u=null===(a=null===(o=d||global||$global)||void 0===o?void 0:o.global)||void 0===a?void 0:a.window)||void 0===u?void 0:u.navigationBarTitleText:null===(c=null===(s=d||global||$global)||void 0===s?void 0:s.window)||void 0===c?void 0:c.navigationBarTitleText),$(g)},this._getTitleFromTabBar=function(e,t){var n,r,i=null===(r=null===(n=null==e?void 0:e.tabBar)||void 0===n?void 0:n.list)||void 0===r?void 0:r.find((function(e){return e.pagePath===t||e.pagePath==="".concat(t,".html")}));return(null==i?void 0:i.text)||""},this.getStorageSync=function(e){var n,r=null===(n=t.minip)||void 0===n?void 0:n.getStorageSync(e);return I(r)&&r.expiredAt?r.expiredAt<Date.now()?"":r.value:r},this.getStorage=function(e){return new Promise((function(n){var r;null===(r=t.minip)||void 0===r||r.getStorage({key:e,success:function(e){var t=e.data;return n(t)},fail:function(){return n("")}})}))},this.setStorageSync=function(e,n,r){var i;r&&(n={value:n,expiredAt:r}),null===(i=t.minip)||void 0===i||i.setStorageSync(e,n)},this.setStorage=function(e,n){var r;null===(r=t.minip)||void 0===r||r.setStorage({key:e,data:n})},this.removeStorageSync=function(e){var n;null===(n=t.minip)||void 0===n||n.removeStorageSync(e)},this.removeStorage=function(e){var n;null===(n=t.minip)||void 0===n||n.removeStorage(e)},this.getNetworkType=function(){var e=t;return new Promise((function(n){var r;null===(r=t.minip)||void 0===r||r.getNetworkType({success:function(t){e.network=t,n(t)},fail:function(){return n(null)}})}))},this.request=function(e){var n,r=e.url,i=e.data,o=e.header,a=e.timeout,u=e.method,s=e.success,c=e.fail,l=e.complete,g=null===(n=t.minip)||void 0===n?void 0:n.request({url:r,data:i,header:o,timeout:a,method:u,success:s,fail:c,complete:l}),d=setTimeout((function(){(null==g?void 0:g.abort)&&y(null==g?void 0:g.abort)&&(null==g||g.abort()),clearTimeout(d),d=null}),(a||1e4)+10);return g},this.getSystemInfo=function(){var e=t;return new Promise((function(n){var r;null===(r=t.minip)||void 0===r||r.getSystemInfo({success:function(t){e.systemInfo=t,n(t)},fail:function(){return n(null)}})}))},this.getSetting=function(){return new Promise((function(e){var n;null===(n=t.minip)||void 0===n||n.getSetting({success:e,fail:e})}))},this.setNetworkStatusListener=function(){var e;null===(e=t.minip)||void 0===e||e.onNetworkStatusChange((function(e){var n=e.networkType;n&&(t.network.networkType=n)}))};var n=this.growingIO.platformConfig,r=n.platform,i=n.scnPrefix;this.platform=r,this.scnPrefix=i,this.growingIO.emitter.on(Ne,(function(){t.getNetworkType().then((function(){var e;return null===(e=t.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()})),t.getSystemInfo().then((function(){var e;return null===(e=t.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()}))}))})),Me=["gioPerformance"],Ge=function(e){var t,n,r,i,o,a,u=this;this.growingIO=e,this.innerPluginInit=function(){var e;Me.forEach((function(e){var t;return L(null===(t=u.pluginsContext)||void 0===t?void 0:t.plugins,e)})),N(null===(e=u.pluginsContext)||void 0===e?void 0:e.plugins).forEach((function(e){var t,n,r=null!==(n=null===(t=u.pluginsContext)||void 0===t?void 0:t.plugins[e])&&void 0!==n?n:{},i=r.name,o=r.method;b(u.pluginItems,(function(e){return e.name===i}))||u.pluginItems.push({name:C(i||e),method:o||function(e){}})})),R(u.pluginItems)||u.installAll()},this.install=function(e,t,n){var r,i,o=u.growingIO.emitter,a=t||b(u.pluginItems,(function(t){return t.name===e}));if((null===(r=u.growingIO)||void 0===r?void 0:r.plugins)[e])return V("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!a)return V("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return(null===(i=u.growingIO)||void 0===i?void 0:i.plugins)[e]=new a.method(u.growingIO,n),t&&(o.emit(Ce,e),V("加载插件 ".concat(e),"info")),!0}catch(n){return u.lifeError(t,n),V("插件【".concat(e,"】加载异常 ").concat(n),"error"),!1}},this.installAll=function(e){(e||u.pluginItems).forEach((function(t){u.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)&&!b(u.pluginItems,(function(e){return e.name===t.name}))&&u.pluginItems.push({name:C(t.name),method:t.method?t.method:function(){}})}))},this.uninstall=function(e){var t;L(u.pluginItems,e);var n=L(null===(t=u.growingIO)||void 0===t?void 0:t.plugins,e);return n||V("卸载插件 ".concat(e," 失败!"),"error"),n},this.uninstallAll=function(){u.pluginItems.forEach((function(e){return u.uninstall(e.name)}))},this.lifeError=function(e,t){u.growingIO.emitter.emit(Ee,{plugin:e,error:t}),V("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.callLifeCycle=function(e,t){u.pluginItems.forEach((function(n){var r=u.growingIO.plugins[n.name]?u.growingIO.plugins[n.name][e]:void 0;if(r&&y(r))try{r(t)}catch(e){u.lifeError(n,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on(Ce,(function(e){return u.callLifeCycle("onInstall",e)})),null===(n=this.growingIO.emitter)||void 0===n||n.on(Ee,(function(e){return u.callLifeCycle("onError",e)})),null===(r=this.growingIO.emitter)||void 0===r||r.on(Te,(function(e){return u.callLifeCycle("onComposeBefore",e)})),null===(i=this.growingIO.emitter)||void 0===i||i.on(be,(function(e){return u.callLifeCycle("onComposeAfter",e)})),null===(o=this.growingIO.emitter)||void 0===o||o.on(xe,(function(e){return u.callLifeCycle("onSendBefore",e)})),null===(a=this.growingIO.emitter)||void 0===a||a.on(Ae,(function(e){return u.callLifeCycle("onSendAfter",e)}))},Qe={},$e={}.hasOwnProperty;function ze(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function We(e){try{return encodeURIComponent(e)}catch(e){return null}}Qe.stringify=function(e,t){t=t||"";var n,r,i=[];for(r in"string"!=typeof t&&(t="?"),e)if($e.call(e,r)){if((n=e[r])||null!=n&&!isNaN(n)||(n=""),r=We(r),n=We(n),null===r||null===n)continue;i.push(r+"="+n)}return i.length?t+i.join("&"):""},Qe.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var i=ze(t[1]),o=ze(t[2]);null===i||null===o||i in r||(r[i]=o)}return r};var Je=function(e){var t=this;this.growingIO=e,this.generateURL=function(e){var n=t.growingIO.dataStore.getTrackerVds(e),r=n.serverUrl,i=n.projectId;return A(r,"http")?"".concat(r,"/v3/projects/").concat(i,"/collect"):"https://".concat(r,"/v3/projects/").concat(i,"/collect")},this.getHoardingQueue=function(e){var n;return null!==(n=t.hoardingQueue[e])&&void 0!==n?n:[]},this.getRequestQueue=function(e){var n;return null!==(n=t.requestQueue[e])&&void 0!==n?n:[]},this.commitRequest=function(e){var n,r,i=c({},e),o=t.growingIO,a=o.vdsConfig;o.emitter.emit(ke,{eventData:e,trackingId:e.trackingId}),a.forceLogin?(p(t.hoardingQueue[e.trackingId])&&(t.hoardingQueue[e.trackingId]=[]),null===(n=t.hoardingQueue[e.trackingId])||void 0===n||n.push(i)):(p(t.requestQueue[e.trackingId])&&(t.requestQueue[e.trackingId]=[]),null===(r=t.requestQueue[e.trackingId])||void 0===r||r.push(i),t.initiateRequest(e.trackingId))},this.initiateRequest=function(e,n){var r=t.growingIO,i=r.plugins,o=r.vdsConfig,a=r.minipInstance,u=r.dataStore,s=t.getHoardingQueue(e),c=t.getRequestQueue(e),l=d(d([],s,!0),c,!0),g=function(e){var r,s;if(null===(r=null==o?void 0:o.tbConfig)||void 0===r?void 0:r.cloudFuncSend)null===(s=null==i?void 0:i.gioTaobaoAdapter)||void 0===s||s.singleInvoke(e);else if(n)t.batchInvoke(e);else{var c=t.growingIO.dataStore.getTrackerVds(e).uploadInterval;H(t.batchInvoke,c,!1,!1)(e)}l.some((function(e){return"VISIT"===e.eventType}))&&a.removeStorageSync(u.getStorageKey(e,"originalSource"))};if(l.length>0)if(t.requestingNum<t.requestLimit)g(e);else var f=setInterval((function(){t.requestingNum<t.requestLimit&&(g(e),clearInterval(f),f=void 0)}),500)},this.batchInvoke=function(e){var n=t.growingIO,r=n.vdsConfig,i=n.emitter,o=t.getHoardingQueue(e),a=t.getRequestQueue(e),u=d(d([],o,!0),a,!0);u.length>50?(u=u.slice(0,50),o.length>50?t.hoardingQueue[e]=o.slice(50):(t.requestQueue[e]=a.slice(50-o.length),t.hoardingQueue[e]=[])):(t.hoardingQueue[e]=[],t.requestQueue[e]=[]);var s=u.filter((function(e){return(t.retryIds[e.requestId]||0)<=t.retryLimit}));if(!R(s)){var l=s.map((function(e){var t=c({},e);return L(t,["requestId","trackingId"]),t}));r.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(l,null,2)),i.emit(xe,{eventsQueue:s,requestData:l,trackingId:e})}},this.sendEvent=function(e,n){var r,i=O(e).trackingId,o=t.growingIO,a=o.minipInstance,u=o.dataStore,s=o.emitter,c=o.plugins,l=u.getTrackerVds(i),g=l.compress,f=l.requestTimeout;t.requestingNum+=1;var p={"content-type":"jdp"===a.platform?"application/json":"application/json;charset=UTF-8"},v=d([],n,!0),h=!!g&&(null===(r=null==c?void 0:c.gioCompress)||void 0===r?void 0:r.compressToUTF16);h&&(v=c.gioCompress.compressToUTF16(JSON.stringify(n)),p["X-Compress-Codec"]="1");var m=t.generateURL(i);a.request({url:"".concat(m,"?stm=").concat(Date.now(),"&compress=").concat(h?"1":"0"),header:p,method:"POST",data:v,timeout:f,fail:function(r){[200,204].includes(r.code)||(e.forEach((function(e){t.requestFailFn(e)})),V("请求失败!".concat(JSON.stringify(r)),"error"),s.emit("ON_SEND_ERROR",{eventsQueue:e,requestData:n,trackingId:i}))},complete:function(e){t.requestingNum-=1,s.emit(Ae,{result:e,requestData:n,trackingId:i}),t.initiateRequest(i)}})},this.requestFailFn=function(e){if(t.retryIds[e.requestId]||(t.retryIds[e.requestId]=0),t.retryIds[e.requestId]+=1,!t.requestQueue[e.trackingId].some((function(t){return t.requestId===e.requestId})))var n=setTimeout((function(){R(t.requestQueue[e.trackingId])?(t.requestQueue[e.trackingId].push(e),t.initiateRequest(e.trackingId)):t.requestQueue[e.trackingId].push(e),clearTimeout(n),n=null}),800)},this.hoardingQueue={},this.requestQueue={},this.requestLimit=3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.growingIO.emitter.on(xe,(function(e){var n,r,i=e.eventsQueue,o=e.requestData,a=e.trackingId,u=t.growingIO,s=u.vdsConfig,c=u.plugins;a===t.growingIO.trackingId&&((null===(n=null==s?void 0:s.tbConfig)||void 0===n?void 0:n.cloudAppId)?null===(r=null==c?void 0:c.gioTaobaoAdapter)||void 0===r||r.tbCloudAppInvoke(i,o):t.sendEvent(i,o))}))},Ye=function(e){var t=this;this.growingIO=e,this._getUidKey=function(){return t.growingIO.inPlugin?"_growing_plugin_uid_":"_growing_uid_"},this.getUid=function(){var e=t.growingIO.minipInstance;return t._uid||(t._uid=e.getStorageSync(t._getUidKey())),t._uid||t.setUid(J()),t._uid},this.setUid=function(e){var n=t._uid;t._uid=e,n!==t._uid&&(t.growingIO.minipInstance.setStorage(t._getUidKey(),t._uid),t.growingIO.emitter.emit("UID_UPDATE",{newUId:e,oldUId:n}))},this.getSessionId=function(e){var n=t.growingIO,r=n.vdsConfig.sessionExpires,i=n.dataStore.trackersExecute;return t._sessionId[e]||t.setSessionId(e),r>-1&&(Date.now()>t._sessionExpires&&i((function(e){t.setSessionId(e)})),t._sessionExpires=Date.now()+6e4*r),t._sessionId[e]},this.setSessionId=function(e,n){var r=t._sessionId[e];n||(n=J()),t._sessionId[e]=n;var i=t.growingIO.vdsConfig.sessionExpires;i>-1&&(t._sessionExpires=Date.now()+6e4*i),r!==n&&t.growingIO.emitter.emit(De,{trackingId:e,newSessionId:n,oldSessionId:r})},this._getUserIdKey=function(e){return t.growingIO.dataStore.getStorageKey(e,"userId")},this.getUserId=function(e){var n=t.growingIO.minipInstance;return t._userId[e]||(t._userId[e]=n.getStorageSync(t._getUserIdKey(e))),t._userId[e]},this.setUserId=function(e,n){var r=t._userId[e];t._userId[e]=p(n)?"":n,r!==t._userId[e]&&(t.growingIO.minipInstance.setStorage(t._getUserIdKey(e),t._userId[e]),t.growingIO.emitter.emit("USERID_UPDATE",{newUserId:n,oldUserId:r})),n&&t.setGioId(e,n)},this._getUserKeyKey=function(e){return t.growingIO.dataStore.getStorageKey(e,"userKey")},this.getUserKey=function(e){var n=t.growingIO.minipInstance;return t._userKey[e]||(t._userKey[e]=n.getStorageSync(t._getUserKeyKey(e))),t._userKey[e]},this.setUserKey=function(e,n){var r=t._userKey[e];t._userKey[e]=p(n)?"":n,r!==t._userKey[e]&&(t.growingIO.minipInstance.setStorage(t._getUserKeyKey(e),t._userKey[e]),t.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:n,oldUserKey:r}))},this._getGioIdKey=function(e){return t.growingIO.dataStore.getStorageKey(e,"gioId")},this.getGioId=function(e){var n=t.growingIO.minipInstance;return t._gioId[e]||(t._gioId[e]=n.getStorageSync(t._getGioIdKey(e))),t._gioId[e]},this.setGioId=function(e,n){var r=t._gioId[e];t._gioId[e]=p(n)?"":n,r!==t._gioId[e]&&(t.growingIO.minipInstance.setStorage(t._getGioIdKey(e),t._gioId[e]),t.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:n,oldGioId:r}))},this.initUserInfo=function(e){var n,r=t.growingIO.minipInstance,i=[t._getUidKey(),t._getUserIdKey(e),t._getUserKeyKey(e),t._getGioIdKey(e)],o=null!==(n=se(r,i))&&void 0!==n?n:[];["_uid","_userId","_userKey","_gioId"].forEach((function(n,r){"_uid"===n?t.getUid():t[n][e]=o[r]}))},this.saveUserInfo=function(){var e=t.growingIO,n=e.minipInstance;(0,e.dataStore.trackersExecute)((function(e){ce(n,[{key:t._getUidKey(),value:t._uid},{key:t._getUserIdKey(e),value:t._userId[e]},{key:t._getUserKeyKey(e),value:t._userKey[e]},{key:t._getGioIdKey(e),value:t._gioId[e]}])}))},this._uid=void 0,this._sessionId={},this._userId={},this._userKey={},this._gioId={},this._sessionExpires=-1},Ze=new function(){var e,t=this;this.init=function(e){var n;t.emitter.emit("ON_SDK_INITIALIZE_BEFORE",{options:e});try{if(V("Gio小程序SDK 初始化中...","info"),e.trackingId&&t.dataStore.initializedTrackingIds.includes(e.trackingId))throw Error("已存在实例 ".concat(e.trackingId,"，请勿重复初始化!"));if(t.trackingId&&!t.plugins.gioMultipleInstances)throw Error("您正在尝试初始化另一个实例，请集成多实例插件后重试!");var r=t.dataStore.initTrackerOptions(e);return null===(n=t.emitter)||void 0===n||n.emit(Ne,r),t.gioSDKInitialized=!0,t.dataStore.initTrackerHooker(r),"quickapp"!==t.gioPlatform&&t.userStore.initUserInfo(e.trackingId),t.emitter.emit(Ue,r),t.trackingId&&t.trackingId!==e.trackingId||(ae().__gio__=function(){return t}),V("Gio小程序SDK 初始化完成！","success"),t.inPlugin&&"tbp"!==t.minipInstance.platform&&t.dataStore.sendVisit(r.trackingId),t.vdsConfig.forceLogin&&V("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),!0}catch(e){return V(e,"error"),!1}},this.handlerDistribute=function(e,n,r){var i=t.dataStore,o=i.initializedTrackingIds;if((0,i.getTrackerVds)(e)&&o.includes(e))return t[n].apply(t,d([e],r,!1));V("不存在实例：".concat(e,"，请检查!"),"warn")},this.registerPlugins=function(e){t.plugins.pluginItems=d(d([],t.plugins.pluginItems,!0),e,!0),t.plugins.installAll(e)},this.getPlugins=function(){return t.plugins.pluginItems},this.getDeviceId=function(){return t.userStore.getUid()},this.getOption=function(e,n){return t.dataStore.getOption(e,n)},this.setOption=function(e,n,r){var i;return N(ye).includes(n)?typeof r===(null===(i=he[n])||void 0===i?void 0:i.type)?(t.dataStore.setOption(e,n,r),V("已修改".concat(ye[n],": ").concat(r),"info"),!0):(V("参数格式不正确：".concat(r,"，请检查后重试!"),"error"),!1):(V("不存在可修改的配置项：".concat(n,"，请检查后重试!"),"error"),!1)},this.setPageAttributes=function(e,n){if(I(n)&&!R(n)){var r=t.dataStore.eventHooks.currentPage,i=r.getPagePath();return R(r.pageProps[e])&&(r.pageProps[e]={}),R(r.pageProps[e][i])&&(r.pageProps[e][i]={}),R(n)||U(n,(function(t,n){y(r.pageProps[e][i][n])&&!y(t)||(r.pageProps[e][i][n]=t)})),!0}return M("setPageAttributes"),!1},this.clearPageAttributes=function(e,n){try{if(!R(t.dataStore.eventHooks.currentPage.pageProps[e])){var r=t.dataStore.eventHooks.currentPage,i=r.getPagePath();S(n)&&!R(n)?n.forEach((function(t){L(r.pageProps[e][i],t)})):r.pageProps[e][i]={}}}catch(e){return M("clearPageAttributes"),!1}},this.sendPage=function(e,n){t.dataStore.getTrackerVds(e).trackPage?V("仅在关闭trackPage时允许调用sendPage，请确认后修改初始化配置项!","error"):t.dataStore.sendPage(e,n)},this.identify=function(e,n){if(e===t.trackingId)if(t.vdsConfig.forceLogin){if(!ve(n))return void M("identify");var r=T(n).slice(0,1e3);t.userStore.setUid(r),t.dataStore.setOption(t.trackingId,"forceLogin",!1),t._identified=!0,t.dataStore.trackersExecute((function(e){var n=t.uploader.getHoardingQueue(e);n.forEach((function(e,t){return n[t].deviceId=r})),t.uploader.initiateRequest(e,!0)}))}else t._identified?M("identify",!1,"请勿重复调用"):M("identify",!1,"forceLogin未开启");else M("identify",!1,"子实例不允许调用identify")},this.setUserAttributes=function(e,n){var r,i,o,a;if(I(n)&&!R(n)){var u=t.dataStore,s=u.eventContextBuilder,l=u.eventInterceptor,g=u.lastVisitEvent,d=c({eventType:"LOGIN_USER_ATTRIBUTES"},s(e));d.attributes=ue(c(c({},null!==(r=d.attributes)&&void 0!==r?r:{}),W(n))),d.path||(d.path=null===(i=g[e])||void 0===i?void 0:i.path,d.query=null===(o=g[e])||void 0===o?void 0:o.query,d.title=null===(a=g[e])||void 0===a?void 0:a.title),l(d)}else M("setUserAttributes")},this.setUserId=function(e,n,r){if(ve(n)){var i=t.userStore.getGioId(e);n=T(n).slice(0,1e3),r=T(r).slice(0,1e3),t.userStore.setUserId(e,n);var o=!p(r)&&T(r).length>0?T(r).slice(0,1e3):"";t.userStore.setUserKey(e,o),!t.dataStore.getTrackerVds(e).idMapping&&o&&V("您设置了 userKey ，请初始化开启 idMapping!","warn"),i&&i!==n&&t.userStore.setSessionId(e)}else M("setUserId")},this.clearUserId=function(e){t.userStore.setUserId(e,void 0),t.userStore.setUserKey(e,void 0)},this.setGeneralProps=function(e,n){return I(n)&&!R(n)?(R(t.dataStore.generalProps[e])&&(t.dataStore.generalProps[e]={}),U(n,(function(n,r){y(t.dataStore.generalProps[e][r])&&!y(n)||(t.dataStore.generalProps[e][r]=n)})),!0):(M("setGeneralProps"),!1)},this.clearGeneralProps=function(e,n){try{R(t.dataStore.generalProps[e])||(S(n)&&!R(n)?n.forEach((function(n){L(t.dataStore.generalProps[e],n)})):t.dataStore.generalProps[e]={})}catch(e){return M("clearGeneralProps"),!1}},this.track=function(e,n,r){z(n,(function(){var i,o=t.dataStore,a=o.eventContextBuilder,u=o.eventInterceptor,s=c({eventType:"CUSTOM",eventName:n},a(e));s.attributes=ue(c(c({},null!==(i=s.attributes)&&void 0!==i?i:{}),W(c({},I(r)&&!R(r)?r:{})))),t.plugins.gioMultipleInstances&&r&&r["&&sendTo"]&&(s["&&sendTo"]=r["&&sendTo"]),u(s)}))},this.trackTimerStart=function(e,n){return t.dataStore.getTrackerVds(e).dataCollect?z(n,(function(){var r=J();return t.dataStore.trackTimers[e]||(t.dataStore.trackTimers[e]={}),t.dataStore.trackTimers[e][r]={eventName:n,leng:0,start:+Date.now()},r})):(V("指定实例未开启数据采集，请检查!","error"),!1)},this.trackTimerPause=function(e,n){var r=t.dataStore.trackTimers[e];if(n&&r&&r[n]){var i=r[n];return i.start&&(i.leng=i.leng+(+Date.now()-i.start)),i.start=0,!0}return!1},this.trackTimerResume=function(e,n){var r=t.dataStore.trackTimers[e];if(n&&r&&r[n]){var i=r[n];return 0===i.start&&(i.start=+Date.now()),!0}return!1},this.trackTimerEnd=function(e,n,r){var i,o=t.dataStore.getTrackerVds(e).dataCollect,a=t.dataStore.trackTimers[e];if(n&&a&&a[n]){if(o){var u=a[n];if(0!==u.start){var s=+Date.now()-u.start;u.leng=s>0?u.leng+s:0}var l=t.dataStore,g=l.eventContextBuilder,d=l.eventInterceptor,f=c({eventType:"CUSTOM",eventName:u.eventName},g(e));return f.attributes=ue(c(c({},null!==(i=f.attributes)&&void 0!==i?i:{}),W(c(c({},I(r)&&!R(r)?r:{}),{event_duration:u.leng>864e5?0:u.leng/1e3})))),t.plugins.gioMultipleInstances&&r&&r["&&sendTo"]&&(f["&&sendTo"]=r["&&sendTo"]),d(f),!0}return V("指定实例未开启数据采集，计时器已移除，请检查!","error"),!1}return V("未查询到指定计时器，请检查!","error"),!1},this.removeTimer=function(e,n){var r=t.dataStore.trackTimers[e];return n&&r&&r[n]?(delete r[n],!0):(V("未查询到指定计时器，请检查!","error"),!1)},this.clearTrackTimer=function(e){t.dataStore.trackTimers[e]={}},this.setLocation=function(e,n,r){R(t.dataStore.locationData[e])&&(t.dataStore.locationData[e]={});var i=t.dataStore.locationData[e],o=function(e){return e>=-180&&180>=e};o(n)&&o(r)&&(i.latitude!==n||i.longitude!==r)&&(t.dataStore.locationData[e]={latitude:n,longitude:r})},this.updateImpression=function(){V("updateImpression 错误! 请集成半自动埋点浏览插件后重试!","error")},this.getABTest=function(e,t,n){V("获取ABTest数据错误! 请集成ABTest插件后重试!","error"),Q(n,{})},this.getGioInfo=function(e){var n,r,i=t.userStore,o=i.getUid,a=i.getUserId,u=i.getUserKey,s=i.getSessionId,c=t.dataStore.getTrackerVds(e),l=c.projectId,g=c.appId,d=c.dataSourceId,f=c.dataCollect,p=c.idMapping,v=c.extraParams,h=c.ignoreFields,m={gioappid:g,giocs1:a(e)||"",gioplatform:t.platformConfig.platform,gioprojectid:l,gios:s(e),giou:o()};if(m.giodatacollect=f,m.giodatasourceid=d,p&&(m.giouserkey=u(e)),R(v)||v.forEach((function(n){var r;h.includes(n)||(m["gio".concat(n)]=(null!==(r=t.dataStore.lastVisitEvent[e])&&void 0!==r?r:{})[n])})),e===t.trackingId){var I=null!==(r=null===(n=t.plugins)||void 0===n?void 0:n.gioEventAutoTracking)&&void 0!==r?r:{},y=I.circleServerUrl,S=I.circleOpen;if(y&&S){var w=ge(y.split("?")[1]);w.roomId&&(m.giocircleroomid=w.roomId)}}return Qe.stringify(m)},this.utils=c(c(c({},j),pe),{qs:Qe}),this.emitter={all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map((function(e){e(n)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,n)}))}},this.gioPlatform="quickapp",this.gioFramework="native",this.sdkVersion="4.4.0";try{"quickapp"===this.gioPlatform||y(getApp)&&y(App)?this.inPlugin=!1:this.inPlugin=!0}catch(e){this.inPlugin=!0}this.inPlugin&&V("未检测到小程序实例，自动切换为插件模式!","info"),this.platformConfig=je,this.minipInstance=new Ve(this),this.dataStore=new Fe(this),this.userStore=new Ye(this),this.uploader=new Je(this),this.plugins=new Ge(this),this.plugins.innerPluginInit()},Xe=function(){var e,t=arguments[0],n="g0",r=t;if(t.indexOf(".")>-1&&(n=null!==(e=t.split(".")[0])&&void 0!==e?e:"g0",r=t.split(".")[1]),v(r)&&Ie.includes(r)&&Ze[r]){var i=P(Array.from(arguments));if("init"===r){var o=function(e,t){var n=T(t[0]),r=T(t[1]),i=(4===t.length?t[3]:t[2])||{};return n&&r?e.dataStore.initializedTrackingIds.some((function(t,i){var o=0===i?e.vdsConfig:e.subInstance[t];return o.projectId===n&&o.dataSourceId===r}))?(V("SDK初始化失败，重复初始化，请检查初始化参数!","error"),!1):{projectId:n,dataSourceId:r,appId:T(4===t.length?t[2]:""),userOptions:i}:(V('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", "您的小程序 AppId（可选）", options: { host: "您的数据上报地址host" }); 进行初始化!',"error"),!1)}(Ze,i);if(o){var a=o.projectId,u=o.dataSourceId,s=o.appId,l=o.userOptions;return Ze.init(c(c({},l),{projectId:a,dataSourceId:u,appId:s,trackingId:n}))}return!1}if("registerPlugins"===r)Ze.registerPlugins(i[0]);else{if(Ze.gioSDKInitialized&&Ze.vdsConfig)return me.includes(r)?G((function(){return Ze.handlerDistribute(n,r,i)})):G((function(){return Ze[r].apply(Ze,i)}));V("SDK未初始化!","error")}}else if(Se.includes(r))V("方法 ".concat(T(r)," 已被弃用，请移除!"),"warn");else{if("canIUse"===r)return Ie.includes(arguments[1])&&!!Ze[arguments[1]];V("不存在名为 ".concat(T(r)," 的方法调用!"),"error")}};ae().gdp=Xe,ae().gioSDKVersion=Ze.sdkVersion;var et=Ze.dataStore.eventHooks,nt=et.growingApp,rt=et.growingPage,it=et.growingComponent,ot=et.growingBehavior;(0,et.initOriginalValue)();var at=G((function(){return null!=nt?nt:App})),ut=G((function(){return null!=rt?rt:Page})),st=G((function(){return null!=it?it:Component})),ct=G((function(){return null!=ot?ot:Behavior}));export{at as GioApp,ct as GioBehavior,st as GioComponent,ut as GioPage,Xe as default};
