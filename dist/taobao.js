const t=/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/,e=t=>["undefined","null"].includes(T(t)),i=t=>"string"===T(t),n=t=>"number"===T(t),s=t=>"boolean"===T(t),r=t=>"[object Object]"==={}.toString.call(t)&&!e(t),o=t=>["function","asyncfunction"].includes(T(t)),a=t=>Array.isArray(t)&&"array"===T(t),g=t=>"date"===T(t),l=t=>{try{return Array.from(t)[0]}catch(t){return}},u=t=>{try{const e=Array.from(t);return e[e.length-1]}catch(t){return}},c=(t,e=1)=>a(t)&&n(e)?t.slice(e>0?e:1,t.length):t,d=(t,e=!1)=>{if(a(t)){let i=0;const n=[];for(const s of t)s&&!_(s)&&(n[i++]=s),e&&0===s&&(n[i++]=s);return n}return t},h=(t,e)=>{if(a(t)){const i=t.findIndex(e);return 0>i?void 0:t[i]}},p=t=>e(t)?"":""+t,v=(t,e)=>"string"===T(t)?t.split(e):t,m=t=>{if(i(t)){const e=v(t,"");return`${l(e).toLowerCase()}${c(e).join("")}`}return t},I=(t,e)=>(i(t)||(t=p(t)),t.slice(0,e.length)===e),f={}.hasOwnProperty,y=(t,i)=>!e(t)&&f.call(t,i),S=t=>r(t)?Object.keys(t):[],O=(t,e)=>{S(t).forEach((i=>e(t[i],i)))},b=(t,e)=>{const i=S(t);return!(!r(t)||!r(e)||i.length!==S(e).length||i.map(((i,n)=>r(t[i])?b(t[i],e[i]):t[i]===e[i])).includes(!1))},w=(t,e,i)=>{let n=t;return r(t)?(e.split(".").forEach((t=>{n=n?n[t]:i})),n):i},k=(t,e)=>{if(!r(t))return!1;try{if("string"===T(e))return delete t[e];if("array"===T(e))return e.map((e=>delete t[e]));"object"===T(e)&&e.constructor===RegExp&&S(t).forEach((i=>{e.test(i)&&k(t,i)}))}catch(t){return!1}},P=(t,e=250,i,n)=>{let s,r=0;return"boolean"!==T(i)&&(n=t,t=i,i=void 0),function(...o){let a=this,g=Date.now()-r;function l(){r=Date.now(),t.apply(a,o)}n&&!s&&l(),s&&clearTimeout(s),void 0===n&&g>e?l():!0!==i&&(s=setTimeout(n?function(){s=void 0}:l,void 0===n?e-g:e))}},_=t=>a(t)?0===t.length:r(t)?0===S(t).length:!t,T=t=>({}.toString.call(t).slice(8,-1).toLowerCase()),C=t=>{function e(t){return 10>t?"0"+t:t}return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+e(t.getMilliseconds())};var E=Object.freeze({__proto__:null,isNil:e,isString:i,isNaN:t=>"NaN"===p(Number(t)),isNumber:n,isBoolean:s,isObject:r,isRegExp:t=>"[object RegExp]"==={}.toString.call(t),isFunction:o,isArray:a,isDate:g,fixed:(t,e)=>n(t)?Number(t.toFixed(n(e)?e:2)):i(t)&&"NaN"!==p(Number(t))?Number(Number(t).toFixed(n(e)?e:2)):t,head:l,last:u,drop:c,dropWhile:(t,e)=>a(t)?t.filter((t=>!e(t))):t,compact:d,find:h,isEqualArray:(t,e)=>!(!a(t)||!a(e)||t.length!==e.length)&&t.every(((t,i)=>t===e[i])),toString:p,split:v,lowerFirst:m,upperFirst:t=>{if(i(t)){const e=v(t,"");return`${l(e).toUpperCase()}${c(e).join("")}`}return t},startsWith:I,endsWith:(t,e)=>{const{length:i}=t;let n=i;n>i&&(n=i);const s=n;return n-=e.length,n>=0&&t.slice(n,s)===e},hasOwnProperty:f,has:y,keys:S,forEach:O,isEqual:b,get:w,unset:k,throttle:P,isEmpty:_,typeOf:T,formatDate:C});const A=(t,e)=>{console.log("%c[GrowingIO]："+t,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[e]||"")},q=(t,e=!0,i="参数不合法")=>A(`${e?"调用":"设置"} ${t} 失败，${i}!`,"warn"),j=t=>{try{return t()}catch(t){return}},x=(t,e)=>{if(o(t))try{t(e)}catch(t){A("回调执行失败！"+t,"error")}},N=t=>i(t)?t.trim().substring(0,100):t,U=(e,n)=>i(e)&&!_(e)&&e.match(t)?n():(A("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1),D=t=>(e(t)||S(t).forEach((e=>{o(t[e])?t[e]=j((()=>t[e]())):r(t[e])?k(t,e):a(t[e])||(t[e]=p(t[e]))})),t),K=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),H=t=>t.pixelRatio?Math.round(t.screenHeight*t.pixelRatio):t.screenHeight,$=t=>t.pixelRatio?Math.round(t.screenWidth*t.pixelRatio):t.screenWidth,R=(t,e)=>{if(t){const i=t.toLowerCase();return-1!==i.indexOf("android")?e+"-Android":-1!==i.indexOf("ios")?e+"-iOS":t}},L=t=>{if(i(t)){const e=t.indexOf("?");return-1!==e?[t.substring(0,e),t.substring(e+1)]:[t,""]}return["",""]},F=t=>i(t)?t.startsWith("/")?t:"/"+t:"",V=t=>j((()=>{switch(t){case"wx":return wx;case"my":case"tb":return my;case"swan":return swan;case"tt":return tt;case"qq":return qq;case"ks":return ks;case"jd":return jd;default:{let t;return t||(t=j((()=>swan))),t||(t=j((()=>my))),t||(t=j((()=>tt))),t||(t=j((()=>qq))),t||(t=j((()=>ks))),t||(t=j((()=>jd))),t||(t=j((()=>wx))),t}}})),G=t=>j((()=>{switch(t){case"wx":return __wxConfig;case"swan":return appConfig;case"tt":return __ttConfig;case"qq":return __qqConfig;case"ks":return __ksConfig;case"jd":return __jdConfig;default:return}})),B=()=>{let t;return!t&&j((()=>swan))&&(t="swan"),!t&&j((()=>tt))&&(t="tt"),!t&&j((()=>qq))&&(t="qq"),!t&&j((()=>my.tb))&&(t="tb"),!t&&j((()=>my))&&(t="my"),!t&&j((()=>ks))&&(t="ks"),!t&&j((()=>jd))&&(t="jd"),!t&&j((()=>wx))&&(t="wx"),t||h(S(global),(t=>p(t).toLowerCase().includes("quickapp")))&&(t="quickapp"),t},M=()=>{var t;return null!==(t=j((()=>$global)))&&void 0!==t?t:global},Q=t=>{const i={};return r(t)&&(k(t,"&&sendTo"),O(t,((t,n)=>{const s=p(n).slice(0,100);r(t)?i[s]=Q(t):a(t)?(i[s]=d(t.slice(0,100),!0),i[s]=i[s].join("||").slice(0,1e3)):g(t)?i[s]=C(t):i[s]=e(t)?"":p(t).slice(0,1e3)}))),i},z=(t,e)=>{const i=()=>e.map((e=>t.getStorageSync(e)));try{return t.minip.canIUse("batchGetStorageSync")?t.minip.batchGetStorageSync(e):i()}catch(t){return i()}},W=(t,e)=>{const i=()=>e.map((({key:e,value:i})=>t.setStorageSync(e,i)));try{return t.minip.canIUse("batchSetStorageSync")?t.minip.batchSetStorageSync(e):i()}catch(t){return i()}},J=t=>S(t||{}).map((i=>i?`${i}=${e(t[i])?"":t[i]}`:"")).join("&"),Y=t=>{(I(t,"?")||I(t,"&"))&&(t=t.slice(1,t.length));const e={};return t.split("&").forEach((t=>{const i=t.split("=");i[0]&&(e[i[0]]=i[1])})),e};var Z=Object.freeze({__proto__:null,consoleText:A,callError:q,niceTry:j,niceCallback:x,limitString:N,eventNameValidate:U,getDynamicAttributes:D,guid:K,getScreenHeight:H,getScreenWidth:$,getOS:R,compareVersion:(t="",e="")=>{const i=t=>t.replace(/\s+/g,""),n=t=>t.replace(/[vV]/g,""),s=i(n(t)),r=i(n(e)),o=s.split("."),a=r.split(".");for(let t=0;3>t;t++){let e=Number(o[t]),i=Number(a[t]);if(e>i)return 1;if(i>e)return-1;if(!isNaN(e)&&isNaN(i))return 1;if(isNaN(e)&&!isNaN(i))return-1}return 0},getVueVersion:t=>{if(t){const e=Number(l(v(t.version,".")));return Number.isNaN(e)?0:e}return 0},splitPath:L,normalPath:F,isTaro3:t=>{const{Current:e,createComponent:i}=t;return!(!t||!e||i)},getPlainMinip:V,getPlainConfig:G,getPlainPlatform:B,getSubKeys:t=>S(t).filter((t=>t.indexOf("__sub")>-1&&t.indexOf("gio__")>-1)).sort(),getAppInst:()=>{let t=j((()=>getApp({allowDefault:!0})));return t||(t=M()),t},getGlobal:M,limitObject:Q,batchGetStorageSync:z,batchSetStorageSync:W,qsStringify:J,qsParse:Y,hashCode:(t,e=!1)=>{let i=0;if(_(t)||"boolean"==typeof t)return i;let n=0;for(;n<t.length;)i=(i<<5)-i+t.charCodeAt(n),i|=0,n++;return e?Math.abs(i):i}});const X=t=>i(t)&&t.length>0||n(t)&&t>0,et={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},idMapping:{type:"boolean",default:!1},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},ignoreFields:{type:"array",default:[]},pluginMode:{type:"boolean",default:!1},originalSource:{type:"boolean",default:!0},keepAlive:{type:"number",default:3e5},performance:{type:"object",default:{monitor:!0,exception:!0}},serverUrl:{type:"string",default:"https://napi.growingio.com"},requestTimeout:{type:"number",default:5e3},taro:{type:["object","module"],default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloud:void 0,cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},trackPage:{type:"boolean",default:!0},uniVue:{type:["object","function"],default:!1},uploadInterval:{type:"number",default:1e3},version:{type:"string",default:"1.0.0"}},it=["clearGeneralProps","clearPageAttributes","clearTrackTimer","clearUserId","getABTest","getGioInfo","getOption","identify","removeTimer","sendPage","sendVisit","setGeneralProps","setLocation","setOption","setPageAttributes","setUserAttributes","setUserId","track","trackTimerEnd","trackTimerPause","trackTimerResume","trackTimerStart"],nt=["init","registerPlugins","getPlugins","getDeviceId","updateImpression",...it],st={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式",serverUrl:"数据上报服务地址"},rt=["enableDebug","setAutotrack","setDataCollect","setTrackerHost","setTrackerScheme","setConfig","collectImp","setPlatformProfile","getLocation"],ot=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],at=[...ot,"appChannel","language","platformVersion"],gt={gsid:"_growing_gsid_",originalSource:"_gdp_original_source_",userId:"_growing_userId_",userKey:"_growing_userKey_",gioId:"_growing_gioId_",plugin_gsid:"_growing_plugin_gsid_",plugin_originalSource:"_gdp_plugin_original_source_",plugin_userId:"_growing_plugin_userId_",plugin_userKey:"_growing_plugin_userKey_",plugin_gioId:"_growing_plugin_gioId_"};var lt="MINIP_LIFECYCLE",ut="ON_COMMIT_REQUEST",ct="ON_COMPOSE_AFTER",dt="ON_COMPOSE_BEFORE",ht="ON_ERROR",pt="ON_INSTALL",vt="ON_SEND_AFTER",mt="ON_SEND_BEFORE",It="OPTION_CHANGE",ft="OPTION_INITIALIZED",yt="SDK_INITIALIZED";class St{constructor(t){this.growingIO=t,this.main=(t,e,i=!0)=>{var n;t||(t=this.growingIO.trackingId);const{sdkVersion:s,platformConfig:r,minipInstance:o,userStore:a,dataStore:g,dataStore:{scene:l,eventHooks:{currentPage:u},lastVisitEvent:c,lastPageEvent:d,generalProps:h}}=this.growingIO,{version:p,dataSourceId:v,appId:m,idMapping:I,ignoreFields:f}=g.getTrackerVds(t),y=g.locationData[t],{systemInfo:S={},network:O={}}=o,{brand:b,model:w,platform:P,language:T}=S,C={appChannel:"scn:"+(l||"NA"),appVersion:p,dataSourceId:v,deviceBrand:b,deviceId:a.getUid(),deviceModel:w,deviceType:R(P,r.name),domain:m,language:T,latitude:null==y?void 0:y.latitude,longitude:null==y?void 0:y.longitude,networkState:(null==O?void 0:O.networkType)||(null==O?void 0:O.type)||(null==O?void 0:O.subtype),operatingSystem:R(P,r.name),path:(null==u?void 0:u.path)?null==u?void 0:u.path:c.path,platform:r.platform,platformVersion:r.name+(S.version?" "+S.version:""),query:(null==u?void 0:u.path)?null==u?void 0:u.query:c.query,screenHeight:H(S),screenWidth:$(S),sdkVersion:s,sessionId:a.getSessionId(t),title:(null===(n=d[t])||void 0===n?void 0:n.title)||(null==u?void 0:u.title)||o.getPageTitle(o.getCurrentPage()),timestamp:Date.now(),timezoneOffset:(new Date).getTimezoneOffset(),userId:a.getUserId(t)};return I&&(C.userKey=a.getUserKey(t)),i&&!_(h[t])&&(C.attributes=Object.assign({},h[t])),_(C.attributes)||(C.attributes=Q(D(Object.assign({},C.attributes)))),_(f)||f.forEach((t=>{k(C,t)})),_(e)?Object.assign(Object.assign({},C),{trackingId:t}):Object.assign(Object.assign(Object.assign({},C),e),{trackingId:t})}}}function Ot(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{g(n.next(t))}catch(t){r(t)}}function a(t){try{g(n.throw(t))}catch(t){r(t)}}function g(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}g((n=n.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class bt{constructor(t){this.growingIO=t,this.main=(t,e)=>{var i,n;const s=Date.now(),{emitter:r,userStore:o,vdsConfig:a,platformConfig:g,uploader:l,dataStore:u,dataStore:{trackersExecute:c,shareOut:d,lastCloseTime:h,eventHooks:p,saveStorageInfo:v,setOriginalSource:m}}=this.growingIO;r.emit(lt,{event:"App "+t,timestamp:s,params:null!==(i=e[0])&&void 0!==i?i:{}}),a.debug&&console.log("App:",t,s);const I=g.listeners.app;switch(r.emit(dt,{event:"App "+t,params:null!==(n=e[0])&&void 0!==n?n:{}}),t){case I.appCreate:case I.appShow:{const{path:t,query:i}=this.enterParamsParse(e[0]);!d&&a.originalSource&&c((e=>{m(e,{path:t,query:i})})),h?(Date.now()-h>a.keepAlive||u.lastScene&&u.scene!==u.lastScene)&&(c((t=>{o.setSessionId(t)})),p.currentPage.time=void 0,c((e=>{this.buildVisitEvent(e,{path:t,query:i})}))):(u.lastVisitEvent={path:t,query:i},c((e=>{this.buildVisitEvent(e,{path:t,query:i})})));break}case I.appClose:u.lastScene=u.scene,u.lastCloseTime=Date.now(),v(),o.saveUserInfo(),c((t=>{this.buildCloseEvent(t),a.forceLogin||l.initiateRequest(t,!0)}))}},this.enterParamsParse=t=>{const{gioPlatform:e,minipInstance:i,dataStore:n}=this.growingIO;let s="",o="";const a=(t,e={})=>{s=t,o=S(e).map((t=>`${t}=${e[t]}`)).join("&")};if("quickapp"!==e&&i.minip.canIUse("getEnterOptionsSync")){const{path:e,query:s,scene:g,referrerInfo:l}=i.minip.getEnterOptionsSync()||{},u=t.query||s;if(a(t.path||e,u),n.scene=t.scene||g,!_(l)&&r(null==l?void 0:l.extraData)){let t=[];O(l.extraData,((e,i)=>{!y(u,i)&&["string","number","boolean"].includes(T(e))&&t.push(`${i}=${e}`)}));const e=t.join("&");o=o&&e?`${o}&${e}`:o||e}}else{const{path:e,query:i}=t;a(e,i),this.parseScene(t)}return{path:s,query:o}},this.parseScene=t=>{var e;const{minipInstance:i,gioPlatform:n,dataStore:s}=this.growingIO;let r;if("quickapp"===n){const{extra:t,type:e}=i.getAppSource();r=(null==t?void 0:t.scene)||e}else _(t)||((null===(e=null==t?void 0:t.query)||void 0===e?void 0:e.wxShoppingListScene)?r=t.query.wxShoppingListScene:(null==t?void 0:t.scene)?r=t.scene:s.scene="NA");s.scene=r},this.buildVisitEvent=(t,i)=>{var n;const{dataStore:{getOriginalSource:s,eventContextBuilder:r,eventInterceptor:o,eventHooks:a},minipInstance:g,vdsConfig:l}=this.growingIO,u=s(t),c=(null==i?void 0:i.query)||"";let d=Object.assign({eventType:"VISIT"},r(t,{path:(null==i?void 0:i.path)||"",query:"string"===T(c)?c:J(c),title:(null===(n=a.currentPage)||void 0===n?void 0:n.title)||g.getPageTitle(g.getCurrentPage()),timestamp:a.currentPage.time?a.currentPage.time-1:+Date.now()}));l.originalSource&&!e(u)&&(d=Object.assign(Object.assign({},d),u)),o(d)},this.buildCloseEvent=t=>{const{dataStore:{eventContextBuilder:e,eventInterceptor:i}}=this.growingIO;i(Object.assign({eventType:"APP_CLOSED"},e(t)))}}}class wt{constructor(t){this.growingIO=t,this.parsePage=(t,e)=>{var i;const n=t.route||t.uri||t.__route__||(null===(i=null==t?void 0:t.$page)||void 0===i?void 0:i.fullPath)||"";_(e)?this.query=void 0:this.query=this.getQuery(e),this.path!==n&&(this.time=Date.now()),this.path=n,this.title=this.settedTitle[this.path]||this.growingIO.minipInstance.getPageTitle(t||this.growingIO.minipInstance.getCurrentPage())},this.getQuery=t=>{const e=Object.assign({},t);return k(e,"wxShoppingListScene"),J(e)},this.getReferralPage=t=>{var e;const{minipInstance:i,dataStore:{lastPageEvent:n,scene:s}}=this.growingIO;return(null===(e=n[t])||void 0===e?void 0:e.path)||(s?`scn:${i.scnPrefix}${s}`:null)},this.updateShareResult=t=>{const[e,i]=this.buildShareQuery(t);return t.path=F(e+(i?"?"+i:"")),t.query=i,t},this.updateAppMessageResult=this.updateShareResult,this.updateTimelineResult=this.updateShareResult,this.updateAddFavoritesResult=t=>{const[e,i]=this.buildShareQuery(t);return t.path=F(e+(i?"?"+i:"")),t.query=i,t},this.eventSetPageProps=(t,e)=>{const i=j((()=>this.pageProps[t][this.path]));return _(i)?e.attributes:Q(D(Object.assign(Object.assign({},e.attributes),i)))},this.query=void 0,this.settedTitle={},this.pageProps={}}buildShareQuery(t){var e,i,n;const s=L(null!==(e=t.path)&&void 0!==e?e:"");let r=this.path,o={},a=y(t,"path");return a&&(r=l(s),o=Y(u(s))||{}),_(o)&&(o=Y(null!==(i=t.query)&&void 0!==i?i:"")||{},d(S(o)).forEach((t=>{t.toLowerCase().startsWith("utm_")&&k(o,t)}))),!a&&_(o)&&(o=Y(null!==(n=this.query)&&void 0!==n?n:"")||{}),[r,J(o)]}}class kt{constructor(t){this.growingIO=t,this.main=(t,e,i)=>{var n,s;const r=Date.now(),{emitter:a,minipInstance:g,plugins:l,vdsConfig:u,platformConfig:c,dataStore:{getTrackerVds:d,trackersExecute:h,shareOut:p,eventHooks:v,toggleShareOut:m,buildAppMessageEvent:I,buildTimelineEvent:f,buildAddFavorites:y},inPlugin:S}=this.growingIO,{currentPage:O}=v;if(this.prevEvent[e]&&50>Date.now()-Number(this.prevEvent[e]))return;t||(t=g.getCurrentPage()),t.route||(t.route=g.getCurrentPath(t));const b=t.route||t.uri||t.__route__||(null===(n=null==t?void 0:t.$page)||void 0===n?void 0:n.fullPath)||"";a.emit(lt,{event:"Page "+e,timestamp:r,params:{page:t,args:i[0]}}),u.debug&&console.log("Page:",b,"#",e,r),this.prevEvent[e]=Date.now();const P=c.listeners.page;switch(a.emit(dt,{page:t,event:"Page "+e,params:{page:t,args:i[0]}}),O.lastLifecycle=O.currentLifecycle,O.currentLifecycle=e,e){case P.pageLoad:this.argQuery[b]=w(t,"options")||w(t,"__displayReporter.query")||w(t,"$page.query")||w(t,"$wx.__displayReporter.query")||i[0]||{},k(this.argQuery[b],"$taroTimestamp"),O.parsePage(t,this.argQuery[b]);break;case P.pageShow:S?(O.parsePage(t,this.argQuery[b]),O.path||(O.path=`/插件${u.appId}}`,O.title=`/插件${u.appId}}`),h((t=>{const{trackPage:e}=d(t);e&&this.buildPageEvent(t)}))):p&&v.currentPage.time||(O.parsePage(t,this.argQuery[b]),v.currentPage.time=Date.now(),h((t=>{const{trackPage:e}=d(t);e&&this.buildPageEvent(t)}))),m(!1);break;case P.pageHide:case P.pageUnload:break;case P.shareApp:m(!0),h((t=>{const{followShare:e}=d(t);e&&I(t,i)}));break;case P.shareTime:h((t=>{const{followShare:e}=d(t);e&&f(t,i)}));break;case P.addFavorites:h((t=>{const{followShare:e}=d(t);e&&y(t,i)}));break;case P.tabTap:{const t=null===(s=null==l?void 0:l.gioEventAutoTracking)||void 0===s?void 0:s.buildTabClickEvent;u.autotrack&&t&&o(t)&&t(this.growingIO.trackingId,i[0]);break}}},this.buildPageEvent=(t,e)=>{const{dataStore:{eventContextBuilder:i,eventInterceptor:n,eventHooks:{currentPage:s}},minipInstance:r}=this.growingIO,o=Object.assign(Object.assign({eventType:"PAGE",referralPage:s.getReferralPage(t)},i(t)),{title:(null==s?void 0:s.title)||r.getPageTitle(r.getCurrentPage()),timestamp:s.time});o.attributes=s.eventSetPageProps(t,o),!_(e)&&e.title&&(o.title=e.title),n(o)},this.prevEvent={},this.argQuery={}}}class Pt{constructor(t){var e;this.growingIO=t,this.isNormalFc=(t,e)=>o(e)&&"constructor"!==t,this.objectTraverse=(t,e)=>{Object.getOwnPropertyNames(t).forEach((i=>e(i,t))),y(t,"methods")&&Object.getOwnPropertyNames(t.methods).forEach((i=>{t[i]||e(i,t.methods)})),y(t,"lifetimes")&&Object.getOwnPropertyNames(t.lifetimes).forEach((i=>{t[i]||e(i,t.lifetimes)})),y(t,"pageLifetimes")&&Object.getOwnPropertyNames(t.pageLifetimes).forEach((i=>{t[i]||e(i,t.pageLifetimes)}))},this.supLifeFcs=(t,e)=>{a(this[e+"Handlers"])&&this[e+"Handlers"].forEach((e=>{o(t[e])||["onShareAppMessage","onShareTimeline"].includes(e)||(t[e]=()=>{})}))},this.lifeFcEffects=(t,e,i)=>{const n=this;return["onShareTimeline","onAddToFavorites"].includes(t)?function(...s){let r=e.apply(this,s);"onShareTimeline"===t&&n.growingIO.vdsConfig.followShare&&(r=n.currentPage.updateTimelineResult(null!=r?r:{})),"onAddToFavorites"===t&&(r=n.currentPage.updateAddFavoritesResult(null!=r?r:{}));const o=[].slice.call(s);return r&&o.push(r),n[`def${i}Cbs`][t].apply(this,o),r}:function(...s){var r;return Ot(this,void 0,void 0,(function*(){let o;try{if("onShareAppMessage"===t){if(o=null!==(r=e.apply(this,s))&&void 0!==r?r:{},"promise"===T(o)&&(o=yield o.then((t=>t))),"promise"===T(o.promise)){const t=function(){return Ot(this,void 0,void 0,(function*(){let t=o;return new Promise((e=>{let i=setTimeout((()=>{e(Object.assign({},t)),clearTimeout(i),i=void 0}),3e3);o.promise.then((n=>{t=n,e(Object.assign({},t)),clearTimeout(i),i=void 0}))}))}))};o=Object.assign(Object.assign({},o),yield t()),k(o,"promise")}n.growingIO.vdsConfig.followShare&&(o=n.currentPage.updateAppMessageResult(null!=o?o:{}))}const a=[].slice.call(s);o&&a.push(o),n[`def${i}Cbs`][t].apply(this,a)}catch(t){A(t,"error")}return"onShareAppMessage"!==t&&(o=e.apply(this,s)),n.growingIO.emitter.emit(lt,{event:`${i} ${t}End`,timestamp:Date.now(),params:{instance:this,arguments:Array.from(s)}}),o}))}},this.customFcEffects=(t,e)=>{const i=this;return function(...n){var s,r;let a;if(i.growingIO.vdsConfig.autotrack&&i.growingIO.plugins.gioEventAutoTracking)try{let e=n[0]||{};y(e,"type")&&((null==e?void 0:e.currentTarget)||(null==e?void 0:e.target))||(e=n[n.length-1]),((null==e?void 0:e.currentTarget)||(null==e?void 0:e.target))&&i.actionEventTypes.includes(e.type)&&(o(i.actionEffects)||(i.actionEffects=(null===(r=null===(s=i.growingIO.plugins)||void 0===s?void 0:s.gioEventAutoTracking)||void 0===r?void 0:r.main)||function(){}),null==i||i.actionEffects(e,t))}catch(t){A(t,"error")}return a=e.apply(this,n),a}},this.appApplyProxy=(t,e)=>this.appHandlers.includes(t)?this.lifeFcEffects(t,e,"App"):this.customFcEffects(t,e),this.pageApplyProxy=(t,e)=>this.pageHandlers.includes(t)?this.lifeFcEffects(t,e,"Page"):this.customFcEffects(t,e),this.appOverriding=t=>(this.setAppEffectCbs(),this.supLifeFcs(t,"app"),this.objectTraverse(t,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.appApplyProxy(t,e[t]))})),t),this.pageOverriding=t=>(this.setPageEffectCbs(),this.supLifeFcs(t,"page"),this.objectTraverse(t,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.pageApplyProxy(t,e[t]))})),t),this.componentOverriding=t=>(this.setPageEffectCbs(),t.methods||(t.methods={}),this.supLifeFcs(this.growingIO.inPlugin?t:t.methods,"page"),this.objectTraverse(this.growingIO.inPlugin?t:t.methods,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.pageApplyProxy(t,e[t]))})),t),this.setAppEffectCbs=()=>{const t=this;this.appHandlers.forEach((e=>{this.defAppCbs[e]=function(...i){t.appEffects.main(e,i)}}))},this.setPageEffectCbs=()=>{const t=this;this.pageHandlers.forEach((e=>{this.defPageCbs[e]=function(...i){t.pageEffects.main(this,e,i)}}))},this.growingApp=t=>this.originalApp(this.appOverriding(t)),this.growingPage=t=>this.originalPage(this.pageOverriding(t)),this.growingComponent=t=>this.originalComponent(this.componentOverriding(t)),this.growingBehavior=t=>this.originalBehavior(this.componentOverriding(t)),this.nativeGrowing=(t=["App","Page","Component","Behavior"])=>{const e=this,{platformConfig:i}=this.growingIO,n=i.hooks;if(this.setAppEffectCbs(),this.setPageEffectCbs(),t.includes("App"))try{n.App&&!this.appHooked&&(this.originalApp=App||global.App||function(){},App=function(...t){return e.growingApp(t[0])},this.appHooked=!0)}catch(t){}if(t.includes("Page"))try{n.Page&&!this.pageHooked&&(this.originalPage=Page||global.Page||function(){},Page=function(...t){return e.growingPage(t[0])},this.pageHooked=!0)}catch(t){}if(t.includes("Component"))try{n.Component&&!this.componentHooked&&(this.originalComponent=Component||global.Component||function(){},Component=function(...t){return e.growingComponent(t[0])},this.componentHooked=!0)}catch(t){}if(t.includes("Behavior"))try{n.Behavior&&!this.behaviorHooked&&(this.originalBehavior=Behavior||global.Behavior||function(){},Behavior=function(...t){return e.growingBehavior(t[0])},this.behaviorHooked=!0)}catch(t){}},this.initEventHooks=()=>{const t=this,{platformConfig:e,gioPlatform:i}=this.growingIO;e.canHook?(this.nativeGrowing(),M().GioApp=j((()=>null!==App&&void 0!==App?App:window.GioApp)),M().GioPage=j((()=>null!==Page&&void 0!==Page?Page:window.GioPage)),M().GioComponent=j((()=>null!==Component&&void 0!==Component?Component:window.GioComponent)),M().GioBehavior=j((()=>Behavior))):"quickapp"===i&&(window.GioApp=function(...e){return t.appOverriding(e[0])},window.GioPage=function(...e){return t.pageOverriding(e[0])},window.GioComponent=function(...e){return t.pageOverriding(e[0])})};const i=null===(e=this.growingIO)||void 0===e?void 0:e.platformConfig;this.defAppCbs={},this.defPageCbs={},this.appHandlers=i.appHandlers,this.pageHandlers=i.pageHandlers,this.actionEventTypes=i.actionEventTypes,this.appEffects=new bt(this.growingIO),this.pageEffects=new kt(this.growingIO),this.currentPage=new wt(this.growingIO)}}class _t{constructor(t){var n,r;this.growingIO=t,this.ALLOW_SETTING_KEYS=S(et),this.getStorageKey=(t,e)=>{const{inPlugin:i}=this.growingIO;return`${t===this.growingIO.trackingId?"":t}${gt[i?"plugin_"+e:e]}`},this.getGsid=t=>{let e=Number(this._gsid[t]);return Number.isNaN(e)||e>=1e9||1>e?(this.setGsid(t,1),1):e},this.setGsid=(t,e)=>{let i=Number(e);(Number.isNaN(i)||i>=1e9||1>i)&&(i=1),this._gsid[t]=i,10>this._gsid[t]-this._stid[t]||this.saveStorageInfo()},this.initStorageInfo=t=>{const{minipInstance:e}=this.growingIO,i=e.getStorageSync(this.getStorageKey(t,"gsid"));let n=Number(i);(Number.isNaN(n)||n>=1e9||1>n)&&(n=1),this._gsid[t]=n,this._stid[t]=n,n!==i&&e.setStorageSync(this.getStorageKey(t,"gsid"),n)},this.saveStorageInfo=()=>{const{minipInstance:t}=this.growingIO;this._stid=Object.assign({},this._gsid),W(t,this.initializedTrackingIds.map((t=>({key:this.getStorageKey(t,"gsid"),value:this._gsid[t]}))))},this.setOriginalSource=(t,{path:i,query:n})=>{const{minipInstance:s}=this.growingIO;if(e(this.getOriginalSource(t))){const e={path:i,query:n,title:""};s.setStorageSync(this.getStorageKey(t,"originalSource"),JSON.stringify(e))}},this.getOriginalSource=t=>{const{minipInstance:e}=this.growingIO;return j((()=>JSON.parse(e.getStorageSync(this.getStorageKey(t,"originalSource")))))},this.getTrackerVds=t=>this.growingIO.trackingId===t?Object.assign({},this.growingIO.vdsConfig):void 0,this.initTrackerOptions=t=>{const e=this.initOptions(t);return e.trackingId=t.trackingId,this.growingIO.trackingId=t.trackingId,this.growingIO.vdsConfig=e,e},this.initTrackerHooker=t=>{var e,i;const{platformConfig:n,inPlugin:s,minipInstance:r,plugins:o}=this.growingIO,{uniVue:a,taro:g}=t;a||g||(n.canHook=!0),s&&!["tbp","jdp"].includes(r.platform)||this.eventHooks.initEventHooks(),a&&(null===(e=null==o?void 0:o.gioUniAppAdapter)||void 0===e||e.main()),g&&(null===(i=null==o?void 0:o.gioTaroAdapter)||void 0===i||i.main())},this.initOptions=t=>{var e,i,n,s,r,o;const{projectId:g,dataSourceId:l,appId:u,trackingId:c}=t,d={};return this.ALLOW_SETTING_KEYS.forEach((e=>{const i=et[e].type;(a(i)?i.includes(T(t[e])):T(t[e])===et[e].type)?"ignoreFields"===e?d.ignoreFields=t.ignoreFields.filter((t=>ot.includes(t))):"extraParams"===e?d.extraParams=t.extraParams.filter((t=>at.includes(t))):(d[e]=t[e],["dataCollect","autotrack"].includes(e)&&!d[e]&&A("已关闭"+st[e],"info")):d[e]=et[e].default})),d.uploadInterval=Math.round(d.uploadInterval),(Number.isNaN(d.uploadInterval)||0>d.uploadInterval||d.uploadInterval>3e3)&&(d.uploadInterval=1e3),d.enableIdMapping&&!d.idMapping&&(d.idMapping=!0,d.idMapping||this.growingIO.userStore.setUserKey(c,"")),k(d,"enableIdMapping"),d.pluginMode&&(this.growingIO.inPlugin=!0),!isNaN(Number(d.requestTimeout))&&d.requestTimeout>0||(d.requestTimeout=5e3),Object.assign(Object.assign({},d),{projectId:g,dataSourceId:l,appId:u,trackingId:c,performance:{monitor:null===(i=null===(e=d.performance)||void 0===e?void 0:e.monitor)||void 0===i||i,exception:null===(s=null===(n=d.performance)||void 0===n?void 0:n.exception)||void 0===s||s,network:null!==(o=null===(r=d.performance)||void 0===r?void 0:r.network)&&void 0!==o&&o}})},this.setOption=(t,e,n)=>{var s;const{userStore:r,emitter:o}=this.growingIO,a=this.getTrackerVds(t),g=i(e)&&this.ALLOW_SETTING_KEYS.includes(e),l=g&&typeof n===(null===(s=et[e])||void 0===s?void 0:s.type);if(g&&l){const i=Object.assign({},a);if(this.updateVdsConfig(t,Object.assign(Object.assign({},a),{[e]:n})),"dataCollect"===e&&i.dataCollect!==n&&n){r.setSessionId(t);const{path:e,query:i,settedTitle:n}=this.eventHooks.currentPage;this.eventHooks.currentPage.title=n[e]||this.growingIO.minipInstance.getPageTitle(this.growingIO.minipInstance.getCurrentPage()),this.sendVisit(t,{path:e,query:i}),this.eventHooks.currentPage.time=Date.now(),this.sendPage(t,{path:e,query:i})}return o.emit(It,{optionName:e,optionValue:n}),!0}return q("setOption > "+e),!1},this.getOption=(t,e)=>{const i=this.getTrackerVds(t);return e&&y(this.growingIO.vdsConfig,e)?y(i,e)?i[e]:this.growingIO.vdsConfig[e]:_(e)?i:void q("getOption > "+e)},this.updateVdsConfig=(t,e)=>{t===this.growingIO.trackingId?(this.growingIO.vdsConfig=Object.assign(Object.assign({},this.growingIO.vdsConfig),e),M().vdsConfig=this.growingIO.vdsConfig):(this.growingIO.subInstance[t]=Object.assign(Object.assign({},this.growingIO.subInstance[t]),e),M().vdsConfig.subInstance[t]=this.growingIO.subInstance[t])},this.toggleShareOut=t=>{s(t)?this.shareOut=t:this.shareOut=!this.shareOut},this.sendVisit=(t,e)=>{this.eventHooks.appEffects.buildVisitEvent(t,null!=e?e:this.lastVisitEvent)},this.sendPage=(t,e)=>{this.eventHooks.pageEffects.buildPageEvent(t,e)},this.eventConverter=t=>{const{dataStore:e,uploader:i}=this.growingIO,{dataCollect:n}=this.getTrackerVds(t.trackingId);if(n){["LOGIN_USER_ATTRIBUTES","APP_CLOSED"].includes(t.eventType)||(t.eventSequenceId=e.getGsid(t.trackingId),e.setGsid(t.trackingId,t.eventSequenceId+1));const n={};O(t,((t,e)=>{var i;if("element"===e){const e=null!==(i=l(t))&&void 0!==i?i:{};O(e,((t,e)=>{_(t)&&0!==t||(n[e]=t)}))}else _(t)&&0!==t||(n[e]=t)})),this.growingIO.emitter.emit(ct,{composedEvent:n}),i.commitRequest(Object.assign(Object.assign({},n),{requestId:K()}))}},this.eventInterceptor=t=>{const{systemInfo:e,network:i}=this.growingIO.minipInstance;_(e)||_(i)?this.interceptEvents.push(t):_(this.interceptEvents)?this.eventConverter(t):([...this.interceptEvents,t].forEach((e=>{const i=Object.assign(Object.assign({},e),this.eventContextBuilder(t.trackingId,{path:e.path,query:e.query,timestamp:e.timestamp}));this.eventConverter(i)})),this.interceptEvents=[])},this.eventReleaseInspector=()=>{const{minipInstance:{systemInfo:t,network:e}}=this.growingIO;t&&e&&!_(this.interceptEvents)&&([...this.interceptEvents].forEach((t=>{const e=Object.assign(Object.assign({},t),this.eventContextBuilder(t.trackingId,{path:t.path,query:t.query,timestamp:t.timestamp}));this.eventConverter(e)})),this.interceptEvents=[])},this.buildAppMessageEvent=(t,e)=>{var i,n;const s=e[0];let r;2>e.length?1===e.length&&(r=s):r=e[1];const{dataStore:{eventContextBuilder:o,eventInterceptor:a}}=this.growingIO,g=((null==r?void 0:r.path)||"").split("?"),u=Object.assign({eventType:"CUSTOM",eventName:"$mp_on_share"},o(t));u.attributes=Q(Object.assign(Object.assign(Object.assign({},null!==(i=u.attributes)&&void 0!==i?i:{}),{$from:s.from,$target:null===(n=null==s?void 0:s.target)||void 0===n?void 0:n.id,$share_title:null==r?void 0:r.title,$share_path:l(g),$share_query:g[1]}),null==r?void 0:r.attributes)),a(u)},this.buildTimelineEvent=(t,e)=>{var i,n;const s=e[0];let r;2>e.length?1===e.length&&(r=s):r=e[1];const{dataStore:{eventContextBuilder:o,eventInterceptor:a}}=this.growingIO,g=((null==r?void 0:r.path)||"").split("?"),u=Object.assign({eventType:"CUSTOM",eventName:"$mp_share_timeline"},o(t));u.attributes=Q(Object.assign(Object.assign(Object.assign({},null!==(i=u.attributes)&&void 0!==i?i:{}),{$target:null===(n=null==s?void 0:s.target)||void 0===n?void 0:n.id,$share_title:null==r?void 0:r.title,$share_path:l(g),$share_query:g[1]}),null==r?void 0:r.attributes)),a(u)},this.buildAddFavorites=(t,e)=>{var i;const n=e[0];let s;2>e.length?1===e.length&&(s=n):s=e[1];const{dataStore:{eventContextBuilder:r,eventInterceptor:o}}=this.growingIO,a=((null==s?void 0:s.path)||"").split("?"),g=Object.assign({eventType:"CUSTOM",eventName:"$mp_add_favorites"},r(t));g.attributes=Q(Object.assign(Object.assign({},null!==(i=g.attributes)&&void 0!==i?i:{}),{$share_title:null==s?void 0:s.title,$share_path:l(a),$share_query:a[1]})),o(g)},this.trackersExecute=t=>{this.initializedTrackingIds.forEach((e=>{"function"===T(t)&&t(e)}))},this.initializedTrackingIds=[],this.eventContextBuilder=new St(this.growingIO).main,this.eventHooks=new Pt(this.growingIO),this.shareOut=!1,this._gsid={},this._stid={},this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.generalProps={},this.trackTimers={},this.interceptEvents=[];const{emitter:g,minipInstance:u}=this.growingIO;g.on(yt,(({trackingId:t})=>{this.initializedTrackingIds.push(t),this.initStorageInfo(t)})),g.on(ut,(({eventData:t,trackingId:e})=>{"VISIT"===t.eventType&&(this.lastVisitEvent=t),"PAGE"===t.eventType&&(this.lastPageEvent[e]=t)})),o(null===(n=u.minip)||void 0===n?void 0:n.onAppHide)&&u.minip.onAppHide((()=>{this.trackersExecute((t=>{const e=this.trackTimers[t];O(e,(t=>{t.start&&(t.leng=t.leng+(+Date.now()-t.start))}))}))})),o(null===(r=u.minip)||void 0===r?void 0:r.onAppShow)&&u.minip.onAppShow((()=>{this.trackersExecute((t=>{const e=this.trackTimers[t];O(e,(t=>{t.start&&(t.start=+Date.now())}))}))})),g.on(It,(({optionName:t,optionValue:e})=>{"dataCollect"===t&&!1===e&&this.trackersExecute((t=>{this.growingIO.clearTrackTimer(t)}))}))}get scene(){return this._scene}set scene(t){const e=this._scene;this._scene=t,e!==this._scene&&this.growingIO.emitter.emit("SCENE_UPDATE",{newScene:t,oldScene:e})}}const Tt={scnPrefix:"",appHandlers:["onLaunch","onShow","onHide","onError","onPageNotFound","onUnhandledRejection","onThemeChange"],pageHandlers:["onLoad","onShow","onReady","onHide","onShareAppMessage","onTabItemTap","onUnload","onPullDownRefresh","onReachBottom","onResize"],actionEventTypes:["onclick","tap","onTap","longpress","longTap","blur","change","onChange","submit","confirm","getuserinfo","getphonenumber","contact","mouseup"],canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},listeners:{app:{appLaunch:"onLaunch",appShow:"onShow",appClose:"onHide"},page:{pageLoad:"onLoad",pageShow:"onShow",pageReady:"onReady",pageHide:"onHide",pageUnload:"onUnload",tabTap:"onTabItemTap",shareApp:"onShareAppMessage"},actions:{click:["onclick","tap","longpress","longTap","getuserinfo","getphonenumber","contact","mouseup"],change:["blur","change","confirm"],submit:["submit"]}}},Ct=Object.assign(Object.assign({},Tt),{pageHandlers:[...Tt.pageHandlers,"onInit","didMount","didUnmount"],listeners:Object.assign(Object.assign({},Tt.listeners),{page:Object.assign(Object.assign({},Tt.listeners.page),{onInit:"onInit",didMount:"didMount",didUnmount:"didUnmount"})}),name:"Taobao",platform:"tbp",scnPrefix:"tbp_",hooks:Object.assign(Object.assign({},Tt.hooks),{Behavior:!1})});class Et{constructor(t){this.growingIO=t,this.minip=V("tb"),this.hookSetTitle=()=>{var t;const e=null===(t=this.minip)||void 0===t?void 0:t.setNavigationBarTitle,i=this;e&&Object.defineProperty(this.minip,"setNavigationBarTitle",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){const t=i.getCurrentPath(),{title:e}=arguments[0]||{};i.growingIO.dataStore.eventHooks.currentPage.settedTitle[t]=e}return e.apply(this,arguments)}})},this.navigateTo=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.navigateTo(t)},this.switchTab=t=>{var e;null===(e=this.minip)||void 0===e||e.switchTab(t)},this.navigateToMiniProgram=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.navigateToMiniProgram(t)},this.getImageInfo=({src:t,success:e,fail:i,complete:n})=>{var s;return null===(s=this.minip)||void 0===s?void 0:s.getImageInfo({src:t,success:e,fail:i,complete:n})},this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"observeAll")},this.getCurrentPage=()=>j((()=>u(getCurrentPages())))||{},this.getCurrentPath=()=>{const t=this.getCurrentPage();return(null==t?void 0:t.route)||(null==t?void 0:t.uri)||(null==t?void 0:t.__route__)||""},this.getPageTitle=t=>{var e,n;let s="";const r=G(B());try{const o=(null==t?void 0:t.data)||t.$data||{};if(s=i(null==o?void 0:o.gioPageTitle)?null==o?void 0:o.gioPageTitle:"",0===s.length){const e=r.page[t.route]||r.page[t.route+".html"];s=e?e.window.navigationBarTitleText:r.global.window.navigationBarTitleText}if(0===s.length){const i=null===(n=null===(e=null==r?void 0:r.tabBar)||void 0===e?void 0:e.list)||void 0===n?void 0:n.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));s=(null==i?void 0:i.text)||""}}catch(t){return""}return N(s)},this.getStorageSync=t=>{var e;let i=null===(e=this.minip)||void 0===e?void 0:e.getStorageSync(t);return r(i)&&i.expiredAt?i.expiredAt<Date.now()?"":i.value:i},this.getStorage=t=>new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getStorage({key:t,success:({data:t})=>e(t),fail:()=>e("")})})),this.setStorageSync=(t,e,i)=>{var n;i&&(e={value:e,expiredAt:i}),null===(n=this.minip)||void 0===n||n.setStorageSync(t,e)},this.setStorage=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorage({key:t,data:e})},this.removeStorageSync=t=>{var e;null===(e=this.minip)||void 0===e||e.removeStorageSync(t)},this.removeStorage=t=>{var e;null===(e=this.minip)||void 0===e||e.removeStorage(t)},this.getNetworkType=()=>{const t=this;return new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getNetworkType({success:i=>{t.network=i,e(i)},fail:()=>e(null)})}))},this.request=({url:t,data:e,header:i,timeout:n,method:s,success:r,fail:a,complete:g})=>{var l;const u=null===(l=this.minip)||void 0===l?void 0:l.request({url:t,data:e,header:i,headers:i,timeout:n,method:s,success:r,fail:a,complete:g});let c=setTimeout((()=>{(null==u?void 0:u.abort)&&o(null==u?void 0:u.abort)&&(null==u||u.abort()),clearTimeout(c),c=null}),(n||1e4)+10);return u},this.getSystemInfo=()=>{const t=this;return new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getSystemInfo({success:i=>{t.systemInfo=i,e(i)},fail:()=>e(null)})}))},this.getSetting=()=>new Promise((t=>{var e;null===(e=this.minip)||void 0===e||e.getSetting({success:t,fail:t})}));const{platformConfig:{platform:e,scnPrefix:n}}=this.growingIO;this.platform=e,this.scnPrefix=n,this.growingIO.emitter.on(ft,(()=>{this.getNetworkType().then((()=>{var t;return null===(t=this.growingIO.dataStore)||void 0===t?void 0:t.eventReleaseInspector()})),this.getSystemInfo().then((()=>{var t;return null===(t=this.growingIO.dataStore)||void 0===t?void 0:t.eventReleaseInspector()}))}))}}class At extends Et{constructor(t){super(t),this.growingIO=t,this.hookSetTitle=()=>{var t;const e=null===(t=this.minip)||void 0===t?void 0:t.setNavigationBar,i=this;e&&Object.defineProperty(this.minip,"setNavigationBar",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){const t=i.getCurrentPath(),{title:e}=arguments[0]||{};i.growingIO.dataStore.eventHooks.currentPage.settedTitle[t]=e}return e.apply(this,arguments)}})},this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"selectAll")},this.getStorageSync=t=>{const{data:e}=my.getStorageSync({key:t});return e},this.setStorageSync=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync({key:t,data:e})},this.hookSetTitle()}}const qt=["gioPerformance"];class jt{constructor(t){var e,i,n,s,r,a;this.growingIO=t,this.innerPluginInit=()=>{var t;qt.forEach((t=>{var e;return k(null===(e=this.pluginsContext)||void 0===e?void 0:e.plugins,t)})),S(null===(t=this.pluginsContext)||void 0===t?void 0:t.plugins).forEach((t=>{var e,i;const{name:n,method:s}=null!==(i=null===(e=this.pluginsContext)||void 0===e?void 0:e.plugins[t])&&void 0!==i?i:{};h(this.pluginItems,(t=>t.name===n))||this.pluginItems.push({name:m(n||t),method:s||(t=>{})})})),_(this.pluginItems)||this.installAll()},this.install=(t,e,i)=>{var n,s;const{emitter:r}=this.growingIO,o=e||h(this.pluginItems,(e=>e.name===t));if((null===(n=this.growingIO)||void 0===n?void 0:n.plugins)[t])return A(`重复加载插件 ${t} 或插件重名，已跳过加载!`,"warn"),!1;if(!o)return A(`插件加载失败!不存在名为 ${t} 的插件!`,"error"),!1;try{return(null===(s=this.growingIO)||void 0===s?void 0:s.plugins)[t]=new o.method(this.growingIO,i),e&&(r.emit(pt,t),A("加载插件 "+t,"info")),!0}catch(i){return this.lifeError(e,i),A(`插件【${t}】加载异常 ${i}`,"error"),!1}},this.installAll=t=>{(t||this.pluginItems).forEach((e=>{this.install(e.name,t?e:void 0,t?null==e?void 0:e.options:void 0)&&!h(this.pluginItems,(t=>t.name===e.name))&&this.pluginItems.push({name:m(e.name),method:e.method?e.method:()=>{}})}))},this.uninstall=t=>{var e;k(this.pluginItems,t);const i=k(null===(e=this.growingIO)||void 0===e?void 0:e.plugins,t);return i||A(`卸载插件 ${t} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((t=>this.uninstall(t.name)))},this.lifeError=(t,e)=>{this.growingIO.emitter.emit(ht,{plugin:t,error:e}),A(`插件执行错误 ${t.name} ${e}`,"error")},this.callLifeCycle=(t,e)=>{this.pluginItems.forEach((i=>{const n=this.growingIO.plugins[i.name]?this.growingIO.plugins[i.name][t]:void 0;if(n&&o(n))try{n(e)}catch(t){this.lifeError(i,t)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(e=this.growingIO.emitter)||void 0===e||e.on(pt,(t=>this.callLifeCycle("onInstall",t))),null===(i=this.growingIO.emitter)||void 0===i||i.on(ht,(t=>this.callLifeCycle("onError",t))),null===(n=this.growingIO.emitter)||void 0===n||n.on(dt,(t=>this.callLifeCycle("onComposeBefore",t))),null===(s=this.growingIO.emitter)||void 0===s||s.on(ct,(t=>this.callLifeCycle("onComposeAfter",t))),null===(r=this.growingIO.emitter)||void 0===r||r.on(mt,(t=>this.callLifeCycle("onSendBefore",t))),null===(a=this.growingIO.emitter)||void 0===a||a.on(vt,(t=>this.callLifeCycle("onSendAfter",t)))}}let xt;var Nt={name:"gioTaobaoAdapter",method:class{constructor(t){this.growingIO=t,this.getSceneInfo=(t,e)=>{var i;null===(i=this.growingIO.minipInstance.minip)||void 0===i||i.getRelationAppInfo({success:i=>e(t,i),fail:()=>e(t,{})})},this.getRelationAppInfo=t=>{var e;null===(e=this.growingIO.minipInstance.minip)||void 0===e||e.getRelationAppInfo({success:t,fail:()=>t({})})},this.singleInvoke=t=>{var e;const{vdsConfig:i,emitter:n,uploader:s}=this.growingIO,r=s.getHoardingQueue(t),o=s.getRequestQueue(t);if(s.requestQueue[t]=[...o].filter((t=>(s.retryIds[t.requestId]||0)<s.retryLimit)),xt.isEmpty([...r,...o]))return;const a=null!==(e=r.shift())&&void 0!==e?e:o.shift();let g=Object.assign({},a);k(g,["requestId","trackingId"]),i.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(g,null,2)),n.emit(mt,{requestData:g}),this.cloudFuncInvoke(a,g)},this.cloudFuncInvoke=(t,e)=>{var i,n;const{vdsConfig:s,emitter:r,uploader:o}=this.growingIO,{serverUrl:a,projectId:g,tbConfig:l}=s,u=xt.niceTry((()=>{var t;return null!==(t=getApp())&&void 0!==t?t:$global})),c=null!==(i=l.cloud)&&void 0!==i?i:u.cloud;(null===(n=null==c?void 0:c.function)||void 0===n?void 0:n.invoke)?(o.requestingNum+=1,c.function.invoke(l.cloudFuncName,{domain:a,path:`/v3/projects/${g}/collect`,params:{stm:Date.now()},body:e},l.cloudFuncHandler).then((i=>{o.requestingNum-=1,i.success?r.emit(vt,{result:i,requestData:e}):(o.requestFailFn(t),xt.consoleText("请求失败! "+JSON.stringify(i),"error")),o.initiateRequest(t.trackingId)})).catch((e=>{o.requestingNum-=1,o.requestFailFn(t),xt.consoleText("请求失败! "+JSON.stringify(e),"error"),o.initiateRequest(t.trackingId)}))):xt.consoleText("请求失败！无法获取 cloud 对象，请检查 tbConfig 配置项！","error")},this.pluginVersion="__PLUGIN_VERSION__";const{utils:e,emitter:i}=this.growingIO;xt=e,i.on(ft,(t=>{const{inPlugin:e,dataStore:i}=t;e&&(xt.getGlobal().Component=function(...t){return i.eventHooks.componentOverriding(t[0])})})),i.on(lt,(({event:t})=>{const{dataStore:e,vdsConfig:i}=this.growingIO,n="小部件"+i.appId;switch(t){case"Page onInit":{const t=(t,i)=>{var s;const r=xt.keys(t).map((e=>`${e}=${t[e]}`)).join("&");e.scene=null!==(s=i.sceneId)&&void 0!==s?s:"",e.trackersExecute((t=>{e.sendVisit(t,{path:n,query:r,title:n})}))};this.getRelationAppInfo((e=>this.getSceneInfo(e,t)))}break;case"Page didMount":e.trackersExecute((t=>{const{trackPage:i}=e.getTrackerVds(t);i&&e.sendPage(t,{path:n,title:n})}))}}))}tbCloudAppInvoke(t,e){var i,n;const{vdsConfig:s,emitter:r,uploader:o}=this.growingIO,{serverUrl:a,projectId:g,tbConfig:u}=s,c=xt.niceTry((()=>{var t;return null!==(t=getApp())&&void 0!==t?t:$global})),d=null!==(i=u.cloud)&&void 0!==i?i:c.cloud;if(null===(n=null==d?void 0:d.application)||void 0===n?void 0:n.httpRequest){const i=l(t).trackingId;o.requestingNum+=1,d.application.httpRequest({path:u.path,method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},params:{serverUrl:a,projectId:g,stm:Date.now()},body:e,exts:{cloudAppId:u.cloudAppId}}).then((n=>{o.requestingNum-=1,n.success?r.emit(vt,{result:n,requestData:e}):(t.forEach((t=>{o.requestFailFn(t)})),xt.consoleText("请求失败! "+JSON.stringify(n),"error")),o.initiateRequest(i)})).catch((e=>{o.requestingNum-=1,t.forEach((t=>{o.requestFailFn(t)})),xt.consoleText("请求失败! "+JSON.stringify(e),"error"),o.initiateRequest(i)}))}else xt.consoleText("请求失败！无法获取 cloud 对象，请检查 tbConfig 配置项！","error")}}};class Ut extends jt{constructor(t){super(t),this.growingIO=t,this.pluginsContext={plugins:{gioTaobaoAdapter:Nt}}}}var Dt={},Kt={}.hasOwnProperty;function Ht(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function $t(t){try{return encodeURIComponent(t)}catch(t){return null}}Dt.stringify=function(t,e){e=e||"";var i,n,s=[];for(n in"string"!=typeof e&&(e="?"),t)if(Kt.call(t,n)){if((i=t[n])||null!=i&&!isNaN(i)||(i=""),n=$t(n),i=$t(i),null===n||null===i)continue;s.push(n+"="+i)}return s.length?e+s.join("&"):""},Dt.parse=function(t){for(var e,i=/([^=?#&]+)=?([^&]*)/g,n={};e=i.exec(t);){var s=Ht(e[1]),r=Ht(e[2]);null===s||null===r||s in n||(n[s]=r)}return n};class Rt{constructor(t){this.growingIO=t,this.generateURL=t=>{const{serverUrl:e,projectId:i}=this.growingIO.dataStore.getTrackerVds(t);return I(e,"http")?`${e}/v3/projects/${i}/collect`:`https://${e}/v3/projects/${i}/collect`},this.getHoardingQueue=t=>{var e;return null!==(e=this.hoardingQueue[t])&&void 0!==e?e:[]},this.getRequestQueue=t=>{var e;return null!==(e=this.requestQueue[t])&&void 0!==e?e:[]},this.commitRequest=t=>{var i,n;const s=Object.assign({},t),{vdsConfig:r,emitter:o}=this.growingIO;o.emit(ut,{eventData:t,trackingId:t.trackingId}),r.forceLogin?(e(this.hoardingQueue[t.trackingId])&&(this.hoardingQueue[t.trackingId]=[]),null===(i=this.hoardingQueue[t.trackingId])||void 0===i||i.push(s)):(e(this.requestQueue[t.trackingId])&&(this.requestQueue[t.trackingId]=[]),null===(n=this.requestQueue[t.trackingId])||void 0===n||n.push(s),this.initiateRequest(t.trackingId))},this.initiateRequest=(t,e)=>{const{plugins:i,vdsConfig:n,minipInstance:s,dataStore:r}=this.growingIO,o=[...this.getHoardingQueue(t),...this.getRequestQueue(t)],a=t=>{var a,g;if(null===(a=null==n?void 0:n.tbConfig)||void 0===a?void 0:a.cloudFuncSend)null===(g=null==i?void 0:i.gioTaobaoAdapter)||void 0===g||g.singleInvoke(t);else if(e)this.batchInvoke(t);else{const{uploadInterval:e}=this.growingIO.dataStore.getTrackerVds(t);P(this.batchInvoke,e,!1,!1)(t)}o.some((t=>"VISIT"===t.eventType))&&s.removeStorageSync(r.getStorageKey(t,"originalSource"))};if(o.length>0)if(this.requestingNum<this.requestLimit)a(t);else{let e=setInterval((()=>{this.requestingNum<this.requestLimit&&(a(t),clearInterval(e),e=void 0)}),500)}},this.batchInvoke=t=>{const{vdsConfig:e,emitter:i}=this.growingIO,n=this.getHoardingQueue(t),s=this.getRequestQueue(t);let r=[...n,...s];r.length>50?(r=r.slice(0,50),n.length>50?this.hoardingQueue[t]=n.slice(50):(this.requestQueue[t]=s.slice(50-n.length),this.hoardingQueue[t]=[])):(this.hoardingQueue[t]=[],this.requestQueue[t]=[]);let o=r.filter((t=>(this.retryIds[t.requestId]||0)<=this.retryLimit));if(_(o))return;const a=o.map((t=>{const e=Object.assign({},t);return k(e,["requestId","trackingId"]),e}));e.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(a,null,2)),i.emit(mt,{eventsQueue:o,requestData:a,trackingId:t})},this.sendEvent=(t,e)=>{var i;const n=l(t).trackingId,{minipInstance:s,dataStore:r,emitter:o,plugins:a}=this.growingIO,{compress:g,requestTimeout:u}=r.getTrackerVds(n);this.requestingNum+=1;const c={"content-type":"jdp"===s.platform?"application/json":"application/json;charset=UTF-8"};let d=[...e];const h=!!g&&(null===(i=null==a?void 0:a.gioCompress)||void 0===i?void 0:i.compressToUTF16);h&&(d=a.gioCompress.compressToUTF16(JSON.stringify(e)),c["X-Compress-Codec"]="1");const p=this.generateURL(n);s.request({url:`${p}?stm=${Date.now()}&compress=${h?"1":"0"}`,header:c,method:"POST",data:d,timeout:u,fail:e=>{[200,204].includes(e.code)||(t.forEach((t=>{this.requestFailFn(t)})),A("请求失败!"+JSON.stringify(e),"error"))},complete:t=>{this.requestingNum-=1,o.emit(vt,{result:t,requestData:e}),this.initiateRequest(n)}})},this.requestFailFn=t=>{if(this.retryIds[t.requestId]||(this.retryIds[t.requestId]=0),this.retryIds[t.requestId]+=1,!this.requestQueue[t.trackingId].some((e=>e.requestId===t.requestId))){let e=setTimeout((()=>{_(this.requestQueue[t.trackingId])?(this.requestQueue[t.trackingId].push(t),this.initiateRequest(t.trackingId)):this.requestQueue[t.trackingId].push(t),clearTimeout(e),e=null}),800)}},this.hoardingQueue={},this.requestQueue={},this.requestLimit=3,this.retryLimit=2,this.retryIds={},this.requestingNum=0;const{emitter:i,vdsConfig:n,plugins:s}=this.growingIO;i.on(mt,(({eventsQueue:t,requestData:e,trackingId:i})=>{var r,o;i===this.growingIO.trackingId&&((null===(r=null==n?void 0:n.tbConfig)||void 0===r?void 0:r.cloudAppId)?null===(o=null==s?void 0:s.gioTaobaoAdapter)||void 0===o||o.tbCloudAppInvoke(t,e):this.sendEvent(t,e))}))}}class Lt{constructor(t){this.growingIO=t,this._getUidKey=()=>this.growingIO.inPlugin?"_growing_plugin_uid_":"_growing_uid_",this.getUid=()=>{const{minipInstance:t}=this.growingIO;return this._uid||(this._uid=t.getStorageSync(this._getUidKey())),this._uid||(this._uid=K(),t.setStorage(this._getUidKey(),this._uid)),this._uid},this.setUid=t=>{const e=this._uid;this._uid=t,e!==this._uid&&(this.growingIO.minipInstance.setStorage(this._getUidKey(),this._uid),this.growingIO.emitter.emit("UID_UPDATE",{newUId:t,oldUId:e}))},this.getSessionId=t=>(this._sessionId[t]||this.setSessionId(t),this._sessionId[t]),this.setSessionId=(t,e)=>{const i=this._sessionId[t];e||(e=K()),this._sessionId[t]=e,i!==e&&this.growingIO.emitter.emit("SESSIONID_UPDATE",{newSessionId:e,oldSessionId:i})},this._getUserIdKey=t=>this.growingIO.dataStore.getStorageKey(t,"userId"),this.getUserId=t=>{const{minipInstance:e}=this.growingIO;return this._userId[t]||(this._userId[t]=e.getStorageSync(this._getUserIdKey(t))),this._userId[t]},this.setUserId=(t,i)=>{const n=this._userId[t];this._userId[t]=e(i)?"":i,n!==this._userId[t]&&(this.growingIO.minipInstance.setStorage(this._getUserIdKey(t),this._userId[t]),this.growingIO.emitter.emit("USERID_UPDATE",{newUserId:i,oldUserId:n})),i&&this.setGioId(t,i)},this._getUserKeyKey=t=>this.growingIO.dataStore.getStorageKey(t,"userKey"),this.getUserKey=t=>{const{minipInstance:e}=this.growingIO;return this._userKey[t]||(this._userKey[t]=e.getStorageSync(this._getUserKeyKey(t))),this._userKey[t]},this.setUserKey=(t,i)=>{const n=this._userKey[t];this._userKey[t]=e(i)?"":i,n!==this._userKey[t]&&(this.growingIO.minipInstance.setStorage(this._getUserKeyKey(t),this._userKey[t]),this.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:i,oldUserKey:n}))},this._getGioIdKey=t=>this.growingIO.dataStore.getStorageKey(t,"gioId"),this.getGioId=t=>{const{minipInstance:e}=this.growingIO;return this._gioId[t]||(this._gioId[t]=e.getStorageSync(this._getGioIdKey(t))),this._gioId[t]},this.setGioId=(t,i)=>{const n=this._gioId[t];this._gioId[t]=e(i)?"":i,n!==this._gioId[t]&&(this.growingIO.minipInstance.setStorage(this._getGioIdKey(t),this._gioId[t]),this.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:i,oldGioId:n}))},this.initUserInfo=t=>{var e;const{minipInstance:i}=this.growingIO,n=[this._getUidKey(),this._getUserIdKey(t),this._getUserKeyKey(t),this._getGioIdKey(t)],s=null!==(e=z(i,n))&&void 0!==e?e:[];["_uid","_userId","_userKey","_gioId"].forEach(((e,i)=>{"_uid"===e?this.getUid():this[e][t]=s[i]}))},this.saveUserInfo=()=>{const{minipInstance:t,dataStore:{trackersExecute:e}}=this.growingIO;e((e=>{W(t,[{key:this._getUidKey(),value:this._uid},{key:this._getUserIdKey(e),value:this._userId[e]},{key:this._getUserKeyKey(e),value:this._userKey[e]},{key:this._getGioIdKey(e),value:this._gioId[e]}])}))},this._uid=void 0,this._sessionId={},this._userId={},this._userKey={},this._gioId={}}}const Ft=new class{constructor(){var t;this.init=t=>{var e;this.emitter.emit("ON_SDK_INITIALIZE_BEFORE",{options:t});try{if(A("Gio小程序SDK 初始化中...","info"),t.trackingId&&this.dataStore.initializedTrackingIds.includes(t.trackingId))throw Error(`已存在实例 ${t.trackingId}，请勿重复初始化!`);if(this.trackingId&&!this.plugins.gioMultipleInstances)throw Error("您正在尝试初始化另一个实例，请集成多实例插件后重试!");const i=this.dataStore.initTrackerOptions(t);return null===(e=this.emitter)||void 0===e||e.emit(ft,i),this.gioSDKInitialized=!0,this.dataStore.initTrackerHooker(i),"quickapp"!==this.gioPlatform&&this.userStore.initUserInfo(t.trackingId),this.emitter.emit(yt,i),this.trackingId&&this.trackingId!==t.trackingId||(M().__gio__=()=>this),A("Gio小程序SDK 初始化完成！","success"),this.inPlugin&&"tbp"!==this.minipInstance.platform&&this.dataStore.sendVisit(i.trackingId),this.vdsConfig.forceLogin&&A("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),!0}catch(t){return A(t,"error"),!1}},this.handlerDistribute=(t,e,i)=>{const{initializedTrackingIds:n,getTrackerVds:s}=this.dataStore;if(s(t)&&n.includes(t))return this[e](t,...i);A(`不存在实例：${t}，请检查!`,"warn")},this.registerPlugins=t=>{this.plugins.pluginItems=[...this.plugins.pluginItems,...t],this.plugins.installAll(t)},this.getPlugins=()=>this.plugins.pluginItems,this.getDeviceId=()=>this.userStore.getUid(),this.getOption=(t,e)=>this.dataStore.getOption(t,e),this.setOption=(t,e,i)=>{var n;return S(st).includes(e)?typeof i===(null===(n=et[e])||void 0===n?void 0:n.type)?(this.dataStore.setOption(t,e,i),A(`已修改${st[e]}: ${i}`,"info"),!0):(A(`参数格式不正确：${i}，请检查后重试!`,"error"),!1):(A(`不存在可修改的配置项：${e}，请检查后重试!`,"error"),!1)},this.setPageAttributes=(t,e)=>{if(r(e)&&!_(e)){const{currentPage:i}=this.dataStore.eventHooks;return _(i.pageProps[t])&&(i.pageProps[t]={}),_(i.pageProps[t][i.path])&&(i.pageProps[t][i.path]={}),_(e)||O(e,((e,n)=>{o(i.pageProps[t][i.path][n])&&!o(e)||(i.pageProps[t][i.path][n]=e)})),!0}return q("setPageAttributes"),!1},this.clearPageAttributes=(t,e)=>{try{if(!_(this.dataStore.eventHooks.currentPage.pageProps[t])){const{currentPage:i}=this.dataStore.eventHooks;a(e)&&!_(e)?e.forEach((e=>{k(i.pageProps[t][i.path],e)})):i.pageProps[t][i.path]={}}}catch(t){return q("clearPageAttributes"),!1}},this.sendPage=(t,e)=>{const{trackPage:i}=this.dataStore.getTrackerVds(t);i?A("仅在关闭trackPage时允许调用sendPage，请确认后修改初始化配置项!","error"):this.dataStore.sendPage(t,e)},this.identify=(t,e)=>{if(t===this.trackingId)if(this.vdsConfig.forceLogin){if(!X(e))return void q("identify");const t=p(e).slice(0,1e3);this.userStore.setUid(t),this.dataStore.setOption(this.trackingId,"forceLogin",!1),this.dataStore.trackersExecute((e=>{const i=this.uploader.getHoardingQueue(e);i.forEach(((e,n)=>i[n].deviceId=t)),this.uploader.initiateRequest(e,!0)}))}else q("identify",!1,"forceLogin未开启");else q("identify",!1,"子实例不允许调用identify")},this.setUserAttributes=(t,e)=>{var i;if(r(e)&&!_(e)){const{eventContextBuilder:n,eventInterceptor:s,lastVisitEvent:r}=this.dataStore,o=Object.assign({eventType:"LOGIN_USER_ATTRIBUTES"},n(t));o.attributes=Q(Object.assign(Object.assign({},null!==(i=o.attributes)&&void 0!==i?i:{}),D(e))),o.path||(o.path=r.path,o.query=r.query,o.title=r.title),s(o)}else q("setUserAttributes")},this.setUserId=(t,i,n)=>{if(X(i)){const s=this.userStore.getGioId(t);i=p(i).slice(0,1e3),n=p(n).slice(0,1e3),this.userStore.setUserId(t,i);const{idMapping:r}=this.dataStore.getTrackerVds(t);if(r&&this.userStore.setUserKey(t,e(n)?"":n),s&&s!==i){this.userStore.setSessionId(t);const{path:e,query:i,settedTitle:n}=this.dataStore.eventHooks.currentPage;this.dataStore.eventHooks.currentPage.title=n[e]||this.minipInstance.getPageTitle(this.minipInstance.getCurrentPage()),this.dataStore.sendVisit(t,{path:e,query:i})}}else q("setUserId")},this.clearUserId=t=>{this.userStore.setUserId(t,void 0),this.userStore.setUserKey(t,void 0)},this.setGeneralProps=(t,e)=>r(e)&&!_(e)?(_(this.dataStore.generalProps[t])&&(this.dataStore.generalProps[t]={}),O(e,((e,i)=>{o(this.dataStore.generalProps[t][i])&&!o(e)||(this.dataStore.generalProps[t][i]=e)})),!0):(q("setGeneralProps"),!1),this.clearGeneralProps=(t,e)=>{try{_(this.dataStore.generalProps[t])||(a(e)&&!_(e)?e.forEach((e=>{k(this.dataStore.generalProps[t],e)})):this.dataStore.generalProps[t]={})}catch(t){return q("clearGeneralProps"),!1}},this.track=(t,e,i)=>{U(e,(()=>{var n;const{eventContextBuilder:s,eventInterceptor:o}=this.dataStore,a=Object.assign({eventType:"CUSTOM",eventName:e},s(t));a.attributes=Q(Object.assign(Object.assign({},null!==(n=a.attributes)&&void 0!==n?n:{}),D(Object.assign({},r(i)&&!_(i)?i:{})))),this.plugins.gioMultipleInstances&&i&&i["&&sendTo"]&&(a["&&sendTo"]=i["&&sendTo"]),o(a)}))},this.trackTimerStart=(t,e)=>{const{dataCollect:i}=this.dataStore.getTrackerVds(t);return i?U(e,(()=>{const i=K();return this.dataStore.trackTimers[t]||(this.dataStore.trackTimers[t]={}),this.dataStore.trackTimers[t][i]={eventName:e,leng:0,start:+Date.now()},i})):(A("指定实例未开启数据采集，请检查!","error"),!1)},this.trackTimerPause=(t,e)=>{const i=this.dataStore.trackTimers[t];if(e&&i&&i[e]){const t=i[e];return t.start&&(t.leng=t.leng+(+Date.now()-t.start)),t.start=0,!0}return!1},this.trackTimerResume=(t,e)=>{const i=this.dataStore.trackTimers[t];if(e&&i&&i[e]){const t=i[e];return 0===t.start&&(t.start=+Date.now()),!0}return!1},this.trackTimerEnd=(t,e,i)=>{var n;const{dataCollect:s}=this.dataStore.getTrackerVds(t),o=this.dataStore.trackTimers[t];if(e&&o&&o[e]){if(s){const s=864e5,a=o[e];if(0!==a.start){const t=+Date.now()-a.start;a.leng=t>0?a.leng+t:0}const{eventContextBuilder:g,eventInterceptor:l}=this.dataStore,u=Object.assign({eventType:"CUSTOM",eventName:a.eventName},g(t));return u.attributes=Q(Object.assign(Object.assign({},null!==(n=u.attributes)&&void 0!==n?n:{}),D(Object.assign(Object.assign({},r(i)&&!_(i)?i:{}),{event_duration:a.leng>s?0:a.leng/1e3})))),this.plugins.gioMultipleInstances&&i&&i["&&sendTo"]&&(u["&&sendTo"]=i["&&sendTo"]),l(u),!0}return A("指定实例未开启数据采集，计时器已移除，请检查!","error"),!1}return A("未查询到指定计时器，请检查!","error"),!1},this.removeTimer=(t,e)=>{const i=this.dataStore.trackTimers[t];return e&&i&&i[e]?(delete i[e],!0):(A("未查询到指定计时器，请检查!","error"),!1)},this.clearTrackTimer=t=>{this.dataStore.trackTimers[t]={}},this.setLocation=(t,e,i)=>{_(this.dataStore.locationData[t])&&(this.dataStore.locationData[t]={});const n=this.dataStore.locationData[t],s=t=>t>=-180&&180>=t;s(e)&&s(i)&&(n.latitude!==e||n.longitude!==i)&&(this.dataStore.locationData[t]={latitude:e,longitude:i})},this.updateImpression=()=>{A("updateImpression 错误! 请集成半自动埋点浏览插件后重试!","error")},this.getABTest=(t,e,i)=>{A("获取ABTest数据错误! 请集成ABTest插件后重试!","error"),x(i,{})},this.getGioInfo=t=>{const{getUid:e,getUserId:i,getUserKey:n,getSessionId:s}=this.userStore,{projectId:r,appId:o,dataSourceId:a,dataCollect:g,idMapping:l,extraParams:u,ignoreFields:c}=this.dataStore.getTrackerVds(t),d={gioappid:o,giocs1:i(t)||"",gioplatform:this.platformConfig.platform,gioprojectid:r,gios:s(t),giou:e()};return d.giodatacollect=g,d.giodatasourceid=a,l&&(d.giouserkey=n(t)),_(u)||u.forEach((t=>{c.includes(t)||(d["gio"+t]=this.dataStore.lastVisitEvent[t])})),Dt.stringify(d)},this.utils=Object.assign(Object.assign(Object.assign({},E),Z),{qs:Dt}),this.emitter={all:t=t||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map((function(t){t(i)})),(n=t.get("*"))&&n.slice().map((function(t){t(e,i)}))}},this.gioPlatform="tb",this.gioFramework="native",this.sdkVersion="4.2.0";try{"quickapp"===this.gioPlatform||o(getApp)&&o(App)?this.inPlugin=!1:this.inPlugin=!0}catch(t){this.inPlugin=!0}this.inPlugin&&A("未检测到小程序实例，自动切换为插件模式!","info"),this.platformConfig=Ct,this.minipInstance=new At(this),this.dataStore=new _t(this),this.userStore=new Lt(this),this.uploader=new Rt(this),this.plugins=new Ut(this),this.plugins.innerPluginInit()}},Vt=function(){var t;const e=arguments[0];let n="g0",s=e;if(e.indexOf(".")>-1&&(n=null!==(t=e.split(".")[0])&&void 0!==t?t:"g0",s=e.split(".")[1]),i(s)&&nt.includes(s)&&Ft[s]){const t=c(Array.from(arguments));if("init"===s){const e=((t,e)=>{const i=p(e[0]),n=p(e[1]),s=(4===e.length?e[3]:e[2])||{};return i&&n?t.dataStore.initializedTrackingIds.some(((e,s)=>{const r=0===s?t.vdsConfig:t.subInstance[e];return r.projectId===i&&r.dataSourceId===n}))?(A("SDK初始化失败，重复初始化，请检查初始化参数!","error"),!1):{projectId:i,dataSourceId:n,appId:p(4===e.length?e[2]:""),userOptions:s}:(A('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", "您的小程序 AppId（可选）", options: { host: "您的数据上报地址host" }); 进行初始化!',"error"),!1)})(Ft,t);if(e){const{projectId:t,dataSourceId:i,appId:s,userOptions:r}=e;return Ft.init(Object.assign(Object.assign({},r),{projectId:t,dataSourceId:i,appId:s,trackingId:n}))}return!1}if("registerPlugins"===s)Ft.registerPlugins(t[0]);else{if(Ft.gioSDKInitialized&&Ft.vdsConfig)return it.includes(s)?j((()=>Ft.handlerDistribute(n,s,t))):j((()=>Ft[s](...t)));A("SDK未初始化!","error")}}else if(rt.includes(s))A(`方法 ${p(s)} 已被弃用，请移除!`,"warn");else{if("canIUse"===s)return nt.includes(arguments[1])&&!!Ft[arguments[1]];A(`不存在名为 ${p(s)} 的方法调用!`,"error")}};M().gdp=Vt,M().gioSDKVersion=Ft.sdkVersion;const Gt=j((()=>{var t;return null!==(t=Ft.dataStore.eventHooks.growingApp)&&void 0!==t?t:App})),Bt=j((()=>{var t;return null!==(t=Ft.dataStore.eventHooks.growingPage)&&void 0!==t?t:Page})),Mt=j((()=>{var t;return null!==(t=Ft.dataStore.eventHooks.growingComponent)&&void 0!==t?t:Component})),Qt=j((()=>{var t;return null!==(t=Ft.dataStore.eventHooks.growingBehavior)&&void 0!==t?t:Behavior}));export{Gt as GioApp,Qt as GioBehavior,Mt as GioComponent,Bt as GioPage,Vt as default};
