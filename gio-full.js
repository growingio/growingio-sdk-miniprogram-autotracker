const t={autotrack:{type:"boolean",default:!0},cml:{type:"object",default:!1},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},subpackage:{type:"boolean",default:!1},keepAlive:{type:"number",default:3e5},remax:{type:["object","module"],default:!1},taro:{type:["object","module"],default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},uniVue:{type:["object","function"],default:!1},version:{type:"string",default:"1.0.0"},wepy:{type:"function",default:!1}},e={compress:{type:"boolean",default:!0},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},gtouchHost:{type:"string",default:"cdp.growingio.com"},host:{type:"string",default:"cdp-api.growingio.com"},ignoreFields:{type:"array",default:[]},scheme:{type:"string",default:"https"},uploadInterval:{type:"number",default:1e3},performance:{type:"object",default:{monitor:!0,exception:!0}}},i={},n=["clearUserId","enableDebug","getGioInfo","getOption","identify","init","setAutotrack","setDataCollect","setOption","setUserId","track","setLocation","setGeneralProps","clearGeneralProps","setPageAttributes","updateImpression","setTrackerHost","setTrackerScheme","setUserAttributes","registerPlugins","getDeviceId","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer"],s=["autotrack","dataCollect","debug","host","scheme"],o={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式"},r=["setConfig","collectImp","setPlatformProfile","getLocation"],a=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],l=[...a,"appChannel","language","platformVersion"],g=t=>["undefined","null"].includes(H(t)),d=t=>"string"===H(t),u=t=>"number"===H(t),c=t=>"boolean"===H(t),h=t=>"[object Object]"==={}.toString.call(t)&&!g(t),p=t=>"function"===H(t),v=t=>Array.isArray(t)&&"array"===H(t),m=t=>{try{return Array.from(t)[0]}catch(t){return}},f=t=>{try{const e=Array.from(t);return e[e.length-1]}catch(t){return}},I=(t,e=1)=>v(t)&&u(e)?t.slice(e>0?e:1,t.length):t,w=t=>{if(v(t)){let e=0;const i=[];for(const n of t)n&&!q(n)&&(i[e++]=n);return i}return t},O=(t,e)=>{if(v(t)){const i=t.findIndex(e);return 0>i?void 0:t[i]}},y=t=>g(t)?"":""+t,S=(t,e)=>"string"===H(t)?t.split(e):t,b=t=>{if(d(t)){const e=S(t,"");return`${m(e).toLowerCase()}${I(e).join("")}`}return t},T=(t,e)=>t.slice(0,e.length)===e,_=(t,e)=>{const{length:i}=t;let n=i;n>i&&(n=i);const s=n;return n-=e.length,n>=0&&t.slice(n,s)===e},P={}.hasOwnProperty,C=(t,e)=>!g(t)&&P.call(t,e),k=t=>h(t)?Object.keys(t):[],E=(t,e)=>{k(t).forEach((i=>e(t[i],i)))},x=(t,e)=>{const i=k(t);return!(!h(t)||!h(e)||i.length!==k(e).length||i.map(((i,n)=>h(t[i])?x(t[i],e[i]):t[i]===e[i])).includes(!1))},A=(t,e,i)=>{let n=t;return h(t)?(e.split(".").forEach((t=>{n=n?n[t]:i})),n):i},N=(t,e)=>{if(!h(t))return!1;try{if("string"===H(e))return delete t[e];if("array"===H(e))return e.map((e=>delete t[e]));"object"===H(e)&&e.constructor===RegExp&&k(t).forEach((i=>{e.test(i)&&N(t,i)}))}catch(t){return!1}},j=(t,e=250,i,n)=>{let s,o=0;return"boolean"!==H(i)&&(n=t,t=i,i=void 0),function(...r){let a=this,l=Date.now()-o;function g(){o=Date.now(),t.apply(a,r)}n&&!s&&g(),s&&clearTimeout(s),void 0===n&&l>e?g():!0!==i&&(s=setTimeout(n?function(){s=void 0}:g,void 0===n?e-l:e))}},q=t=>v(t)?0===t.length:h(t)?0===k(t).length:!t,H=t=>({}.toString.call(t).slice(8,-1).toLowerCase());var V=Object.freeze({__proto__:null,isNil:g,isString:d,isNumber:u,isBoolean:c,isObject:h,isRegExp:t=>"[object RegExp]"==={}.toString.call(t),isFunction:p,isArray:v,isDate:t=>"date"===H(t),fixed:(t,e)=>u(t)?Number(t.toFixed(u(e)?e:2)):d(t)&&"NaN"!==y(Number(t))?Number(Number(t).toFixed(u(e)?e:2)):t,head:m,last:f,drop:I,dropWhile:(t,e)=>v(t)?t.filter((t=>!e(t))):t,compact:w,find:O,toString:y,split:S,lowerFirst:b,upperFirst:t=>{if(d(t)){const e=S(t,"");return`${m(e).toUpperCase()}${I(e).join("")}`}return t},startsWith:T,endsWith:_,hasOwnProperty:P,has:C,keys:k,forEach:E,isEqual:x,get:A,unset:N,throttle:j,isEmpty:q,typeOf:H,formatDate:t=>{function e(t){return 10>t?"0"+t:t}return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"."+e(t.getMilliseconds())}});const $=(t,e)=>{console.log("%c[GrowingIO]："+t,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[e]||"")},D=t=>{try{return t()}catch(t){return}},F=t=>{const e={};return h(t)&&E(t,((t,i)=>{const n=y(i).slice(0,100);h(t)?e[n]=F(t):v(t)?(e[n]=t.slice(0,100),"cdp"===(global||$global).gioEnvironment?e[n]=e[n].join("||"):e[n]=y(e[n])):e[n]=g(t)?"":y(t).slice(0,1e3)})),e},R=t=>d(t)?t.trim().substring(0,100):t,L=(t,e)=>d(t)&&!q(t)&&t.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?e():($("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1);var B=Object.freeze({__proto__:null,consoleText:$,niceTry:D,limitObject:F,limitString:R,eventNameValidate:L});const U=t=>d(t)&&t.length>0||u(t)&&t>0,M=t=>!t.vdsConfig&&!t.gioSDKInitialized||($("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1),K=t=>!!w(t)||($('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", "你的应用 AppId", options); 进行初始化!',"error"),!1),G=t=>{const e=t[0];let i=f(t);return U(e)?(h(i)&&i||(i={}),{projectId:e,userOptions:i}):($("SDK初始化失败，accountId 参数不合法!","error"),!1)},Q=t=>{const e=t[1];let i=t[2];const n=f(t);return e&&d(e)?U(i)?{dataSourceId:e,appId:i,cdpOptions:n}:($("SDK初始化失败，appId 参数不合法!","error"),!1):($("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)},W=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,z=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i;let J;var X={name:"gioUniAppAdapter",method:class{constructor(t){var e,i;this.growingIO=t,this.main=()=>{var t,e,i,n;if(this.uniVue||(this.uniVue=null===(e=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===e?void 0:e.uniVue),console.log("Vue version: ",this.uniVue.version),null===(n=null===(i=this.growingIO)||void 0===i?void 0:i.vdsConfig)||void 0===n?void 0:n.subpackage)return!1;switch(Number.parseInt(J.head(J.split(this.uniVue.version,".")),10)){case 2:this.uniVue2Proxy(this.uniVue);break;case 3:this.uniVue3Proxy(this.uniVue);break;default:J.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")}},this.getHandlerName=t=>{let e="__e";const{type:i,currentTarget:n,target:s}=t,o=(null==n?void 0:n.dataset)||(null==s?void 0:s.dataset);if(o){const t=o.eventOpts||o["event-opts"],n=(t,e)=>t===e||"regionchange"===e&&("begin"===t||"end"===t);t&&t.forEach((t=>{let s=J.head(t);const o="^"===s.charAt(0);s=o?s.slice(1):i;const r="~"===s.charAt(0);s=r?s.slice(1):i;const a=J.last(t);n(i,s)&&(e=J.head(J.head(a)))}))}return e},this.uniVue2Proxy=t=>{const{dataStore:{eventHooks:e},gioPlatform:i,minipInstance:n}=this.growingIO;"swan"===i?App=function(){return e.growingApp(arguments[0])}:e.nativeGrowing(),t.mixin({beforeMount(){if("page"===this.mpType){e.pageOverriding(this.$scope);const t=this,i=n.getPageTitle;n.getPageTitle=function(){var n,s,o;const r=t.$scope.route,a=r===e.currentPage.path?null===(o=null===(s=null===(n=t.$scope)||void 0===n?void 0:n.$vm)||void 0===s?void 0:s._data)||void 0===o?void 0:o.gioPageTitle:void 0;return a||i.apply(this,arguments)}}}})},this.uniVue3Proxy=t=>{const{dataStore:{eventHooks:e},minipInstance:i}=this.growingIO;e.nativeGrowing();const n=i.getPageTitle;i.getPageTitle=function(){var t,e,s;let o=J.isEmpty(arguments[0])?i.getCurrentPage():arguments[0];if("page"===(null===(t=null==o?void 0:o.$vm)||void 0===t?void 0:t.mpType)&&(null===(e=null==o?void 0:o.$vm)||void 0===e?void 0:e.__route__)){return(null===(s=null==o?void 0:o.$vm)||void 0===s?void 0:s.gioPageTitle)||n.apply(this,arguments)}return n.apply(this,arguments)},t.mixin({beforeMount(){var t;const i=(t,i)=>J.isFunction(i)&&!e.pageHandlers.includes(t)?function(){return e.customFcEffects(t,i).apply(this,arguments)}:i,n=t=>J.keys(t).forEach((t=>{Object.defineProperty(this,t,{value:i(t,this[t]),configurable:!0,writable:!0})}));n(this.$options.methods),n(null===(t=null==this?void 0:this.$)||void 0===t?void 0:t.setupState);const s=this._.emit;this._.emit=function(){return(()=>{e.customFcEffects(arguments[0],(()=>{})).apply(this,arguments)})(),s.apply(this,arguments)}}})},J=this.growingIO.utils,this.uniVue=null===(i=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===i?void 0:i.uniVue}}};let Z;var Y={name:"gioTaroAdapter",method:class{constructor(t){var e,i,n,s;this.growingIO=t,this.main=()=>{var t,e,i,n;this.taro||(this.taro=null===(e=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===e?void 0:e.taro),this.vue||(this.vue=null===(n=null===(i=this.growingIO)||void 0===i?void 0:i.vdsConfig)||void 0===n?void 0:n.taroVue);const{Current:s,createComponent:o}=this.taro;!s&&o?this.proxyTaro2(this.taro):s&&!o?this.proxyTaro3(this.taro,this.vue):Z.consoleText("未获取到Taro实例或不支持的Taro版本，请检查!","error")},this.proxyTaro2=t=>{const e=this,i=t.createApp,n=t.createComponent;i&&(t.createApp=function(t){const n=i(t);return e.growingIO.dataStore.eventHooks.appOverriding(n),n}),n&&(t.createComponent=function(t,i){const s=n(t,i);return i?e.growingIO.dataStore.eventHooks.pageOverriding(["my","tt"].includes(e.growingIO.gioPlatform)?s:s.methods):e.growingIO.dataStore.eventHooks.componentOverriding(["my","tt"].includes(e.growingIO.gioPlatform)?s:s.methods),s})},this.proxyTaro3=(t,e)=>{const{eventHooks:i}=this.growingIO.dataStore;if(e){console.log("Vue version: ",e.version);const t=Number.parseInt(Z.head(Z.split(e.version,".")),10);i.nativeGrowing(),2===t?this.taro3Vue2Proxy(e):3===t?this.taro3Vue3Proxy(e):Z.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")}else i.nativeGrowing(["App"]),this.taro3ReactProxy(t)},this.taro3ReactProxy=t=>{var e;const i=document.__proto__.__proto__,n=this,{eventHooks:s}=this.growingIO.dataStore,o=null===(e=null==t?void 0:t.hooks)||void 0===e?void 0:e.call;var r;o?Object.defineProperty(t.hooks,"call",{writable:!0,enumerable:!0,configurable:!0,value:function(){const t=Array.from(arguments);let e=o.apply(this,t);if("getLifecycle"===t[0]){const i=t[2];if(s.pageHandlers.includes(i)){let t=Z.isArray(e)?e[0]:e;t=s.lifeFcEffects(i,Z.isFunction(t)?t:()=>{},"Page"),e=Z.isArray(e)?[t]:t}}return e}}):($("Taro3实例获取失败，请检查初始化逻辑!","warn"),s.nativeGrowing(["Page"])),Object.defineProperty(i,"addEventListener",{writable:!0,enumerable:!0,configurable:!0,value:(r=i.addEventListener,function(){const t=arguments[1],e=n.growingIO.dataStore.eventHooks.customFcEffects(t.name,t);return r.call(this,arguments[0],e,arguments[2])})})},this.taro3Vue2Proxy=t=>{const{eventHooks:e}=this.growingIO.dataStore,i=(t,i,n)=>Z.isFunction(n)&&!e.pageHandlers.includes(i)?function(){e.customFcEffects(i,n).apply(this,arguments)}:n;t.mixin({beforeMount:function(){const t=this.$options.methods;Z.keys(t).forEach((t=>{Object.defineProperty(this,t,{writable:!0,enumerable:!0,configurable:!0,value:i(0,t,this[t])})}))}})},this.taro3Vue3Proxy=t=>{const{eventHooks:e}=this.growingIO.dataStore;t.mixin({beforeMount:function(){var t;const i=(t,i)=>Z.isFunction(i)&&!e.pageHandlers.includes(t)?function(){return e.customFcEffects(t,i).apply(this,arguments)}:i,n=t=>Z.keys(t).forEach((t=>{Object.defineProperty(this,t,{value:i(t,this[t]),configurable:!0,writable:!0})}));n(this.$options.methods),n(null===(t=null==this?void 0:this.$)||void 0===t?void 0:t.setupState);const s=this._.emit;this._.emit=function(){return(()=>{e.customFcEffects(arguments[0],(()=>{})).apply(this,arguments)})(),s.apply(this,arguments)}}})},this.saveFullPage=t=>{const e=t=>{t.forEach((t=>{var i;(null===(i=null==t?void 0:t.ctx)||void 0===i?void 0:i.route)?(this.growingIO.taro3VMs||(this.growingIO.taro3VMs={}),this.growingIO.taro3VMs[t.ctx.route]=t):Z.isArray(t.childNodes)&&e(t.childNodes)}))};e(t.childNodes)},Z=this.growingIO.utils,this.taro=null===(i=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===i?void 0:i.taro,this.vue=null===(s=null===(n=this.growingIO)||void 0===n?void 0:n.vdsConfig)||void 0===s?void 0:s.taroVue}}};let et,it,nt,st=[];var ot={name:"gioRemaxAdapter",method:class{constructor(t){var e,i;this.growingIO=t,this.main=()=>{var t,e;this.remax||(this.remax=null===(e=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===e?void 0:e.remax);const{nativeGrowing:i}=this.growingIO.dataStore.eventHooks;i()},this.getTopView=t=>{var e;const i=null===(e=t.__data__||t.data)||void 0===e?void 0:e.root,n=et.head(i.children);let s;return et.isNumber(n)&&et.has(i,"nodes")?s=i.nodes[et.head(i.children)]:et.isObject(n)&&(s=n),s},this.isPageTopView=(t,e)=>{var i,n,s,o,r;const a=this.getTopView(e),l=et.isArray(null===(i=null==t?void 0:t.memoizedProps)||void 0===i?void 0:i.children)?et.compact(null===(n=null==t?void 0:t.memoizedProps)||void 0===n?void 0:n.children):[];return(null==t?void 0:t.type)===(null==a?void 0:a.type)&&(null===(s=null==t?void 0:t.memoizedProps)||void 0===s?void 0:s.className)===(null===(o=null==a?void 0:a.props)||void 0===o?void 0:o.class)&&l.length===(null===(r=null==a?void 0:a.children)||void 0===r?void 0:r.length)},this.fiberNodeTraverse=(t,e)=>this.isPageTopView(t,e)?t:t.child?this.fiberNodeTraverse(t.child,e):null,this.findRealRoot=t=>{var e,i;return(null===(i=null===(e=null==t?void 0:t.wrapperRef)||void 0===e?void 0:e.current)||void 0===i?void 0:i._reactInternals)&&(t.__data__||t.data)?this.fiberNodeTraverse(t.wrapperRef.current._reactInternals,t):null},this.getHandlerName=t=>{const e=this.growingIO.remaxVMs[this.page];if(it=t,nt=Number(et.split(it,"_")[2]),st=[],e){this.getDataNodePath(e.data);let t=e.fiberNode;const i=(e,i)=>{const[n,s]=et.split(e,"-");return et.isArray(i.children)?t=et.compact(i.children)[Number(s)]:et.isObject(i.children)&&(t=i.children),t},n=st.map((e=>i(e,t.props||t.memoizedProps)));if(n.length===st.length)return et.last(n).props[et.last(et.split(it,"_"))].name}},this.getDataNodePath=({children:t,nodes:e})=>{let i=null;const n=t.find(((t,i)=>{const n=(et.toString(t)===et.toString(nt)||et.toString(t.id)===et.toString(nt))&&Object.values((e?e[t]:t).props).includes(it);return n&&st.unshift(`${e?t:t.id}-${i}`),n}));return n?i=et.isNumber(n)&&e?e[n]:n:t.every(((t,n)=>!(e?e[t]:t).children||(i=this.getDataNodePath(e?e[t]:t),i&&st.unshift(`${e?t:t.id}-${n}`),!i))),i},et=this.growingIO.utils,this.remax=null===(i=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===i?void 0:i.remax,this.page="",this.growingIO.emitter.on("minipLifecycle",(({event:t,params:e})=>{var i;if("Page onShow"===t){if(!this.remax)return;const{page:t}=e,{dataStore:n,remaxVMs:s}=this.growingIO,{customFcEffects:o}=n.eventHooks;s||(this.growingIO.remaxVMs={}),t&&!this.growingIO.remaxVMs[t.route]&&(this.growingIO.remaxVMs[t.route]={}),this.page=t.route,t&&!(null===(i=this.growingIO.remaxVMs[t.route])||void 0===i?void 0:i.hooked)&&(et.keys(t).filter((t=>t.indexOf("$$REMAX_METHOD")>-1)).forEach((e=>{t[e]=o(e,t[e])})),this.growingIO.remaxVMs[t.route]={hooked:!0,fiberNode:this.findRealRoot(t),data:this.getTopView(t)})}}))}}};function rt(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))}var at={},lt={}.hasOwnProperty;function gt(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function dt(t){try{return encodeURIComponent(t)}catch(t){return null}}at.stringify=function(t,e){e=e||"";var i,n,s=[];for(n in"string"!=typeof e&&(e="?"),t)if(lt.call(t,n)){if((i=t[n])||null!=i&&!isNaN(i)||(i=""),n=dt(n),i=dt(i),null===n||null===i)continue;s.push(n+"="+i)}return s.length?e+s.join("&"):""},at.parse=function(t){for(var e,i=/([^=?#&]+)=?([^&]*)/g,n={};e=i.exec(t);){var s=gt(e[1]),o=gt(e[2]);null===s||null===o||s in n||(n[s]=o)}return n};const ut=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),ct=t=>t.pixelRatio?Math.round(t.screenWidth*t.pixelRatio):t.screenWidth,ht=(t,e)=>{if(t){const i=t.toLowerCase();return-1!==i.indexOf("android")?e+"-Android":-1!==i.indexOf("ios")?e+"-iOS":t}},pt=t=>d(t)?t.startsWith("/")?t:"/"+t:"",vt=t=>{const{Current:e,createComponent:i}=t;return!(!t||!e||i)},mt=()=>{let t;return!t&&D((()=>swan))&&(t="swan"),!t&&D((()=>tt))&&(t="tt"),!t&&D((()=>qq))&&(t="qq"),!t&&D((()=>my))&&(t="my"),!t&&D((()=>ks))&&(t="ks"),!t&&D((()=>jd))&&(t="jd"),!t&&D((()=>wx))&&(t="wx"),t||O(k(global),(t=>y(t).toLowerCase().includes("quickapp")))&&(t="quickapp"),t},ft=t=>k(t).filter((t=>t.indexOf("__sub")>-1&&t.indexOf("gio__")>-1)).sort(),It=()=>{let t=D((()=>getApp({allowDefault:!0})));return t||(t=global||$global),t};let wt;var Ot={name:"gioImpressionTracking",method:class{constructor(t){this.growingIO=t,this.main=(t,e)=>{var i,n,s;const{vdsConfig:o,minipInstance:r,gioPlatform:a}=this.growingIO,{uniVue:l}=o,g=(t=>{if(t){const e=Number.parseInt(m(S(t.version,".")),10);return Number.isNaN(e)?0:e}return 0})(l);l&&2===g&&(t=t.$vm.$scope),this.impressionObserver&&this.impressionObserver.disconnect(),"my"===a?-1>((t="",e="")=>{const i=t=>t.replace(/\s+/g,""),n=t=>t.replace(/[vV]/g,""),s=i(n(t)),o=i(n(e)),r=s.split("."),a=o.split(".");for(var l=0;3>l;l++){var g=Number(r[l]),d=Number(a[l]);if(g>d)return 1;if(d>g)return-1;if(!isNaN(g)&&isNaN(d))return 1;if(isNaN(g)&&!isNaN(d))return-1}return 0})(my.SDKVersion,"2.7.0")||(this.impressionObserver=null===(i=r.minip)||void 0===i?void 0:i.createIntersectionObserver({[e]:!0,dataset:!0})):t.isComponent?this.impressionObserver=t.createIntersectionObserver({[e]:!0}):this.impressionObserver=null===(n=r.minip)||void 0===n?void 0:n.createIntersectionObserver(t,{[e]:!0}),null===(s=this.growingIO.minipInstance.minip)||void 0===s||s.createSelectorQuery().select(".growing_collect_imp").boundingClientRect((e=>{e&&this.creatObserver(t)})).exec()},this.creatObserver=t=>{var e;const{vdsConfig:{taro:i},gioPlatform:n}=this.growingIO,s=null===(e=this.impressionObserver)||void 0===e?void 0:e.relativeToViewport();null==s||s.observe(".growing_collect_imp",(e=>rt(this,void 0,void 0,(function*(){if(!wt.isEmpty(e)&&e.intersectionRatio>0){let s=e.dataset;i&&vt(i)&&(s=this.getTaro3Dataset(t.route,e.id)),"ks"===n&&(yield this.getKsDataset(e).then((t=>s=t)));const o=this.getImpressionProperties(s),r=e.id;if(r){if("once"===s.gioImpType&&wt.has(this.sentImps,r))return;this.sentImps[r]=o}o.eventId?this.buildImpEvent(o):wt.consoleText("曝光事件格式不正确，事件名只能包含数字、字母和下划线，且不以数字开头!","warn")}}))))},this.getImpressionProperties=t=>{let e={eventId:void 0,properties:{}};if(!(null==t?void 0:t.gioImpTrack))return e;if(e.eventId=t.gioImpTrack,wt.has(t,"gioImpAttrs"))e.properties=wt.niceTry((()=>wt.isObject(t.gioImpAttrs)?t.gioImpAttrs:JSON.parse(t.gioImpAttrs))),e.items=wt.niceTry((()=>wt.isObject(t.gioImpItems)?t.gioImpItems:JSON.parse(t.gioImpItems)));else{const i=/^gioTrack(.+)/;for(const n in t){let s;const o=n.match(i);o&&(s=wt.lowerFirst(o[1]),"track"!==s&&(e.properties[s]=t[n]))}}return e.properties=wt.limitObject(e.properties),e.items=wt.limitObject(e.items),/^\w+$/.test(e.eventId)&&!Number.isInteger(Number.parseInt(wt.head(e.eventId.split("")),10))||(e.eventId=null,e={}),e},this.getTaro3Dataset=(t,e)=>{var i;const n=null===(i=this.growingIO)||void 0===i?void 0:i.taro3VMs[t];if(!n)return!1;let s={};const o=t=>{t.some((t=>{var i;return t.uid===e&&(null===(i=t.props)||void 0===i?void 0:i.class.indexOf("growing_collect_imp"))>-1&&!wt.isEmpty(t.dataset)?(s=t.dataset,!0):!!Array.isArray(t.childNodes)&&o(t.childNodes)}))};return o(n.childNodes),s},this.getKsDataset=t=>{const{minipInstance:e}=this.growingIO,i=e.minip.createSelectorQuery().selectAll(".growing_collect_imp"),{width:n,height:s}=t.boundingClientRect;return new Promise((t=>{i.boundingClientRect((e=>{const i=e.find((t=>wt.fixed(n)===wt.fixed(t.width)&&wt.fixed(s)===wt.fixed(t.height)));t((null==i?void 0:i.dataset)||{})})).exec()}))},this.buildImpEvent=t=>{const{eventId:e,properties:i,items:n}=t,{dataStore:{eventContextBuilder:s,eventInterceptor:o,eventHooks:r}}=this.growingIO;o(Object.assign({eventType:"CUSTOM",pageShowTimestamp:r.currentPage.time,eventName:e,attributes:i,resourceItem:n},s()))},wt=this.growingIO.utils,this.growingIO.updateImpression=()=>{this.main(this.growingIO.minipInstance.getCurrentPage(),"observeAll")},this.sentImps={}}}};let yt;var St={name:"gioEventAutoTracking",method:class{constructor(t){this.growingIO=t,this.main=(t,e)=>{var i,n;const{remaxVMs:s,vdsConfig:o,platformConfig:r,plugins:a,emitter:l}=this.growingIO;if(!o.autotrack||!e||yt.get(t,"currentTarget.dataset.growingIgnore")||yt.get(t,"target.dataset.growingIgnore")||!yt.get(t,"target.dataset.growingTrack")&&"autoplay"===yt.get(t,"detail.source")||t.type===(null===(i=this.prevEvent)||void 0===i?void 0:i.type)&&10>Math.abs(Number(t.timeStamp)-Number(null===(n=this.prevEvent)||void 0===n?void 0:n.timeStamp)))return;if(this.prevEvent=t,"__e"===e&&o.uniVue&&(e=null==a?void 0:a.gioUniAppAdapter.getHandlerName(t)),["#eh","eh"].includes(e)&&o.taro)return;if(["_cmlEventProxy","onclick","blurEvent","handleDetail"].includes(e)&&o.cml)return;e.indexOf("$$REMAX_METHOD")>-1&&s&&(e=null==a?void 0:a.gioRemaxAdapter.getHandlerName(e)),o.debug&&console.log("Action：",t.type,Date.now()),l.emit("onComposeBefore",{event:e,params:null!=t?t:{}});const g=r.listeners.actions;g.click.includes(t.type)?this.buildClickEvent(t,e):g.change.includes(t.type)?this.buildChangeEvent(t,e):g.submit.includes(t.type)&&this.buildSubmitEvent(t,e)},this.getNodeXpath=(t,e)=>{const{gioPlatform:i,vdsConfig:n}=this.growingIO;let s=(t.currentTarget||t.target).id;if((!s||"swan"===i&&/^_[0-9a-f]+/.test(s)||vt(n.taro)&&/^_n_[0-9]+$/.test(s))&&(s=""),!n.octopus||(e=t.handler,/^bound .*/.test(e)&&(e=e.replace("bound ","")),/^t[0-9]+$/.test(s)&&(s=""),s&&!e&&(e="anonymousFunc"),s||e))return`${s}#${e}`},this.buildClickEvent=(t,e)=>{var i,n,s;const o=this.getNodeXpath(t,e);if(o){const{dataStore:{eventContextBuilder:e,eventInterceptor:r,eventHooks:a},gioEnvironment:l}=this.growingIO,g=t.currentTarget||t.target;let d;yt.has(null==g?void 0:g.dataset,"index")&&""!==(null===(i=null==g?void 0:g.dataset)||void 0===i?void 0:i.index)&&(d=Number.parseInt(g.dataset.index,10),Number.isNaN(d)&&(d=-1)),r(Object.assign({eventType:"saas"===l&&t.type.includes("long")?"lngprss":"VIEW_CLICK",pageShowTimestamp:a.currentPage.time,element:[{xpath:o,index:d,textValue:null===(n=null==g?void 0:g.dataset)||void 0===n?void 0:n.title,hyperlink:null===(s=null==g?void 0:g.dataset)||void 0===s?void 0:s.src}]},e()))}},this.buildTabClickEvent=t=>{const{dataStore:{eventContextBuilder:e,eventInterceptor:i,eventHooks:n}}=this.growingIO;i(Object.assign({eventType:"VIEW_CLICK",pageShowTimestamp:n.currentPage.time,element:[{xpath:"#onTabItemTap",textValue:t.text,index:t.index,hyperlink:yt.toString(t.pagePath)}]},e()))},this.buildChangeEvent=(t,e)=>{var i,n;const s=this.getNodeXpath(t,e);if(s){const{dataStore:{eventContextBuilder:e,eventInterceptor:o,eventHooks:r}}=this.growingIO,a=t.currentTarget||t.target,l=Object.assign({eventType:"VIEW_CHANGE",pageShowTimestamp:r.currentPage.time,element:{xpath:s}},e()),g=yt.get(t,"detail.value")||yt.get(t,"target.attr.value");((null===(i=null==a?void 0:a.dataset)||void 0===i?void 0:i.growingTrack)||(null===(n=null==a?void 0:a.dataset)||void 0===n?void 0:n.growingtrack))&&(yt.isNil(g)||(l.element.textValue=yt.toString(g))),l.element=[l.element],o(l)}},this.buildSubmitEvent=(t,e)=>{const i=this.getNodeXpath(t,e);if(i){const{dataStore:{eventContextBuilder:t,eventInterceptor:e,eventHooks:n}}=this.growingIO;e(Object.assign({eventType:"FORM_SUBMIT",pageShowTimestamp:n.currentPage.time,element:[{xpath:i}]},t()))}},yt=this.growingIO.utils,this.prevEvent={}}}};let bt;var Tt={name:"gioCustomTracking",method:class{constructor(t){this.growingIO=t,this.getValidResourceItem=t=>{if(t&&bt.isObject(t)&&t.id&&t.key){const e={id:bt.isString(t.id)?t.id:bt.toString(t.id),key:bt.isString(t.key)?t.key:bt.toString(t.key)};return t.attributes&&(e.attributes=t.attributes),e}},this.getDynamicAttributes=t=>(bt.isNil(t)||bt.keys(t).forEach((e=>{bt.isFunction(t[e])?t[e]=t[e]():bt.isArray(t[e])||(t[e]=bt.toString(t[e]))})),t),this.buildCustomEvent=(t,e,i)=>{bt.eventNameValidate(t,(()=>{var n;const{dataStore:{eventContextBuilder:s,eventInterceptor:o,eventHooks:r}}=this.growingIO;o(Object.assign({eventType:"CUSTOM",eventName:t,pageShowTimestamp:null===(n=null==r?void 0:r.currentPage)||void 0===n?void 0:n.time,attributes:bt.limitObject(this.getDynamicAttributes(bt.isObject(e)&&!bt.isEmpty(e)?e:void 0)),resourceItem:bt.limitObject(this.getValidResourceItem(i))},s()))}))},this.buildUserAttributesEvent=t=>{const{dataStore:{eventContextBuilder:e,eventInterceptor:i,lastVisitEvent:n}}=this.growingIO,s=Object.assign({eventType:"LOGIN_USER_ATTRIBUTES",attributes:bt.limitObject(t)},e());s.path||(s.path=n.path,s.query=n.query,s.title=n.title),i(s)},bt=this.growingIO.utils}}},_t={name:"gioCompress",method:class{constructor(t){this.growingIO=t,this.compressToUTF16=t=>{const e=this;return null===t?"":this._compress(t,15,(function(t){return e.f(t+32)}))+" "},this.f=String.fromCharCode,this._compress=function(t,e,i){if(null===t)return"";let n,s,o,r={},a={},l="",g="",d="",u=2,c=3,h=2,p=[],v=0,m=0;for(o=0;o<t.length;o+=1)if(l=t.charAt(o),{}.hasOwnProperty.call(r,l)||(r[l]=c++,a[l]=!0),g=d+l,{}.hasOwnProperty.call(r,g))d=g;else{if({}.hasOwnProperty.call(a,d)){if(256>d.charCodeAt(0)){for(n=0;h>n;n++)v<<=1,m===e-1?(m=0,p.push(i(v)),v=0):m++;for(s=d.charCodeAt(0),n=0;8>n;n++)v=v<<1|1&s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s>>=1}else{for(s=1,n=0;h>n;n++)v=v<<1|s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s=0;for(s=d.charCodeAt(0),n=0;16>n;n++)v=v<<1|1&s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s>>=1}u--,0===u&&(u=Math.pow(2,h),h++),delete a[d]}else for(s=r[d],n=0;h>n;n++)v=v<<1|1&s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s>>=1;u--,0===u&&(u=Math.pow(2,h),h++),r[g]=c++,d=l+""}if(""!==d){if({}.hasOwnProperty.call(a,d)){if(256>d.charCodeAt(0)){for(n=0;h>n;n++)v<<=1,m===e-1?(m=0,p.push(i(v)),v=0):m++;for(s=d.charCodeAt(0),n=0;8>n;n++)v=v<<1|1&s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s>>=1}else{for(s=1,n=0;h>n;n++)v=v<<1|s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s=0;for(s=d.charCodeAt(0),n=0;16>n;n++)v=v<<1|1&s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s>>=1}u--,0===u&&(u=Math.pow(2,h),h++),delete a[d]}else for(s=r[d],n=0;h>n;n++)v=v<<1|1&s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s>>=1;u--,0===u&&(u=Math.pow(2,h),h++)}for(s=2,n=0;h>n;n++)v=v<<1|1&s,m===e-1?(m=0,p.push(i(v)),v=0):m++,s>>=1;for(;;){if(v<<=1,m===e-1){p.push(i(v));break}m++}return p.join("")}}}};const Pt={};function Ct(t,e,i){var n=t;e.map((function(t,s){n[t]=s==e.length-1?i:n[t]||{},n=n[t]}))}Ct(Pt,["plugins","gioChameleonAdapter"],{name:"gioChameleonAdapter",method:class{constructor(t){var e,i;this.growingIO=t,this.main=()=>{const{vdsConfig:t,dataStore:{eventHooks:e}}=this.growingIO;this.cml||(this.cml=null==t?void 0:t.cml);const i=this.cml.createApp,n=this.cml.createPage,s=this.cml.createComponent;this.cml.createApp=function(t){return i(e.appOverriding(t))},this.cml.createPage=function(t){return n(e.pageOverriding(t))},this.cml.createComponent=function(t){return s(e.componentOverriding(t))}},this.cml=null===(i=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===i?void 0:i.cml}}}),Ct(Pt,["plugins","gioCompress"],_t),Ct(Pt,["plugins","gioCustomTracking"],Tt),Ct(Pt,["plugins","gioEventAutoTracking"],St),Ct(Pt,["plugins","gioImpressionTracking"],Ot),Ct(Pt,["plugins","gioRemaxAdapter"],ot),Ct(Pt,["plugins","gioTaroAdapter"],Y),Ct(Pt,["plugins","gioUniAppAdapter"],X),Ct(Pt,["plugins","gioWepyAdapter"],{name:"gioWepyAdapter",method:class{constructor(t){var e,i;this.growingIO=t,this.main=()=>{var t,e;this.wepy||(this.wepy=null===(e=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===e?void 0:e.wepy),this.proxyWepy(this.wepy)},this.proxyWepy=t=>{const{appOverriding:e,pageOverriding:i,componentOverriding:n}=this.growingIO.dataStore.eventHooks,s=t.app,o=t.page,r=t.component;t.app=function(t,i){return s(e(t),i)},t.page=function(t,e){return o(i(t),e)},t.component=function(t,e){return r(n(t),e)}},this.wepy=null===(i=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===i?void 0:i.wepy}}});class kt{constructor(t){this.growingIO=t,this.innerPluginInit=()=>{k(Pt.plugins).forEach((t=>{const{name:e,method:i}=Pt.plugins[t];this.pluginItems.find((t=>t.name===e))||this.pluginItems.push({name:b(e||t),method:i||(t=>{})})})),q(this.pluginItems)||this.installAll()},this.install=(t,e,i)=>{var n;const s=e||this.pluginItems.find((e=>e.name===t));if(null===(n=this.growingIO)||void 0===n?void 0:n.plugins[t])return $(`重复加载插件 ${t} 或插件重名，已跳过加载!`,"warn"),!1;if(!s)return $(`插件加载失败!不存在名为 ${t} 的插件!`,"error"),!1;try{return this.growingIO.plugins[t]=new s.method(this.growingIO,i),"cdp"===this.growingIO.gioEnvironment&&e&&$("加载插件："+t,"info"),!0}catch(t){return $("插件加载异常："+t,"error"),!1}},this.installAll=t=>{(t||this.pluginItems).forEach((e=>this.install(e.name,t?e:void 0,e.options)))},this.uninstall=t=>{var e;N(this.pluginItems,t);const i=N(null===(e=this.growingIO)||void 0===e?void 0:e.plugins,t);return i||$(`卸载插件 ${t} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((t=>this.uninstall(t.name)))},this.lifeError=(t,e)=>$(`插件执行错误 ${t.name} ${e}`,"error"),this.onComposeBefore=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onComposeBefore;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.onComposeAfter=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onComposeAfter;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.onSendBefore=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onSendBefore;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.onSendAfter=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onSendAfter;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.pluginItems=[],this.growingIO.emitter.on("onComposeBefore",this.onComposeBefore),this.growingIO.emitter.on("onComposeAfter",this.onComposeAfter),this.growingIO.emitter.on("onSendBefore",this.onSendBefore),this.growingIO.emitter.on("onSendAfter",this.onSendAfter)}}class Et{constructor(t){var e;this.growingIO=t,this.initUserInfo=()=>{const{minipInstance:t}=this.growingIO;this.uid=t.getStorageSync(this.uidStorageName)||ut(),this.userId=t.getStorageSync(this.userIdStorageName),this.userKey=t.getStorageSync(this.userKeyStorageName),this.gioId=t.getStorageSync(this.gioIdStorageName)},this.syncUserInfo=()=>{const{minipInstance:t}=this.growingIO;t.setStorageSync(this.uidStorageName,this.uid),t.setStorageSync(this.userIdStorageName,this.userId),t.setStorageSync(this.userKeyStorageName,this.userKey),t.setStorageSync(this.gioIdStorageName,this.gioId)};const{inPlugin:i}=this.growingIO;this.uidStorageName=i?"_growing_plugin_uid_":"_growing_uid_",this.userIdStorageName=i?"_growing_plugin_userId_":"_growing_userId_",this.userKeyStorageName=i?"_growing_plugin_userKey_":"_growing_userKey_",this.gioIdStorageName=i?"_growing_plugin_gioId_":"_growing_gioId_",this._sessionId=ut(),this._uid=void 0,this._userId=void 0,this._userKey=void 0,this._gioId=void 0,"quickapp"!==(null===(e=this.growingIO)||void 0===e?void 0:e.gioPlatform)&&this.initUserInfo()}get sessionId(){return this._sessionId||(this._sessionId=ut()),this._sessionId}set sessionId(t){const e=this._sessionId;this._sessionId=t||ut(),e!==this._sessionId&&this.growingIO.emitter.emit("SESSIONID_UPDATE",{newSessionId:this._sessionId,oldSessionId:e})}get uid(){return this._uid}set uid(t){const e=this._uid;this._uid=t,this.growingIO.minipInstance.setStorage(this.uidStorageName,this._uid),e!==this._uid&&this.growingIO.emitter.emit("UID_UPDATE",{newUId:t,oldUId:e})}get userId(){return this._userId}set userId(t){const e=this._userId;this._userId=t,this.growingIO.minipInstance.setStorage(this.userIdStorageName,this._userId),e!==this._userId&&this.growingIO.emitter.emit("USERID_UPDATE",{newUserId:t,oldUserId:e}),t&&(this.gioId=t)}get userKey(){return this._userKey}set userKey(t){const e=this._userKey;this._userKey=t,this.growingIO.minipInstance.setStorage(this.userKeyStorageName,this._userKey),e!==this._userKey&&this.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:t,oldUserKey:e})}get gioId(){return this._gioId}set gioId(t){const e=this._gioId;this._gioId=t,this.growingIO.minipInstance.setStorage(this.gioIdStorageName,this._gioId),e!==this._gioId&&this.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:t,oldGioId:e})}}const xt={scnPrefix:"",appHandlers:["onLaunch","onShow","onHide","onError","onPageNotFound"],pageHandlers:["onLoad","onShow","onReady","onHide","onUnload","onShareAppMessage","onTabItemTap"],actionEventTypes:["onclick","tap","longpress","longTap","blur","change","submit","confirm","getuserinfo","getphonenumber","contact"],originalApp:D((()=>App)),originalPage:D((()=>Page)),originalComponent:D((()=>Component)),originalBehavior:D((()=>Behavior)),canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},listeners:{app:{appLaunch:"onLaunch",appShow:"onShow",appClose:"onHide"},page:{pageLoad:"onLoad",pageShow:"onShow",pageReady:"onReady",pageHide:"onHide",pageUnload:"onUnload",tabTap:"onTabItemTap",shareApp:"onShareAppMessage"},actions:{click:["onclick","tap","longpress","longTap","getuserinfo","getphonenumber","contact"],change:["blur","change","confirm"],submit:["submit"]}}},At=Object.assign(Object.assign({},xt),{listeners:Object.assign({},xt.listeners),name:"JingDong",platform:"jd",scnPrefix:"jd_"}),Nt=Object.assign(Object.assign({},xt),{listeners:Object.assign({},xt.listeners),name:"KuaiShou",platform:"kuaishoup",scnPrefix:"ks_"}),jt=Object.assign(Object.assign({},xt),{listeners:Object.assign({},xt.listeners),name:"Alipay",platform:"alip",scnPrefix:"alip_",hooks:Object.assign(Object.assign({},null==xt?void 0:xt.hooks),{Behavior:!1})}),qt=Object.assign(Object.assign({},xt),{listeners:Object.assign({},xt.listeners),name:"QQ",platform:"qq",scnPrefix:"qq_"});qt.pageHandlers=[...xt.pageHandlers,"onAddToFavorites"],qt.listeners.page.addFavorites="onAddToFavorites";const Ht=Object.assign(Object.assign({},xt),{listeners:Object.assign({},xt.listeners),name:"Baidu",platform:"baidup",scnPrefix:"baidup_"}),Vt=Object.assign(Object.assign({},xt),{listeners:Object.assign({},xt.listeners),name:"Bytedance",platform:"bytedance",scnPrefix:"bytedance_"}),$t=Object.assign(Object.assign({},xt),{listeners:Object.assign({},xt.listeners),name:"Weixin",platform:"MinP"});$t.pageHandlers=[...xt.pageHandlers,"onShareTimeline","onAddToFavorites"],$t.listeners.page=Object.assign(Object.assign({},xt.listeners.page),{shareTime:"onShareTimeline",addFavorites:"onAddToFavorites"});const Dt=mt(),Ft=D((()=>{const t={jd:At,ks:Nt,my:jt,qq:qt,swan:Ht,tt:Vt,wx:$t}[Dt];return t.canHook=!1,t}));class Rt{constructor(t){this.growingIO=t,this.minip=D((()=>{{let t;return t||(t=D((()=>swan))),t||(t=D((()=>my))),t||(t=D((()=>tt))),t||(t=D((()=>qq))),t||(t=D((()=>ks))),t||(t=D((()=>wx))),t}})),this.hookSetTitle=()=>{var t;const e=null===(t=this.minip)||void 0===t?void 0:t.setNavigationBarTitle,i=this;e&&Object.defineProperty(this.minip,"setNavigationBarTitle",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){const t=i.getCurrentPath(),e=i.growingIO.dataStore.eventHooks.currentPage.path,{title:n}=arguments[0]||{};e!==t&&(i.growingIO.dataStore.eventHooks.currentPage.settedTitle[t]=n)}return e.apply(this,arguments)}})},this.navigateTo=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.navigateTo(t)},this.switchTab=t=>{var e;null===(e=this.minip)||void 0===e||e.switchTab(t)},this.navigateToMiniProgram=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.navigateToMiniProgram(t)},this.getImageInfo=({src:t,success:e,fail:i,complete:n})=>{var s;return null===(s=this.minip)||void 0===s?void 0:s.getImageInfo({src:t,success:e,fail:i,complete:n})},this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"observeAll")},this.getCurrentPage=()=>D((()=>f(getCurrentPages())))||{},this.getCurrentPath=()=>{const t=this.getCurrentPage();return(null==t?void 0:t.route)||(null==t?void 0:t.uri)||(null==t?void 0:t.__route__)||""},this.getPageTitle=t=>{var e,i;return d(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.gioPageTitle)?R(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.gioPageTitle):""},this.getStorageSync=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.getStorageSync(t)},this.getStorage=t=>new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getStorage({key:t,success:({data:t})=>e(t),fail:()=>e("")})})),this.setStorageSync=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync(t,e)},this.setStorage=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorage({key:t,data:e})},this.removeStorageSync=t=>{var e;null===(e=this.minip)||void 0===e||e.removeStorageSync(t)},this.removeStorage=t=>{var e;null===(e=this.minip)||void 0===e||e.removeStorage(t)},this.getNetworkType=()=>rt(this,void 0,void 0,(function*(){const t=this;return yield new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getNetworkType({success:i=>{t.network=i,e(i)},fail:()=>e(null)})}))})),this.request=({url:t,data:e,header:i,timeout:n,method:s,success:o,fail:r,complete:a})=>{var l;const g=null===(l=this.minip)||void 0===l?void 0:l.request({url:t,data:e,header:i,headers:i,timeout:n,method:s,success:o,fail:r,complete:a}),d=setTimeout((()=>{null==g||g.abort(),clearTimeout(d)}),(n||1e4)+10);return g},this.getSystemInfo=()=>rt(this,void 0,void 0,(function*(){const t=this;return yield new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getSystemInfo({success:i=>{t.systemInfo=i,e(i)},fail:()=>e(null)})}))})),this.getSetting=()=>new Promise((t=>{var e;null===(e=this.minip)||void 0===e||e.getSetting({success:t,fail:t})}));const{platformConfig:{platform:e,scnPrefix:i}}=this.growingIO;this.platform=e,this.scnPrefix=i,this.getNetworkType().then((()=>{var t;return null===(t=this.growingIO.dataStore)||void 0===t?void 0:t.eventReleaseInspector()})),this.getSystemInfo().then((()=>{var t;return null===(t=this.growingIO.dataStore)||void 0===t?void 0:t.eventReleaseInspector()}))}}const Lt=mt();var Bt={wx:class extends Rt{constructor(t){super(t),this.growingIO=t,this.getPageTitle=t=>{var e,i;let n="";try{const s=(null==t?void 0:t.data)||t.$data||{};if(n=d(null==s?void 0:s.gioPageTitle)?null==s?void 0:s.gioPageTitle:"",0===n.length){const e=__wxConfig.page[t.route]||__wxConfig.page[t.route+".html"];n=e?e.window.navigationBarTitleText:__wxConfig.global.window.navigationBarTitleText}if(0===n.length){const s=null===(i=null===(e=null===__wxConfig||void 0===__wxConfig?void 0:__wxConfig.tabBar)||void 0===e?void 0:e.list)||void 0===i?void 0:i.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));n=(null==s?void 0:s.text)||""}}catch(t){return""}return R(n)},this.hookSetTitle()}},swan:class extends Rt{constructor(t){super(t),this.growingIO=t,this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"selectAll")},this.getPageTitle=t=>{var e,i;let n="";try{const s=(null==t?void 0:t.data)||t.$data||{};n=d(null==s?void 0:s.gioPageTitle)?null==s?void 0:s.gioPageTitle:"";const o=D((()=>JSON.parse(appConfig)))||{};if(0===n.length){const e=o.page[t.route]||o.page[t.route+".html"];n=e?e.window.navigationBarTitleText:o.window.navigationBarTitleText}if(0===n.length){const s=null===(i=null===(e=null==o?void 0:o.tabBar)||void 0===e?void 0:e.list)||void 0===i?void 0:i.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));n=(null==s?void 0:s.text)||""}}catch(t){return""}return R(n)},this.hookSetTitle()}},my:class extends Rt{constructor(t){super(t),this.growingIO=t,this.hookSetTitle=()=>{var t;const e=null===(t=this.minip)||void 0===t?void 0:t.setNavigationBar,i=this;e&&Object.defineProperty(this.minip,"setNavigationBar",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){const t=i.getCurrentPath(),e=i.growingIO.dataStore.eventHooks.currentPage.path,{title:n}=arguments[0]||{};e!==t&&(i.growingIO.dataStore.eventHooks.currentPage.settedTitle[t]=n)}return e.apply(this,arguments)}})},this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"selectAll")},this.getStorageSync=t=>{const{data:e}=my.getStorageSync({key:t});return e},this.setStorageSync=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync({key:t,data:e})},this.hookSetTitle()}},qq:class extends Rt{constructor(t){super(t),this.growingIO=t,this.getPageTitle=t=>{var e,i;let n="";try{const s=(null==t?void 0:t.data)||t.$data||{};if(n=d(null==s?void 0:s.gioPageTitle)?null==s?void 0:s.gioPageTitle:"",0===n.length){const e=__qqConfig.page[t.route]||__qqConfig.page[t.route+".html"];n=e?e.window.navigationBarTitleText:__qqConfig.global.window.navigationBarTitleText}if(0===n.length){const s=null===(i=null===(e=null===__qqConfig||void 0===__qqConfig?void 0:__qqConfig.tabBar)||void 0===e?void 0:e.list)||void 0===i?void 0:i.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));n=(null==s?void 0:s.text)||""}}catch(t){return""}return R(n)},this.hookSetTitle()}},tt:class extends Rt{constructor(t){super(t),this.growingIO=t,this.getPageTitle=t=>{var e,i;let n="";try{const s=(null==t?void 0:t.data)||t.$data||{};if(n=d(null==s?void 0:s.gioPageTitle)?null==s?void 0:s.gioPageTitle:"",0===n.length){const e=__ttConfig.page[t.route]||__ttConfig.page[t.route+".html"];n=e?e.window.navigationBarTitleText:__ttConfig.global.window.navigationBarTitleText}if(0===n.length){const s=null===(i=null===(e=null===__ttConfig||void 0===__ttConfig?void 0:__ttConfig.tabBar)||void 0===e?void 0:e.list)||void 0===i?void 0:i.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));n=(null==s?void 0:s.text)||""}}catch(t){return""}return R(n)},this.hookSetTitle()}}}[Lt];class Ut{constructor(t){this.growingIO=t,this.main=t=>{var e,i,n,s,o;const{sdkVersion:r,vdsConfig:a,platformConfig:l,minipInstance:g,userStore:d,dataStore:{eventHooks:u,locationData:c,lastVisitEvent:h}}=this.growingIO,{systemInfo:p={},network:v={}}=g,{brand:m,model:f,platform:I,language:w,version:O}=p,y={appChannel:"scn:"+(u.scene||"NA"),appVersion:a.version,dataSourceId:a.dataSourceId,deviceBrand:m,deviceId:d.uid,deviceModel:f,deviceType:ht(I,l.name),domain:a.appId,gioId:d.gioId,language:w,latitude:null==c?void 0:c.latitude,longitude:null==c?void 0:c.longitude,networkState:(null==v?void 0:v.networkType)||(null==v?void 0:v.type),operatingSystem:ht(I,l.name),path:(null===(e=u.currentPage)||void 0===e?void 0:e.path)?null===(i=u.currentPage)||void 0===i?void 0:i.path:h.path,platform:l.platform,platformVersion:l.name+(O?" "+O:""),query:(null===(n=u.currentPage)||void 0===n?void 0:n.path)?null===(s=u.currentPage)||void 0===s?void 0:s.query:h.query,screenHeight:(S=p,S.pixelRatio?Math.round(S.screenHeight*S.pixelRatio):S.screenHeight),screenWidth:ct(p),sdkVersion:r,sessionId:d.sessionId,title:(null===(o=u.currentPage)||void 0===o?void 0:o.title)||g.getPageTitle(g.getCurrentPage()),timestamp:Date.now(),userId:d.userId};var S;return a.enableIdMapping&&(y.userKey=d.userKey),q(a.ignoreFields)||a.ignoreFields.forEach((t=>{N(y,t)})),q(t)?y:Object.assign(Object.assign({},y),t)}}}class Mt{constructor(t){this.growingIO=t,this.main=(t,e)=>{var i,n;const s=Date.now(),{emitter:o,userStore:r,vdsConfig:a,platformConfig:l,dataStore:{eventHooks:g,lastVisitEvent:d}}=this.growingIO;o.emit("minipLifecycle",{event:"App "+t,timestamp:s,params:null!==(i=e[0])&&void 0!==i?i:{}}),a.debug&&console.log("App:",t,s);const u=l.listeners.app;switch(o.emit("onComposeBefore",{event:"App "+t,params:null!==(n=e[0])&&void 0!==n?n:{}}),t){case u.appCreate:case u.appShow:if(q(d)&&e[0]){const{path:t="",query:i={}}=e[0];this.growingIO.dataStore.lastVisitEvent={path:t,query:at.stringify(i)}}this.parseScene(e),g.lastCloseTime?(Date.now()-g.lastCloseTime>g.keepAlive||g.lastScene&&g.scene!==g.lastScene)&&(r.sessionId="",g.currentPage.time=void 0,this.buildVisitEvent(e[0])):this.buildVisitEvent(e[0]);break;case u.appClose:g.lastScene=g.scene,g.lastCloseTime=Date.now(),r.syncUserInfo(),this.buildCloseEvent(),this.growingIO.vdsConfig.forceLogin||this.growingIO.uploader.initiateRequest(!0)}},this.parseScene=t=>{var e;const{minipInstance:i,gioPlatform:n,emitter:s,dataStore:{eventHooks:o}}=this.growingIO,r=o.scene;let a;if("quickapp"===n){const{extra:t,type:e}=i.getAppSource();a=(null==t?void 0:t.scene)||e}else if(t.length>0){const i=t[0];(null===(e=null==i?void 0:i.query)||void 0===e?void 0:e.wxShoppingListScene)?a=i.query.wxShoppingListScene:(null==i?void 0:i.scene)?a=i.scene:o.scene="NA"}o.scene=a,a!==r&&s.emit("SCENE_UPDATE",{newScene:a,oldScene:r})},this.buildVisitEvent=t=>{const{dataStore:e}=this.growingIO,{eventContextBuilder:i,eventInterceptor:n}=e;n(Object.assign({eventType:"VISIT"},i({path:(null==t?void 0:t.path)||(null==t?void 0:t.p)||"",query:h(null==t?void 0:t.query)?at.stringify((null==t?void 0:t.query)||{}):(null==t?void 0:t.query)||(null==t?void 0:t.q)||""})))},this.buildCloseEvent=()=>{const{dataStore:{eventContextBuilder:t,eventInterceptor:e}}=this.growingIO;e(Object.assign({eventType:"APP_CLOSED"},t()))}}}class Kt{constructor(t){this.growingIO=t,this.parsePage=(t,e)=>{var i;this.path=t.route||t.uri||t.__route__||(null===(i=null==t?void 0:t.$page)||void 0===i?void 0:i.fullPath)||"",q(e)?this.query=void 0:this.query=this.getQuery(e),this.time=Date.now(),this.title=this.settedTitle[this.path]||this.growingIO.minipInstance.getPageTitle(t||this.growingIO.minipInstance.getCurrentPage())},this.getQuery=t=>w(k(t||{})).filter((t=>"wxShoppingListScene"!==t)).map((e=>`${e}=${t[e]}`)).join("&"),this.saveShareId=t=>{(null==t?void 0:t.gioShareId)&&(this.queryShareId=t.gioShareId)},this.updateShareResult=(t,e)=>{const[i,n,s]=this.buildShareQuery(t,e);return e.path=pt(i+(n?"?"+n:"")),e.attributes=s,e.query=n,e},this.updateAppMessageResult=this.updateShareResult,this.updateTimelineResult=this.updateShareResult,this.updateAddFavoritesResult=(t,e)=>{const[i,n]=this.buildShareQuery(t,e,!1);return e.path=pt(i+(n?"?"+n:"")),e.query=n,e},this.query=void 0,this.settedTitle={},this.pageProps={}}buildShareQuery(t,e,i=!0){const{userStore:n}=t;let[s,o]=(t=>{if(d(t)){const e=t.indexOf("?");return-1!==e?[t.substring(0,e),t.substring(e+1)]:[t,""]}return["",""]})(C(e,"path")?e.path:this.path);const r=at.parse(e.query||o||this.query||"")||{};if(!i)return[s,at.stringify(r),{}];k(r).forEach((t=>{(["gioPreShareId","gioShareId","suid"].includes(t)||t.toLowerCase().startsWith("utm_"))&&N(r,t)}));const a={gioShareId:ut(),suid:n.uid},l={contentType:e.contentType||r.contentType,contentId:e.contentId||r.contentId,gioPreShareId:this.queryShareId};return E(a,((t,e)=>{t||N(a,e)})),[s,at.stringify(Object.assign(Object.assign({},r),a)),Object.assign(Object.assign({},a),l)]}}class Gt{constructor(t){this.growingIO=t,this.main=(t,e,i)=>{var n,s,o,r,a,l,g;const d=Date.now(),{emitter:u,minipInstance:c,plugins:h,vdsConfig:v,platformConfig:m,dataStore:{eventHooks:f},inPlugin:I}=this.growingIO,{currentPage:w,shareOut:O,toggleShareOut:y}=f;if(this.prevEvent[e]&&50>Date.now()-Number(this.prevEvent[e]))return;t||(t=c.getCurrentPage()),v.wepy&&(t.route=t.$is),t.route||(t.route=c.getCurrentPath(t));const S=t.route||t.uri||t.__route__||(null===(n=null==t?void 0:t.$page)||void 0===n?void 0:n.fullPath)||"";u.emit("minipLifecycle",{event:"Page "+e,timestamp:d,params:{page:t,args:i[0]}}),v.debug&&console.log("Page:",S,"#",e,d),this.prevEvent[e]=Date.now();const b=m.listeners.page;switch(u.emit("onComposeBefore",{page:t,event:"Page "+e,params:{page:t,args:i[0]}}),w.lastLifecycle=w.currentLifecycle,w.currentLifecycle=e,b.pageLoad&&(this.argQuery[S]=A(t,"options")||A(t,"__displayReporter.query")||A(t,"$page.query")||A(t,"$wx.__displayReporter.query")||i[0]||{}),e){case b.pageShow:if(I)break;O&&f.currentPage.time||(w.parsePage(t,this.argQuery[S]),this.buildPageEvent()),y(!1),w.saveShareId(this.argQuery[S]),c.initImpression(c.getCurrentPage());break;case b.pageReady:v.taro&&vt(v.taro)&&(null===(o=null===(s=this.growingIO.plugins)||void 0===s?void 0:s.gioTaroAdapter)||void 0===o||o.saveFullPage(document.body),c.initImpression(c.getCurrentPage()));break;case b.pageHide:case b.pageUnload:v.taro&&vt(v.taro)||!(null===(r=null==h?void 0:h.gioImpressionTracking)||void 0===r?void 0:r.impressionObserver)||(null===(l=null===(a=null==h?void 0:h.gioImpressionTracking)||void 0===a?void 0:a.impressionObserver)||void 0===l||l.disconnect(),this.growingIO.plugins.gioImpressionTracking.impressionObserver=null);break;case b.shareApp:y(!0),v.followShare&&this.buildAppMessageEvent(i);break;case b.shareTime:v.followShare&&this.buildTimelineEvent(i);break;case b.addFavorites:this.buildAddFavorites(i);break;case b.tabTap:{const t=null===(g=null==h?void 0:h.gioEventAutoTracking)||void 0===g?void 0:g.buildTabClickEvent;v.autotrack&&t&&p(t)&&t(i[0]);break}}e===b.pageUnload&&(w.pageProps[S]=void 0)},this.buildPageEvent=()=>{const{minipInstance:t,dataStore:{lastPageEvent:e,eventContextBuilder:i,eventInterceptor:n,eventHooks:s}}=this.growingIO,{scene:o,currentPage:r}=s,a=Object.assign(Object.assign({eventType:"PAGE",referralPage:(null==e?void 0:e.path)||(null==e?void 0:e.p)||(o?`scn:${t.scnPrefix}${o}`:null)},i()),{timestamp:r.time});q(r.pageProps[a.path])||(a.attributes=r.pageProps[a.path]),n(a)},this.buildAppMessageEvent=t=>{var e;const i=t[0];let n;2>t.length?1===t.length&&(n=i):n=t[1];const{dataStore:{eventContextBuilder:s,eventInterceptor:o,eventHooks:{currentPage:r}}}=this.growingIO,a=decodeURI((null==n?void 0:n.path)||"").split("?");o(Object.assign({eventType:"CUSTOM",eventName:"$mp_on_share",pageShowTimestamp:r.time,attributes:Object.assign({$from:i.from,$target:null===(e=null==i?void 0:i.target)||void 0===e?void 0:e.id,$share_title:null==n?void 0:n.title,$share_path:m(a),$share_query:a[1]},null==n?void 0:n.attributes)},s()))},this.buildTimelineEvent=t=>{var e;const i=t[0];let n;2>t.length?1===t.length&&(n=i):n=t[1];const{dataStore:{eventContextBuilder:s,eventInterceptor:o,eventHooks:{currentPage:r}}}=this.growingIO,a=decodeURI((null==n?void 0:n.path)||"").split("?");o(Object.assign({eventType:"CUSTOM",eventName:"$mp_share_timeline",pageShowTimestamp:r.time,attributes:Object.assign({$target:null===(e=null==i?void 0:i.target)||void 0===e?void 0:e.id,$share_title:null==n?void 0:n.title,$share_path:m(a),$share_query:a[1]},null==n?void 0:n.attributes)},s()))},this.buildAddFavorites=t=>{const e=t[0];let i;2>t.length?1===t.length&&(i=e):i=t[1];const{dataStore:{eventContextBuilder:n,eventInterceptor:s,eventHooks:{currentPage:o}}}=this.growingIO,r=decodeURI((null==i?void 0:i.path)||"").split("?");s(Object.assign({eventType:"CUSTOM",eventName:"$mp_add_favorites",pageShowTimestamp:o.time,attributes:{$share_title:null==i?void 0:i.title,$share_path:m(r),$share_query:r[1]}},n()))},this.prevEvent={},this.argQuery={}}}class Qt{constructor(t){var e,i,n;this.growingIO=t,this.toggleShareOut=t=>{c(t)?this.shareOut=t:this.shareOut=!this.shareOut},this.isNormalFc=(t,e)=>p(e)&&"constructor"!==t,this.objectTraverse=(t,e)=>{Object.getOwnPropertyNames(t).forEach((i=>e(i,t))),C(t,"methods")&&Object.getOwnPropertyNames(t.methods).forEach((i=>{t[i]||e(i,t.methods)})),C(t,"lifetimes")&&Object.getOwnPropertyNames(t.lifetimes).forEach((i=>{t[i]||e(i,t.lifetimes)})),C(t,"pageLifetimes")&&Object.getOwnPropertyNames(t.pageLifetimes).forEach((i=>{t[i]||e(i,t.pageLifetimes)}))},this.supLifeFcs=(t,e)=>{v(this[e+"Handlers"])&&this[e+"Handlers"].forEach((e=>{p(t[e])||["onShareAppMessage","onShareTimeline"].includes(e)||(t[e]=()=>{})}))},this.lifeFcEffects=(t,e,i)=>{const n=this;return["onShareTimeline","onAddToFavorites"].includes(t)?function(){let s=e.apply(this,arguments);"onShareTimeline"===t&&n.growingIO.vdsConfig.followShare&&(s=n.currentPage.updateTimelineResult(n.growingIO,null!=s?s:{})),"onAddToFavorites"===t&&(s=n.currentPage.updateAddFavoritesResult(n.growingIO,null!=s?s:{}));const o=[].slice.call(arguments);return s&&o.push(s),n[`def${i}Cbs`][t].apply(this,o),s}:function(){return rt(this,arguments,void 0,(function*(){let s;try{"onShareAppMessage"===t&&(s=yield e.apply(this,arguments),n.growingIO.vdsConfig.followShare&&(s=n.currentPage.updateAppMessageResult(n.growingIO,null!=s?s:{})));const o=[].slice.call(arguments);s&&o.push(s),n[`def${i}Cbs`][t].apply(this,o)}catch(t){$(t,"error")}return"onShareAppMessage"!==t&&(s=e.apply(this,arguments)),n.growingIO.emitter.emit("minipLifecycle",{event:`${i} ${t}End`,timestamp:Date.now(),params:{instance:this,arguments:Array.from(arguments)}}),s}))}},this.customFcEffects=(t,e)=>{const i=this;return function(){var n,s;let o;try{let e=arguments[0]||{};C(e,"type")&&((null==e?void 0:e.currentTarget)||(null==e?void 0:e.target))||(e=arguments[arguments.length-1]),((null==e?void 0:e.currentTarget)||(null==e?void 0:e.target))&&i.actionEventTypes.includes(e.type)&&(p(i.actionEffects)||(i.actionEffects=(null===(s=null===(n=i.growingIO.plugins)||void 0===n?void 0:n.gioEventAutoTracking)||void 0===s?void 0:s.main)||function(){}),null==i||i.actionEffects(e,t))}catch(t){$(t,"error")}return o=e.apply(this,arguments),o}},this.appApplyProxy=(t,e)=>this.appHandlers.includes(t)?this.lifeFcEffects(t,e,"App"):this.autotrack?this.customFcEffects(t,e):e,this.pageApplyProxy=(t,e)=>this.pageHandlers.includes(t)?this.lifeFcEffects(t,e,"Page"):this.autotrack?this.customFcEffects(t,e):e,this.appOverriding=t=>(this.supLifeFcs(t,"app"),this.objectTraverse(t,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.appApplyProxy(t,e[t]))})),t),this.pageOverriding=t=>(this.supLifeFcs(t,"page"),this.objectTraverse(t,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.pageApplyProxy(t,e[t]))})),t),this.componentOverriding=t=>(t.methods||(t.methods={}),this.supLifeFcs(t.methods,"page"),this.objectTraverse(t.methods,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.pageApplyProxy(t,e[t]))})),t),this.growingApp=t=>this.originalApp(this.appOverriding(t)),this.growingPage=t=>this.originalPage(this.pageOverriding(t)),this.growingComponent=t=>this.originalComponent(this.componentOverriding(t)),this.growingBehavior=t=>this.originalBehavior(this.componentOverriding(t)),this.nativeGrowing=(t=["App","Page","Component","Behavior"])=>{const e=this,{platformConfig:i}=this.growingIO,n=i.hooks;if(t.includes("App"))try{n.App&&!this.appHooked&&(App=function(){return e.growingApp(arguments[0])},this.appHooked=!0)}catch(t){}if(t.includes("Page"))try{n.Page&&!this.pageHooked&&(Page=function(){return e.growingPage(arguments[0])},this.pageHooked=!0)}catch(t){}if(t.includes("Component"))try{n.Component&&!this.componentHooked&&(Component=function(){return e.growingComponent(arguments[0])},this.componentHooked=!0)}catch(t){}if(t.includes("Behavior"))try{n.Behavior&&!this.behaviorHooked&&(Behavior=function(){return e.growingBehavior(arguments[0])},this.behaviorHooked=!0)}catch(t){}},this.initEventHooks=()=>{const t=this,{platformConfig:e,gioPlatform:i}=this.growingIO;this.appHandlers.forEach((e=>{this.defAppCbs[e]=function(){t.appEffects.main(e,arguments)}})),this.pageHandlers.forEach((e=>{this.defPageCbs[e]=function(){t.pageEffects.main(this,e,arguments)}})),e.canHook?this.nativeGrowing():"quickapp"===i&&(window.GioApp=function(){return t.appOverriding(arguments[0])},window.GioPage=function(){return t.pageOverriding(arguments[0])},window.GioComponent=function(){return t.pageOverriding(arguments[0])}),this.growingIO.App=D((()=>App)),this.growingIO.Page=D((()=>Page)),this.growingIO.Component=D((()=>Component)),this.growingIO.Behavior=D((()=>Behavior)),"quickapp"===i&&(this.growingIO.GioApp=window.GioApp,this.growingIO.GioPage=window.GioPage,this.growingIO.GioComponent=window.GioComponent)};const s=null===(e=this.growingIO)||void 0===e?void 0:e.platformConfig;this.autotrack=this.growingIO.vdsConfig.autotrack&&this.growingIO.plugins.gioEventAutoTracking,this.defAppCbs={},this.defPageCbs={},this.appHandlers=s.appHandlers,this.pageHandlers=s.pageHandlers,this.actionEventTypes=s.actionEventTypes,this.originalApp=s.originalApp,this.originalPage=s.originalPage,this.originalComponent=s.originalComponent,this.originalBehavior=null!==(i=s.originalBehavior)&&void 0!==i?i:function(){},this.appEffects=new Mt(this.growingIO),this.pageEffects=new Gt(this.growingIO),this.currentPage=new Kt(this.growingIO),this.shareOut=!1,this.keepAlive=null===(n=this.growingIO)||void 0===n?void 0:n.vdsConfig.keepAlive}}class Wt extends class{constructor(n){this.growingIO=n,this.ALLOW_SETTING=Object.assign({},t,"saas"===this.growingIO.gioEnvironment?i:e),this.allowOptKeys=k(this.ALLOW_SETTING),this.initStorageId=()=>{const t=It();let e=t.gio_esid?t.gio_esid:this.growingIO.minipInstance.getStorageSync(this.esidStorageName);e=h(e)&&!g(e)?e:{},this._esid={},k(e).forEach((t=>{this._esid[t]=Number.isNaN(Number(e[t]))||e[t]>=1e9||1>e[t]?1:e[t]})),x(e,this._esid)||this.growingIO.minipInstance.setStorageSync(this.esidStorageName,this._esid);const i=t.gio_gsid?t.gio_gsid:Number.parseInt(this.growingIO.minipInstance.getStorageSync(this.gsidStorageName),10);this._gsid=Number.isNaN(i)||i>=1e9||1>i?1:i,i!==this._gsid&&this.growingIO.minipInstance.setStorageSync(this.gsidStorageName,this._gsid)},this.initOptions=t=>{var e,i,n,s,o,r,g,d,u,c,h;const{projectId:p,dataSourceId:m,appId:f}=t,I={};this.allowOptKeys.forEach((e=>{const i=this.ALLOW_SETTING[e].type;(v(i)?i.includes(H(t[e])):H(t[e])===this.ALLOW_SETTING[e].type)?"ignoreFields"===e?I.ignoreFields=t.ignoreFields.filter((t=>a.includes(t))):"extraParams"===e?I.extraParams=t.extraParams.filter((t=>l.includes(t))):I[e]=t[e]:I[e]=this.ALLOW_SETTING[e].default})),I.uploadInterval=Math.round(I.uploadInterval),(Number.isNaN(I.uploadInterval)||0>I.uploadInterval||I.uploadInterval>2e3)&&(I.uploadInterval=1e3),this.growingIO.vdsConfig=Object.assign(Object.assign({},I),{projectId:p,dataSourceId:m,appId:f,performance:{monitor:null===(i=null===(e=I.performance)||void 0===e?void 0:e.monitor)||void 0===i||i,exception:null===(s=null===(n=I.performance)||void 0===n?void 0:n.exception)||void 0===s||s,network:null!==(r=null===(o=I.performance)||void 0===o?void 0:o.network)&&void 0!==r&&r}}),I.dataCollect||$("已关闭数据采集","info"),I.autotrack||$("已关闭无埋点","info"),this.growingIO.inPlugin&&(this.growingIO.vdsConfig.autotrack=!1);const{cml:w,uniVue:O,wepy:y,taro:S,remax:b}=I;"full"!==this.growingIO.gioFramework||w||O||y||S||b||(this.growingIO.platformConfig.canHook=!0),this.eventHooks=new Qt(this.growingIO),this.growingIO.inPlugin||this.eventHooks.initEventHooks();const{plugins:T}=this.growingIO;w&&(null===(g=null==T?void 0:T.gioChameleonAdapter)||void 0===g||g.main()),O&&(null===(d=null==T?void 0:T.gioUniAppAdapter)||void 0===d||d.main()),y&&(null===(u=null==T?void 0:T.gioWepyAdapter)||void 0===u||u.main()),S&&(null===(c=null==T?void 0:T.gioTaroAdapter)||void 0===c||c.main()),b&&(null===(h=null==T?void 0:T.gioRemaxAdapter)||void 0===h||h.main())},this.setOption=(t,e)=>{var i;const{vdsConfig:n,callError:s,uploader:o,emitter:r}=this.growingIO,a=d(t)&&this.allowOptKeys.includes(t),l=a&&typeof e===(null===(i=this.ALLOW_SETTING[t])||void 0===i?void 0:i.type);if(a&&l){if("dataCollect"===t&&!1===n.dataCollect&&!0===e){const t=setTimeout((()=>{this.sendVisit(),this.sendPage(),clearTimeout(t)}))}return n[t]=e,["host","scheme"].includes(t)&&(null==o||o.generateURL()),r.emit("OPTION_CHANGE",{optionName:t,optionValue:e}),!0}return s("setOption > "+t),!1},this.getOption=t=>{const{vdsConfig:e,callError:i}=this.growingIO;return t&&C(e,y(t))?e[y(t)]:g(t)?Object.assign({},e):void i("getOption > "+t)},this.sendVisit=()=>{this.eventHooks.appEffects.buildVisitEvent(this.lastVisitEvent)},this.sendPage=()=>{this.eventHooks.pageEffects.buildPageEvent()},this.eventInterceptor=t=>{const{systemInfo:e,network:i}=this.growingIO.minipInstance;q(e)||q(i)?this.interceptEvents.push(t):q(this.interceptEvents)?this.eventConverter(t):([...this.interceptEvents,t].forEach((t=>{const e=Object.assign(Object.assign({},t),this.eventContextBuilder({path:t.path,query:t.query,timestamp:t.timestamp}));this.eventConverter(e)})),this.interceptEvents=[])},this.eventReleaseInspector=()=>{const{minipInstance:{systemInfo:t,network:e}}=this.growingIO;t&&e&&!q(this.interceptEvents)&&([...this.interceptEvents].forEach((t=>{const e=Object.assign(Object.assign({},t),this.eventContextBuilder({path:t.path,query:t.query,timestamp:t.timestamp}));this.eventConverter(e)})),this.interceptEvents=[])},this.esidStorageName="_growing_esid_",this.gsidStorageName="_growing_gsid_",this.initStorageId(),this.eventContextBuilder=new Ut(this.growingIO).main,this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.generalProps={},this.interceptEvents=[],this.growingIO.emitter.on("onComposeAfter",(({composedEvent:t})=>{"VISIT"!==t.eventType&&"vst"!==t.t||(this.lastVisitEvent=t),"PAGE"!==t.eventType&&"page"!==t.t||(this.lastPageEvent=t)}))}get esid(){const t=It(),e=ft(t);return!q(e)&&t.gio_esid?t.gio_esid:this._esid}set esid(t){const e={};k(t).forEach((i=>{e[i]=Number.isNaN(t[i])||t[i]>=1e9||1>t[i]?1:t[i]})),x(e,this._esid)||(this._esid=e,It().gio_esid=this._esid,this.growingIO.minipInstance.setStorageSync(this.esidStorageName,this._esid))}get gsid(){const t=It(),e=ft(t);return!q(e)&&t.gio_gsid?t.gio_gsid:this._gsid}set gsid(t){const e=Number.parseInt(t,10);this._gsid=Number.isNaN(e)||t>=1e9||1>t?1:t,It().gio_gsid=this._gsid,this.growingIO.minipInstance.setStorageSync(this.gsidStorageName,this._gsid)}}{constructor(t){super(t),this.growingIO=t,this.eventConverter=t=>{const{vdsConfig:e,dataStore:i,uploader:n}=this.growingIO;if(e.dataCollect){t.globalSequenceId=i.gsid,t.eventSequenceId=i.esid[t.eventType]||1;const e={};E(t,((t,i)=>{var n;if("element"===i){const i=null!==(n=m(t))&&void 0!==n?n:{};E(i,((t,i)=>{q(t)&&0!==t||(e[i]=t)}))}else q(t)&&0!==t||(e[i]=t)})),this.growingIO.dataStore.gsid+=1,this.growingIO.dataStore.esid=Object.assign(Object.assign({},this.growingIO.dataStore.esid),{[e.eventType]:(this.growingIO.dataStore.esid[e.eventType]||1)+1}),this.growingIO.emitter.emit("onComposeAfter",{composedEvent:e}),n.commitRequest(e)}},this.trackTimers={}}}class zt extends class{constructor(t){this.growingIO=t,this.commitRequest=t=>{const e=Object.assign({},t),{vdsConfig:i}=this.growingIO;i.forceLogin?this.hoardingQueue.push(e):(this.requestQueue.push(e),this.initiateRequest())},this.initiateRequest=t=>{var e,i;const{plugins:n,vdsConfig:s}=this.growingIO;[...this.hoardingQueue,...this.requestQueue].length>0&&this.requestingNum<this.requestLimit&&((null===(e=null==s?void 0:s.tbConfig)||void 0===e?void 0:e.cloudFuncSend)?null===(i=null==n?void 0:n.gioTaobaoSendAdapter)||void 0===i||i.singleInvoke():t?this.batchInvoke():this.batchInvokeThrottle())},this.batchInvoke=()=>{var t,e;const{vdsConfig:i,plugins:n,emitter:s}=this.growingIO;let o=[...this.hoardingQueue,...this.requestQueue];o.length>50?(o=o.slice(0,50),this.hoardingQueue.length>50?this.hoardingQueue=this.hoardingQueue.slice(50):(this.hoardingQueue=[],this.requestQueue=this.requestQueue.slice(50-this.hoardingQueue.length))):(this.hoardingQueue=[],this.requestQueue=[]);let r=o.filter((t=>(this.retryIds[t.globalSequenceId||t.esid]||0)<=this.retryLimit));q(r)||(i.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(r,null,2)),s.emit("onSendBefore",{requestData:r}),(null===(t=null==i?void 0:i.tbConfig)||void 0===t?void 0:t.cloudAppId)?null===(e=null==n?void 0:n.gioTaobaoSendAdapter)||void 0===e||e.tbCloudAppInvoke(r):this.normalBatchInvoke(r))},this.batchInvokeThrottle=j(this.batchInvoke,this.growingIO.vdsConfig.uploadInterval,!1,!1),this.normalBatchInvoke=t=>{var e;const{minipInstance:i,vdsConfig:n,emitter:s,plugins:o,gioEnvironment:r}=this.growingIO;this.requestingNum+=1;const a={"content-type":"application/json;charset=UTF-8"};let l=[...t];const g=n.compress&&(null===(e=null==o?void 0:o.gioCompress)||void 0===e?void 0:e.compressToUTF16);"cdp"===r&&g&&(l=o.gioCompress.compressToUTF16(JSON.stringify(t)),a["X-Compress-Codec"]="1"),i.request({url:`${this.requestURL}?stm=${Date.now()}${"cdp"===r?"&compress="+(g?"1":"0"):""}`,header:a,method:"POST",data:l,timeout:this.requestTimeout,fail:e=>{[200,204].includes(e.code)||(v(t)?t.forEach((t=>{this.requestFailFn(t)})):this.requestFailFn(t),$("请求失败!"+JSON.stringify(e),"error"))},complete:t=>{this.requestingNum-=1,s.emit("onSendAfter",{result:t}),this.initiateRequest()}})},this.requestFailFn=t=>{this.retryIds[t.globalSequenceId||t.esid]||(this.retryIds[t.globalSequenceId||t.esid]=0),this.retryIds[t.globalSequenceId||t.esid]+=1,this.requestQueue.some((e=>e.globalSequenceId===t.globalSequenceId&&e.esid===t.esid))||this.requestQueue.push(t)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=3,this.requestTimeout=5e3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.requestURL=""}}{constructor(t){super(t),this.growingIO=t,this.generateURL=()=>{let{scheme:t,host:e="",projectId:i}=this.growingIO.vdsConfig;t?_(y(t),"://")||(t+="://"):t="https://",T(e,"http")&&(e=e.substring(e.indexOf("://")+(_(y(t),"://")?4:1))),this.requestURL=`${t}${e}/v3/projects/${i}/collect`},this.generateURL()}}const Jt=new class extends class{constructor(){var t;this.init=t=>($("Gio小程序SDK 初始化中...","info"),this.dataStore.initOptions(t),this.gioSDKInitialized=!0,this.vdsConfig.subpackage||(It().__gio__=()=>this),null==this||this.initCallback(),this.emitter.emit("SDK_INITIALIZED",this),$("Gio小程序SDK 初始化完成！","success"),this.vdsConfig.forceLogin&&$("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),this.inPlugin&&this.dataStore.sendVisit(),!0),this.setDataCollect=t=>{this.setOption("dataCollect",!!t),this.notRecommended()},this.setAutotrack=t=>{this.setOption("autotrack",!!t),this.notRecommended()},this.enableDebug=t=>{this.setOption("debug",!!t),this.notRecommended()},this.setOption=(t,e)=>{if(s.includes(t)){const i=this.dataStore.setOption(t,e);return i&&o[t]&&$(`已${e?"开启":"关闭"}${o[t]}`,"info"),i}return $(`不存在可修改的配置项：${t}，请检查后重试!`,"warn"),!1},this.getDeviceId=()=>this.userStore.uid,this.getOption=t=>this.dataStore.getOption(t),this.getGioInfo=()=>{const{uid:t,userId:e,userKey:i,sessionId:n,gioId:s}=this.userStore,{projectId:o,appId:r,dataSourceId:a,dataCollect:l,enableIdMapping:g,extraParams:d,ignoreFields:u}=this.vdsConfig,c={gioappid:r,giocs1:e||"",gioplatform:this.platformConfig.platform,gioprojectid:o,gios:n,giou:t};return"cdp"===this.gioEnvironment&&(c.giodatacollect=l,c.giodatasourceid=a,c.gioid=s||"",g&&(c.giouserkey=i),q(d)||d.forEach((t=>{u.includes(t)||(c["gio"+t]=this.dataStore.lastVisitEvent[t])}))),at.stringify(c)},this.setLocation=(t,e)=>{const i={latitude:t,longitude:e},n=this.dataStore.locationData,s=t=>t>=-180&&180>=t;s(t)&&s(e)&&(n.latitude!==t||n.longitude!==e)&&(this.dataStore.locationData=i,this.dataStore.sendVisit())},this.setGeneralProps=t=>{h(t)&&!q(t)?(this.dataStore.generalProps=Object.assign(Object.assign({},this.dataStore.generalProps),t),k(this.dataStore.generalProps).forEach((t=>{[void 0,null].includes(this.dataStore.generalProps[t])&&(this.dataStore.generalProps[t]="")}))):this.callError("setGeneralProps")},this.clearGeneralProps=t=>{v(t)&&!q(t)?t.forEach((t=>{N(this.dataStore.generalProps,t)})):this.dataStore.generalProps={}},this.setPageAttributes=t=>{const{currentPage:e}=this.dataStore.eventHooks,i=this.minipInstance.getCurrentPath();["onLoad","attached"].includes(e.currentLifecycle)&&(e.pageProps[i]=F(t))},this.updateImpression=()=>{$("当前未集成半自动浏览插件，请集成插件后再调用 updateImpression!","warn")},this.notRecommended=()=>$("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info"),this.callError=(t,e=!0,i="参数不合法")=>$(`${e?"调用":"设置"} ${t} 失败，${i}!`,"warn"),this.utils=Object.assign(Object.assign(Object.assign({},V),B),{qs:at}),this.emitter={all:t=t||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map((function(t){t(i)})),(n=t.get("*"))&&n.slice().map((function(t){t(e,i)}))}},this.gioPlatform=mt(),this.gioFramework="full",this.gioEnvironment="cdp",this.sdkVersion="3.8.13";try{"quickapp"===this.gioPlatform||p(getApp)&&p(App)?this.inPlugin=!1:this.inPlugin=!0}catch(t){this.inPlugin=!0}this.inPlugin&&$("未检测到小程序实例，自动切换为插件模式!","info"),this.platformConfig=Ft,this.minipInstance=new Bt(this),this.userStore=new Et(this),this.plugins=new kt(this),this.plugins.innerPluginInit()}}{constructor(){var t,e;super(),this.registerPlugins=t=>{this.plugins.pluginItems=[...this.plugins.pluginItems,...t],this.plugins.installAll(t)},this.initCallback=()=>{this.uploader=new zt(this),this.vdsConfig.enableIdMapping||(this.userStore.userKey="")},this.setTrackerScheme=t=>{["http","https"].includes(t)?(this.dataStore.setOption("scheme",t),this.notRecommended()):this.callError("scheme",!1)},this.setTrackerHost=t=>{W.test(t)||z.test(t)?(this.dataStore.setOption("host",t),this.notRecommended()):this.callError("host",!1)},this.identify=t=>{if(this.vdsConfig.forceLogin){if(!U(t))return void this.callError("identify");const e=y(t).slice(0,1e3);this.userStore.uid=e,this.uploader.hoardingQueue.forEach(((t,i)=>this.uploader.hoardingQueue[i].deviceId=e)),this.dataStore.setOption("forceLogin",!1),this.uploader.initiateRequest(!0)}else this.callError("identify",!1,"forceLogin未开启")},this.setUserAttributes=t=>{var e,i;!q(t)&&h(t)?null===(i=null===(e=this.plugins)||void 0===e?void 0:e.gioCustomTracking)||void 0===i||i.buildUserAttributesEvent(t):this.callError("setUserAttributes")},this.setUserId=(t,e)=>{if(U(t)){const i=this.userStore.gioId;t=y(t).slice(0,1e3),e=y(e).slice(0,1e3),this.userStore.userId=t,this.vdsConfig.enableIdMapping&&(this.userStore.userKey=g(e)?"":e),this.reissueLogic(i,t)}else this.callError("setUserId")},this.clearUserId=()=>{this.userStore.userId=void 0,this.userStore.userKey=void 0},this.track=(t,e,i)=>{var n,s;((null===(s=null===(n=this.plugins)||void 0===n?void 0:n.gioCustomTracking)||void 0===s?void 0:s.buildCustomEvent)||function(){})(t,Object.assign(Object.assign({},this.dataStore.generalProps),h(e)&&!q(e)?e:{}),i)},this.reissueLogic=(t,e)=>{t&&t!==e&&(this.userStore.sessionId="",this.dataStore.sendVisit()),t||t===e||this.dataStore.sendVisit()},this.trackTimerStart=t=>!!this.vdsConfig.dataCollect&&L(t,(()=>{const e=ut();return this.dataStore.trackTimers[e]={eventName:t,leng:0,start:+Date.now()},e})),this.trackTimerPause=t=>{if(t&&this.dataStore.trackTimers[t]){const e=this.dataStore.trackTimers[t];return e.start&&(e.leng=e.leng+(+Date.now()-e.start)),e.start=0,!0}return!1},this.trackTimerResume=t=>{if(t&&this.dataStore.trackTimers[t]){const e=this.dataStore.trackTimers[t];return 0===e.start&&(e.start=+Date.now()),!0}return!1},this.trackTimerEnd=(t,e)=>{if(this.vdsConfig.dataCollect){const i=864e5;if(t&&this.dataStore.trackTimers[t]){const n=this.dataStore.trackTimers[t];if(0!==n.start){const t=+Date.now()-n.start;n.leng=t>0?n.leng+t:0}return this.track(n.eventName,Object.assign(Object.assign({},e),{event_duration:n.leng>i?0:n.leng/1e3})),this.removeTimer(t),!0}return $("未查找到对应的计时器，请检查!","error"),!1}return!1},this.removeTimer=t=>!(!t||!this.dataStore.trackTimers[t]||(delete this.dataStore.trackTimers[t],0)),this.clearTrackTimer=()=>{this.dataStore.trackTimers={}},this.dataStore=new Wt(this),p(null===(t=this.minipInstance.minip)||void 0===t?void 0:t.onAppHide)&&this.minipInstance.minip.onAppHide((()=>{E(this.dataStore.trackTimers,(t=>{t.start&&(t.leng=t.leng+(+Date.now()-t.start))}))})),p(null===(e=this.minipInstance.minip)||void 0===e?void 0:e.onAppShow)&&this.minipInstance.minip.onAppShow((()=>{E(this.dataStore.trackTimers,(t=>{t.start&&(t.start=+Date.now())}))}))}},Xt=function(){const t=arguments[0];if(d(t)&&n.includes(t)&&Jt[t]){const e=I(Array.from(arguments));if("init"===t){const t=M(Jt),i=K(e),n=G(e),s=Q(e);if(t&&i&&n&&s){const{projectId:t}=n,{dataSourceId:e,appId:i,cdpOptions:o}=s;return Jt.init(Object.assign(Object.assign({},o),{projectId:t,dataSourceId:e,appId:i}))}}else if("registerPlugins"===t)Jt.registerPlugins(e[0]);else{if(Jt.gioSDKInitialized&&Jt.vdsConfig)return Jt[t](...e);$("SDK未初始化!","error")}}else r.includes(t)?$(`方法 ${y(t)} 已被弃用!`,"warn"):$(`不存在名为 ${y(t)} 的方法调用!`,"error")};(global||$global).gdp=Xt,(global||$global).gioEnvironment="cdp",(global||$global).gioSDKVersion=Jt.sdkVersion;export{Xt as default};
