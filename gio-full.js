const e={autotrack:{type:"boolean",default:!0},cml:{type:"object",default:!1},comAsPage:{type:"boolean",default:!1},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},subpackage:{type:"boolean",default:!1},keepAlive:{type:"number",default:3e5},remax:{type:"object",default:!1},taro:{type:"object",default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},uniVue:{type:["object","function"],default:!1},version:{type:"string",default:"1.0.0"},wepy:{type:"function",default:!1}},t={compress:{type:"boolean",default:!0},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},gtouchHost:{type:"string",default:""},host:{type:"string",default:""},ignoreFields:{type:"array",default:[]},scheme:{type:"string",default:"https"},uploadInterval:{type:"number",default:1e3}},i={},n=["clearUserId","enableDebug","getGioInfo","getOption","identify","init","setAutotrack","setDataCollect","setOption","setUserId","track","setLocation","setEvar","setPage","setUser","setVisitor"],o=["autotrack","dataCollect","debug","host","scheme"],s={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式"},r=["setConfig","collectImp","setPlatformProfile","getLocation"],a=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],l=[...a,"appChannel","language","platformVersion"],g=e=>null==e||void 0===e,d=e=>"string"==typeof e,u=e=>"number"==typeof e,c=e=>"boolean"==typeof e,h=e=>"[object Object]"==={}.toString.call(e)&&!g(e),p=e=>"function"==typeof e,v=e=>Array.isArray(e)&&"[object Array]"==={}.toString.call(e),m=e=>v(e)?e[0]:void 0,f=e=>v(e)?e[e.length-1]:void 0,I=(e,t=1)=>v(e)&&u(t)?e.slice(t>0&&t<e.length?t:1,e.length):e,w=e=>{if(v(e)){let t=0;const i=[];for(const n of e)n&&(i[t++]=n);return i}return e},y=(e,t)=>{if(v(e)){const i=e.findIndex(t);return 0>i?void 0:e[i]}},O=e=>g(e)?"":""+e,b=(e,t)=>"string"==typeof e?e.split(t):e,S=e=>{if(d(e)){const t=b(e,"");return`${m(t).toLowerCase()}${I(t).join("")}`}return e},_=(e,t)=>e.slice(0,t.length)===t,C=(e,t)=>{const{length:i}=e;let n=i;n>i&&(n=i);const o=n;return n-=t.length,n>=0&&e.slice(n,o)===t},T=(e,t=" ")=>(_(e,t)&&(e=e.substring(1)),C(e,t)&&(e=e.substring(-1)),e),E={}.hasOwnProperty,P=(e,t)=>!g(e)&&E.call(e,t),x=e=>"object"==typeof e?Object.keys(e):[],k=(e,t)=>{x(e).forEach((i=>t(e[i],i)))},A=(e,t)=>{const i=x(e);if(!h(e)||!h(t)||i.length!==x(t).length)return!1;for(let n=0;n<i.length;n+=1){if(h(e[i[n]]))return A(e[i[n]],t[i[n]]);if(e[i[n]]!==t[i[n]])return!1}},N=(e,t,i)=>{let n=e;return h(e)?(t.split(".").forEach((e=>{n=n?n[e]:i})),n):i},j=(e,t)=>{if(!h(e))return!1;try{return Reflect.deleteProperty(e,t)}catch(e){return!1}},q=(e,t=250,i,n)=>{let o,s=0;return"boolean"!=typeof i&&(n=e,e=i,i=void 0),function(...r){let a=this,l=Date.now()-s;function g(){s=Date.now(),e.apply(a,r)}n&&!o&&g(),o&&clearTimeout(o),void 0===n&&l>t?g():!0!==i&&(o=setTimeout(n?function(){o=void 0}:g,void 0===n?t-l:t))}},V=e=>v(e)?0===e.length:h(e)?0===x(e).length:!e,H=e=>{const t=typeof e;return"object"===t&&v(e)?"array":t};var B=Object.freeze({__proto__:null,isNil:g,isString:d,isNumber:u,isBoolean:c,isObject:h,isFunction:p,isArray:v,fixed:(e,t)=>u(e)?e.toFixed(u(t)?t:2,10):e,head:m,last:f,drop:I,dropWhile:(e,t)=>v(e)?e.filter((e=>!t(e))):e,compact:w,find:y,toString:O,split:b,lowerFirst:S,upperFirst:e=>{if(d(e)){const t=b(e,"");return`${m(t).toUpperCase()}${I(t).join("")}`}return e},startsWith:_,endsWith:C,trim:T,hasOwnProperty:E,has:P,keys:x,forEach:k,isEqual:A,get:N,unset:j,throttle:q,isEmpty:V,typeOf:H});const F=(e,t)=>{console.log("%c[GrowingIO]："+e,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},L=e=>{try{return e()}catch(e){return}},D=e=>{const t={};return h(e)&&k(e,((e,i)=>{const n=O(i).slice(0,50);h(e)?t[n]=D(e):v(e)?(t[n]=e.slice(0,100),"cdp"===(global||$global).gioEnvironment&&(t[n]=t[n].join("||"))):t[n]=g(e)?"":O(e).slice(0,1e3)})),t},R=e=>d(e)?T(e).substring(0,100):e;var $=Object.freeze({__proto__:null,consoleText:F,niceTry:L,limitObject:D,limitString:R});const U=e=>d(e)&&e.length>0||u(e)&&e>0,M=e=>!e.vdsConfig&&!e.gioSDKInitialized||(F("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1),K=e=>!!w(e)||(F('SDK初始化失败，请使用 gio("init", "您的GrowingIO项目 accountId", "你的应用 AppId", options); 进行初始化!',"error"),!1),G=e=>{const t=e[0];let i=f(e);return U(t)?(h(i)&&i||(i={}),{projectId:t,userOptions:i}):(F("SDK初始化失败，accountId 参数不合法!","error"),!1)},Q=e=>{let t=e[1];return t=(e=>(U(e)||(e="",F("检测到应用 AppId 未填写或不合法，将自动为您获取!")),e))(t),{appId:t}};var W={},z={}.hasOwnProperty;function J(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function X(e){try{return encodeURIComponent(e)}catch(e){return null}}W.stringify=function(e,t){t=t||"";var i,n,o=[];for(n in"string"!=typeof t&&(t="?"),e)if(z.call(e,n)){if((i=e[n])||null!=i&&!isNaN(i)||(i=""),n=X(n),i=X(i),null===n||null===i)continue;o.push(n+"="+i)}return o.length?t+o.join("&"):""},W.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,n={};t=i.exec(e);){var o=J(t[1]),s=J(t[2]);null===o||null===s||o in n||(n[o]=s)}return n};const Z=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),Y=e=>e.pixelRatio?Math.round(e.screenWidth*e.pixelRatio):e.screenWidth,ee=(e,t)=>{if(e){const i=e.toLowerCase();return-1!==i.indexOf("android")?t+"-Android":-1!==i.indexOf("ios")?t+"-iOS":e}},te=(e,t)=>{const i=e=>e.replace(/\s+/g,""),n=e=>e.replace(/[vV]/g,""),o=i(n(e)),s=i(n(t)),r=o.split("."),a=s.split(".");return""===m(r)&&r.unshift(0),""===m(a)&&a.unshift(0),(r.length>a.length?r:a).every(((e,t)=>Number.parseInt(r[t]||0,10)>=Number.parseInt(a[t]||0,10)))},ie=e=>{const{Current:t,createComponent:i}=e;return!(!e||!t||i)},ne=()=>{let e;return!e&&L((()=>swan))&&(e="swan"),!e&&L((()=>tt))&&(e="tt"),!e&&L((()=>qq))&&(e="qq"),!e&&L((()=>my))&&(e="my"),!e&&L((()=>ks))&&(e="ks"),!e&&L((()=>jd))&&(e="jd"),!e&&L((()=>wx))&&(e="wx"),e||y(x(global),(e=>O(e).toLowerCase().includes("quickapp")))&&(e="quickapp"),e},oe=e=>x(e).filter((e=>e.indexOf("__sub")>-1&&e.indexOf("gio__")>-1)).sort(),se=()=>{let e=L((()=>getApp({allowDefault:!0})));return e||(e=global||$global),e};class re{constructor(e){var t;this.growingIO=e,this.initUserInfo=()=>{const{minipInstance:e}=this.growingIO;this.uid=e.getStorageSync(this.uidStorageName)||Z(),this.userId=e.getStorageSync(this.userIdStorageName),this.userKey=e.getStorageSync(this.userKeyStorageName),this.gioId=e.getStorageSync(this.gioIdStorageName)},this.syncUserInfo=()=>{const{minipInstance:e}=this.growingIO;e.setStorageSync(this.uidStorageName,this.uid),e.setStorageSync(this.userIdStorageName,this.userId),e.setStorageSync(this.userKeyStorageName,this.userKey),e.setStorageSync(this.gioIdStorageName,this.gioId)};const{inPlugin:i}=this.growingIO;this.uidStorageName=i?"_growing_plugin_uid_":"_growing_uid_",this.userIdStorageName=i?"_growing_plugin_userId_":"_growing_userId_",this.userKeyStorageName=i?"_growing_plugin_userKey_":"_growing_userKey_",this.gioIdStorageName=i?"_growing_plugin_gioId_":"_growing_gioId_",this._sessionId=Z(),this._uid=void 0,this._userId=void 0,this._userKey=void 0,this._gioId=void 0,"quickapp"!==(null===(t=this.growingIO)||void 0===t?void 0:t.gioPlatform)&&this.initUserInfo()}get sessionId(){return this._sessionId||(this._sessionId=Z()),this._sessionId}set sessionId(e){const t=this._sessionId;this._sessionId=e||Z(),t!==this._sessionId&&this.growingIO.emitter.emit("SESSIONID_UPDATE",{newSessionId:this._sessionId,oldSessionId:t})}get uid(){return this._uid}set uid(e){const t=this._uid;this._uid=e,this.growingIO.minipInstance.setStorage(this.uidStorageName,this._uid),t!==this._uid&&this.growingIO.emitter.emit("UID_UPDATE",{newUId:e,oldUId:t})}get userId(){return this._userId}set userId(e){const t=this._userId;this._userId=e,this.growingIO.minipInstance.setStorage(this.userIdStorageName,this._userId),t!==this._userId&&this.growingIO.emitter.emit("USERID_UPDATE",{newUserId:e,oldUserId:t}),e&&(this.gioId=e)}get userKey(){return this._userKey}set userKey(e){const t=this._userKey;this._userKey=e,this.growingIO.minipInstance.setStorage(this.userKeyStorageName,this._userKey),t!==this._userKey&&this.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:t})}get gioId(){return this._gioId}set gioId(e){const t=this._gioId;this._gioId=e,this.growingIO.minipInstance.setStorage(this.gioIdStorageName,this._gioId),t!==this._gioId&&this.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:e,oldGioId:t})}}let ae;var le={name:"gioUniAppAdapter",method:class{constructor(e){var t,i;this.growingIO=e,this.main=()=>{var e,t,i,n;if(this.uniVue||(this.uniVue=null===(t=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===t?void 0:t.uniVue),console.log("Vue version: ",this.uniVue.version),null===(n=null===(i=this.growingIO)||void 0===i?void 0:i.vdsConfig)||void 0===n?void 0:n.subpackage)return!1;switch(Number.parseInt(ae.head(ae.split(this.uniVue.version,".")),10)){case 2:this.uniVue2Proxy(this.uniVue);break;case 3:this.uniVue3Proxy(this.uniVue);break;default:ae.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")}},this.getHandlerName=e=>{let t="__e";const{type:i,currentTarget:n,target:o}=e,s=(null==n?void 0:n.dataset)||(null==o?void 0:o.dataset);if(s){const e=s.eventOpts||s["event-opts"],n=(e,t)=>e===t||"regionchange"===t&&("begin"===e||"end"===e);e&&e.forEach((e=>{let o=ae.head(e);const s="^"===o.charAt(0);o=s?o.slice(1):i;const r="~"===o.charAt(0);o=r?o.slice(1):i;const a=ae.last(e);n(i,o)&&(t=ae.head(ae.head(a)))}))}return t},this.uniVue2Proxy=e=>{const{dataStore:{eventHooks:t},gioPlatform:i}=this.growingIO;"swan"===i?App=function(){return t.growingApp(arguments[0])}:t.nativeGrowing(),e.mixin({beforeMount(){"page"===this.mpType&&t.pageOverriding(this.$scope)}})},this.uniVue3Proxy=e=>{const{eventHooks:t}=this.growingIO.dataStore;t.nativeGrowing(),e.mixin({beforeMount(){const e=(e,i)=>ae.isFunction(i)&&!t.pageHandlers.includes(e)?function(){return t.customFcEffects(e,i).apply(this,arguments)}:i;ae.keys(this).forEach((t=>{ae.isFunction(this[t])&&!["getOpenerEventChannel","$hasHook","$callHook","createSelectorQuery","createIntersectionObserver","selectAllComponents","selectComponent"].includes(t)&&(this[t]=e(t,this[t]))}));const i=this._.emit;this._.emit=function(){return(()=>{t.customFcEffects(arguments[0],(()=>{})).apply(this,arguments)})(),i.apply(this,arguments)}}})},ae=this.growingIO.utils,this.uniVue=null===(i=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===i?void 0:i.uniVue}}};let ge;var de={name:"gioTaroAdapter",method:class{constructor(e){var t,i,n,o;this.growingIO=e,this.main=()=>{var e,t,i,n;this.taro||(this.taro=null===(t=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===t?void 0:t.taro),this.vue||(this.vue=null===(n=null===(i=this.growingIO)||void 0===i?void 0:i.vdsConfig)||void 0===n?void 0:n.taroVue);const{Current:o,createComponent:s}=this.taro;!o&&s?this.proxyTaro2(this.taro):o&&!s?this.proxyTaro3(this.taro,this.vue):ge.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")},this.proxyTaro2=e=>{const t=this,i=e.createApp,n=e.createComponent;i&&(e.createApp=function(e){const n=i(e);return t.growingIO.dataStore.eventHooks.appOverriding(n),n}),n&&(e.createComponent=function(e,i){const o=n(e,i);return i?t.growingIO.dataStore.eventHooks.pageOverriding(o.methods):t.growingIO.dataStore.eventHooks.componentOverriding(o.methods),o})},this.proxyTaro3=(e,t)=>{const{eventHooks:i}=this.growingIO.dataStore;if(i.nativeGrowing(),t){console.log("Vue version: ",t.version);const e=Number.parseInt(ge.head(ge.split(t.version,".")),10);2===e?this.taro3Vue2Proxy(t):3===e?this.taro3Vue3Proxy(t):ge.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")}else this.taro3ReactProxy()},this.taro3ReactProxy=()=>{const e=document.__proto__.__proto__;Object.defineProperty(e,"dispatchEvent",{value:(e=>{const t=this;return function(){const i=this,n=arguments[0],o=i.__handlers[n.type];return Array.isArray(o)&&o.forEach(((e,i)=>{o[i]=t.growingIO.dataStore.eventHooks.customFcEffects(e.name,e)})),e.apply(this,arguments)}})(e.dispatchEvent),enumerable:!1,configurable:!0})},this.taro3Vue2Proxy=e=>{const{eventHooks:t}=this.growingIO.dataStore,i=(e,i,n)=>ge.isFunction(n)&&!t.pageHandlers.includes(i)?function(){t.customFcEffects(i,n).apply(this,arguments)}:n;e.mixin({beforeMount:function(){const e=this.$options.methods;ge.keys(e).forEach((e=>{Object.defineProperty(this,e,{value:i(0,e,this[e]),configurable:!0,writable:!0})}))}})},this.taro3Vue3Proxy=e=>{const{eventHooks:t}=this.growingIO.dataStore;e.mixin({beforeMount:function(){const e=(e,i)=>ge.isFunction(i)&&!t.pageHandlers.includes(e)?function(){return t.customFcEffects(e,i).apply(this,arguments)}:i;ge.keys(this).forEach((t=>{ge.isFunction(this[t])&&!["getOpenerEventChannel","$hasHook","$callHook","createSelectorQuery","createIntersectionObserver","selectAllComponents","selectComponent"].includes(t)&&(this[t]=e(t,this[t]))}));const i=this._.emit;this._.emit=function(){return(()=>{t.customFcEffects(arguments[0],(()=>{})).apply(this,arguments)})(),i.apply(this,arguments)}}})},this.saveFullPage=e=>{const t=e=>{e.forEach((e=>{var i;(null===(i=null==e?void 0:e.ctx)||void 0===i?void 0:i.route)?(this.growingIO.taro3VMs||(this.growingIO.taro3VMs={}),this.growingIO.taro3VMs[e.ctx.route]=e):Array.isArray(e.childNodes)&&t(e.childNodes)}))};t(e.childNodes)},ge=this.growingIO.utils,this.taro=null===(i=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===i?void 0:i.taro,this.vue=null===(o=null===(n=this.growingIO)||void 0===n?void 0:n.vdsConfig)||void 0===o?void 0:o.taroVue}}};let ue,ce,he,pe=[];var ve={name:"gioRemaxAdapter",method:class{constructor(e){var t,i;this.growingIO=e,this.main=()=>{var e,t;this.remax||(this.remax=null===(t=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===t?void 0:t.remax);const{nativeGrowing:i}=this.growingIO.dataStore.eventHooks;i()},this.onComposeBefore=({page:e,event:t})=>{var i;if(!this.remax)return;const{dataStore:n,remaxVMs:o}=this.growingIO,{customFcEffects:s}=n.eventHooks;o||(this.growingIO.remaxVMs={}),e&&!this.growingIO.remaxVMs[e.route]&&(this.growingIO.remaxVMs[e.route]={}),e&&"onShow"===t&&!(null===(i=this.growingIO.remaxVMs[e.route])||void 0===i?void 0:i.hooked)&&(ue.keys(e).filter((e=>e.indexOf("$$REMAX_METHOD")>-1)).forEach((t=>{e[t]=s(t,e[t])})),this.page=e.route,this.growingIO.remaxVMs[e.route]={hooked:!0,fiberNode:this.findRealRoot(e),data:this.getTopView(e)})},this.getTopView=e=>{var t;const i=null===(t=e.__data__||e.data)||void 0===t?void 0:t.root,n=ue.head(i.children);let o;return ue.isNumber(n)&&ue.has(i,"nodes")?o=i.nodes[ue.head(i.children)]:ue.isObject(n)&&(o=n),o},this.isPageTopView=(e,t)=>{var i,n,o,s,r;const a=this.getTopView(t),l=ue.isArray(null===(i=null==e?void 0:e.memoizedProps)||void 0===i?void 0:i.children)?ue.compact(null===(n=null==e?void 0:e.memoizedProps)||void 0===n?void 0:n.children):[];return(null==e?void 0:e.type)===(null==a?void 0:a.type)&&(null===(o=null==e?void 0:e.memoizedProps)||void 0===o?void 0:o.className)===(null===(s=null==a?void 0:a.props)||void 0===s?void 0:s.class)&&l.length===(null===(r=null==a?void 0:a.children)||void 0===r?void 0:r.length)},this.fiberNodeTraverse=(e,t)=>this.isPageTopView(e,t)?e:e.child?this.fiberNodeTraverse(e.child,t):null,this.findRealRoot=e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.wrapperRef)||void 0===t?void 0:t.current)||void 0===i?void 0:i._reactInternals)&&(e.__data__||e.data)?this.fiberNodeTraverse(e.wrapperRef.current._reactInternals,e):null},this.getHandlerName=e=>{const t=this.growingIO.remaxVMs[this.page];if(ce=e,he=Number(ue.split(ce,"_")[2]),pe=[],t){this.getDataNodePath(t.data);let e=t.fiberNode;const i=(t,i)=>{const[n,o]=ue.split(t,"-");return ue.isArray(i.children)?e=ue.compact(i.children)[Number(o)]:ue.isObject(i.children)&&(e=i.children),e},n=pe.map((t=>i(t,e.props||e.memoizedProps)));if(n.length===pe.length)return ue.last(n).props[ue.last(ue.split(ce,"_"))].name}},this.getDataNodePath=({children:e,nodes:t})=>{let i=null;const n=e.find(((e,i)=>{const n=(ue.toString(e)===ue.toString(he)||ue.toString(e.id)===ue.toString(he))&&Object.values((t?t[e]:e).props).includes(ce);return n&&pe.unshift(`${t?e:e.id}-${i}`),n}));return n?i=ue.isNumber(n)&&t?t[n]:n:e.every(((e,n)=>!(t?t[e]:e).children||(i=this.getDataNodePath(t?t[e]:e),i&&pe.unshift(`${t?e:e.id}-${n}`),!i))),i},ue=this.growingIO.utils,this.remax=null===(i=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===i?void 0:i.remax,this.page=""}}};function me(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}let fe;var Ie={name:"gioImpressionTracking",method:class{constructor(e){this.growingIO=e,this.main=(e,t)=>{var i,n,o;const{vdsConfig:s,minipInstance:r,gioPlatform:a}=this.growingIO,{uniVue:l,taro:g}=s,d=(e=>{if(e){const t=Number.parseInt(m(b(e.version,".")),10);return Number.isNaN(t)?0:t}return 0})(l);l&&2===d&&(e=e.$vm.$scope),this.impressionObserver&&this.impressionObserver.disconnect(),"my"===a?te(my.SDKVersion,"2.7.0")&&(this.impressionObserver=null===(i=r.minip)||void 0===i?void 0:i.createIntersectionObserver({[t]:!0,dataset:!0})):e.isComponent?this.impressionObserver=e.createIntersectionObserver({[t]:!0}):this.impressionObserver=null===(n=r.minip)||void 0===n?void 0:n.createIntersectionObserver(e,{[t]:!0});const u=null===(o=this.impressionObserver)||void 0===o?void 0:o.relativeToViewport();null==u||u.observe(".growing_collect_imp",(t=>me(this,void 0,void 0,(function*(){if(!fe.isEmpty(t)&&t.intersectionRatio>0){let i=t.dataset;g&&ie(g)&&(i=this.getTaro3Dataset(e.route,t.id)),"ks"===a&&(yield this.getKsDataset(t).then((e=>i=e)));const n=this.getImpressionProperties(i);n.eventId?this.buildImpEvent(n):fe.consoleText("曝光事件格式不正确，事件名只能包含数字、字母和下划线，且不以数字开头!","warn")}}))))},this.getImpressionProperties=e=>{let t={eventId:void 0,properties:{}};if(!(null==e?void 0:e.gioImpTrack))return t;if(t.eventId=e.gioImpTrack,fe.has(e,"gioImpAttrs"))t.properties=fe.niceTry((()=>fe.isObject(e.gioImpAttrs)?e.gioImpAttrs:JSON.parse(e.gioImpAttrs))),t.items=fe.niceTry((()=>fe.isObject(e.gioImpItems)?e.gioImpItems:JSON.parse(e.gioImpItems)));else{const i=/^gioTrack(.+)/;for(const n in e){let o;const s=n.match(i);s&&(o=fe.lowerFirst(s[1]),"track"!==o&&(t.properties[o]=e[n]))}}return t.properties=fe.limitObject(t.properties),t.items=fe.limitObject(t.items),/^\w+$/.test(t.eventId)&&!Number.isInteger(Number.parseInt(fe.head(t.eventId.split("")),10))||(t.eventId=null,t={}),t},this.getTaro3Dataset=(e,t)=>{var i;const n=null===(i=this.growingIO)||void 0===i?void 0:i.taro3VMs[e];if(!n)return!1;let o={};const s=e=>{e.some((e=>{var i;return e.uid===t&&(null===(i=e.props)||void 0===i?void 0:i.class.indexOf("growing_collect_imp"))>-1&&!fe.isEmpty(e.dataset)?(o=e.dataset,!0):!!Array.isArray(e.childNodes)&&s(e.childNodes)}))};return s(n.childNodes),o},this.getKsDataset=e=>{const{minipInstance:t}=this.growingIO,i=t.minip.createSelectorQuery().selectAll(".growing_collect_imp"),{width:n,height:o}=e.boundingClientRect;return new Promise((e=>{i.boundingClientRect((t=>{const i=t.find((e=>fe.fixed(n)===fe.fixed(e.width)&&fe.fixed(o)===fe.fixed(e.height)));e((null==i?void 0:i.dataset)||{})})).exec()}))},this.buildImpEvent=e=>{const{eventId:t,properties:i,items:n}=e,{dataStore:{eventContextBuilder:o,eventInterceptor:s,eventHooks:r}}=this.growingIO;s(Object.assign({eventType:"CUSTOM",pageShowTimestamp:r.currentPage.time,eventName:t,attributes:i,resourceItem:n},o()))},fe=this.growingIO.utils}}};let we;var ye={name:"gioEventAutoTracking",method:class{constructor(e){this.growingIO=e,this.main=(e,t)=>{var i,n;const{remaxVMs:o,dataStore:{eventHooks:s},vdsConfig:r,platformConfig:a,plugins:l,emitter:g}=this.growingIO;if(!r.autotrack||!t||s.shareOut||we.get(e,"currentTarget.dataset.growingIgnore")||we.get(e,"target.dataset.growingIgnore")||!we.get(e,"target.dataset.growingTrack")&&"autoplay"===we.get(e,"detail.source")||e.type===(null===(i=this.prevEvent)||void 0===i?void 0:i.type)&&10>Number(e.timeStamp)-Number(null===(n=this.prevEvent)||void 0===n?void 0:n.timeStamp))return;if(this.prevEvent=e,"__e"===t&&r.uniVue&&(t=null==l?void 0:l.gioUniAppAdapter.getHandlerName(e)),["#eh","eh"].includes(t)&&r.taro)return;if(["_cmlEventProxy","onclick","blurEvent","handleDetail"].includes(t)&&r.cml)return;t.indexOf("$$REMAX_METHOD")>-1&&o&&(t=null==l?void 0:l.gioRemaxAdapter.getHandlerName(t)),r.debug&&console.log("Action：",e.type,Date.now()),g.emit("onComposeBefore",{event:t,params:null!=e?e:{}});const d=a.listeners.actions;d.click.includes(e.type)?this.buildClickEvent(e,t):d.change.includes(e.type)?this.buildChangeEvent(e,t):d.submit.includes(e.type)&&this.buildSubmitEvent(e,t)},this.getNodeXpath=(e,t)=>{const{gioPlatform:i,vdsConfig:n}=this.growingIO;let o=(e.currentTarget||e.target).id;if((!o||"swan"===i&&/^_[0-9a-f]+/.test(o)||ie(n.taro)&&/^_n_[0-9]+$/.test(o))&&(o=""),!n.octopus||(t=e.handler,/^bound .*/.test(t)&&(t=t.replace("bound ","")),/^t[0-9]+$/.test(o)&&(o=""),o&&!t&&(t="anonymousFunc"),o||t))return`${o}#${t}`},this.buildClickEvent=(e,t)=>{var i,n;const o=this.getNodeXpath(e,t);if(o){const{dataStore:{eventContextBuilder:t,eventInterceptor:s,eventHooks:r},gioEnvironment:a}=this.growingIO,l=e.currentTarget||e.target;let g;we.has(null==l?void 0:l.dataset,"index")&&(g=Number.parseInt(l.dataset.index,10),Number.isNaN(g)&&(g=-1)),s(Object.assign({eventType:"saas"===a&&e.type.includes("long")?"lngprss":"VIEW_CLICK",pageShowTimestamp:r.currentPage.time,element:[{xpath:o,index:g,textValue:null===(i=null==l?void 0:l.dataset)||void 0===i?void 0:i.title,hyperlink:null===(n=null==l?void 0:l.dataset)||void 0===n?void 0:n.src}]},t()))}},this.buildTabClickEvent=e=>{const{dataStore:{eventContextBuilder:t,eventInterceptor:i,eventHooks:n}}=this.growingIO;i(Object.assign({eventType:"VIEW_CLICK",pageShowTimestamp:n.currentPage.time,element:[{xpath:"#onTabItemTap",textValue:e.text,index:e.index,hyperlink:we.toString(e.pagePath)}]},t()))},this.buildChangeEvent=(e,t)=>{var i,n;const o=this.getNodeXpath(e,t);if(o){const{dataStore:{eventContextBuilder:t,eventInterceptor:s,eventHooks:r}}=this.growingIO,a=e.currentTarget||e.target,l=Object.assign({eventType:"VIEW_CHANGE",pageShowTimestamp:r.currentPage.time,element:{xpath:o}},t()),g=we.get(e,"detail.value")||we.get(e,"target.attr.value");((null===(i=null==a?void 0:a.dataset)||void 0===i?void 0:i.growingTrack)||(null===(n=null==a?void 0:a.dataset)||void 0===n?void 0:n.growingtrack))&&(we.isNil(g)||(l.element.textValue=we.toString(g))),l.element=[l.element],s(l)}},this.buildSubmitEvent=(e,t)=>{const i=this.getNodeXpath(e,t);if(i){const{dataStore:{eventContextBuilder:e,eventInterceptor:t,eventHooks:n}}=this.growingIO;t(Object.assign({eventType:"FORM_SUBMIT",pageShowTimestamp:n.currentPage.time,element:[{xpath:i}]},e()))}},we=this.growingIO.utils,this.prevEvent={}}}};let Oe;var be={name:"gioCustomTracking",method:class{constructor(e){this.growingIO=e,this.getValidResourceItem=e=>{if(e&&Oe.isObject(e)&&e.id&&e.key){const t={id:Oe.isString(e.id)?e.id:JSON.stringify(e.id),key:Oe.isString(e.key)?e.key:JSON.stringify(e.key)};return e.attributes&&(t.attributes=e.attributes),t}},this.buildCustomEvent=(e,t,i)=>{var n;if(Oe.isString(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,50}$/)){const{dataStore:{eventContextBuilder:o,eventInterceptor:s,eventHooks:r}}=this.growingIO;s(Object.assign({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null===(n=null==r?void 0:r.currentPage)||void 0===n?void 0:n.time,attributes:Oe.limitObject(Oe.isObject(t)&&!Oe.isEmpty(t)?t:void 0),resourceItem:Oe.limitObject(this.getValidResourceItem(i))},o()))}else Oe.consoleText("埋点事件格式不正确，事件名只能包含数字、字母和下划线，且不能以数字开头!","warn")},Oe=this.growingIO.utils}buildVisitorVariable(e){if(Oe.isObject(e)&&!Oe.isEmpty(e)){const{dataStore:{lastVisitEvent:t,eventContextBuilder:i,eventInterceptor:n}}=this.growingIO,o=Object.assign({eventType:"vstr",attributes:Oe.limitObject(e)},i());o.path||(o.path=t.path,o.query=t.query,o.title=t.title),n(o)}}buildPeopleVariable(e){if(this.growingIO.userStore.uid&&Oe.isObject(e)&&!Oe.isEmpty(e)){const{dataStore:{lastVisitEvent:t,eventContextBuilder:i,eventInterceptor:n}}=this.growingIO,o=Object.assign({eventType:"ppl",properties:Oe.limitObject(e)},i());o.path||(o.path=t.path,o.query=t.query,o.title=t.title),n(o)}}buildPageLevelVariable(e){if(Oe.isObject(e)&&!Oe.isEmpty(e)){const{dataStore:{eventContextBuilder:t,eventInterceptor:i,eventHooks:n}}=this.growingIO;i(Object.assign({eventType:"pvar",pageShowTimestamp:n.currentPage.time,properties:Oe.limitObject(e)},t()))}}buildConversionVariable(e){if(Oe.isObject(e)&&!Oe.isEmpty(e)){const{dataStore:{eventContextBuilder:t,eventInterceptor:i}}=this.growingIO;i(Object.assign({eventType:"evar",properties:Oe.limitObject(e)},t()))}}}};const Se={};function _e(e,t,i){var n=e;t.map((function(e,o){n[e]=o==t.length-1?i:n[e]||{},n=n[e]}))}_e(Se,["plugins","gioChameleonAdapter"],{name:"gioChameleonAdapter",method:class{constructor(e){var t,i;this.growingIO=e,this.main=()=>{const{vdsConfig:e,dataStore:{eventHooks:t}}=this.growingIO;this.cml||(this.cml=null==e?void 0:e.cml);const i=this.cml.createApp,n=this.cml.createPage,o=this.cml.createComponent;this.cml.createApp=function(e){return i(t.appOverriding(e))},this.cml.createPage=function(e){return n(t.pageOverriding(e))},this.cml.createComponent=function(e){return o(t.componentOverriding(e))}},this.cml=null===(i=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===i?void 0:i.cml}}}),_e(Se,["plugins","gioCustomTracking"],be),_e(Se,["plugins","gioEventAutoTracking"],ye),_e(Se,["plugins","gioImpressionTracking"],Ie),_e(Se,["plugins","gioRemaxAdapter"],ve),_e(Se,["plugins","gioTaroAdapter"],de),_e(Se,["plugins","gioUniAppAdapter"],le),_e(Se,["plugins","gioWepyAdapter"],{name:"gioWepyAdapter",method:class{constructor(e){var t,i;this.growingIO=e,this.main=()=>{var e,t;this.wepy||(this.wepy=null===(t=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===t?void 0:t.wepy),this.proxyWepy(this.wepy)},this.proxyWepy=e=>{const{appOverriding:t,pageOverriding:i,componentOverriding:n}=this.growingIO.dataStore.eventHooks,o=e.app,s=e.page,r=e.component;e.app=function(e,i){return o(t(e),i)},e.page=function(e,t){return s(i(e),t)},e.component=function(e,t){return r(n(e),t)}},this.wepy=null===(i=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===i?void 0:i.wepy}}});class Ce{constructor(e){this.growingIO=e,this.innerPluginInit=()=>{x(Se.plugins).forEach((e=>{const{name:t,method:i}=Se.plugins[e];this.pluginItems.find((e=>e.name===t))||this.pluginItems.push({name:S(t||e),method:i||(e=>{})})})),V(this.pluginItems)||this.installAll()},this.install=(e,t)=>{var i;const n=t||this.pluginItems.find((t=>t.name===e));if(null===(i=this.growingIO)||void 0===i?void 0:i.plugins[e])return F(`重复加载插件 ${e} 或插件重名，已跳过加载!`,"warn"),!1;if(!n)return F(`插件加载失败!不存在名为 ${e} 的插件!`,"error"),!1;try{return this.growingIO.plugins[e]=new n.method(this.growingIO),"cdp"===this.growingIO.gioEnvironment&&t&&F("加载插件："+e,"info"),!0}catch(e){return F("插件加载异常："+e,"error"),!1}},this.installAll=e=>{(e||this.pluginItems).forEach((t=>this.install(t.name,e?t:void 0)))},this.uninstall=e=>{var t;j(this.pluginItems,e);const i=j(null===(t=this.growingIO)||void 0===t?void 0:t.plugins,e);return i||F(`卸载插件 ${e} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((e=>this.uninstall(e.name)))},this.lifeError=(e,t)=>F(`插件执行错误 ${e.name} ${t}`,"error"),this.onComposeBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeBefore;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onComposeAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeAfter;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendBefore;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendAfter;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.pluginItems=[],this.growingIO.emitter.on("onComposeBefore",this.onComposeBefore),this.growingIO.emitter.on("onComposeAfter",this.onComposeAfter),this.growingIO.emitter.on("onSendBefore",this.onSendBefore),this.growingIO.emitter.on("onSendAfter",this.onSendAfter)}}const Te={scnPrefix:"",appHandlers:["onLaunch","onShow","onHide","onError","onPageNotFound"],pageHandlers:["onLoad","onShow","onReady","onHide","onShareAppMessage","onTabItemTap"],componentHandlers:["created","attached","detached","onShareAppMessage","onTabItemTap","show","hide"],actionEventTypes:["onclick","tap","longpress","longTap","blur","change","submit","confirm","getuserinfo","getphonenumber","contact"],originalApp:L((()=>App)),originalPage:L((()=>Page)),originalComponent:L((()=>Component)),originalBehavior:L((()=>Behavior)),canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},listeners:{app:{appLaunch:"onLaunch",appShow:"onShow",appClose:"onHide",appError:"onError",appPageNotFound:"onPageNotFound"},page:{pageLoad:"onLoad",pageShow:"onShow",pageReady:"onReady",pageHide:"onHide",tabTap:"onTabItemTap",shareApp:"onShareAppMessage",comCreated:"created",comAttached:"attached",comDetached:"detached",comShow:"show",comHide:"hide"},actions:{click:["onclick","tap","longpress","longTap","getuserinfo","getphonenumber","contact"],change:["blur","change","confirm"],submit:["submit"]}}},Ee=Object.assign(Object.assign({},Te),{listeners:Object.assign({},Te.listeners),name:"JingDong",platform:"jd",scnPrefix:"jd_"}),Pe=Object.assign(Object.assign({},Te),{listeners:Object.assign({},Te.listeners),name:"KuaiShou",platform:"kuaishoup",scnPrefix:"ks_"}),xe=Object.assign(Object.assign({},Te),{listeners:Object.assign({},Te.listeners),name:"Alipay",platform:"alip",scnPrefix:"alip_",componentHandlers:["onInit","didMount","didUnmount"],hooks:Object.assign(Object.assign({},null==Te?void 0:Te.hooks),{Behavior:!1})});xe.listeners.page=Object.assign(Object.assign({},xe.listeners.page),{comCreated:"onInit",comAttached:"didMount",comDetached:"didUnmount"});const ke=Object.assign(Object.assign({},Te),{listeners:Object.assign({},Te.listeners),name:"QQ",platform:"qq",scnPrefix:"qq_"}),Ae=Object.assign(Object.assign({},Te),{listeners:Object.assign({},Te.listeners),name:"Baidu",platform:"baidup",scnPrefix:"baidup_"}),Ne=Object.assign(Object.assign({},Te),{listeners:Object.assign({},Te.listeners),name:"Bytedance",platform:"bytedance",scnPrefix:"bytedance_"}),je=Object.assign(Object.assign({},Te),{listeners:Object.assign({},Te.listeners),name:"Weixin",platform:"MinP"});je.pageHandlers=[...Te.pageHandlers,"onShareTimeline"],je.componentHandlers=[...Te.componentHandlers,"onShareTimeline"],je.listeners.page.shareTime="onShareTimeline";const qe=ne(),Ve=L((()=>{const e={jd:Ee,ks:Pe,my:xe,qq:ke,swan:Ae,tt:Ne,wx:je}[qe];return e.canHook=!1,e}));class He{constructor(e){this.growingIO=e,this.minip=L((()=>{{let e;return e||(e=L((()=>swan))),e||(e=L((()=>my))),e||(e=L((()=>tt))),e||(e=L((()=>qq))),e||(e=L((()=>ks))),e||(e=L((()=>wx))),e}})),this.getAppId=()=>"",this.navigateTo=e=>{var t;return null===(t=this.minip)||void 0===t?void 0:t.navigateTo(e)},this.switchTab=e=>{var t;null===(t=this.minip)||void 0===t||t.switchTab(e)},this.navigateToMiniProgram=e=>{var t;return null===(t=this.minip)||void 0===t?void 0:t.navigateToMiniProgram(e)},this.onAppShow=e=>{var t;null===(t=this.minip)||void 0===t||t.onAppShow(e)},this.onAppHide=e=>{var t;null===(t=this.minip)||void 0===t||t.onAppHide(e)},this.getImageInfo=({src:e,success:t,fail:i,complete:n})=>{var o;return null===(o=this.minip)||void 0===o?void 0:o.getImageInfo({src:e,success:t,fail:i,complete:n})},this.initImpression=e=>{var t,i;null===(i=null===(t=this.growingIO.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===i||i.main(e,"observeAll")},this.getCurrentPage=()=>L((()=>f(getCurrentPages())))||{},this.getCurrentPath=()=>{const e=this.getCurrentPage();return(null==e?void 0:e.route)||(null==e?void 0:e.uri)||(null==e?void 0:e.__route__)||""},this.getPageTitle=e=>{var t,i;return d(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.gioPageTitle)?R(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.gioPageTitle):""},this.getStorageSync=e=>{var t;return null===(t=this.minip)||void 0===t?void 0:t.getStorageSync(e)},this.getStorage=e=>new Promise((t=>{var i;null===(i=this.minip)||void 0===i||i.getStorage({key:e,success:({data:e})=>t(e),fail:()=>t("")})})),this.setStorageSync=(e,t)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync(e,t)},this.setStorage=(e,t)=>{var i;null===(i=this.minip)||void 0===i||i.setStorage({key:e,data:t})},this.removeStorageSync=e=>{var t;null===(t=this.minip)||void 0===t||t.removeStorageSync(e)},this.removeStorage=e=>{var t;null===(t=this.minip)||void 0===t||t.removeStorage(e)},this.getNetworkType=()=>me(this,void 0,void 0,(function*(){const e=this;return yield new Promise((t=>{var i;null===(i=this.minip)||void 0===i||i.getNetworkType({success:i=>{e.network=i,t(i)},fail:()=>t(null)})}))})),this.request=({url:e,data:t,header:i,timeout:n,method:o,success:s,fail:r,complete:a})=>{var l;const g=null===(l=this.minip)||void 0===l?void 0:l.request({url:e,data:t,header:i,timeout:n,method:o,success:s,fail:r,complete:a}),d=setTimeout((()=>{null==g||g.abort(),clearTimeout(d)}),(n||1e4)+10);return g},this.getSystemInfo=()=>me(this,void 0,void 0,(function*(){const e=this;return yield new Promise((t=>{var i;null===(i=this.minip)||void 0===i||i.getSystemInfo({success:i=>{e.systemInfo=i,t(i)},fail:()=>t(null)})}))})),this.getSetting=()=>new Promise((e=>{var t;null===(t=this.minip)||void 0===t||t.getSetting({success:e,fail:e})}));const{platformConfig:{platform:t,scnPrefix:i}}=this.growingIO;this.platform=t,this.scnPrefix=i,this.getNetworkType().then((()=>{var e;return null===(e=this.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()})),this.getSystemInfo().then((()=>{var e;return null===(e=this.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()}))}}const Be=ne();var Fe={wx:class extends He{constructor(e){super(e),this.growingIO=e,this.getAppId=()=>{this.systemInfo||(this.systemInfo=wx.getSystemInfoSync());const e=this.systemInfo.SDKVersion;let t;return te(e,"2.2.2")&&(t=wx.getAccountInfoSync().miniProgram.appId),t},this.getPageTitle=e=>{var t,i,n,o;let s="";try{if(s=d(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.gioPageTitle)?null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.gioPageTitle:"",0===s.length){const t=null===(o=null===(n=null===__wxConfig||void 0===__wxConfig?void 0:__wxConfig.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((t=>t.pagePath===e.route||t.pagePath===e.route+".html"));s=(null==t?void 0:t.text)||""}if(0===s.length){const t=__wxConfig.page[e.route]||__wxConfig.page[e.route+".html"];s=t?t.window.navigationBarTitleText:__wxConfig.global.window.navigationBarTitleText}}catch(e){return""}return R(s)}}},swan:class extends He{constructor(e){super(e),this.growingIO=e,this.initImpression=e=>{var t,i;null===(i=null===(t=this.growingIO.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===i||i.main(e,"selectAll")},this.getPageTitle=e=>{var t,i,n,o;let s="";try{s=d(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.gioPageTitle)?null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.gioPageTitle:"";const r=L((()=>JSON.parse(appConfig)))||{};if(0===s.length){const t=null===(o=null===(n=null==r?void 0:r.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((t=>t.pagePath===e.route||t.pagePath===e.route+".html"));s=(null==t?void 0:t.text)||""}if(0===s.length){const t=r.page[e.route]||r.page[e.route+".html"];s=t?t.window.navigationBarTitleText:r.window.navigationBarTitleText}}catch(e){return""}return R(s)}}},my:class extends He{constructor(e){super(e),this.growingIO=e,this.getAppId=()=>{if(my.getAppIdSync){const{appId:e}=my.getAppIdSync();return e}return F("当前支付宝版本过低，无法获取AppId，请升级最新版本支付宝!","warn"),""},this.initImpression=e=>{var t,i;null===(i=null===(t=this.growingIO.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===i||i.main(e,"selectAll")},this.getStorageSync=e=>{const{data:t}=my.getStorageSync({key:e});return t},this.setStorageSync=(e,t)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync({key:e,data:t})}}},qq:class extends He{constructor(e){super(e),this.growingIO=e,this.getAppId=()=>{var e;const t=qq.getAccountInfoSync();return null===(e=null==t?void 0:t.miniProgram)||void 0===e?void 0:e.appId},this.getPageTitle=e=>{var t,i,n,o;let s="";try{if(s=d(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.gioPageTitle)?null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.gioPageTitle:"",0===s.length){const t=null===(o=null===(n=null===__qqConfig||void 0===__qqConfig?void 0:__qqConfig.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((t=>t.pagePath===e.route||t.pagePath===e.route+".html"));s=(null==t?void 0:t.text)||""}if(0===s.length){const t=__qqConfig.page[e.route]||__qqConfig.page[e.route+".html"];s=t?t.window.navigationBarTitleText:__qqConfig.global.window.navigationBarTitleText}}catch(e){return""}return R(s)}}},tt:class extends He{constructor(e){super(e),this.growingIO=e,this.getPageTitle=e=>{var t,i,n,o;let s="";try{if(s=d(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.gioPageTitle)?null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.gioPageTitle:"",0===s.length){const t=null===(o=null===(n=null===__ttConfig||void 0===__ttConfig?void 0:__ttConfig.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((t=>t.pagePath===e.route||t.pagePath===e.route+".html"));s=(null==t?void 0:t.text)||""}if(0===s.length){const t=__ttConfig.page[e.route]||__ttConfig.page[e.route+".html"];s=t?t.window.navigationBarTitleText:__ttConfig.global.window.navigationBarTitleText}}catch(e){return""}return R(s)}}}}[Be];const Le={VISIT:"vst",PAGE:"page",CUSTOM:"cstm",VISITOR_ATTRIBUTES:"",LOGIN_USER_ATTRIBUTES:"",APP_CLOSED:"cls",VIEW_CLICK:"clck",VIEW_CHANGE:"chng",FORM_SUBMIT:"sbmt"},De={appChannel:"ch",appVersion:"cv",attributes:"var",dataSourceId:void 0,deviceBrand:"db",deviceId:"u",deviceModel:"dm",domain:"d",element:"e",eventName:"n",eventType:"t",globalSequenceId:"esid",hyperlink:"h",index:"idx",language:"l",latitude:"lat",longitude:"lng",networkState:"nt",operatingSystem:"os",pageShowTimestamp:"ptm",path:"p",platform:"b",platformVersion:"osv",properties:"var",query:"q",referralPage:"rp",screenHeight:"sh",screenWidth:"sw",sdkVersion:"av",sessionId:"s",textValue:"v",timestamp:"tm",title:"tl",userId:"cs1",userKey:void 0,xpath:"x"};class Re{constructor(e){this.growingIO=e,this.main=e=>{var t,i,n,o;const{sdkVersion:s,vdsConfig:r,platformConfig:a,minipInstance:l,userStore:g,dataStore:{eventHooks:d,locationData:u,lastVisitEvent:c}}=this.growingIO,{systemInfo:h={},network:p={}}=l,{brand:v,model:m,platform:f,language:I,version:w}=h,y={appChannel:"scn:"+(d.scene||"NA"),appVersion:r.version,dataSourceId:r.dataSourceId,deviceBrand:v,deviceId:g.uid,deviceModel:m,deviceType:ee(f,a.name),domain:r.appId||l.getAppId(),gioId:g.gioId,language:I,latitude:null==u?void 0:u.latitude,longitude:null==u?void 0:u.longitude,networkState:(null==p?void 0:p.networkType)||(null==p?void 0:p.type),operatingSystem:ee(f,a.name),path:(null===(t=d.currentPage)||void 0===t?void 0:t.path)?null===(i=d.currentPage)||void 0===i?void 0:i.path:c.path,platform:a.platform,platformVersion:a.name+(w?" "+w:""),query:(null===(n=d.currentPage)||void 0===n?void 0:n.path)?null===(o=d.currentPage)||void 0===o?void 0:o.query:c.query,screenHeight:(O=h,O.pixelRatio?Math.round(O.screenHeight*O.pixelRatio):O.screenHeight),screenWidth:Y(h),sdkVersion:s,sessionId:g.sessionId,title:l.getPageTitle(l.getCurrentPage()),timestamp:Date.now(),userId:g.userId,userKey:g.userKey};var O;return V(r.ignoreFields)||r.ignoreFields.forEach((e=>{j(y,e)})),V(e)?y:Object.assign(Object.assign({},y),e)}}}const $e=e=>{const t=e.split(/[\r\n]/);return(e=>{const t=[];if(e&&e.length>0)for(let i=0;i<e.length;i++){const n=e[i];if(t[0]=e[i-1],t[1]=n,/at /.test(n))break}if(t.some((e=>!e)))return;const i=t[0].split(/: ?/);if(!i||2>i.length)return;const n=t[1].match(/at (.*?) \((.*)\)/);return n&&n.length>=3?{key:i[0],error:i[1],function:n[1],page:n[2]}:void 0})(t)||(e=>{let t;if(e&&e.length>1){const i=e[1].split(";");if(i&&i.length>1){const n=i[1].match(/at ([^ ]+) page (.*) function/);t={key:e[0],error:i[0]},n&&n.length>2&&(t.page=n[1],t.function=n[2])}}return t})(t)||(e=>{if(e&&e.length>0)return{error:e.join("")}})(t)};class Ue{constructor(e){this.growingIO=e,this.main=(e,t)=>{var i;const{userStore:n,vdsConfig:o,platformConfig:s,dataStore:{eventHooks:r,lastVisitEvent:a}}=this.growingIO;o.debug&&console.log("App:",e,Date.now());const l=s.listeners.app;if(!r.shareOut)switch(this.growingIO.emitter.emit("onComposeBefore",{event:e,params:null!==(i=t[0])&&void 0!==i?i:{}}),e){case l.appCreate:case l.appShow:if(V(a)&&t[0]){const{path:e="",query:i={}}=t[0];this.growingIO.dataStore.lastVisitEvent={path:e,query:W.stringify(i)}}this.parseScene(t),(!r.lastCloseTime||Date.now()-r.lastCloseTime>r.keepAlive||r.lastScene&&r.scene!==r.lastScene)&&(n.sessionId="",this.buildVisitEvent(t[0]));break;case l.appClose:r.lastScene=r.scene,r.lastCloseTime=Date.now(),n.syncUserInfo(),this.buildCloseEvent(),this.growingIO.uploader.initiateRequest(!0);break;case l.appError:case l.appPageNotFound:case l.appUnhandledRejection:t&&t.length>0&&d(t[0])&&this.buildErrorEvent(t[0])}},this.parseScene=e=>{var t;const{minipInstance:i,gioPlatform:n,emitter:o,dataStore:{eventHooks:s}}=this.growingIO,r=s.scene;let a;if("quickapp"===n){const{extra:e,type:t}=i.getAppSource();a=(null==e?void 0:e.scene)||t}else if(e.length>0){const i=e[0];(null===(t=null==i?void 0:i.query)||void 0===t?void 0:t.wxShoppingListScene)?a=i.query.wxShoppingListScene:(null==i?void 0:i.scene)?a=i.scene:s.scene="NA"}s.scene=a,a!==r&&o.emit("SCENE_UPDATE",{newScene:a,oldScene:r})},this.buildVisitEvent=e=>{const{dataStore:t}=this.growingIO,{eventContextBuilder:i,eventInterceptor:n}=t;n(Object.assign({eventType:"VISIT"},i({path:(null==e?void 0:e.path)||(null==e?void 0:e.p)||"",query:h(null==e?void 0:e.query)?W.stringify((null==e?void 0:e.query)||{}):(null==e?void 0:e.query)||(null==e?void 0:e.q)||""})))},this.buildCloseEvent=()=>{const{dataStore:{eventContextBuilder:e,eventInterceptor:t}}=this.growingIO;t(Object.assign({eventType:"APP_CLOSED"},e()))},this.buildErrorEvent=e=>{const{dataStore:{eventContextBuilder:t,eventInterceptor:i,eventHooks:n}}=this.growingIO;i(Object.assign({eventType:"CUSTOM",pageShowTimestamp:n.currentPage.time,eventName:"onError",attributes:$e(e)},t()))}}}class Me{constructor(){this.parsePage=(e,t)=>{var i;this.path=e.route||e.uri||e.__route__||(null===(i=null==e?void 0:e.$page)||void 0===i?void 0:i.fullPath)||"",V(t)?this.query=void 0:this.query=this.getQuery(t),this.time=Date.now()},this.getQuery=e=>w(Object.keys(e||{})).filter((e=>"wxShoppingListScene"!==e)).map((t=>`${t}=${e[t]}`)).join("&"),this.updateShareResult=(e,t)=>{const{vdsConfig:i,currentPage:n,minipInstance:o,userStore:s}=e;if(null==i?void 0:i.followShare){const e=s.uid;t||(t={}),t.title||(t.title=o.getPageTitle(o.getCurrentPage()));const[i,r]=(e=>{if(d(e)){const t=e.indexOf("?");return-1!==t?[e.substring(0,t),e.substring(t+1)]:[e,""]}return["",""]})(P(t,"path")?t.path:n.path),a=W.parse(r||(P(t,"path")?t.query:n.query)||"")||{};P(t,"path")||x(a).forEach((e=>{(["gioPreShareId","gioShareId","suid"].includes(e)||e.toLowerCase().startsWith("utm_"))&&delete a[e]}));const[l,g]=this.buildShareQuery(a,e,t);t.query=l,t.path=(e=>d(e)?e.startsWith("/")?e:"/"+e:"")(i+"?"+l),t.attributes=g}return t},this.updateQueryShareId=e=>{e.gioShareId&&(this.queryShareId=e.gioShareId)},this.query=void 0}buildShareQuery(e,t,i){const n={gioShareId:Z(),suid:t},o=Object.assign({},e,n),s=i.contentType||o.contentType,r=i.contentId||o.contentId;return s&&(n.contentType=s),r&&(n.contentId=r),this.queryShareId&&(n.gioPreShareId=this.queryShareId),[W.stringify(o),n]}}class Ke{constructor(e){this.growingIO=e,this.main=(e,t,i)=>{var n,o,s,r,a,l,g,d;const{minipInstance:u,plugins:c,vdsConfig:h,platformConfig:v,dataStore:{eventHooks:m}}=this.growingIO,{currentPage:f,shareOut:I,toggleShareOut:w}=m;if(this.prevEvent[t]&&50>Date.now()-Number(this.prevEvent[t]))return;this.prevEvent[t]=Date.now(),h.wepy&&(e.route=e.$is),e.route||(e.route=u.getCurrentPath(e)),h.debug&&console.log("Page:",e.route,"#",t,Date.now());const y=v.listeners.page;this.growingIO.emitter.emit("onComposeBefore",{page:e,event:t,params:null!==(n=i[0])&&void 0!==n?n:{}});const O=e.route||e.uri||e.__route__||(null===(o=null==e?void 0:e.$page)||void 0===o?void 0:o.fullPath)||"";switch(t){case y.comShow:if(!h.comAsPage)break;case y.pageLoad:this.argQuery[O]=i[0]||N(e,"__displayReporter.query")||N(e,"$page.query")||N(e,"$wx.__displayReporter.query")||{};break;case y.pageShow:f.parsePage(e,this.argQuery[O]),I?w():this.buildPageEvent(),f.updateQueryShareId(this.argQuery[O]),u.initImpression(u.getCurrentPage());break;case y.pageReady:h.taro&&ie(h.taro)&&(null===(r=null===(s=this.growingIO.plugins)||void 0===s?void 0:s.gioTaroAdapter)||void 0===r||r.saveFullPage(document.body),u.initImpression(u.getCurrentPage()));break;case y.comHide:case y.pageHide:(null===(a=null==c?void 0:c.gioImpressionTracking)||void 0===a?void 0:a.impressionObserver)&&(null===(g=null===(l=null==c?void 0:c.gioImpressionTracking)||void 0===l?void 0:l.impressionObserver)||void 0===g||g.disconnect(),this.growingIO.plugins.gioImpressionTracking.impressionObserver=null);break;case y.shareApp:case y.shareTime:w(!0),h.followShare&&this.buildPageShareEvent(i);break;case y.tabTap:{const e=null===(d=null==c?void 0:c.gioEventAutoTracking)||void 0===d?void 0:d.buildTabClickEvent;h.autotrack&&e&&p(e)&&e(i[0]);break}}},this.buildPageEvent=()=>{const{minipInstance:e,dataStore:{lastPageEvent:t,eventContextBuilder:i,eventInterceptor:n,eventHooks:o}}=this.growingIO,{scene:s,currentPage:r}=o;n(Object.assign(Object.assign({eventType:"PAGE",referralPage:(null==t?void 0:t.path)||(null==t?void 0:t.p)||(s?`scn:${e.scnPrefix}${s}`:null)},i()),{timestamp:r.time}))},this.buildPageShareEvent=e=>{var t;let i,n;2>e.length?1===e.length&&(e[0].from?i=e[0]:e[0].title&&(n=e[0])):(i=e[0],n=e[1]);const{dataStore:{eventContextBuilder:o,eventInterceptor:s,eventHooks:r}}=this.growingIO;s(Object.assign({eventType:"CUSTOM",eventName:"onShareAppMessage",pageShowTimestamp:r.currentPage.time,attributes:Object.assign({from:null==i?void 0:i.from,target:null===(t=null==i?void 0:i.target)||void 0===t?void 0:t.id,title:null==n?void 0:n.title,path:decodeURI((null==n?void 0:n.path)||"")},null==n?void 0:n.attributes)},o()))},this.prevEvent={},this.argQuery={}}}class Ge{constructor(e){var t,i,n;this.growingIO=e,this.toggleShareOut=e=>{c(e)?this.shareOut=e:this.shareOut=!this.shareOut},this.isNormalFc=(e,t)=>p(t)&&"constructor"!==e,this.objectTraverse=(e,t)=>{Object.getOwnPropertyNames(e).forEach((i=>t(i,e))),P(e,"methods")&&Object.getOwnPropertyNames(e.methods).forEach((i=>{e[i]||t(i,e.methods)})),P(e,"lifetimes")&&Object.getOwnPropertyNames(e.lifetimes).forEach((i=>{e[i]||t(i,e.lifetimes)})),P(e,"pageLifetimes")&&Object.getOwnPropertyNames(e.pageLifetimes).forEach((i=>{e[i]||t(i,e.pageLifetimes)}))},this.supLifeFcs=(e,t)=>{v(this[t+"Handlers"])&&this[t+"Handlers"].forEach((t=>{p(e[t])||["onShareAppMessage","onShareTimeline"].includes(t)||(e[t]=()=>{})}))},this.lifeFcEffects=(e,t,i)=>{const n=this;return function(){let o;try{["onShareAppMessage","onShareTimeline"].includes(e)&&(o=t.apply(this,arguments),n.growingIO.vdsConfig.followShare&&(o=n.currentPage.updateShareResult(Object.assign(Object.assign({},n),n.growingIO),o)));const s=[].slice.call(arguments);o&&s.push(o),n[`def${i}Cbs`][e].apply(this,s)}catch(e){F(e,"error")}return["onShareAppMessage","onShareTimeline"].includes(e)||(o=t.apply(this,arguments)),o}},this.customFcEffects=(e,t)=>{const i=this;return function(){var n,o;let s;try{let t=arguments[0]||{};P(t,"type")&&((null==t?void 0:t.currentTarget)||(null==t?void 0:t.target))||(t=arguments[arguments.length-1]),((null==t?void 0:t.currentTarget)||(null==t?void 0:t.target))&&i.actionEventTypes.includes(t.type)&&(p(i.actionEffects)||(i.actionEffects=(null===(o=null===(n=i.growingIO.plugins)||void 0===n?void 0:n.gioEventAutoTracking)||void 0===o?void 0:o.main)||function(){}),null==i||i.actionEffects(t,e))}catch(e){F(e,"error")}return s=t.apply(this,arguments),s}},this.appApplyProxy=(e,t)=>this.appHandlers.includes(e)?this.lifeFcEffects(e,t,"App"):this.customFcEffects(e,t),this.pageApplyProxy=(e,t)=>this.pageHandlers.includes(e)?this.lifeFcEffects(e,t,"Page"):this.customFcEffects(e,t),this.componentApplyProxy=(e,t)=>this.componentHandlers.includes(e)?this.lifeFcEffects(e,t,"Component"):this.customFcEffects(e,t),this.appOverriding=e=>(this.supLifeFcs(e,"app"),this.objectTraverse(e,((e,t)=>{this.isNormalFc(e,t[e])&&(t[e]=this.appApplyProxy(e,t[e]))})),e),this.pageOverriding=e=>(this.supLifeFcs(e,"page"),this.objectTraverse(e,((e,t)=>{this.isNormalFc(e,t[e])&&(t[e]=this.pageApplyProxy(e,t[e]))})),e),this.componentOverriding=e=>{const{vdsConfig:{comAsPage:t}}=this.growingIO;return t&&("my"===this.growingIO.gioPlatform?this.supLifeFcs(e,"component"):(e.lifetimes||(e.lifetimes={}),this.supLifeFcs(e.lifetimes,"component"),e.pageLifetimes||(e.pageLifetimes={}),this.supLifeFcs(e.pageLifetimes,"component"))),this.objectTraverse(e,((e,i)=>{this.isNormalFc(e,i[e])&&(i[e]=t?this.componentApplyProxy(e,i[e]):this.pageApplyProxy(e,i[e]))})),e},this.growingApp=e=>this.originalApp(this.appOverriding(e)),this.growingPage=e=>this.originalPage(this.pageOverriding(e)),this.growingComponent=e=>this.originalComponent(this.componentOverriding(e)),this.growingBehavior=e=>this.originalBehavior(this.componentOverriding(e)),this.nativeGrowing=()=>{const e=this,{platformConfig:t}=this.growingIO,i=t.hooks;try{i.App&&!this.appHooked&&(App=function(){return e.growingApp(arguments[0])},this.appHooked=!0)}catch(e){}try{i.Page&&!this.pageHooked&&(Page=function(){return e.growingPage(arguments[0])},this.pageHooked=!0)}catch(e){}try{i.Component&&!this.componentHooked&&(Component=function(){return e.growingComponent(arguments[0])},this.componentHooked=!0)}catch(e){}try{i.Behavior&&!this.behaviorHooked&&(Behavior=function(){return e.growingBehavior(arguments[0])},this.behaviorHooked=!0)}catch(e){}},this.initEventHooks=()=>{const e=this,{platformConfig:t,gioPlatform:i}=this.growingIO;this.appHandlers.forEach((t=>{this.defAppCbs[t]=function(){e.appEffects.main(t,arguments)}})),this.pageHandlers.forEach((t=>{this.defPageCbs[t]=function(){e.pageEffects.main(this,t,arguments)}})),this.componentHandlers.forEach((t=>{this.defComponentCbs[t]=function(){e.pageEffects.main(this,t,arguments)}})),t.canHook?this.nativeGrowing():"quickapp"===i&&(window.GioApp=function(){return e.appOverriding(arguments[0])},window.GioPage=function(){return e.pageOverriding(arguments[0])},window.GioComponent=function(){return e.componentOverriding(arguments[0])}),this.growingIO.App=L((()=>App)),this.growingIO.Page=L((()=>Page)),this.growingIO.Component=L((()=>Component)),this.growingIO.Behavior=L((()=>Behavior)),"quickapp"===i&&(this.growingIO.GioApp=window.GioApp,this.growingIO.GioPage=window.GioPage,this.growingIO.GioComponent=window.GioComponent)};const o=null===(t=this.growingIO)||void 0===t?void 0:t.platformConfig;this.defAppCbs={},this.defPageCbs={},this.defComponentCbs={},this.appHandlers=o.appHandlers,this.pageHandlers=o.pageHandlers,this.componentHandlers=o.componentHandlers,this.actionEventTypes=o.actionEventTypes,this.originalApp=o.originalApp,this.originalPage=o.originalPage,this.originalComponent=o.originalComponent,this.originalBehavior=null!==(i=o.originalBehavior)&&void 0!==i?i:function(){},this.appEffects=new Ue(this.growingIO),this.pageEffects=new Ke(this.growingIO),this.currentPage=new Me,this.shareOut=!1,this.keepAlive=null===(n=this.growingIO)||void 0===n?void 0:n.vdsConfig.keepAlive}}class Qe extends class{constructor(n){this.growingIO=n,this.ALLOW_SETTING=Object.assign({},e,"saas"===this.growingIO.gioEnvironment?i:t),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.initStorageId=()=>{const e=se();let t=e.gio_esid?e.gio_esid:this.growingIO.minipInstance.getStorageSync(this.esidStorageName);t=h(t)&&!g(t)?t:{},this._esid={},x(t).forEach((e=>{this._esid[e]=Number.isNaN(Number(t[e]))||t[e]>=1e9||1>t[e]?1:t[e]})),A(t,this._esid)||this.growingIO.minipInstance.setStorageSync(this.esidStorageName,this._esid);const i=e.gio_gsid?e.gio_gsid:Number.parseInt(this.growingIO.minipInstance.getStorageSync(this.gsidStorageName),10);this._gsid=Number.isNaN(i)||i>=1e9||1>i?1:i,i!==this._gsid&&this.growingIO.minipInstance.setStorageSync(this.gsidStorageName,this._gsid)},this.initOptions=e=>{var t,i,n,o,s;const{projectId:r,dataSourceId:g,appId:d}=e,u={};this.allowOptKeys.forEach((t=>{const i=this.ALLOW_SETTING[t].type;(v(i)?i.includes(H(e[t])):H(e[t])===this.ALLOW_SETTING[t].type)?"ignoreFields"===t?u.ignoreFields=e.ignoreFields.filter((e=>a.includes(e))):"extraParams"===t?u.extraParams=e.extraParams.filter((e=>l.includes(e))):u[t]=e[t]:u[t]=this.ALLOW_SETTING[t].default})),u.uploadInterval=Math.round(u.uploadInterval),(Number.isNaN(u.uploadInterval)||0>u.uploadInterval||u.uploadInterval>2e3)&&(u.uploadInterval=1e3),this.growingIO.vdsConfig=Object.assign(Object.assign({},u),{projectId:r,dataSourceId:g,appId:d}),this.growingIO.inPlugin&&(this.growingIO.vdsConfig.autotrack=!1),this.eventHooks=new Ge(this.growingIO),this.growingIO.inPlugin||this.eventHooks.initEventHooks();const{plugins:c}=this.growingIO,{cml:h,uniVue:p,wepy:m,taro:f,remax:I}=u;h&&(null===(t=null==c?void 0:c.gioChameleonAdapter)||void 0===t||t.main()),p&&(null===(i=null==c?void 0:c.gioUniAppAdapter)||void 0===i||i.main()),m&&(null===(n=null==c?void 0:c.gioWepyAdapter)||void 0===n||n.main()),f&&(null===(o=null==c?void 0:c.gioTaroAdapter)||void 0===o||o.main()),I&&(null===(s=null==c?void 0:c.gioRemaxAdapter)||void 0===s||s.main())},this.setOption=(e,t)=>{var i;const{vdsConfig:n,callError:o,uploader:s,emitter:r}=this.growingIO,a=d(e)&&this.allowOptKeys.includes(e),l=a&&typeof t===(null===(i=this.ALLOW_SETTING[e])||void 0===i?void 0:i.type);if(a&&l){if("dataCollect"===e&&!1===n.dataCollect&&!0===t){const e=setTimeout((()=>{this.sendVisit(),this.sendPage(),clearTimeout(e)}))}return n[e]=t,["host","scheme"].includes(e)&&(null==s||s.generateURL()),r.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),!0}return o("setOption > "+e),!1},this.getOption=e=>{const{vdsConfig:t,callError:i}=this.growingIO;return e&&P(t,O(e))?t[O(e)]:g(e)?Object.assign({},t):void i("getOption > "+e)},this.sendVisit=()=>{this.eventHooks.appEffects.buildVisitEvent(this.lastVisitEvent)},this.sendPage=()=>{this.eventHooks.pageEffects.buildPageEvent()},this.eventInterceptor=e=>{const{systemInfo:t,network:i}=this.growingIO.minipInstance;V(t)||V(i)?this.interceptEvents.push(e):V(this.interceptEvents)?this.eventConverter(e):([...this.interceptEvents,e].forEach((e=>{const t=Object.assign(Object.assign({},e),this.eventContextBuilder({path:e.path,query:e.query}));this.eventConverter(t)})),this.interceptEvents=[])},this.eventReleaseInspector=()=>{const{minipInstance:{systemInfo:e,network:t}}=this.growingIO;e&&t&&!V(this.interceptEvents)&&([...this.interceptEvents].forEach((e=>{const t=Object.assign(Object.assign({},e),this.eventContextBuilder({path:e.path,query:e.query}));this.eventConverter(t)})),this.interceptEvents=[])},this.esidStorageName="_growing_esid_",this.gsidStorageName="_growing_gsid_",this.initStorageId(),this.eventContextBuilder=new Re(this.growingIO).main,this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.interceptEvents=[],this.growingIO.emitter.on("onComposeAfter",(({composedEvent:e})=>{"VISIT"!==e.eventType&&"vst"!==e.t||(this.lastVisitEvent=e),"PAGE"!==e.eventType&&"page"!==e.t||(this.lastPageEvent=e)}))}get esid(){const e=se(),t=oe(e);return!V(t)&&e.gio_esid?e.gio_esid:this._esid}set esid(e){const t={};x(e).forEach((i=>{t[i]=Number.isNaN(e[i])||e[i]>=1e9||1>e[i]?1:e[i]})),A(e,t)||(this._esid=t,se().gio_esid=this._esid,this.growingIO.minipInstance.setStorageSync(this.esidStorageName,this._esid))}get gsid(){const e=se(),t=oe(e);return!V(t)&&e.gio_gsid?e.gio_gsid:this._gsid}set gsid(e){const t=Number.parseInt(e,10);this._gsid=Number.isNaN(t)||e>=1e9||1>e?1:e,se().gio_gsid=this._gsid,this.growingIO.minipInstance.setStorageSync(this.gsidStorageName,this._gsid)}}{constructor(e){super(e),this.growingIO=e,this.eventConverter=e=>{var t;const{vdsConfig:i,dataStore:n,uploader:o}=this.growingIO;if(i.dataCollect){e.globalSequenceId=n.gsid;const i={};k(e,((e,t)=>{var n;if(!De[t]||V(e)&&0!==e||(i[De[t]]=e,"eventType"===t&&(i.t=Le[e]||e)),"element"===t){const t={},o=null!==(n=m(e))&&void 0!==n?n:{};k(o,((e,i)=>{!De[i]||V(e)&&0!==e||(t[De[i]]=e)})),i.e=[t]}})),this.growingIO.dataStore.gsid+=1,null===(t=this.growingIO)||void 0===t||t.emitter.emit("onComposeAfter",{composedEvent:i}),o.commitRequest(i)}}}}class We extends class{constructor(e){this.growingIO=e,this.commitRequest=e=>{const t=Object.assign({},e),{vdsConfig:i}=this.growingIO;i.forceLogin?this.hoardingQueue.push(t):(this.requestQueue.push(t),this.initiateRequest())},this.initiateRequest=e=>{var t,i;const{plugins:n,vdsConfig:o}=this.growingIO;[...this.hoardingQueue,...this.requestQueue].length>0&&this.requestingNum<this.requestLimit&&((null===(t=null==o?void 0:o.tbConfig)||void 0===t?void 0:t.cloudFuncSend)?null===(i=null==n?void 0:n.gioTaobaoSendAdapter)||void 0===i||i.singleInvoke():e?this.batchInvoke():this.batchInvokeThrottle())},this.batchInvoke=()=>{var e,t,i;const{vdsConfig:n,plugins:o,emitter:s}=this.growingIO;let r=[...this.hoardingQueue,...this.requestQueue];r.length>50?(r=r.slice(0,50),this.hoardingQueue.length>50?this.hoardingQueue=this.hoardingQueue.slice(50):(this.hoardingQueue=[],this.requestQueue=this.requestQueue.slice(50-this.hoardingQueue.length))):(this.hoardingQueue=[],this.requestQueue=[]);let a=r.filter((e=>(this.retryIds[e.globalSequenceId||e.esid]||0)<=this.retryLimit));if(V(a))return;n.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(a,null,2));const l={"content-type":"application/json;charset=UTF-8"};if(s.emit("onSendBefore",{requestData:a}),null===(e=null==n?void 0:n.tbConfig)||void 0===e?void 0:e.cloudAppId)null===(t=null==o?void 0:o.gioTaobaoSendAdapter)||void 0===t||t.tbCloudAppInvoke(a);else{let e=[...a];n.compress&&(null===(i=null==o?void 0:o.gioCompress)||void 0===i?void 0:i.compressToUTF16)&&(e=o.gioCompress.compressToUTF16(JSON.stringify(a)),l["X-Compress-Codec"]="1"),this.normalBatchInvoke({header:l,data:e})}},this.batchInvokeThrottle=q(this.batchInvoke,this.growingIO.vdsConfig.uploadInterval,!1,!1),this.normalBatchInvoke=({header:e,data:t})=>{this.requestingNum+=1,this.growingIO.minipInstance.request({url:`${this.requestURL}?stm=${Date.now()}`,header:e,method:"POST",data:t,timeout:this.requestTimeout,fail:e=>{[200,204].includes(e.code)||(v(t)?t.forEach((e=>{this.requestFailFn(e)})):this.requestFailFn(t),F("请求失败!"+JSON.stringify(e),"error"))},complete:e=>{this.requestingNum-=1,this.growingIO.emitter.emit("onSendAfter",{result:e}),this.initiateRequest()}})},this.requestFailFn=e=>{this.retryIds[e.globalSequenceId||e.esid]||(this.retryIds[e.globalSequenceId||e.esid]=0),this.retryIds[e.globalSequenceId||e.esid]+=1,this.requestQueue.some((t=>t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid))||this.requestQueue.push(e)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=3,this.requestTimeout=5e3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.requestURL=""}}{constructor(e){super(e),this.growingIO=e;let{appId:t,projectId:i}=this.growingIO.vdsConfig;this.requestURL=`https://wxapi.growingio.com/projects/${i}/apps/${t}/collect`}}const ze=new class extends class{constructor(){var e;this.init=e=>(F("Gio小程序SDK 初始化中...","info"),e.appId||(e.appId=this.minipInstance.getAppId()||e.projectId),this.dataStore.initOptions(e),this.gioSDKInitialized=!0,this.vdsConfig.subpackage||(se().__gio__=this),null==this||this.initCallback(),this.emitter.emit("SDK_INITIALIZED",this),F("Gio小程序SDK 初始化完成！","success"),this.vdsConfig.forceLogin&&F("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),this.inPlugin&&this.dataStore.sendVisit(),!0),this.setDataCollect=e=>{this.setOption("dataCollect",!!e),this.notRecommended()},this.setAutotrack=e=>{this.setOption("autotrack",!!e),this.notRecommended()},this.enableDebug=e=>{this.setOption("debug",!!e),this.notRecommended()},this.setOption=(e,t)=>{if(o.includes(e)){const i=this.dataStore.setOption(e,t);return i&&s[e]&&F(`已${t?"开启":"关闭"}${s[e]}`,"info"),i}return F(`不存在可修改的配置项：${e}，请检查后重试!`,"warn"),!1},this.getDeviceId=()=>this.userStore.uid,this.getOption=e=>this.dataStore.getOption(e),this.getGioInfo=()=>{const{uid:e,userId:t,userKey:i,sessionId:n,gioId:o}=this.userStore,{projectId:s,appId:r,dataSourceId:a,dataCollect:l,enableIdMapping:g,extraParams:d,ignoreFields:u}=this.vdsConfig,c={gioappid:r,giocs1:t||"",gioplatform:this.platformConfig.platform,gioprojectid:s,gios:n,giou:e};return"cdp"===this.gioEnvironment&&(c.giodatacollect=l,c.giodatasourceid=a,c.gioid=o||"",g&&(c.giouserkey=i),V(d)||d.forEach((e=>{u.includes(e)||(c["gio"+e]=this.dataStore.lastVisitEvent[e])}))),W.stringify(c)},this.setLocation=(e,t)=>{const i={latitude:e,longitude:t},n=this.dataStore.locationData,o=e=>e>=-180&&180>=e;o(e)&&o(t)&&(n.latitude!==e||n.longitude!==t)&&(this.dataStore.locationData=i,this.dataStore.sendVisit())},this.notRecommended=()=>F("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info"),this.callError=(e,t=!0,i="参数不合法")=>F(`${t?"调用":"设置"} ${e} 失败，${i}!`,"warn"),this.utils=Object.assign(Object.assign(Object.assign({},B),$),{qs:W}),this.emitter={all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map((function(e){e(i)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,i)}))}},this.gioPlatform=ne(),this.gioEnvironment="saas",this.sdkVersion="3.8.0";try{("quickapp"===this.gioPlatform||p(getApp)&&App)&&(this.inPlugin=!1)}catch(e){this.inPlugin=!0,F("未检测到小程序实例，自动切换为插件模式!","info")}this.platformConfig=Ve,this.minipInstance=new Fe(this),this.userStore=new re(this),this.plugins=new Ce(this),this.plugins.innerPluginInit()}}{constructor(){super(),this.initCallback=()=>{this.uploader=new We(this)},this.identify=(e,t)=>{if(this.vdsConfig.forceLogin){if(!U(e)||t&&!U(t))return void this.callError("identify");const i=O(e).slice(0,1e3),n=O(t).slice(0,1e3)||"";this.userStore.uid=i,this.uploader.hoardingQueue.forEach(((e,t)=>this.uploader.hoardingQueue[t].u=i)),this.dataStore.setOption("forceLogin",!1),this.uploader.initiateRequest();const o={openId:i};n&&(o.unionId=n),this.setVisitor(o)}else this.callError("identify",!1,"forceLogin 未开启")},this.setVisitor=e=>{var t;!V(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildVisitorVariable(e):this.callError("setVisitor")},this.setUser=e=>{var t;!V(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildPeopleVariable(e):this.callError("setUser")},this.setUserId=e=>{if(U(e)){e=O(e).slice(0,1e3);const t=this.userStore.gioId,i=this.userStore.userId;this.userStore.userId=e,this.reissueLogic(i,e,t)}else this.callError("setUserId")},this.clearUserId=()=>{this.userStore.userId=void 0},this.setPage=e=>{var t;!V(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildPageLevelVariable(e):this.callError("setPage")},this.setEvar=e=>{var t;!V(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildConversionVariable(e):this.callError("setEvar")},this.track=(e,t)=>{var i,n;((null===(n=null===(i=this.plugins)||void 0===i?void 0:i.gioCustomTracking)||void 0===n?void 0:n.buildCustomEvent)||function(){})(e,t)},this.reissueLogic=(e,t,i)=>{i&&i!==t?(this.userStore.sessionId="",this.dataStore.sendVisit(),this.dataStore.sendPage()):e!==t&&this.dataStore.sendPage()},this.dataStore=new Qe(this)}},Je=function(){const e=arguments[0];if(d(e)&&n.includes(e)&&ze[e]){const t=I(Array.from(arguments));if("init"===e){const e=M(ze),i=K(t),n=G(t),o=Q(t);if(e&&i&&n&&o){const{projectId:e,userOptions:t}=n,{appId:i}=o;return i||"quickapp"!==ze.gioPlatform?ze.init(Object.assign(Object.assign({},t),{projectId:e,appId:i})):(F("请填写AppId(packageName)!","error"),!1)}}else{if(ze.gioSDKInitialized&&ze.vdsConfig)return ze[e](...t);F("SDK未初始化!","error")}}else r.includes(e)?F(`方法 ${O(e)} 已被弃用!`,"warn"):F(`不存在名为 ${O(e)} 的方法调用!`,"error")};(global||$global).gio=Je,(global||$global).gioEnvironment="saas",(global||$global).gioSDKVersion=ze.sdkVersion;export{Je as default};
