import e from"@system.app";import t from"@system.device";import n from"@system.fetch";import i from"@system.image";import r from"@system.network";import o from"@system.router";import a from"@system.share";import u from"@system.storage";var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},s(e,t)};function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var c=function(){return c=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c.apply(this,arguments)};function g(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{s(i.next(e))}catch(e){o(e)}}function u(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((i=i.apply(e,t||[])).next())}))}function d(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function p(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}var f={autotrack:{type:"boolean",default:!0},cml:{type:"object",default:!1},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},subpackage:{type:"boolean",default:!1},keepAlive:{type:"number",default:3e5},remax:{type:["object","module"],default:!1},requestTimeout:{type:"number",default:5e3},taro:{type:["object","module"],default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},uniVue:{type:["object","function"],default:!1},version:{type:"string",default:"1.0.0"},wepy:{type:"function",default:!1}},v={compress:{type:"boolean",default:!0},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},gtouchHost:{type:"string",default:"cdp.growingio.com"},host:{type:"string",default:"napi.growingio.com"},ignoreFields:{type:"array",default:[]},scheme:{type:"string",default:"https"},uploadInterval:{type:"number",default:1e3},performance:{type:"object",default:{monitor:!0,exception:!0}}},h={},m=["clearUserId","enableDebug","getGioInfo","getOption","identify","init","setAutotrack","setDataCollect","setOption","setUserId","track","setLocation","setGeneralProps","clearGeneralProps","setPageAttributes","updateImpression"];p(p([],m),["setEvar","setPage","setUser","setVisitor"]);var I,y,S=p(p([],m),["setTrackerHost","setTrackerScheme","setUserAttributes","registerPlugins","getDeviceId","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer"]),w=["autotrack","dataCollect","debug","host","scheme"],b={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式"},O=["setConfig","collectImp","setPlatformProfile","getLocation"],P=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],T=p(p([],P),["appChannel","language","platformVersion"]),_=function(e){return["undefined","null"].includes(J(e))},C=function(e){return"string"===J(e)},k=function(e){return"number"===J(e)},E=function(e){return"boolean"===J(e)},A=function(e){return"[object Object]"==={}.toString.call(e)&&!_(e)},x=function(e){return["function","asyncfunction"].includes(J(e))},N=function(e){return Array.isArray(e)&&"array"===J(e)},q=function(e){try{return Array.from(e)[0]}catch(e){return}},D=function(e){try{var t=Array.from(e);return t[t.length-1]}catch(e){return}},j=function(e,t){return void 0===t&&(t=1),N(e)&&k(t)?e.slice(t>0?t:1,e.length):e},H=function(e){if(N(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!Z(o)&&(n[t++]=o)}return n}return e},L=function(e,t){if(N(e)){var n=e.findIndex(t);return 0>n?void 0:e[n]}},B=function(e){return _(e)?"":""+e},R=function(e,t){return"string"===J(e)?e.split(t):e},F=function(e){if(C(e)){var t=R(e,"");return""+q(t).toLowerCase()+j(t).join("")}return e},U=function(e,t){return e.slice(0,t.length)===t},V=function(e,t){var n=e.length,i=n;i>n&&(i=n);var r=i;return(i-=t.length)>=0&&e.slice(i,r)===t},K={}.hasOwnProperty,M=function(e,t){return null!=e&&("object"==typeof e||"function"==typeof e)&&K.call(e,t)},G=function(e){return A(e)?Object.keys(e):[]},$=function(e,t){G(e).forEach((function(n){return t(e[n],n)}))},Q=function(e,t){var n=G(e);return!(!A(e)||!A(t)||n.length!==G(t).length||n.map((function(n,i){return A(e[n])?Q(e[n],t[n]):e[n]===t[n]})).includes(!1))},W=function(e,t,n){var i=e;return A(e)?(t.split(".").forEach((function(e){i=i?i[e]:n})),i):n},z=function(e,t){if(!A(e))return!1;try{if("string"===J(t))return delete e[t];if("array"===J(t))return t.map((function(t){return delete e[t]}));"object"===J(t)&&t.constructor===RegExp&&G(e).forEach((function(n){t.test(n)&&z(e,n)}))}catch(e){return!1}},X=function(e,t,n,i){var r;void 0===t&&(t=250);var o=0;return"boolean"!==J(n)&&(i=e,e=n,n=void 0),function(){for(var a=[],u=0;arguments.length>u;u++)a[u]=arguments[u];var s=this,l=Date.now()-o;function c(){o=Date.now(),e.apply(s,a)}i&&!r&&c(),r&&clearTimeout(r),void 0===i&&l>t?c():!0!==n&&(r=setTimeout(i?function(){r=void 0}:c,void 0===i?t-l:t))}},Z=function(e){return N(e)?0===e.length:A(e)?0===G(e).length:!e},J=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},Y=Object.freeze({__proto__:null,isNil:_,isString:C,isNumber:k,isBoolean:E,isObject:A,isRegExp:function(e){return"[object RegExp]"==={}.toString.call(e)},isFunction:x,isArray:N,isDate:function(e){return"date"===J(e)},fixed:function(e,t){return k(e)?Number(e.toFixed(k(t)?t:2)):C(e)&&"NaN"!==B(Number(e))?Number(Number(e).toFixed(k(t)?t:2)):e},head:q,last:D,drop:j,dropWhile:function(e,t){return N(e)?e.filter((function(e){return!t(e)})):e},compact:H,find:L,isEqualArray:function(e,t){return!(!N(e)||!N(t)||e.length!==t.length)&&e.every((function(e,n){return e===t[n]}))},toString:B,split:R,lowerFirst:F,upperFirst:function(e){if(C(e)){var t=R(e,"");return""+q(t).toUpperCase()+j(t).join("")}return e},startsWith:U,endsWith:V,hasOwnProperty:K,has:M,keys:G,forEach:$,isEqual:Q,get:W,unset:z,throttle:X,isEmpty:Z,typeOf:J,formatDate:function(e){function t(e){return 10>e?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}}),ee=function(e,t){console.log("%c[GrowingIO]："+e,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},te=function(e){try{return e()}catch(e){return}},ne=function(e){return C(e)?e.trim().substring(0,100):e},ie=function(e,t){return C(e)&&!Z(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():(ee("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},re=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},oe=function(e){return e.pixelRatio?Math.round(e.screenHeight*e.pixelRatio):e.screenHeight},ae=function(e){return e.pixelRatio?Math.round(e.screenWidth*e.pixelRatio):e.screenWidth},ue=function(e,t){if(e){var n=e.toLowerCase();return-1!==n.indexOf("android")?t+"-Android":-1!==n.indexOf("ios")?t+"-iOS":e}},se=function(e){if(C(e)){var t=e.indexOf("?");return-1!==t?[e.substring(0,t),e.substring(t+1)]:[e,""]}return["",""]},le=function(e){return C(e)?e.startsWith("/")?e:"/"+e:""},ce=function(e){var t=e.Current,n=e.createComponent;return!(!e||!t||n)},ge=function(e){return te((function(){switch(e){case"wx":return wx;case"my":return my;case"swan":return swan;case"tt":return tt;case"qq":return qq;case"ks":return ks;case"jd":return jd;default:var t=void 0;return t||(t=te((function(){return swan}))),t||(t=te((function(){return my}))),t||(t=te((function(){return tt}))),t||(t=te((function(){return qq}))),t||(t=te((function(){return ks}))),t||(t=te((function(){return jd}))),t||(t=te((function(){return wx}))),t}}))},de=function(e){return te((function(){switch(e){case"wx":return __wxConfig;case"swan":return appConfig;case"tt":return te((function(){return __ttConfig}))||(null===global||void 0===global?void 0:global.TMAConfig)||(null===globalThis||void 0===globalThis?void 0:globalThis.TMAConfig);case"qq":return __qqConfig;case"ks":return __ksConfig;case"jd":return __jdConfig;default:return}}))},pe=function(e){return te((function(){switch(e){case"wx":case"qq":return __wxAppCode__;case"tt":return __allConfig__;case"ks":return __module__;case"jd":return __jdAppCode__;default:return}}))},fe=function(){var e;return!e&&te((function(){return swan}))&&(e="swan"),!e&&te((function(){return tt}))&&(e="tt"),!e&&te((function(){return qq}))&&(e="qq"),!e&&te((function(){return my}))&&(e="my"),!e&&te((function(){return ks}))&&(e="ks"),!e&&te((function(){return jd}))&&(e="jd"),!e&&te((function(){return wx}))&&(e="wx"),e||L(G(global),(function(e){return B(e).toLowerCase().includes("quickapp")}))&&(e="quickapp"),e},ve=function(e){return G(e).filter((function(e){return e.indexOf("__sub")>-1&&e.indexOf("gio__")>-1})).sort()},he=function(){var e=te((function(){return getApp({allowDefault:!0})}));return e||(e=me()),e},me=function(){var e;return null!==(e=te((function(){return $global})))&&void 0!==e?e:global},Ie=function(e){var t={};return A(e)&&$(e,(function(e,n){var i=B(n).slice(0,100);A(e)?t[i]=Ie(e):N(e)?(t[i]=e.slice(0,100),"cdp"===me().gioEnvironment?t[i]=t[i].join("||").slice(0,1e3):t[i]=B(t[i]).slice(0,1e3)):t[i]=_(e)?"":B(e).slice(0,1e3)})),t},ye=function(e,t){var n=function(){return t.map((function(t){return e.getStorageSync(t)}))};try{return e.minip.canIUse("batchGetStorageSync")?e.minip.batchGetStorageSync(t):n()}catch(e){return n()}},Se=function(e,t){var n=function(){return t.map((function(t){var n=t.key,i=t.value;return e.setStorageSync(n,i)}))};try{return e.minip.canIUse("batchSetStorageSync")?e.minip.batchSetStorageSync(t):n()}catch(e){return n()}},we=function(e){return G(e||{}).map((function(t){return t?t+"="+(_(e[t])?"":e[t]):""})).join("&")},be=function(e){(U(e,"?")||U(e,"&"))&&(e=e.slice(1,e.length));var t={};return e.split("&").forEach((function(e){var n=e.split("=");n[0]&&(t[n[0]]=n[1])})),t},Oe=["wxShoppingListScene","$taroTimestamp"],Pe=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var n="string"==typeof e?be(e):e||{};function i(e,t){if("object"!=typeof e||null===e||Array.isArray(e))return e;var i={};return G(e).forEach((function(r){var o=Oe.some((function(e){return r.includes(e)})),a=M(n,r);if(!(o||t&&a)){var u=e[r];"string"==typeof u?Oe.some((function(e){return u.includes(e)}))||(i[r]=u):"number"!=typeof u&&"boolean"!=typeof u||(i[r]=u)}})),i}return Object.assign({},i(n,!1),i(t,!0))},Te=Object.freeze({__proto__:null,consoleText:ee,niceTry:te,limitString:ne,eventNameValidate:ie,guid:re,getScreenHeight:oe,getScreenWidth:ae,getOS:ue,compareVersion:function(e,t){void 0===e&&(e=""),void 0===t&&(t="");for(var n=function(e){return e.replace(/\s+/g,"")},i=function(e){return e.replace(/[vV]/g,"")},r=n(i(e)),o=n(i(t)),a=r.split("."),u=o.split("."),s=0;3>s;s++){var l=Number(a[s]),c=Number(u[s]);if(l>c)return 1;if(c>l)return-1;if(!isNaN(l)&&isNaN(c))return 1;if(isNaN(l)&&!isNaN(c))return-1}return 0},getVueVersion:function(e){if(e){var t=Number(q(R(e.version,".")));return Number.isNaN(t)?0:t}return 0},splitPath:se,normalPath:le,isTaro3:ce,getPlainMinip:ge,getPlainConfig:de,getPlainAppCode:pe,getPlainPlatform:fe,getSubKeys:ve,getAppInst:he,getGlobal:me,limitObject:Ie,batchGetStorageSync:ye,batchSetStorageSync:Se,qsStringify:we,qsParse:be,hashCode:function(e){var t=0;if(Z(e)||"boolean"==typeof e)return t;for(var n=0;n<e.length;)t=(t<<5)-t+e.charCodeAt(n),t&=t,n++;return t},getPureParams:Pe}),_e=function(e){return C(e)&&e.length>0||k(e)&&e>0},Ce=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,ke=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,Ee={name:"gioEventAutoTracking",method:function(e){var t=this;this.growingIO=e,this.main=function(e,n){var i,r,o=t.growingIO,a=o.vdsConfig,u=o.platformConfig,s=o.plugins,l=o.emitter;if(!(!a.autotrack||!n||I.get(e,"currentTarget.dataset.growingIgnore")||I.get(e,"target.dataset.growingIgnore")||!I.get(e,"target.dataset.growingTrack")&&"autoplay"===I.get(e,"detail.source")||e.type===(null===(i=t.prevEvent)||void 0===i?void 0:i.type)&&10>Math.abs(Number(e.timeStamp)-Number(null===(r=t.prevEvent)||void 0===r?void 0:r.timeStamp))||a.taro&&["eh"].includes(n)||a.cml&&["_cmlEventProxy","onclick","blurEvent","handleDetail"].includes(n))){t.prevEvent=e,a.uniVue&&(n=null==s?void 0:s.gioUniAppAdapter.getHandlerName(n,e)),a.remax&&n.indexOf("$$REMAX_METHOD")>-1&&(n=null==s?void 0:s.gioRemaxAdapter.getHandlerName(n)),a.debug&&console.log("Action：",e.type,Date.now()),l.emit("onComposeBefore",{event:n,params:null!=e?e:{}});var c=u.listeners.actions;c.click.includes(e.type)?t.buildClickEvent(e,n):c.change.includes(e.type)?t.buildChangeEvent(e,n):c.submit.includes(e.type)&&t.buildSubmitEvent(e,n)}},this.getNodeXpath=function(e,n){var i=t.growingIO,r=i.gioPlatform,o=i.vdsConfig,a=(e.currentTarget||e.target).id;if((!a||"swan"===r&&/^_[0-9a-f]+/.test(a)||ce(o.taro)&&/^_n_[0-9]+$/.test(a))&&(a=""),!o.octopus||(n=e.handler,/^bound .*/.test(n)&&(n=n.replace("bound ","")),/^t[0-9]+$/.test(a)&&(a=""),a&&!n&&(n="anonymousFunc"),a||n))return a+"#"+n},this.buildClickEvent=function(e,n){var i,r,o,a=t.getNodeXpath(e,n);if(a){var u=t.growingIO,s=u.dataStore,l=s.eventContextBuilder,g=s.eventInterceptor,d=s.eventHooks,p=u.gioEnvironment,f=e.currentTarget||e.target,v=void 0;I.has(null==f?void 0:f.dataset,"index")&&""!==(null===(i=null==f?void 0:f.dataset)||void 0===i?void 0:i.index)&&(v=Number(f.dataset.index),Number.isNaN(v)&&(v=-1)),g(c({eventType:"saas"===p&&e.type.includes("long")?"lngprss":"VIEW_CLICK",pageShowTimestamp:d.currentPage.time,element:[{xpath:a,index:v,textValue:null===(r=null==f?void 0:f.dataset)||void 0===r?void 0:r.title,hyperlink:null===(o=null==f?void 0:f.dataset)||void 0===o?void 0:o.src}]},l()))}},this.buildTabClickEvent=function(e){var n=t.growingIO.dataStore,i=n.eventContextBuilder,r=n.eventInterceptor,o=n.eventHooks;r(c({eventType:"VIEW_CLICK",pageShowTimestamp:o.currentPage.time,element:[{xpath:"#onTabItemTap",textValue:e.text,index:e.index,hyperlink:I.toString(e.pagePath)}]},i()))},this.buildChangeEvent=function(e,n){var i,r,o=t.getNodeXpath(e,n);if(o){var a=t.growingIO.dataStore,u=a.eventContextBuilder,s=a.eventInterceptor,l=a.eventHooks,g=e.currentTarget||e.target,d=c({eventType:"VIEW_CHANGE",pageShowTimestamp:l.currentPage.time,element:{xpath:o}},u()),p=I.get(e,"detail.value")||I.get(e,"target.attr.value");((null===(i=null==g?void 0:g.dataset)||void 0===i?void 0:i.growingTrack)||(null===(r=null==g?void 0:g.dataset)||void 0===r?void 0:r.growingtrack))&&(I.isNil(p)||(d.element.textValue=I.toString(p))),d.element=[d.element],s(d)}},this.buildSubmitEvent=function(e,n){var i=t.getNodeXpath(e,n);if(i){var r=t.growingIO.dataStore,o=r.eventContextBuilder,a=r.eventInterceptor,u=r.eventHooks;a(c({eventType:"FORM_SUBMIT",pageShowTimestamp:u.currentPage.time,element:[{xpath:i}]},o()))}},I=this.growingIO.utils,this.prevEvent={}}};const Ae={};function xe(e,t,n){var i=e;t.map((function(e,r){i[e]=r==t.length-1?n:i[e]||{},i=i[e]}))}xe(Ae,["plugins","gioCustomTracking"],{name:"gioCustomTracking",method:function(e){var t=this;this.growingIO=e,this.getValidResourceItem=function(e){if(e&&y.isObject(e)&&e.id&&e.key){var t={id:y.isString(e.id)?e.id:y.toString(e.id),key:y.isString(e.key)?e.key:y.toString(e.key)};return e.attributes&&(t.attributes=e.attributes),t}},this.getDynamicAttributes=function(e){return y.isNil(e)||y.keys(e).forEach((function(t){y.isFunction(e[t])?e[t]=e[t]():y.isArray(e[t])||(e[t]=y.toString(e[t]))})),e},this.buildCustomEvent=function(e,n,i){y.eventNameValidate(e,(function(){var r,o=t.growingIO.dataStore,a=o.eventContextBuilder,u=o.eventInterceptor,s=o.eventHooks;u(c({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null===(r=null==s?void 0:s.currentPage)||void 0===r?void 0:r.time,attributes:y.limitObject(t.getDynamicAttributes(y.isObject(n)&&!y.isEmpty(n)?n:void 0)),resourceItem:y.limitObject(t.getValidResourceItem(i))},a()))}))},this.buildUserAttributesEvent=function(e){var n=t.growingIO.dataStore,i=n.eventContextBuilder,r=n.eventInterceptor,o=n.lastVisitEvent,a=c({eventType:"LOGIN_USER_ATTRIBUTES",attributes:y.limitObject(e)},i());a.path||(a.path=o.path,a.query=o.query,a.title=o.title),r(a)},y=this.growingIO.utils}}),xe(Ae,["plugins","gioEventAutoTracking"],Ee);var Ne=function(e){var t=this;this.growingIO=e,this.innerPluginInit=function(){G(Ae.plugins).forEach((function(e){var n=Ae.plugins[e],i=n.name,r=n.method;t.pluginItems.find((function(e){return e.name===i}))||t.pluginItems.push({name:F(i||e),method:r||function(e){}})})),Z(t.pluginItems)||t.installAll()},this.install=function(e,n,i){var r,o=n||t.pluginItems.find((function(t){return t.name===e}));if(null===(r=t.growingIO)||void 0===r?void 0:r.plugins[e])return ee("重复加载插件 "+e+" 或插件重名，已跳过加载!","warn"),!1;if(!o)return ee("插件加载失败!不存在名为 "+e+" 的插件!","error"),!1;try{return t.growingIO.plugins[e]=new o.method(t.growingIO,i),"cdp"===t.growingIO.gioEnvironment&&n&&ee("加载插件："+e,"info"),!0}catch(e){return ee("插件加载异常："+e,"error"),!1}},this.installAll=function(e){(e||t.pluginItems).forEach((function(n){return t.install(n.name,e?n:void 0,n.options)}))},this.uninstall=function(e){var n;z(t.pluginItems,e);var i=z(null===(n=t.growingIO)||void 0===n?void 0:n.plugins,e);return i||ee("卸载插件 "+e+" 失败!","error"),i},this.uninstallAll=function(){t.pluginItems.forEach((function(e){return t.uninstall(e.name)}))},this.lifeError=function(e,t){return ee("插件执行错误 "+e.name+" "+t,"error")},this.onComposeBefore=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onComposeBefore;if(r&&x(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.onComposeAfter=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onComposeAfter;if(r&&x(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.onSendBefore=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onSendBefore;if(r&&x(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.onSendAfter=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onSendAfter;if(r&&x(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.pluginItems=[],this.growingIO.emitter.on("onComposeBefore",this.onComposeBefore),this.growingIO.emitter.on("onComposeAfter",this.onComposeAfter),this.growingIO.emitter.on("onSendBefore",this.onSendBefore),this.growingIO.emitter.on("onSendAfter",this.onSendAfter)},qe=function(){function e(e){var t,n=this;this.growingIO=e,this.initUserInfo=function(){var e,t=n.growingIO.minipInstance,i=[n.uidStorageName,n.userIdStorageName,n.userKeyStorageName,n.gioIdStorageName],r=null!==(e=ye(t,i))&&void 0!==e?e:[];["_uid","_userId","_userKey","_gioId"].forEach((function(e,t){n[e]=r[t],"_uid"!==e||n[e]||(n.uid=re())}))},this.saveUserInfo=function(){var e=n.growingIO.minipInstance;Se(e,[{key:n.uidStorageName,value:n.uid},{key:n.userIdStorageName,value:n.userId},{key:n.userKeyStorageName,value:n.userKey},{key:n.gioIdStorageName,value:n.gioId}])};var i=this.growingIO.inPlugin;this.uidStorageName=i?"_growing_plugin_uid_":"_growing_uid_",this.userIdStorageName=i?"_growing_plugin_userId_":"_growing_userId_",this.userKeyStorageName=i?"_growing_plugin_userKey_":"_growing_userKey_",this.gioIdStorageName=i?"_growing_plugin_gioId_":"_growing_gioId_",this._sessionId=re(),this._uid=void 0,this._userId=void 0,this._userKey=void 0,this._gioId=void 0,"quickapp"!==(null===(t=this.growingIO)||void 0===t?void 0:t.gioPlatform)&&this.initUserInfo()}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId||(this._sessionId=re()),this._sessionId},set:function(e){var t=this._sessionId;this._sessionId=e||re(),t!==this._sessionId&&this.growingIO.emitter.emit("SESSIONID_UPDATE",{newSessionId:this._sessionId,oldSessionId:t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},set:function(e){var t=this._uid;this._uid=e,t!==this._uid&&(this.growingIO.minipInstance.setStorage(this.uidStorageName,this._uid),this.growingIO.emitter.emit("UID_UPDATE",{newUId:e,oldUId:t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){var t=this._userId;this._userId=e,t!==this._userId&&(this.growingIO.minipInstance.setStorage(this.userIdStorageName,this._userId),this.growingIO.emitter.emit("USERID_UPDATE",{newUserId:e,oldUserId:t})),e&&(this.gioId=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userKey",{get:function(){return this._userKey},set:function(e){var t=this._userKey;this._userKey=e,t!==this._userKey&&(this.growingIO.minipInstance.setStorage(this.userKeyStorageName,this._userKey),this.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gioId",{get:function(){return this._gioId},set:function(e){var t=this._gioId;this._gioId=e,t!==this._gioId&&(this.growingIO.minipInstance.setStorage(this.gioIdStorageName,this._gioId),this.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:e,oldGioId:t}))},enumerable:!1,configurable:!0}),e}(),De={name:"QuickApp",platform:"quickapp",scnPrefix:"quickapp_",appHandlers:["onCreate","onShow","onHide","onDestroy","onError"],pageHandlers:["onInit","onReady","onShow","onHide","onDestroy","onMenuPress","onShareAppMessage"],actionEventTypes:["click","longpress","blur","change"],canHook:!1,hooks:{App:!1,Page:!1,Component:!1,Behavior:!1},listeners:{app:{appCreate:"onCreate",appShow:"onShow",appHide:"onHide",appClose:"onDestroy"},page:{pageLoad:"onInit",pageReady:"onReady",pageShow:"onShow",pageHide:"onHide",pageClose:"onDestroy",menuPress:"onMenuPress",tabTap:void 0,shareApp:"onShareAppMessage"},actions:{click:["click","longpress"],change:["blur","change"],submit:[]}}},je=function(s){function g(l){var g=s.call(this,l)||this;return g.growingIO=l,g.getAppSource=function(){var t=e.getInfo().source;return g.appSource=t||{},g.appSource},g.navigateTo=function(){},g.switchTab=function(){},g.navigateToMiniProgram=function(){},g.onAppShow=function(){},g.onAppHide=function(){},g.getImageInfo=function(e){var t=e.src,n=e.success,r=e.fail,o=e.complete;return null==i?void 0:i.getImageInfo({uri:t,success:n,fail:r,complete:o})},g.initImpression=function(){},g.initShareAppMessage=function(e){var t=e.vdsConfig,n=e.platformConfig;try{g.growingIO.shareAppMessage=function(){var i,r=arguments[0];r&&r.type&&!/^text.*/.test(r.type)&&r.data&&t.followShare&&(-1===r.data.indexOf("?")?r.data=r.data+"?suid="+e.userStore.uid:r.data=r.data+"&suid="+e.userStore.uid),null==a||a.share(r),null===(i=null==e?void 0:e.eventTracking)||void 0===i||i.pageEffects(this,n.listeners.page.shareApp,arguments)}}catch(e){}},g.getCurrentPage=function(){return(null==o?void 0:o.getPages)?D(null==o?void 0:o.getPages()):{}},g.getCurrentPath=function(){var e=null==o?void 0:o.getState();return null==e?void 0:e.path},g.getPageTitle=function(){var e=null==o?void 0:o.getState();return ne(null==e?void 0:e.name)},g.getStorageSync=function(){return""},g.getStorage=function(e){return new Promise((function(t){null==u||u.get({key:e,success:function(e){return t(e)},fail:function(){return t(null)}})}))},g.setStorageSync=function(){},g.setStorage=function(e,t){null==u||u.set({key:e,value:t})},g.removeStorageSync=function(){},g.removeStorage=function(e){null==u||u.delete({key:e})},g.getNetworkType=function(){var e=g;return new Promise((function(t){null==r||r.getType({success:function(n){e.network=n,t(n)},fail:function(){return t(null)}})}))},g.request=function(e){var t=e.url,i=e.header,r=e.method,o=e.data,a=e.success,u=e.fail,s=e.complete;return null==n?void 0:n.fetch({url:t,header:i,method:r,data:o,success:a,fail:u,complete:s})},g.getSystemInfo=function(){var e=g;return new Promise((function(n){null==t||t.getInfo({success:function(t){var i=c(c({},t),{version:t.platformVersionName,platform:t.osType});e.systemInfo=i,n(i)},fail:function(){return n(null)}})}))},g}return l(g,s),g}((function(e){var t=this;this.growingIO=e,this.minip=ge("quickapp"),this.hookSetTitle=function(){var e,n=null===(e=t.minip)||void 0===e?void 0:e.setNavigationBarTitle,i=t;n&&Object.defineProperty(t.minip,"setNavigationBarTitle",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){var e=i.getCurrentPath(),t=(arguments[0]||{}).title;i.growingIO.dataStore.eventHooks.currentPage.configuredTitle[e]=t}return n.apply(this,arguments)}})},this.navigateTo=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.navigateTo(e)},this.switchTab=function(e){var n;null===(n=t.minip)||void 0===n||n.switchTab(e)},this.navigateToMiniProgram=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.navigateToMiniProgram(e)},this.getImageInfo=function(e){var n,i=e.src,r=e.success,o=e.fail,a=e.complete;return null===(n=t.minip)||void 0===n?void 0:n.getImageInfo({src:i,success:r,fail:o,complete:a})},this.initImpression=function(e){var n,i;null===(i=null===(n=t.growingIO.plugins)||void 0===n?void 0:n.gioImpressionTracking)||void 0===i||i.main(e,"observeAll")},this.getCurrentPage=function(){return te((function(){return D(getCurrentPages())}))||{}},this.getCurrentPath=function(){var e=t.getCurrentPage();return(null==e?void 0:e.route)||(null==e?void 0:e.uri)||(null==e?void 0:e.__route__)||""},this.getPageTitle=function(e){var n,i,r,o,a,u,s,l,c=fe(),g="",d=de(c);"string"===J(d)&&(d=null!==(n=te((function(){return JSON.parse(d)})))&&void 0!==n?n:{});var p,f=(null==e?void 0:e.data)||e.$data||{};if((g=C(null==f?void 0:f.gioPageTitle)?null==f?void 0:f.gioPageTitle:"")||te((function(){var t,n,i=pe(c);i&&(p=i[e.route+".json"]||{},g=(null==p?void 0:p.navigationBarTitleText)||(null===(n=null===(t=null==p?void 0:p.mod)||void 0===t?void 0:t.exports)||void 0===n?void 0:n.navigationBarTitleText))})),!g&&d){var v=t.growingIO.dataStore.eventHooks.appEffects.enterParams;if(e.route||Z(v)||(e.route=v.path||"",g=e.route?t._getTitleFromTabBar(d,e.route):""),!g&&(p=N(d.pages)?null!==(i=d.pages.find((function(t){return t.path===e.route})))&&void 0!==i?i:{}:d.page||{})){var h=p[e.route]||p[e.route+".html"]||p;g=(null==h?void 0:h.navigationBarTitleText)||(null===(r=null==h?void 0:h.window)||void 0===r?void 0:r.navigationBarTitleText)}g||(g=t._getTitleFromTabBar(d,e.route))}return g||(g=["wx","tt"].includes(c)?null===(u=null===(a=null===(o=d||global||$global)||void 0===o?void 0:o.global)||void 0===a?void 0:a.window)||void 0===u?void 0:u.navigationBarTitleText:null===(l=null===(s=d||global||$global)||void 0===s?void 0:s.window)||void 0===l?void 0:l.navigationBarTitleText),ne(g)},this._getTitleFromTabBar=function(e,t){var n,i,r=null===(i=null===(n=null==e?void 0:e.tabBar)||void 0===n?void 0:n.list)||void 0===i?void 0:i.find((function(e){return e.pagePath===t||e.pagePath===t+".html"}));return(null==r?void 0:r.text)||""},this.getStorageSync=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.getStorageSync(e)},this.getStorage=function(e){return new Promise((function(n){var i;null===(i=t.minip)||void 0===i||i.getStorage({key:e,success:function(e){var t=e.data;return n(t)},fail:function(){return n("")}})}))},this.setStorageSync=function(e,n){var i;null===(i=t.minip)||void 0===i||i.setStorageSync(e,n)},this.setStorage=function(e,n){var i;null===(i=t.minip)||void 0===i||i.setStorage({key:e,data:n})},this.removeStorageSync=function(e){var n;null===(n=t.minip)||void 0===n||n.removeStorageSync(e)},this.removeStorage=function(e){var n;null===(n=t.minip)||void 0===n||n.removeStorage(e)},this.getNetworkType=function(){return g(t,void 0,void 0,(function(){var e,t=this;return d(this,(function(n){switch(n.label){case 0:return e=this,[4,new Promise((function(n){var i;null===(i=t.minip)||void 0===i||i.getNetworkType({success:function(t){e.network=t,n(t)},fail:function(){return n(null)}})}))];case 1:return[2,n.sent()]}}))}))},this.request=function(e){var n,i=e.url,r=e.data,o=e.header,a=e.timeout,u=e.method,s=e.success,l=e.fail,c=e.complete,g=null===(n=t.minip)||void 0===n?void 0:n.request({url:i,data:r,header:o,headers:o,timeout:a,method:u,success:s,fail:l,complete:c}),d=setTimeout((function(){null==g||g.abort(),clearTimeout(d),d=null}),(a||1e4)+10);return g},this.getSystemInfo=function(){return g(t,void 0,void 0,(function(){var e,t=this;return d(this,(function(n){switch(n.label){case 0:return e=this,[4,new Promise((function(n){var i;null===(i=t.minip)||void 0===i||i.getSystemInfo({success:function(t){e.systemInfo=t,n(t)},fail:function(){return n(null)}})}))];case 1:return[2,n.sent()]}}))}))},this.getSetting=function(){return new Promise((function(e){var n;null===(n=t.minip)||void 0===n||n.getSetting({success:e,fail:e})}))};var n=this.growingIO.platformConfig,i=n.platform,r=n.scnPrefix;this.platform=i,this.scnPrefix=r,this.getNetworkType().then((function(){var e;return null===(e=t.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()})),this.getSystemInfo().then((function(){var e;return null===(e=t.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()}))})),He={},Le={}.hasOwnProperty;function Be(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function Re(e){try{return encodeURIComponent(e)}catch(e){return null}}He.stringify=function(e,t){t=t||"";var n,i,r=[];for(i in"string"!=typeof t&&(t="?"),e)if(Le.call(e,i)){if((n=e[i])||null!=n&&!isNaN(n)||(n=""),i=Re(i),n=Re(n),null===i||null===n)continue;r.push(i+"="+n)}return r.length?t+r.join("&"):""},He.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var r=Be(t[1]),o=Be(t[2]);null===r||null===o||r in i||(i[r]=o)}return i};var Fe=function(e){var t=this;this.growingIO=e,this.main=function(e){var n,i=t.growingIO,r=i.sdkVersion,o=i.vdsConfig,a=i.platformConfig,u=i.minipInstance,s=i.userStore,l=i.dataStore,g=l.scene,d=l.eventHooks.currentPage,p=l.locationData,f=u.systemInfo,v=void 0===f?{}:f,h=u.network,m=void 0===h?{}:h,I=v.brand,y=v.model,S=v.platform,w=v.language,b=v.version,O=d.getPagePath(),P={appChannel:"scn:"+(g||"NA"),appVersion:o.version,dataSourceId:o.dataSourceId,deviceBrand:I,deviceId:s.uid,deviceModel:y,deviceType:ue(S,a.name),domain:o.appId,gioId:s.gioId,language:w,latitude:null==p?void 0:p.latitude,longitude:null==p?void 0:p.longitude,networkState:(null===(n=null==m?void 0:m.networkType)||void 0===n?void 0:n.result)||(null==m?void 0:m.networkType)||(null==m?void 0:m.type)||(null==m?void 0:m.subtype),operatingSystem:ue(S,a.name),path:O,platform:a.platform,platformVersion:a.name+(b?" "+b:""),query:O?d.getPageQuery():"",screenHeight:oe(v),screenWidth:ae(v),sdkVersion:r,sessionId:s.sessionId,title:d.getPageTitle(),timestamp:Date.now(),userId:s.userId};return o.enableIdMapping&&(P.userKey=s.userKey),Z(o.ignoreFields)||o.ignoreFields.forEach((function(e){z(P,e)})),Z(e)?P:c(c({},P),e)}},Ue=function(e){var t=this;this.growingIO=e,this.enterParams={},this.main=function(e,n){var i,r,o=Date.now(),a=t.growingIO,u=a.emitter,s=a.userStore,l=a.vdsConfig,g=a.platformConfig,d=a.uploader,p=a.dataStore,f=a.dataStore,v=f.keepAlive,h=f.lastCloseTime,m=f.eventHooks,I=f.saveStorageInfo;u.emit("minipLifecycle",{event:"App "+e,timestamp:o,params:null!==(i=n[0])&&void 0!==i?i:{}}),l.debug&&console.log("App:",e,o);var y=g.listeners.app;switch(u.emit("onComposeBefore",{event:"App "+e,params:null!==(r=n[0])&&void 0!==r?r:{}}),e){case y.appLaunch:t.enterParams=c({},n[0]);break;case y.appCreate:case y.appShow:var S=t.enterParamsParse(n[0]),w=S.path,b=S.query,O=S.referralPage;h?(Date.now()-h>v||p.lastScene&&p.scene!==p.lastScene)&&(s.sessionId="",m.currentPage.time=void 0,t.buildVisitEvent({path:w,query:b,referralPage:O})):(t.growingIO.dataStore.lastVisitEvent={path:w,query:b,referralPage:O},t.buildVisitEvent({path:w,query:b,referralPage:O}));break;case y.appClose:p.lastScene=p.scene,p.lastCloseTime=Date.now(),I(),s.saveUserInfo(),t.buildCloseEvent(),l.forceLogin||d.initiateRequest(!0)}},this.enterParamsParse=function(e){var n,i=t.growingIO,r=i.gioPlatform,o=i.minipInstance,a=i.dataStore,u="",s="",l="",c=function(e,t){void 0===t&&(t={}),u=e,s=G(t).map((function(e){return e+"="+t[e]})).join("&")};if("quickapp"!==r&&o.minip.canIUse("getEnterOptionsSync")){var g=o.minip.getEnterOptionsSync()||{},d=g.path,p=g.query,f=g.scene,v=g.referrerInfo||g.refererInfo,h=e.query||p;if(c(e.path||d,h),l=(null==v?void 0:v.appId)||(null===(n=null==e?void 0:e.referrerInfo)||void 0===n?void 0:n.appId)||"",a.scene=e.scene||f,!Z(v)&&A(null==v?void 0:v.extraData)){var m=[];$(v.extraData,(function(e,t){!M(h,t)&&["string","number","boolean"].includes(J(e))&&m.push(t+"="+e)}));var I=m.join("&");s=s&&I?s+"&"+I:s||I}}else d=e.path,p=e.query,v=e.referrerInfo,c(d,p),l=(null==v?void 0:v.appId)||"",t.parseScene(e);return{path:u,query:s,referralPage:l}},this.parseScene=function(e){var n,i,r=t.growingIO,o=r.minipInstance,a=r.gioPlatform,u=r.dataStore;if("quickapp"===a){var s=o.getAppSource(),l=s.extra,c=s.type;i=(null==l?void 0:l.scene)||c}else Z(e)||((null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.wxShoppingListScene)?i=e.query.wxShoppingListScene:(null==e?void 0:e.scene)?i=e.scene:u.scene="NA");u.scene=i},this.buildVisitEvent=function(e){var n=t.growingIO.dataStore,i=n.eventContextBuilder,r=n.eventInterceptor,o=(null==e?void 0:e.query)||(null==e?void 0:e.q)||"";r(c({eventType:"VISIT"},i({path:(null==e?void 0:e.path)||(null==e?void 0:e.p)||"",query:"string"===J(o)?o:we(o),referralPage:e.referralPage||""})))},this.buildCloseEvent=function(){var e=t.growingIO.dataStore,n=e.eventContextBuilder;(0,e.eventInterceptor)(c({eventType:"APP_CLOSED"},n()))}},Ve=function(){function e(e){var t=this;this.growingIO=e,this.getPagePath=function(){var e,n,i,r=t.growingIO,o=r.minipInstance,a=r.inPlugin,u=r.dataStore,s=r.vdsConfig,l=o.getCurrentPath();return a?l||"/插件"+s.appId:l||(null===(e=u.eventHooks.appEffects.enterParams)||void 0===e?void 0:e.path)||(null===(n=u.lastPageEvent)||void 0===n?void 0:n.path)||(null===(i=u.lastVisitEvent)||void 0===i?void 0:i.path)},this.getPageQuery=function(){var e,n,i,r,o,a,u=t.growingIO,s=u.minipInstance,l=u.dataStore,c=s.getCurrentPage(),g=s.getCurrentPath(),d=l.eventHooks.appEffects.enterParams,p=void 0===d?{}:d;if(!g)return p.path?we(Pe(null==p?void 0:p.query,null===(i=null==p?void 0:p.referrerInfo)||void 0===i?void 0:i.extraData)):(null===(r=l.lastPageEvent)||void 0===r?void 0:r.path)?null===(o=l.lastPageEvent)||void 0===o?void 0:o.query:null===(a=l.lastVisitEvent)||void 0===a?void 0:a.query;var f=null!==(e=c.options)&&void 0!==e?e:c.$taroParams;return Z(f)?Z(t.queryOptions[g])?g===p.path?we(Pe(null==p?void 0:p.query,null===(n=null==p?void 0:p.referrerInfo)||void 0===n?void 0:n.extraData)):void 0:we(Pe(t.queryOptions[g])):we(Pe(f))},this.getPageTitle=function(){var e=t.growingIO,n=e.minipInstance,i=e.inPlugin,r=e.vdsConfig,o=n.getCurrentPath(),a=t.configuredTitle[o]||n.getPageTitle(n.getCurrentPage());return i?a||"/插件"+r.appId+(o?"_"+D(o.split("/")):""):a},this.getReferralPage=function(){var e,n,i=t.growingIO,r=i.minipInstance,o=i.dataStore,a=o.lastPageEvent,u=o.scene,s=o.eventHooks;return(null==a?void 0:a.path)||(null==a?void 0:a.p)||(null===(n=null===(e=s.appEffects.enterParams)||void 0===e?void 0:e.referrerInfo)||void 0===n?void 0:n.appId)||(u?"scn:"+r.scnPrefix+u:null)},this.saveShareId=function(e){(null==e?void 0:e.gioShareId)&&(t.queryShareId=e.gioShareId)},this.updateShareResult=function(e,n){var i=t.buildShareQuery(e,n),r=i[0],o=i[1],a=i[2];return n.path=le(r+(o?"?"+o:"")),n.attributes=a,n.query=o,n},this.updateAppMessageResult=this.updateShareResult,this.updateTimelineResult=this.updateShareResult,this.updateAddFavoritesResult=function(e,n){var i=t.buildShareQuery(e,n,!1),r=i[0],o=i[1];return n.path=le(r+(o?"?"+o:"")),n.query=o,n},this.queryOptions={},this.configuredTitle={},this.pageProps={}}return e.prototype.buildShareQuery=function(e,t,n){var i,r;void 0===n&&(n=!0);var o=e.userStore,a=se(null!==(i=t.path)&&void 0!==i?i:""),u=t.path||this.getPagePath(),s={},l=M(t,"path");if(M(t,"query"))s=be(null!==(r=t.query)&&void 0!==r?r:"")||{};else if(l)s=be(D(a))||{};else{var g=this.growingIO.minipInstance.getCurrentPage();s=c({},g.options||this.queryOptions[g.route]||{}),H(G(s)).forEach((function(e){(["gioPreShareId","gioShareId","suid"].includes(e)||e.toLowerCase().startsWith("utm_"))&&z(s,e)}))}if(!n)return[u,we(s),{}];var d={gioShareId:re(),suid:o.uid},p={contentType:t.contentType||s.contentType,contentId:t.contentId||s.contentId,gioPreShareId:this.queryShareId};return $(d,(function(e,t){e||z(d,t)})),[u,we(c(c({},s),d)),c(c({},d),p)]},e}(),Ke=function(e){var t=this;this.growingIO=e,this.main=function(e,n,i){var r,o,a=Date.now(),u=t.growingIO,s=u.emitter,l=u.minipInstance,c=u.plugins,g=u.vdsConfig,d=u.platformConfig,p=u.dataStore,f=p.shareOut,v=p.eventHooks,h=p.toggleShareOut,m=p.buildAppMessageEvent,I=p.buildTimelineEvent,y=p.buildAddFavorites,S=u.inPlugin,w=v.currentPage;if(!t.prevEvent[n]||Date.now()-Number(t.prevEvent[n])>=50){e||(e=l.getCurrentPage()),g.wepy&&(e.route=e.$is),e.route||(e.route=l.getCurrentPath(e));var b=e.route||e.uri||e.__route__||(null===(r=null==e?void 0:e.$page)||void 0===r?void 0:r.fullPath)||"";s.emit("minipLifecycle",{event:"Page "+n,timestamp:a,params:{page:e,args:i[0]}}),g.debug&&console.log("Page:",b,"#",n,a),t.prevEvent[n]=Date.now();var O=d.listeners.page;switch(s.emit("onComposeBefore",{page:e,event:"Page "+n,params:{page:e,args:i[0]}}),w.lastLifecycle=w.currentLifecycle,w.currentLifecycle=n,n){case O.pageLoad:w.queryOptions[b]=W(e,"options")||W(e,"__displayReporter.query")||W(e,"$page.query")||W(e,"$wx.__displayReporter.query")||W(e,"$taroParams")||i[0]||{},z(w.queryOptions[b],["$taroTimestamp","gdpCircleRoomCollectUrl"]);break;case O.pageShow:if(S)break;f&&v.currentPage.time||(v.currentPage.time=Date.now(),t.buildPageEvent()),h(!1),w.saveShareId(w.queryOptions[b]);break;case O.pageHide:case O.pageUnload:break;case O.shareApp:h(!0),g.followShare&&m(i);break;case O.shareTime:g.followShare&&I(i);break;case O.addFavorites:y(i);break;case O.tabTap:var P=null===(o=null==c?void 0:c.gioEventAutoTracking)||void 0===o?void 0:o.buildTabClickEvent;g.autotrack&&P&&x(P)&&P(i[0])}n===O.pageUnload&&(w.pageProps[b]=void 0)}},this.buildPageEvent=function(){var e=t.growingIO.dataStore,n=e.eventContextBuilder,i=e.eventInterceptor,r=e.eventHooks.currentPage,o=c(c({eventType:"PAGE",referralPage:r.getReferralPage()},n()),{timestamp:r.time});Z(r.pageProps[o.path])||(o.attributes=r.pageProps[o.path]),i(o)},this.prevEvent={}},Me=function(e){var t,n=this;this.growingIO=e,this.isNormalFc=function(e,t){return x(t)&&"constructor"!==e},this.objectTraverse=function(e,t){Object.getOwnPropertyNames(e).forEach((function(n){return t(n,e)})),M(e,"methods")&&Object.getOwnPropertyNames(e.methods).forEach((function(n){e[n]||t(n,e.methods)})),M(e,"lifetimes")&&Object.getOwnPropertyNames(e.lifetimes).forEach((function(n){e[n]||t(n,e.lifetimes)})),M(e,"pageLifetimes")&&Object.getOwnPropertyNames(e.pageLifetimes).forEach((function(n){e[n]||t(n,e.pageLifetimes)}))},this.supLifeFcs=function(e,t){N(n[t+"Handlers"])&&n[t+"Handlers"].forEach((function(t){x(e[t])||["onShareAppMessage","onShareTimeline"].includes(t)||(e[t]=function(){})}))},this.lifeFcEffects=function(e,t,i){var r=n;return["onShareTimeline","onAddToFavorites"].includes(e)?function(){for(var n=[],o=0;arguments.length>o;o++)n[o]=arguments[o];var a=t.apply(this,n);"onShareTimeline"===e&&r.growingIO.vdsConfig.followShare&&(a=r.currentPage.updateTimelineResult(r.growingIO,null!=a?a:{})),"onAddToFavorites"===e&&(a=r.currentPage.updateAddFavoritesResult(r.growingIO,null!=a?a:{}));var u=[].slice.call(n);return a&&u.push(a),r["def"+i+"Cbs"][e].apply(this,u),a}:function(){for(var n,o=[],a=0;arguments.length>a;a++)o[a]=arguments[a];return g(this,void 0,void 0,(function(){var a,u,s,l,g;return d(this,(function(d){switch(d.label){case 0:return d.trys.push([0,6,,7]),"onShareAppMessage"!==e?[3,5]:(a=null!==(n=t.apply(this,o))&&void 0!==n?n:{},"promise"!==J(a)?[3,2]:[4,a.then((function(e){return e}))]);case 1:a=d.sent(),d.label=2;case 2:return"promise"!==J(a.promise)?[3,4]:(u=function(){var e=a;return new Promise((function(t){var n=setTimeout((function(){t(c({},e)),clearTimeout(n),n=void 0}),3e3);a.promise.then((function(i){t(c({},e=i)),clearTimeout(n),n=void 0}))}))},s=[c({},a)],[4,u()]);case 3:a=c.apply(void 0,s.concat([d.sent()])),z(a,"promise"),d.label=4;case 4:r.growingIO.vdsConfig.followShare&&(a=r.currentPage.updateAppMessageResult(r.growingIO,null!=a?a:{})),d.label=5;case 5:return l=[].slice.call(o),a&&l.push(a),r["def"+i+"Cbs"][e].apply(this,l),[3,7];case 6:return g=d.sent(),ee(g,"error"),[3,7];case 7:return"onShareAppMessage"!==e&&(a=t.apply(this,o)),r.growingIO.emitter.emit("minipLifecycle",{event:i+" "+e+"End",timestamp:Date.now(),params:{instance:this,arguments:Array.from(o)}}),[2,a]}}))}))}},this.customFcEffects=function(e,t){var i=n;return function(){for(var n,r,o=[],a=0;arguments.length>a;a++)o[a]=arguments[a];if(i.growingIO.vdsConfig.autotrack&&i.growingIO.plugins.gioEventAutoTracking)try{var u=o[0]||{};M(u,"type")&&((null==u?void 0:u.currentTarget)||(null==u?void 0:u.target))||(u=o[o.length-1]),((null==u?void 0:u.currentTarget)||(null==u?void 0:u.target))&&i.actionEventTypes.includes(u.type)&&(x(i.actionEffects)||(i.actionEffects=(null===(r=null===(n=i.growingIO.plugins)||void 0===n?void 0:n.gioEventAutoTracking)||void 0===r?void 0:r.main)||function(){}),null==i||i.actionEffects(u,e))}catch(e){ee(e,"error")}return t.apply(this,o)}},this.appApplyProxy=function(e,t){return n.appHandlers.includes(e)?n.lifeFcEffects(e,t,"App"):n.customFcEffects(e,t)},this.pageApplyProxy=function(e,t){return n.pageHandlers.includes(e)?n.lifeFcEffects(e,t,"Page"):n.customFcEffects(e,t)},this.appOverriding=function(e){return n.supLifeFcs(e,"app"),n.objectTraverse(e,(function(e,t){n.isNormalFc(e,t[e])&&(t[e]=n.appApplyProxy(e,t[e]))})),e},this.pageOverriding=function(e){return n.supLifeFcs(e,"page"),n.objectTraverse(e,(function(e,t){n.isNormalFc(e,t[e])&&(t[e]=n.pageApplyProxy(e,t[e]))})),e},this.componentOverriding=function(e){return e.methods||(e.methods={}),n.supLifeFcs(e.methods,"page"),n.objectTraverse(e.methods,(function(e,t){n.isNormalFc(e,t[e])&&(t[e]=n.pageApplyProxy(e,t[e]))})),e},this.growingApp=function(e){return n.originalApp(n.appOverriding(e))},this.growingPage=function(e){return n.originalPage(n.pageOverriding(e))},this.growingComponent=function(e){return n.originalComponent(n.componentOverriding(e))},this.growingBehavior=function(e){return n.originalBehavior(n.componentOverriding(e))},this.nativeGrowing=function(e){void 0===e&&(e=["App","Page","Component","Behavior"]);var t=n,i=n.growingIO.platformConfig.hooks;if(e.includes("App"))try{i.App&&!n.appHooked&&(n.originalApp=App||global.App||function(){},App=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingApp(e[0])},n.appHooked=!0)}catch(e){}if(e.includes("Page"))try{i.Page&&!n.pageHooked&&(n.originalPage=Page||global.Page||function(){},Page=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingPage(e[0])},n.pageHooked=!0)}catch(e){}if(e.includes("Component"))try{i.Component&&!n.componentHooked&&(n.originalComponent=Component||global.Component||function(){},Component=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingComponent(e[0])},n.componentHooked=!0)}catch(e){}if(e.includes("Behavior"))try{i.Behavior&&!n.behaviorHooked&&(n.originalBehavior=Behavior||global.Behavior||function(){},Behavior=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingBehavior(e[0])},n.behaviorHooked=!0)}catch(e){}},this.initEventHooks=function(){var e=n,t=n.growingIO,i=t.platformConfig,r=t.gioPlatform;n.appHandlers.forEach((function(t){n.defAppCbs[t]=function(){for(var n=[],i=0;arguments.length>i;i++)n[i]=arguments[i];e.appEffects.main(t,n)}})),n.pageHandlers.forEach((function(t){n.defPageCbs[t]=function(){for(var n=[],i=0;arguments.length>i;i++)n[i]=arguments[i];e.pageEffects.main(this,t,n)}})),i.canHook?n.nativeGrowing():"quickapp"===r&&(window.GioApp=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.appOverriding(t[0])},window.GioPage=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.pageOverriding(t[0])},window.GioComponent=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.pageOverriding(t[0])}),n.growingIO.App=te((function(){return App})),n.growingIO.Page=te((function(){return Page})),n.growingIO.Component=te((function(){return Component})),n.growingIO.Behavior=te((function(){return Behavior})),"quickapp"===r&&(n.growingIO.GioApp=window.GioApp,n.growingIO.GioPage=window.GioPage,n.growingIO.GioComponent=window.GioComponent)};var i=null===(t=this.growingIO)||void 0===t?void 0:t.platformConfig;this.defAppCbs={},this.defPageCbs={},this.appHandlers=i.appHandlers,this.pageHandlers=i.pageHandlers,this.actionEventTypes=i.actionEventTypes,this.appEffects=new Ue(this.growingIO),this.pageEffects=new Ke(this.growingIO),this.currentPage=new Ve(this.growingIO)},Ge=function(){function e(e){var t=this;this.growingIO=e,this.ALLOW_SETTING=Object.assign({},f,"saas"===this.growingIO.gioEnvironment?h:v),this.allowOptKeys=G(this.ALLOW_SETTING),this.initStorageInfo=function(){var e=t.growingIO.minipInstance,n=he(),i=n.gio_esid?n.gio_esid:e.getStorageSync(t.esidStorageName);i=A(i)&&!_(i)?i:{},t._esid={},G(i).forEach((function(e){t._esid[e]=Number.isNaN(Number(i[e]))||i[e]>=1e9||1>i[e]?1:i[e]})),Q(i,t._esid)||e.setStorageSync(t.esidStorageName,t._esid);var r=n.gio_gsid?n.gio_gsid:Number(e.getStorageSync(t.gsidStorageName));t._gsid=Number.isNaN(r)||r>=1e9||1>r?1:r,t._stid=t._gsid,r!==t._gsid&&e.setStorageSync(t.gsidStorageName,t._gsid)},this.saveStorageInfo=function(){var e=t.growingIO.minipInstance;t._stid=t._gsid,Se(e,[{key:t.esidStorageName,value:t._esid},{key:t.gsidStorageName,value:t._gsid}])},this.initOptions=function(e){var n,i,r,o,a,u,s,l,g,d,p,f=e.projectId,v=e.dataSourceId,h=e.appId,m={};t.allowOptKeys.forEach((function(n){var i=t.ALLOW_SETTING[n].type;(N(i)?i.includes(J(e[n])):J(e[n])===t.ALLOW_SETTING[n].type)?"ignoreFields"===n?m.ignoreFields=e.ignoreFields.filter((function(e){return P.includes(e)})):"extraParams"===n?m.extraParams=e.extraParams.filter((function(e){return T.includes(e)})):m[n]=e[n]:m[n]=t.ALLOW_SETTING[n].default})),m.uploadInterval=Math.round(m.uploadInterval),(Number.isNaN(m.uploadInterval)||0>m.uploadInterval||m.uploadInterval>2e3)&&(m.uploadInterval=1e3),!isNaN(Number(m.requestTimeout))&&m.requestTimeout>0||(m.requestTimeout=5e3),t.growingIO.vdsConfig=c(c({},m),{projectId:f,dataSourceId:v,appId:h,performance:{monitor:null===(i=null===(n=m.performance)||void 0===n?void 0:n.monitor)||void 0===i||i,exception:null===(o=null===(r=m.performance)||void 0===r?void 0:r.exception)||void 0===o||o,network:null!==(u=null===(a=m.performance)||void 0===a?void 0:a.network)&&void 0!==u&&u}}),t.keepAlive=m.keepAlive,m.dataCollect||ee("已关闭数据采集","info"),m.autotrack||ee("已关闭无埋点","info"),t.growingIO.inPlugin&&(t.growingIO.vdsConfig.autotrack=!1);var I=m.cml,y=m.uniVue,S=m.wepy,w=m.taro,b=m.remax;"full"!==t.growingIO.gioFramework||I||y||S||w||b||(t.growingIO.platformConfig.canHook=!0),t.growingIO.inPlugin||t.eventHooks.initEventHooks();var O=t.growingIO.plugins;I&&(null===(s=null==O?void 0:O.gioChameleonAdapter)||void 0===s||s.main()),y&&(null===(l=null==O?void 0:O.gioUniAppAdapter)||void 0===l||l.main()),S&&(null===(g=null==O?void 0:O.gioWepyAdapter)||void 0===g||g.main()),w&&(null===(d=null==O?void 0:O.gioTaroAdapter)||void 0===d||d.main()),b&&(null===(p=null==O?void 0:O.gioRemaxAdapter)||void 0===p||p.main())},this.setOption=function(e,n){var i,r=t.growingIO,o=r.vdsConfig,a=r.callError,u=r.uploader,s=r.emitter,l=C(e)&&t.allowOptKeys.includes(e),c=l&&typeof n===(null===(i=t.ALLOW_SETTING[e])||void 0===i?void 0:i.type);if(l&&c){if("dataCollect"===e&&!1===o.dataCollect&&!0===n)var g=setTimeout((function(){t.sendVisit(),t.eventHooks.currentPage.time=Date.now(),t.sendPage(),clearTimeout(g),g=null}));return o[e]=n,["host","scheme"].includes(e)&&(null==u||u.generateURL()),s.emit("OPTION_CHANGE",{optionName:e,optionValue:n}),!0}return a("setOption > "+e),!1},this.getOption=function(e){var n=t.growingIO,i=n.vdsConfig,r=n.callError;return e&&M(i,B(e))?i[B(e)]:_(e)?c({},i):void r("getOption > "+e)},this.toggleShareOut=function(e){E(e)?t.shareOut=e:t.shareOut=!t.shareOut},this.sendVisit=function(){t.eventHooks.appEffects.buildVisitEvent(t.lastVisitEvent)},this.sendPage=function(){t.eventHooks.pageEffects.buildPageEvent()},this.eventInterceptor=function(e){var n=t.growingIO.minipInstance,i=n.systemInfo,r=n.network;Z(i)||Z(r)?t.interceptEvents.push(e):Z(t.interceptEvents)?t.eventConverter(e):(p(p([],t.interceptEvents),[e]).forEach((function(e){var n=c(c({},e),t.eventContextBuilder({path:e.path,query:e.query,timestamp:e.timestamp}));t.eventConverter(n)})),t.interceptEvents=[])},this.eventReleaseInspector=function(){var e=t.growingIO.minipInstance,n=e.systemInfo,i=e.network;n&&i&&!Z(t.interceptEvents)&&(p([],t.interceptEvents).forEach((function(e){var n=c(c({},e),t.eventContextBuilder({path:e.path,query:e.query,timestamp:e.timestamp}));t.eventConverter(n)})),t.interceptEvents=[])},this.buildAppMessageEvent=function(e){},this.buildTimelineEvent=function(e){},this.buildAddFavorites=function(e){},this.esidStorageName="_growing_esid_",this.gsidStorageName="_growing_gsid_",this.initStorageInfo(),this.eventContextBuilder=new Fe(this.growingIO).main,this.eventHooks=new Me(this.growingIO),this.shareOut=!1,this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.generalProps={},this.interceptEvents=[],this.growingIO.emitter.on("onComposeAfter",(function(e){var n=e.composedEvent;"VISIT"!==n.eventType&&"vst"!==n.t||(t.lastVisitEvent=n),"PAGE"!==n.eventType&&"page"!==n.t||(t.lastPageEvent=n)}))}return Object.defineProperty(e.prototype,"esid",{get:function(){var e=he(),t=ve(e);return!Z(t)&&e.gio_esid?e.gio_esid:this._esid},set:function(e){var t={};G(e).forEach((function(n){t[n]=Number.isNaN(e[n])||e[n]>=1e9||1>e[n]?1:e[n]})),Q(t,this._esid)||(this._esid=t,he().gio_esid=this._esid)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gsid",{get:function(){var e=he(),t=ve(e);return!Z(t)&&e.gio_gsid?e.gio_gsid:this._gsid},set:function(e){var t=Number(e);this._gsid=Number.isNaN(t)||e>=1e9||1>e?1:e,he().gio_gsid=this._gsid,10>this._gsid-this._stid||this.saveStorageInfo()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},set:function(e){var t=this._scene;this._scene=e,t!==this._scene&&this.growingIO.emitter.emit("SCENE_UPDATE",{newScene:e,oldScene:t})},enumerable:!1,configurable:!0}),e}(),$e=function(e){function t(t){var n=e.call(this,t)||this;return n.growingIO=t,n.eventConverter=function(e){var t,i=n.growingIO,r=i.vdsConfig,o=i.dataStore,a=i.uploader;if(r.dataCollect){e.globalSequenceId=o.gsid,e.eventSequenceId=o.esid[e.eventType]||1;var u={};$(e,(function(e,t){var n;if("element"===t){var i=null!==(n=q(e))&&void 0!==n?n:{};$(i,(function(e,t){Z(e)&&0!==e||(u[t]=e)}))}else Z(e)&&0!==e||(u[t]=e)})),n.growingIO.dataStore.gsid+=1,n.growingIO.dataStore.esid=c(c({},n.growingIO.dataStore.esid),((t={})[u.eventType]=(n.growingIO.dataStore.esid[u.eventType]||1)+1,t)),n.growingIO.emitter.emit("onComposeAfter",{composedEvent:u}),a.commitRequest(u)}},n.buildAppMessageEvent=function(e){var t,i,r=e[0];2>e.length?1===e.length&&(i=r):i=e[1];var o=n.growingIO.dataStore,a=o.eventContextBuilder,u=o.eventInterceptor,s=o.eventHooks.currentPage,l=((null==i?void 0:i.path)||"").split("?");u(c({eventType:"CUSTOM",eventName:"$mp_on_share",pageShowTimestamp:s.time,attributes:c({$from:r.from,$target:null===(t=null==r?void 0:r.target)||void 0===t?void 0:t.id,$share_title:null==i?void 0:i.title,$share_path:q(l),$share_query:l[1]},null==i?void 0:i.attributes)},a()))},n.buildTimelineEvent=function(e){var t,i,r=e[0];2>e.length?1===e.length&&(i=r):i=e[1];var o=n.growingIO.dataStore,a=o.eventContextBuilder,u=o.eventInterceptor,s=o.eventHooks.currentPage,l=((null==i?void 0:i.path)||"").split("?");u(c({eventType:"CUSTOM",eventName:"$mp_share_timeline",pageShowTimestamp:s.time,attributes:c({$target:null===(t=null==r?void 0:r.target)||void 0===t?void 0:t.id,$share_title:null==i?void 0:i.title,$share_path:q(l),$share_query:l[1]},null==i?void 0:i.attributes)},a()))},n.buildAddFavorites=function(e){var t,i=e[0];2>e.length?1===e.length&&(t=i):t=e[1];var r=n.growingIO.dataStore,o=r.eventContextBuilder,a=r.eventInterceptor,u=r.eventHooks.currentPage,s=((null==t?void 0:t.path)||"").split("?");a(c({eventType:"CUSTOM",eventName:"$mp_add_favorites",pageShowTimestamp:u.time,attributes:{$share_title:null==t?void 0:t.title,$share_path:q(s),$share_query:s[1]}},o()))},n.trackTimers={},n}return l(t,e),t}(Ge),Qe=function(e){function t(t){var n=e.call(this,t)||this;return n.growingIO=t,n.generateURL=function(){var e=n.growingIO.vdsConfig,t=e.scheme,i=e.host,r=void 0===i?"":i,o=e.projectId;t&&U(t,"http")?V(B(t),"://")||(t+="://"):t="https://",r=r.replace("http://","").replace("https://",""),n.requestURL=""+t+r+"/v3/projects/"+o+"/collect"},n.generateURL(),n}return l(t,e),t}((function(e){var t=this;this.growingIO=e,this.commitRequest=function(e){var n=c({},e);t.growingIO.vdsConfig.forceLogin?t.hoardingQueue.push(n):(t.requestQueue.push(n),t.initiateRequest())},this.initiateRequest=function(e){var n,i,r=t.growingIO,o=r.plugins,a=r.vdsConfig;p(p([],t.hoardingQueue),t.requestQueue).length>0&&t.requestingNum<t.requestLimit&&((null===(n=null==a?void 0:a.tbConfig)||void 0===n?void 0:n.cloudFuncSend)?null===(i=null==o?void 0:o.gioTaobaoSendAdapter)||void 0===i||i.singleInvoke():e?t.batchInvoke():t.batchInvokeThrottle())},this.batchInvoke=function(){var e,n,i=t.growingIO,r=i.vdsConfig,o=i.plugins,a=i.emitter,u=p(p([],t.hoardingQueue),t.requestQueue);u.length>50?(u=u.slice(0,50),t.hoardingQueue.length>50?t.hoardingQueue=t.hoardingQueue.slice(50):(t.requestQueue=t.requestQueue.slice(50-t.hoardingQueue.length),t.hoardingQueue=[])):(t.hoardingQueue=[],t.requestQueue=[]);var s=u.filter((function(e){return(t.retryIds[e.globalSequenceId||e.esid]||0)<=t.retryLimit}));Z(s)||(r.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(s,null,2)),a.emit("onSendBefore",{requestData:s}),(null===(e=null==r?void 0:r.tbConfig)||void 0===e?void 0:e.cloudAppId)?null===(n=null==o?void 0:o.gioTaobaoSendAdapter)||void 0===n||n.tbCloudAppInvoke(s):t.normalBatchInvoke(s))},this.batchInvokeThrottle=X(this.batchInvoke,this.growingIO.vdsConfig.uploadInterval,!1,!1),this.normalBatchInvoke=function(e){var n,i=t.growingIO,r=i.minipInstance,o=i.vdsConfig,a=i.emitter,u=i.plugins,s=i.gioEnvironment;t.requestingNum+=1;var l={"content-type":"jdp"===r.platform?"application/json":"application/json;charset=UTF-8"},c=p([],e),g=o.compress&&(null===(n=null==u?void 0:u.gioCompress)||void 0===n?void 0:n.compressToUTF16);"cdp"===s&&g&&(c=u.gioCompress.compressToUTF16(JSON.stringify(e)),l["X-Compress-Codec"]="1"),r.request({url:t.requestURL+"?stm="+Date.now()+("cdp"===s?"&compress="+(g?"1":"0"):""),header:l,method:"POST",data:c,timeout:o.requestTimeout,fail:function(n){[200,204].includes(n.code)||(N(e)?e.forEach((function(e){t.requestFailFn(e)})):t.requestFailFn(e),ee("请求失败!"+JSON.stringify(n),"error"))},complete:function(e){t.requestingNum-=1,a.emit("onSendAfter",{result:e}),t.initiateRequest()}})},this.requestFailFn=function(e){if(t.retryIds[e.globalSequenceId||e.esid]||(t.retryIds[e.globalSequenceId||e.esid]=0),t.retryIds[e.globalSequenceId||e.esid]+=1,!t.requestQueue.some((function(t){return t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid})))var n=setTimeout((function(){Z(t.requestQueue)?(t.requestQueue.push(e),t.initiateRequest()):t.requestQueue.push(e),clearTimeout(n),n=null}),800)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.requestURL=""})),We=new(function(e){function t(){var t,n,i=e.call(this)||this;return i.registerPlugins=function(e){i.plugins.pluginItems=p(p([],i.plugins.pluginItems),e),i.plugins.installAll(e)},i.initCallback=function(){i.uploader=new Qe(i),i.vdsConfig.enableIdMapping||(i.userStore.userKey="")},i.setTrackerScheme=function(e){["http","https"].includes(e)?(i.dataStore.setOption("scheme",e),i.notRecommended()):i.callError("scheme",!1)},i.setTrackerHost=function(e){Ce.test(e)||ke.test(e)?(i.dataStore.setOption("host",e),i.notRecommended()):i.callError("host",!1)},i.identify=function(e){if(i.vdsConfig.forceLogin){if(!_e(e))return void i.callError("identify");var t=B(e).slice(0,1e3);i.userStore.uid=t,i.uploader.hoardingQueue.forEach((function(e,n){return i.uploader.hoardingQueue[n].deviceId=t})),i.dataStore.setOption("forceLogin",!1),i.uploader.initiateRequest(!0)}else i.callError("identify",!1,"forceLogin未开启")},i.setUserAttributes=function(e){var t,n;!Z(e)&&A(e)?null===(n=null===(t=i.plugins)||void 0===t?void 0:t.gioCustomTracking)||void 0===n||n.buildUserAttributesEvent(e):i.callError("setUserAttributes")},i.setUserId=function(e,t){if(_e(e)){var n=i.userStore.gioId;e=B(e).slice(0,1e3),t=B(t).slice(0,1e3),i.userStore.userId=e,i.vdsConfig.enableIdMapping&&(i.userStore.userKey=_(t)?"":t),i.reissueLogic(n,e)}else i.callError("setUserId")},i.clearUserId=function(){i.userStore.userId=void 0,i.userStore.userKey=void 0},i.track=function(e,t,n){var r,o;((null===(o=null===(r=i.plugins)||void 0===r?void 0:r.gioCustomTracking)||void 0===o?void 0:o.buildCustomEvent)||function(){})(e,c(c({},i.dataStore.generalProps),A(t)&&!Z(t)?t:{}),n)},i.reissueLogic=function(e,t){e&&e!==t&&(i.userStore.sessionId="",i.dataStore.sendVisit()),e||e===t||i.dataStore.sendVisit()},i.trackTimerStart=function(e){return!!i.vdsConfig.dataCollect&&ie(e,(function(){var t=re();return i.dataStore.trackTimers[t]={eventName:e,leng:0,start:+Date.now()},t}))},i.trackTimerPause=function(e){if(e&&i.dataStore.trackTimers[e]){var t=i.dataStore.trackTimers[e];return t.start&&(t.leng=t.leng+(+Date.now()-t.start)),t.start=0,!0}return!1},i.trackTimerResume=function(e){if(e&&i.dataStore.trackTimers[e]){var t=i.dataStore.trackTimers[e];return 0===t.start&&(t.start=+Date.now()),!0}return!1},i.trackTimerEnd=function(e,t){if(i.vdsConfig.dataCollect){if(e&&i.dataStore.trackTimers[e]){var n=i.dataStore.trackTimers[e];if(0!==n.start){var r=+Date.now()-n.start;n.leng=r>0?n.leng+r:0}return i.track(n.eventName,c(c({},t),{event_duration:n.leng>864e5?0:n.leng/1e3})),i.removeTimer(e),!0}return ee("未查找到对应的计时器，请检查!","error"),!1}return!1},i.removeTimer=function(e){return!(!e||!i.dataStore.trackTimers[e]||(delete i.dataStore.trackTimers[e],0))},i.clearTrackTimer=function(){i.dataStore.trackTimers={}},i.dataStore=new $e(i),x(null===(t=i.minipInstance.minip)||void 0===t?void 0:t.onAppHide)&&i.minipInstance.minip.onAppHide((function(){$(i.dataStore.trackTimers,(function(e){e.start&&(e.leng=e.leng+(+Date.now()-e.start))}))})),x(null===(n=i.minipInstance.minip)||void 0===n?void 0:n.onAppShow)&&i.minipInstance.minip.onAppShow((function(){$(i.dataStore.trackTimers,(function(e){e.start&&(e.start=+Date.now())}))})),i.emitter.on("OPTION_CHANGE",(function(e){var t=e.optionName,n=e.optionValue;"dataCollect"===t&&!1===n&&i.clearTrackTimer()})),i}return l(t,e),t}((function(){var e,t=this;this.init=function(e){return ee("Gio小程序SDK 初始化中...","info"),t.dataStore.initOptions(e),t.gioSDKInitialized=!0,t.vdsConfig.subpackage||(he().__gio__=function(){return t}),null==t||t.initCallback(),t.emitter.emit("SDK_INITIALIZED",t),ee("Gio小程序SDK 初始化完成！","success"),t.vdsConfig.forceLogin&&ee("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),t.inPlugin&&t.dataStore.sendVisit(),!0},this.setDataCollect=function(e){t.setOption("dataCollect",!!e),t.notRecommended()},this.setAutotrack=function(e){t.setOption("autotrack",!!e),t.notRecommended()},this.enableDebug=function(e){t.setOption("debug",!!e),t.notRecommended()},this.setOption=function(e,n){if(w.includes(e)){var i=t.dataStore.setOption(e,n);return i&&b[e]&&ee("已"+(n?"开启":"关闭")+b[e],"info"),i}return ee("不存在可修改的配置项："+e+"，请检查后重试!","warn"),!1},this.getDeviceId=function(){return t.userStore.uid},this.getOption=function(e){return t.dataStore.getOption(e)},this.getGioInfo=function(){var e=t.userStore,n=e.uid,i=e.userId,r=e.userKey,o=e.sessionId,a=e.gioId,u=t.vdsConfig,s=u.projectId,l=u.appId,c=u.dataSourceId,g=u.dataCollect,d=u.enableIdMapping,p=u.extraParams,f=u.ignoreFields,v={gioappid:l,giocs1:i||"",gioplatform:t.platformConfig.platform,gioprojectid:s,gios:o,giou:n};return"cdp"===t.gioEnvironment&&(v.giodatacollect=g,v.giodatasourceid=c,v.gioid=a||"",d&&(v.giouserkey=r),Z(p)||p.forEach((function(e){f.includes(e)||(v["gio"+e]=t.dataStore.lastVisitEvent[e])}))),He.stringify(v)},this.setLocation=function(e,n){var i={latitude:e,longitude:n},r=t.dataStore.locationData,o=function(e){return e>=-180&&180>=e};o(e)&&o(n)&&(r.latitude!==e||r.longitude!==n)&&(t.dataStore.locationData=i,t.dataStore.sendVisit())},this.setGeneralProps=function(e){A(e)&&!Z(e)?(t.dataStore.generalProps=c(c({},t.dataStore.generalProps),e),G(t.dataStore.generalProps).forEach((function(e){[void 0,null].includes(t.dataStore.generalProps[e])&&(t.dataStore.generalProps[e]="")}))):t.callError("setGeneralProps")},this.clearGeneralProps=function(e){N(e)&&!Z(e)?e.forEach((function(e){z(t.dataStore.generalProps,e)})):t.dataStore.generalProps={}},this.setPageAttributes=function(e){var n=t.dataStore.eventHooks.currentPage,i=t.minipInstance.getCurrentPath();["onLoad","attached"].includes(n.currentLifecycle)&&(n.pageProps[i]=Ie(e))},this.updateImpression=function(){ee("当前未集成半自动浏览插件，请集成插件后再调用 updateImpression!","warn")},this.notRecommended=function(){return ee("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info")},this.callError=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),ee((t?"调用":"设置")+" "+e+" 失败，"+n+"!","warn")},this.utils=c(c(c({},Y),Te),{qs:He}),this.emitter={all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map((function(e){e(n)})),(i=e.get("*"))&&i.slice().map((function(e){e(t,n)}))}},this.gioPlatform="quickapp",this.gioFramework="",this.gioEnvironment="cdp",this.sdkVersion="3.8.21";try{"quickapp"===this.gioPlatform||x(getApp)&&x(App)?this.inPlugin=!1:this.inPlugin=!0}catch(e){this.inPlugin=!0}this.inPlugin&&ee("未检测到小程序实例，自动切换为插件模式!","info"),this.platformConfig=De,this.minipInstance=new je(this),this.userStore=new qe(this),this.plugins=new Ne(this),this.plugins.innerPluginInit()}))),ze=function(){var e,t=arguments[0];if(C(t)&&S.includes(t)&&We[t]){var n=j(Array.from(arguments));if("init"===t){var i=!(e=We).vdsConfig&&!e.gioSDKInitialized||(ee("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1),r=function(e){return!!H(e)||(ee('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", "你的应用 AppId", options); 进行初始化!',"error"),!1)}(n),o=function(e){var t=e[0],n=D(e);return _e(t)?(A(n)&&n||(n={}),{projectId:t,userOptions:n}):(ee("SDK初始化失败，accountId 参数不合法!","error"),!1)}(n),a=function(e){var t=e[1],n=e[2],i=D(e);return t&&C(t)?_e(n)?{dataSourceId:t,appId:n,cdpOptions:i}:(ee("SDK初始化失败，appId 参数不合法!","error"),!1):(ee("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)}(n);if(i&&r&&o&&a){var u=o.projectId,s=a.dataSourceId,l=a.appId,g=a.cdpOptions;return We.init(c(c({},g),{projectId:u,dataSourceId:s,appId:l}))}}else if("registerPlugins"===t)We.registerPlugins(n[0]);else{if(We.gioSDKInitialized&&We.vdsConfig)return We[t].apply(We,n);ee("SDK未初始化!","error")}}else O.includes(t)?ee("方法 "+B(t)+" 已被弃用!","warn"):ee("不存在名为 "+B(t)+" 的方法调用!","error")};me().gdp=ze,me().gioEnvironment="cdp",me().gioSDKVersion=We.sdkVersion;export default ze;
