const e={autotrack:{type:"boolean",default:!0},cml:{type:"object",default:!1},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},subpackage:{type:"boolean",default:!1},keepAlive:{type:"number",default:3e5},remax:{type:["object","module"],default:!1},taro:{type:["object","module"],default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},uniVue:{type:["object","function"],default:!1},version:{type:"string",default:"1.0.0"},wepy:{type:"function",default:!1}},t={compress:{type:"boolean",default:!0},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},gtouchHost:{type:"string",default:"cdp.growingio.com"},host:{type:"string",default:"cdp-api.growingio.com"},ignoreFields:{type:"array",default:[]},scheme:{type:"string",default:"https"},uploadInterval:{type:"number",default:1e3},performance:{type:"object",default:{monitor:!0,exception:!0}}},i={},n=["clearUserId","enableDebug","getGioInfo","getOption","identify","init","setAutotrack","setDataCollect","setOption","setUserId","track","setLocation","setGeneralProps","clearGeneralProps","setPageAttributes","updateImpression","setEvar","setPage","setUser","setVisitor"],s=["autotrack","dataCollect","debug","host","scheme"],o={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式"},r=["setConfig","collectImp","setPlatformProfile","getLocation"],a=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],l=[...a,"appChannel","language","platformVersion"],g=e=>["undefined","null"].includes(q(e)),u=e=>"string"===q(e),d=e=>"number"===q(e),c=e=>"boolean"===q(e),h=e=>"[object Object]"==={}.toString.call(e)&&!g(e),p=e=>"function"===q(e),v=e=>Array.isArray(e)&&"array"===q(e),m=e=>{try{return Array.from(e)[0]}catch(e){return}},I=e=>{try{const t=Array.from(e);return t[t.length-1]}catch(e){return}},f=(e,t=1)=>v(e)&&d(t)?e.slice(t>0?t:1,e.length):e,y=e=>{if(v(e)){let t=0;const i=[];for(const n of e)n&&!x(n)&&(i[t++]=n);return i}return e},S=(e,t)=>{if(v(e)){const i=e.findIndex(t);return 0>i?void 0:e[i]}},O=e=>g(e)?"":""+e,b=(e,t)=>"string"===q(e)?e.split(t):e,w=e=>{if(u(e)){const t=b(e,"");return`${m(t).toLowerCase()}${f(t).join("")}`}return e},T={}.hasOwnProperty,C=(e,t)=>!g(e)&&T.call(e,t),E=e=>h(e)?Object.keys(e):[],P=(e,t)=>{E(e).forEach((i=>t(e[i],i)))},k=(e,t)=>{const i=E(e);return!(!h(e)||!h(t)||i.length!==E(t).length||i.map(((i,n)=>h(e[i])?k(e[i],t[i]):e[i]===t[i])).includes(!1))},_=(e,t,i)=>{let n=e;return h(e)?(t.split(".").forEach((e=>{n=n?n[e]:i})),n):i},A=(e,t)=>{if(!h(e))return!1;try{if("string"===q(t))return delete e[t];if("array"===q(t))return t.map((t=>delete e[t]));"object"===q(t)&&t.constructor===RegExp&&E(e).forEach((i=>{t.test(i)&&A(e,i)}))}catch(e){return!1}},N=(e,t=250,i,n)=>{let s,o=0;return"boolean"!==q(i)&&(n=e,e=i,i=void 0),function(...r){let a=this,l=Date.now()-o;function g(){o=Date.now(),e.apply(a,r)}n&&!s&&g(),s&&clearTimeout(s),void 0===n&&l>t?g():!0!==i&&(s=setTimeout(n?function(){s=void 0}:g,void 0===n?t-l:t))}},x=e=>v(e)?0===e.length:h(e)?0===E(e).length:!e,q=e=>({}.toString.call(e).slice(8,-1).toLowerCase());var j=Object.freeze({__proto__:null,isNil:g,isString:u,isNumber:d,isBoolean:c,isObject:h,isRegExp:e=>"[object RegExp]"==={}.toString.call(e),isFunction:p,isArray:v,isDate:e=>"date"===q(e),fixed:(e,t)=>d(e)?Number(e.toFixed(d(t)?t:2)):u(e)&&"NaN"!==O(Number(e))?Number(Number(e).toFixed(d(t)?t:2)):e,head:m,last:I,drop:f,dropWhile:(e,t)=>v(e)?e.filter((e=>!t(e))):e,compact:y,find:S,toString:O,split:b,lowerFirst:w,upperFirst:e=>{if(u(e)){const t=b(e,"");return`${m(t).toUpperCase()}${f(t).join("")}`}return e},startsWith:(e,t)=>e.slice(0,t.length)===t,endsWith:(e,t)=>{const{length:i}=e;let n=i;n>i&&(n=i);const s=n;return n-=t.length,n>=0&&e.slice(n,s)===t},hasOwnProperty:T,has:C,keys:E,forEach:P,isEqual:k,get:_,unset:A,throttle:N,isEmpty:x,typeOf:q,formatDate:e=>{function t(e){return 10>e?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}}),F={},L={}.hasOwnProperty;function H(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function V(e){try{return encodeURIComponent(e)}catch(e){return null}}F.stringify=function(e,t){t=t||"";var i,n,s=[];for(n in"string"!=typeof t&&(t="?"),e)if(L.call(e,n)){if((i=e[n])||null!=i&&!isNaN(i)||(i=""),n=V(n),i=V(i),null===n||null===i)continue;s.push(n+"="+i)}return s.length?t+s.join("&"):""},F.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,n={};t=i.exec(e);){var s=H(t[1]),o=H(t[2]);null===s||null===o||s in n||(n[s]=o)}return n};const D=(e,t)=>{console.log("%c[GrowingIO]："+e,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},R=e=>{try{return e()}catch(e){return}},B=e=>u(e)?e.trim().substring(0,100):e,U=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),$=e=>e.pixelRatio?Math.round(e.screenHeight*e.pixelRatio):e.screenHeight,K=e=>e.pixelRatio?Math.round(e.screenWidth*e.pixelRatio):e.screenWidth,G=(e,t)=>{if(e){const i=e.toLowerCase();return-1!==i.indexOf("android")?t+"-Android":-1!==i.indexOf("ios")?t+"-iOS":e}},M=(e="",t="")=>{const i=e=>e.replace(/\s+/g,""),n=e=>e.replace(/[vV]/g,""),s=i(n(e)),o=i(n(t)),r=s.split("."),a=o.split(".");for(let e=0;3>e;e++){let t=Number(r[e]),i=Number(a[e]);if(t>i)return 1;if(i>t)return-1;if(!isNaN(t)&&isNaN(i))return 1;if(isNaN(t)&&!isNaN(i))return-1}return 0},Q=e=>{if(e){const t=Number.parseInt(m(b(e.version,".")),10);return Number.isNaN(t)?0:t}return 0},W=e=>{if(u(e)){const t=e.indexOf("?");return-1!==t?[e.substring(0,t),e.substring(t+1)]:[e,""]}return["",""]},J=e=>u(e)?e.startsWith("/")?e:"/"+e:"",z=e=>{const{Current:t,createComponent:i}=e;return!(!e||!t||i)},X=e=>R((()=>{switch(e){case"wx":return wx;case"my":return my;case"swan":return swan;case"tt":return tt;case"qq":return qq;case"ks":return ks;case"jd":return jd;default:{let e;return e||(e=R((()=>swan))),e||(e=R((()=>my))),e||(e=R((()=>tt))),e||(e=R((()=>qq))),e||(e=R((()=>ks))),e||(e=R((()=>wx))),e}}})),Z=e=>E(e).filter((e=>e.indexOf("__sub")>-1&&e.indexOf("gio__")>-1)).sort(),Y=()=>{let e=R((()=>getApp({allowDefault:!0})));return e||(e=ee()),e},ee=()=>{var e;return null!==(e=R((()=>$global)))&&void 0!==e?e:global},te=e=>{const t={};return h(e)&&P(e,((e,i)=>{const n=O(i).slice(0,100);h(e)?t[n]=te(e):v(e)?(t[n]=e.slice(0,100),"cdp"===ee().gioEnvironment?t[n]=t[n].join("||"):t[n]=O(t[n])):t[n]=g(e)?"":O(e).slice(0,1e3)})),t},ie=(e,t)=>{try{return e.minip.batchGetStorageSync(t)}catch(i){return t.map((t=>e.getStorageSync(t)))}},ne=(e,t)=>{try{return e.minip.batchSetStorageSync(t)}catch(i){return t.map((({key:t,value:i})=>e.setStorageSync(t,i)))}};var se=Object.freeze({__proto__:null,consoleText:D,niceTry:R,limitString:B,eventNameValidate:(e,t)=>u(e)&&!x(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():(D("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1),guid:U,getScreenHeight:$,getScreenWidth:K,getOS:G,compareVersion:M,getVueVersion:Q,clearShareQuery:e=>{if(!e)return;const t=F.parse(e);return delete t.shareId,delete t.contentType,F.stringify(t)},splitPath:W,normalPath:J,isTaro3:z,getPlainMinip:X,getPlainPlatform:()=>{let e;return!e&&R((()=>swan))&&(e="swan"),!e&&R((()=>tt))&&(e="tt"),!e&&R((()=>qq))&&(e="qq"),!e&&R((()=>my))&&(e="my"),!e&&R((()=>ks))&&(e="ks"),!e&&R((()=>jd))&&(e="jd"),!e&&R((()=>wx))&&(e="wx"),e||S(E(global),(e=>O(e).toLowerCase().includes("quickapp")))&&(e="quickapp"),e},getSubKeys:Z,getAppInst:Y,getGlobal:ee,limitObject:te,batchGetStorageSync:ie,batchSetStorageSync:ne});const oe=e=>u(e)&&e.length>0||d(e)&&e>0,re=e=>!e.vdsConfig&&!e.gioSDKInitialized||(D("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1),ae=e=>!!y(e)||(D('SDK初始化失败，请使用 gio("init", "您的GrowingIO项目 accountId", "你的应用 AppId", options); 进行初始化!',"error"),!1),le=e=>{const t=e[0];let i=I(e);return oe(t)?(h(i)&&i||(i={}),{projectId:t,userOptions:i}):(D("SDK初始化失败，accountId 参数不合法!","error"),!1)},ge=e=>{let t=e[1];return oe(t)?{appId:t}:(D("SDK初始化失败，appId 参数不合法!","error"),!1)};let ue;var de={name:"gioTaobaoSendAdapter",method:class{constructor(e){this.growingIO=e,this.singleInvoke=()=>{const{vdsConfig:e,emitter:t,uploader:i}=this.growingIO,n=[...i.hoardingQueue,...i.requestQueue].filter((e=>(i.retryIds[e.globalSequenceId||e.esid]||0)<i.retryLimit));if(ue.isEmpty(n))return;let s=n.shift();e.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(s,null,2)),t.emit("onSendBefore",{requestData:s}),this.cloudFuncInvoke(s)},this.cloudFuncInvoke=e=>{var t,i;const{vdsConfig:n,emitter:s,uploader:o}=this.growingIO;let r;try{r=getApp()}catch(e){r=$global}if(r||(r=$global),null===(i=null===(t=null==r?void 0:r.cloud)||void 0===t?void 0:t.function)||void 0===i?void 0:i.invoke){const{host:t,projectId:i,tbConfig:a}=n;o.requestingNum+=1,null==r||r.cloud.function.invoke(a.cloudFuncName,{domain:t,path:`/v3/projects/${i}/collect`,params:{stm:Date.now()},body:e},a.cloudFuncHandler).then((t=>{o.requestingNum-=1,t.success?s.emit("onSendAfter",{result:t}):(o.requestFailFn(e),ue.consoleText("请求失败! "+JSON.stringify(t),"error")),o.initiateRequest()})).catch((t=>{o.requestingNum-=1,o.requestFailFn(e),ue.consoleText("请求失败! "+JSON.stringify(t),"error"),o.initiateRequest()}))}else ue.consoleText("请求失败!当前应用不支持淘宝云函数!","error")},ue=this.growingIO.utils}tbCloudAppInvoke(e){var t,i;const{vdsConfig:n,emitter:s,uploader:o}=this.growingIO;let r;try{r=getApp()}catch(e){r=$global}if(r||(r=$global),null===(i=null===(t=null==r?void 0:r.cloud)||void 0===t?void 0:t.application)||void 0===i?void 0:i.httpRequest){const{host:t,projectId:i,tbConfig:a}=n;o.requestingNum+=1,r.cloud.application.httpRequest({path:a.path,method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},params:{host:t,projectId:i,stm:Date.now()},body:e,exts:{cloudAppId:a.cloudAppId}}).then((t=>{o.requestingNum-=1,t.success?s.emit("onSendAfter",{result:t}):(ue.isArray(e)?e.forEach((e=>{o.requestFailFn(e)})):o.requestFailFn(e),ue.consoleText("请求失败! "+JSON.stringify(t),"error")),o.initiateRequest()})).catch((t=>{o.requestingNum-=1,ue.isArray(e)?e.forEach((e=>{o.requestFailFn(e)})):o.requestFailFn(e),ue.consoleText("请求失败! "+JSON.stringify(t),"error"),o.initiateRequest()}))}else ue.consoleText("请求失败!当前应用不支持淘宝云应用!","error")}}};function ce(e,t,i,n){return new(i||(i=Promise))((function(s,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}let he;var pe={name:"gioImpressionTracking",method:class{constructor(e){this.growingIO=e,this.main=(e,t)=>{var i,n,s;const{vdsConfig:o,minipInstance:r,gioPlatform:a}=this.growingIO,{uniVue:l}=o,g=Q(l);l&&2===g&&(e=e.$vm.$scope),this.impressionObserver&&this.impressionObserver.disconnect(),"my"===a?-1>M(my.SDKVersion,"2.7.0")||(this.impressionObserver=null===(i=r.minip)||void 0===i?void 0:i.createIntersectionObserver({[t]:!0,dataset:!0})):e.isComponent?this.impressionObserver=e.createIntersectionObserver({[t]:!0}):this.impressionObserver=null===(n=r.minip)||void 0===n?void 0:n.createIntersectionObserver(e,{[t]:!0}),null===(s=this.growingIO.minipInstance.minip)||void 0===s||s.createSelectorQuery().select(".growing_collect_imp").boundingClientRect((t=>{t&&this.creatObserver(e)})).exec()},this.creatObserver=e=>{var t;const{vdsConfig:{taro:i},gioPlatform:n}=this.growingIO,s=null===(t=this.impressionObserver)||void 0===t?void 0:t.relativeToViewport();null==s||s.observe(".growing_collect_imp",(t=>ce(this,void 0,void 0,(function*(){if(!he.isEmpty(t)&&t.intersectionRatio>0){let s=t.dataset;i&&z(i)&&(s=this.getTaro3Dataset(e.route,t.id)),"ks"===n&&(yield this.getKsDataset(t).then((e=>s=e)));const o=this.getImpressionProperties(s),r=t.id;if(r){if("once"===s.gioImpType&&he.has(this.sentImps,r))return;this.sentImps[r]=o}o.eventId?this.buildImpEvent(o):he.consoleText("曝光事件格式不正确，事件名只能包含数字、字母和下划线，且不以数字开头!","warn")}}))))},this.getImpressionProperties=e=>{let t={eventId:void 0,properties:{}};if(!(null==e?void 0:e.gioImpTrack))return t;if(t.eventId=e.gioImpTrack,he.has(e,"gioImpAttrs"))t.properties=he.niceTry((()=>he.isObject(e.gioImpAttrs)?e.gioImpAttrs:JSON.parse(e.gioImpAttrs))),t.items=he.niceTry((()=>he.isObject(e.gioImpItems)?e.gioImpItems:JSON.parse(e.gioImpItems)));else{const i=/^gioTrack(.+)/;for(const n in e){let s;const o=n.match(i);o&&(s=he.lowerFirst(o[1]),"track"!==s&&(t.properties[s]=e[n]))}}return t.properties=he.limitObject(t.properties),t.items=he.limitObject(t.items),/^\w+$/.test(t.eventId)&&!Number.isInteger(Number.parseInt(he.head(t.eventId.split("")),10))||(t.eventId=null,t={}),t},this.getTaro3Dataset=(e,t)=>{var i;const n=null===(i=this.growingIO)||void 0===i?void 0:i.taro3VMs[e];if(!n)return!1;let s={};const o=e=>{e.some((e=>{var i;return e.uid===t&&(null===(i=e.props)||void 0===i?void 0:i.class.indexOf("growing_collect_imp"))>-1&&!he.isEmpty(e.dataset)?(s=e.dataset,!0):!!Array.isArray(e.childNodes)&&o(e.childNodes)}))};return o(n.childNodes),s},this.getKsDataset=e=>{const{minipInstance:t}=this.growingIO,i=t.minip.createSelectorQuery().selectAll(".growing_collect_imp"),{width:n,height:s}=e.boundingClientRect;return new Promise((e=>{i.boundingClientRect((t=>{const i=t.find((e=>he.fixed(n)===he.fixed(e.width)&&he.fixed(s)===he.fixed(e.height)));e((null==i?void 0:i.dataset)||{})})).exec()}))},this.buildImpEvent=e=>{const{eventId:t,properties:i,items:n}=e,{dataStore:{eventContextBuilder:s,eventInterceptor:o,eventHooks:r}}=this.growingIO;o(Object.assign({eventType:"CUSTOM",pageShowTimestamp:r.currentPage.time,eventName:t,attributes:i,resourceItem:n},s()))},he=this.growingIO.utils,this.growingIO.updateImpression=()=>{this.main(this.growingIO.minipInstance.getCurrentPage(),"observeAll")},this.sentImps={}}}};let ve;var me={name:"gioEventAutoTracking",method:class{constructor(e){this.growingIO=e,this.main=(e,t)=>{var i,n;const{vdsConfig:s,platformConfig:o,plugins:r,emitter:a}=this.growingIO;if(!s.autotrack||!t||ve.get(e,"currentTarget.dataset.growingIgnore")||ve.get(e,"target.dataset.growingIgnore")||!ve.get(e,"target.dataset.growingTrack")&&"autoplay"===ve.get(e,"detail.source")||e.type===(null===(i=this.prevEvent)||void 0===i?void 0:i.type)&&10>Math.abs(Number(e.timeStamp)-Number(null===(n=this.prevEvent)||void 0===n?void 0:n.timeStamp)))return;if(this.prevEvent=e,s.uniVue&&(t=null==r?void 0:r.gioUniAppAdapter.getHandlerName(t,e)),s.taro&&["eh"].includes(t))return;if(s.cml&&["_cmlEventProxy","onclick","blurEvent","handleDetail"].includes(t))return;s.remax&&t.indexOf("$$REMAX_METHOD")>-1&&(t=null==r?void 0:r.gioRemaxAdapter.getHandlerName(t)),s.debug&&console.log("Action：",e.type,Date.now()),a.emit("onComposeBefore",{event:t,params:null!=e?e:{}});const l=o.listeners.actions;l.click.includes(e.type)?this.buildClickEvent(e,t):l.change.includes(e.type)?this.buildChangeEvent(e,t):l.submit.includes(e.type)&&this.buildSubmitEvent(e,t)},this.getNodeXpath=(e,t)=>{const{gioPlatform:i,vdsConfig:n}=this.growingIO;let s=(e.currentTarget||e.target).id;if((!s||"swan"===i&&/^_[0-9a-f]+/.test(s)||z(n.taro)&&/^_n_[0-9]+$/.test(s))&&(s=""),!n.octopus||(t=e.handler,/^bound .*/.test(t)&&(t=t.replace("bound ","")),/^t[0-9]+$/.test(s)&&(s=""),s&&!t&&(t="anonymousFunc"),s||t))return`${s}#${t}`},this.buildClickEvent=(e,t)=>{var i,n,s;const o=this.getNodeXpath(e,t);if(o){const{dataStore:{eventContextBuilder:t,eventInterceptor:r,eventHooks:a},gioEnvironment:l}=this.growingIO,g=e.currentTarget||e.target;let u;ve.has(null==g?void 0:g.dataset,"index")&&""!==(null===(i=null==g?void 0:g.dataset)||void 0===i?void 0:i.index)&&(u=Number.parseInt(g.dataset.index,10),Number.isNaN(u)&&(u=-1)),r(Object.assign({eventType:"saas"===l&&e.type.includes("long")?"lngprss":"VIEW_CLICK",pageShowTimestamp:a.currentPage.time,element:[{xpath:o,index:u,textValue:null===(n=null==g?void 0:g.dataset)||void 0===n?void 0:n.title,hyperlink:null===(s=null==g?void 0:g.dataset)||void 0===s?void 0:s.src}]},t()))}},this.buildTabClickEvent=e=>{const{dataStore:{eventContextBuilder:t,eventInterceptor:i,eventHooks:n}}=this.growingIO;i(Object.assign({eventType:"VIEW_CLICK",pageShowTimestamp:n.currentPage.time,element:[{xpath:"#onTabItemTap",textValue:e.text,index:e.index,hyperlink:ve.toString(e.pagePath)}]},t()))},this.buildChangeEvent=(e,t)=>{var i,n;const s=this.getNodeXpath(e,t);if(s){const{dataStore:{eventContextBuilder:t,eventInterceptor:o,eventHooks:r}}=this.growingIO,a=e.currentTarget||e.target,l=Object.assign({eventType:"VIEW_CHANGE",pageShowTimestamp:r.currentPage.time,element:{xpath:s}},t()),g=ve.get(e,"detail.value")||ve.get(e,"target.attr.value");((null===(i=null==a?void 0:a.dataset)||void 0===i?void 0:i.growingTrack)||(null===(n=null==a?void 0:a.dataset)||void 0===n?void 0:n.growingtrack))&&(ve.isNil(g)||(l.element.textValue=ve.toString(g))),l.element=[l.element],o(l)}},this.buildSubmitEvent=(e,t)=>{const i=this.getNodeXpath(e,t);if(i){const{dataStore:{eventContextBuilder:e,eventInterceptor:t,eventHooks:n}}=this.growingIO;t(Object.assign({eventType:"FORM_SUBMIT",pageShowTimestamp:n.currentPage.time,element:[{xpath:i}]},e()))}},ve=this.growingIO.utils,this.prevEvent={}}}};let Ie;const fe={};function ye(e,t,i){var n=e;t.map((function(e,s){n[e]=s==t.length-1?i:n[e]||{},n=n[e]}))}ye(fe,["plugins","gioCustomTracking"],{name:"gioCustomTracking",method:class{constructor(e){this.growingIO=e,this.getDynamicAttributes=e=>(Ie.isNil(e)||Ie.keys(e).forEach((t=>{Ie.isFunction(e[t])?e[t]=e[t]():Ie.isArray(e[t])||(e[t]=Ie.toString(e[t]))})),e),this.buildCustomEvent=(e,t)=>{Ie.eventNameValidate(e,(()=>{var i;const{dataStore:{eventContextBuilder:n,eventInterceptor:s,eventHooks:o}}=this.growingIO;s(Object.assign({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null===(i=null==o?void 0:o.currentPage)||void 0===i?void 0:i.time,attributes:Ie.limitObject(this.getDynamicAttributes(Ie.isObject(t)&&!Ie.isEmpty(t)?t:void 0))},n()))}))},Ie=this.growingIO.utils}buildVisitorVariable(e){if(Ie.isObject(e)&&!Ie.isEmpty(e)){const{dataStore:{lastVisitEvent:t,eventContextBuilder:i,eventInterceptor:n}}=this.growingIO,s=Object.assign({eventType:"vstr",attributes:Ie.limitObject(e)},i());s.path||(s.path=t.path,s.query=t.query,s.title=t.title),n(s)}}buildPeopleVariable(e){if(this.growingIO.userStore.uid&&Ie.isObject(e)&&!Ie.isEmpty(e)){const{dataStore:{lastVisitEvent:t,eventContextBuilder:i,eventInterceptor:n}}=this.growingIO,s=Object.assign({eventType:"ppl",properties:Ie.limitObject(e)},i());s.path||(s.path=t.path,s.query=t.query,s.title=t.title),n(s)}}buildPageLevelVariable(e){if(Ie.isObject(e)&&!Ie.isEmpty(e)){const{dataStore:{eventContextBuilder:t,eventInterceptor:i,eventHooks:n}}=this.growingIO;i(Object.assign({eventType:"pvar",pageShowTimestamp:n.currentPage.time,properties:Ie.limitObject(e)},t()))}}buildConversionVariable(e){if(Ie.isObject(e)&&!Ie.isEmpty(e)){const{dataStore:{eventContextBuilder:t,eventInterceptor:i}}=this.growingIO;i(Object.assign({eventType:"evar",properties:Ie.limitObject(e)},t()))}}}}),ye(fe,["plugins","gioEventAutoTracking"],me),ye(fe,["plugins","gioImpressionTracking"],pe),ye(fe,["plugins","gioTaobaoSendAdapter"],de);class Se{constructor(e){this.growingIO=e,this.innerPluginInit=()=>{E(fe.plugins).forEach((e=>{const{name:t,method:i}=fe.plugins[e];this.pluginItems.find((e=>e.name===t))||this.pluginItems.push({name:w(t||e),method:i||(e=>{})})})),x(this.pluginItems)||this.installAll()},this.install=(e,t,i)=>{var n;const s=t||this.pluginItems.find((t=>t.name===e));if(null===(n=this.growingIO)||void 0===n?void 0:n.plugins[e])return D(`重复加载插件 ${e} 或插件重名，已跳过加载!`,"warn"),!1;if(!s)return D(`插件加载失败!不存在名为 ${e} 的插件!`,"error"),!1;try{return this.growingIO.plugins[e]=new s.method(this.growingIO,i),"cdp"===this.growingIO.gioEnvironment&&t&&D("加载插件："+e,"info"),!0}catch(e){return D("插件加载异常："+e,"error"),!1}},this.installAll=e=>{(e||this.pluginItems).forEach((t=>this.install(t.name,e?t:void 0,t.options)))},this.uninstall=e=>{var t;A(this.pluginItems,e);const i=A(null===(t=this.growingIO)||void 0===t?void 0:t.plugins,e);return i||D(`卸载插件 ${e} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((e=>this.uninstall(e.name)))},this.lifeError=(e,t)=>D(`插件执行错误 ${e.name} ${t}`,"error"),this.onComposeBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeBefore;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onComposeAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeAfter;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendBefore;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendAfter;if(n&&p(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.pluginItems=[],this.growingIO.emitter.on("onComposeBefore",this.onComposeBefore),this.growingIO.emitter.on("onComposeAfter",this.onComposeAfter),this.growingIO.emitter.on("onSendBefore",this.onSendBefore),this.growingIO.emitter.on("onSendAfter",this.onSendAfter)}}class Oe{constructor(e){var t;this.growingIO=e,this.initUserInfo=()=>{const{minipInstance:e}=this.growingIO,t=[this.uidStorageName,this.userIdStorageName,this.userKeyStorageName,this.gioIdStorageName],i=ie(e,t);["_uid","_userId","_userKey","_gioId"].forEach(((e,t)=>{this[e]=i[t],"_uid"!==e||this[e]||(this.uid=U())}))},this.saveUserInfo=()=>{const{minipInstance:e}=this.growingIO;ne(e,[{key:this.uidStorageName,value:this.uid},{key:this.userIdStorageName,value:this.userId},{key:this.userKeyStorageName,value:this.userKey},{key:this.gioIdStorageName,value:this.gioId}])};const{inPlugin:i}=this.growingIO;this.uidStorageName=i?"_growing_plugin_uid_":"_growing_uid_",this.userIdStorageName=i?"_growing_plugin_userId_":"_growing_userId_",this.userKeyStorageName=i?"_growing_plugin_userKey_":"_growing_userKey_",this.gioIdStorageName=i?"_growing_plugin_gioId_":"_growing_gioId_",this._sessionId=U(),this._uid=void 0,this._userId=void 0,this._userKey=void 0,this._gioId=void 0,"quickapp"!==(null===(t=this.growingIO)||void 0===t?void 0:t.gioPlatform)&&this.initUserInfo()}get sessionId(){return this._sessionId||(this._sessionId=U()),this._sessionId}set sessionId(e){const t=this._sessionId;this._sessionId=e||U(),t!==this._sessionId&&this.growingIO.emitter.emit("SESSIONID_UPDATE",{newSessionId:this._sessionId,oldSessionId:t})}get uid(){return this._uid}set uid(e){const t=this._uid;this._uid=e,t!==this._uid&&(this.growingIO.minipInstance.setStorage(this.uidStorageName,this._uid),this.growingIO.emitter.emit("UID_UPDATE",{newUId:e,oldUId:t}))}get userId(){return this._userId}set userId(e){const t=this._userId;this._userId=e,t!==this._userId&&(this.growingIO.minipInstance.setStorage(this.userIdStorageName,this._userId),this.growingIO.emitter.emit("USERID_UPDATE",{newUserId:e,oldUserId:t})),e&&(this.gioId=e)}get userKey(){return this._userKey}set userKey(e){const t=this._userKey;this._userKey=e,t!==this._userKey&&(this.growingIO.minipInstance.setStorage(this.userKeyStorageName,this._userKey),this.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:t}))}get gioId(){return this._gioId}set gioId(e){const t=this._gioId;this._gioId=e,t!==this._gioId&&(this.growingIO.minipInstance.setStorage(this.gioIdStorageName,this._gioId),this.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:e,oldGioId:t}))}}const be={scnPrefix:"",appHandlers:["onLaunch","onShow","onHide","onError","onPageNotFound"],pageHandlers:["onLoad","onShow","onReady","onHide","onUnload","onShareAppMessage","onTabItemTap"],actionEventTypes:["onclick","tap","onTap","longpress","longTap","blur","change","onChange","submit","confirm","getuserinfo","getphonenumber","contact"],originalApp:R((()=>App)),originalPage:R((()=>Page)),originalComponent:R((()=>Component)),originalBehavior:R((()=>Behavior)),canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},listeners:{app:{appLaunch:"onLaunch",appShow:"onShow",appClose:"onHide"},page:{pageLoad:"onLoad",pageShow:"onShow",pageReady:"onReady",pageHide:"onHide",pageUnload:"onUnload",tabTap:"onTabItemTap",shareApp:"onShareAppMessage"},actions:{click:["onclick","tap","longpress","longTap","getuserinfo","getphonenumber","contact"],change:["blur","change","confirm"],submit:["submit"]}}},we=Object.assign(Object.assign({},be),{listeners:Object.assign({},be.listeners),name:"Alipay",platform:"alip",scnPrefix:"alip_",hooks:Object.assign(Object.assign({},null==be?void 0:be.hooks),{Behavior:!1})});class Te extends class{constructor(e){this.growingIO=e,this.minip=X("my"),this.hookSetTitle=()=>{var e;const t=null===(e=this.minip)||void 0===e?void 0:e.setNavigationBarTitle,i=this;t&&Object.defineProperty(this.minip,"setNavigationBarTitle",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){const e=i.getCurrentPath(),t=i.growingIO.dataStore.eventHooks.currentPage.path,{title:n}=arguments[0]||{};t!==e&&(i.growingIO.dataStore.eventHooks.currentPage.settedTitle[e]=n)}return t.apply(this,arguments)}})},this.navigateTo=e=>{var t;return null===(t=this.minip)||void 0===t?void 0:t.navigateTo(e)},this.switchTab=e=>{var t;null===(t=this.minip)||void 0===t||t.switchTab(e)},this.navigateToMiniProgram=e=>{var t;return null===(t=this.minip)||void 0===t?void 0:t.navigateToMiniProgram(e)},this.getImageInfo=({src:e,success:t,fail:i,complete:n})=>{var s;return null===(s=this.minip)||void 0===s?void 0:s.getImageInfo({src:e,success:t,fail:i,complete:n})},this.initImpression=e=>{var t,i;null===(i=null===(t=this.growingIO.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===i||i.main(e,"observeAll")},this.getCurrentPage=()=>R((()=>I(getCurrentPages())))||{},this.getCurrentPath=()=>{const e=this.getCurrentPage();return(null==e?void 0:e.route)||(null==e?void 0:e.uri)||(null==e?void 0:e.__route__)||""},this.getPageTitle=e=>{var t,i;return u(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.gioPageTitle)?B(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.gioPageTitle):""},this.getStorageSync=e=>{var t;return null===(t=this.minip)||void 0===t?void 0:t.getStorageSync(e)},this.getStorage=e=>new Promise((t=>{var i;null===(i=this.minip)||void 0===i||i.getStorage({key:e,success:({data:e})=>t(e),fail:()=>t("")})})),this.setStorageSync=(e,t)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync(e,t)},this.setStorage=(e,t)=>{var i;null===(i=this.minip)||void 0===i||i.setStorage({key:e,data:t})},this.removeStorageSync=e=>{var t;null===(t=this.minip)||void 0===t||t.removeStorageSync(e)},this.removeStorage=e=>{var t;null===(t=this.minip)||void 0===t||t.removeStorage(e)},this.getNetworkType=()=>ce(this,void 0,void 0,(function*(){const e=this;return yield new Promise((t=>{var i;null===(i=this.minip)||void 0===i||i.getNetworkType({success:i=>{e.network=i,t(i)},fail:()=>t(null)})}))})),this.request=({url:e,data:t,header:i,timeout:n,method:s,success:o,fail:r,complete:a})=>{var l;const g=null===(l=this.minip)||void 0===l?void 0:l.request({url:e,data:t,header:i,headers:i,timeout:n,method:s,success:o,fail:r,complete:a}),u=setTimeout((()=>{null==g||g.abort(),clearTimeout(u)}),(n||1e4)+10);return g},this.getSystemInfo=()=>ce(this,void 0,void 0,(function*(){const e=this;return yield new Promise((t=>{var i;null===(i=this.minip)||void 0===i||i.getSystemInfo({success:i=>{e.systemInfo=i,t(i)},fail:()=>t(null)})}))})),this.getSetting=()=>new Promise((e=>{var t;null===(t=this.minip)||void 0===t||t.getSetting({success:e,fail:e})}));const{platformConfig:{platform:t,scnPrefix:i}}=this.growingIO;this.platform=t,this.scnPrefix=i,this.getNetworkType().then((()=>{var e;return null===(e=this.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()})),this.getSystemInfo().then((()=>{var e;return null===(e=this.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()}))}}{constructor(e){super(e),this.growingIO=e,this.hookSetTitle=()=>{var e;const t=null===(e=this.minip)||void 0===e?void 0:e.setNavigationBar,i=this;t&&Object.defineProperty(this.minip,"setNavigationBar",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){const e=i.getCurrentPath(),t=i.growingIO.dataStore.eventHooks.currentPage.path,{title:n}=arguments[0]||{};t!==e&&(i.growingIO.dataStore.eventHooks.currentPage.settedTitle[e]=n)}return t.apply(this,arguments)}})},this.initImpression=e=>{var t,i;null===(i=null===(t=this.growingIO.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===i||i.main(e,"selectAll")},this.getStorageSync=e=>{const{data:t}=my.getStorageSync({key:e});return t},this.setStorageSync=(e,t)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync({key:e,data:t})},this.hookSetTitle()}}const Ce={VISIT:"vst",PAGE:"page",CUSTOM:"cstm",VISITOR_ATTRIBUTES:"",LOGIN_USER_ATTRIBUTES:"",APP_CLOSED:"cls",VIEW_CLICK:"clck",VIEW_CHANGE:"chng",FORM_SUBMIT:"sbmt"},Ee={appChannel:"ch",appVersion:"cv",attributes:"var",dataSourceId:void 0,deviceBrand:"db",deviceId:"u",deviceModel:"dm",domain:"d",element:"e",eventName:"n",eventType:"t",globalSequenceId:"esid",hyperlink:"h",index:"idx",language:"l",latitude:"lat",longitude:"lng",networkState:"nt",operatingSystem:"os",pageShowTimestamp:"ptm",path:"p",platform:"b",platformVersion:"osv",properties:"var",query:"q",referralPage:"rp",screenHeight:"sh",screenWidth:"sw",sdkVersion:"av",sessionId:"s",textValue:"v",timestamp:"tm",title:"tl",userId:"cs1",userKey:void 0,xpath:"x"};class Pe{constructor(e){this.growingIO=e,this.main=e=>{var t,i,n,s,o;const{sdkVersion:r,vdsConfig:a,platformConfig:l,minipInstance:g,userStore:u,dataStore:{eventHooks:d,locationData:c,lastVisitEvent:h}}=this.growingIO,{systemInfo:p={},network:v={}}=g,{brand:m,model:I,platform:f,language:y,version:S}=p,O={appChannel:"scn:"+(d.scene||"NA"),appVersion:a.version,dataSourceId:a.dataSourceId,deviceBrand:m,deviceId:u.uid,deviceModel:I,deviceType:G(f,l.name),domain:a.appId,gioId:u.gioId,language:y,latitude:null==c?void 0:c.latitude,longitude:null==c?void 0:c.longitude,networkState:(null==v?void 0:v.networkType)||(null==v?void 0:v.type),operatingSystem:G(f,l.name),path:(null===(t=d.currentPage)||void 0===t?void 0:t.path)?null===(i=d.currentPage)||void 0===i?void 0:i.path:h.path,platform:l.platform,platformVersion:l.name+(S?" "+S:""),query:(null===(n=d.currentPage)||void 0===n?void 0:n.path)?null===(s=d.currentPage)||void 0===s?void 0:s.query:h.query,screenHeight:$(p),screenWidth:K(p),sdkVersion:r,sessionId:u.sessionId,title:(null===(o=d.currentPage)||void 0===o?void 0:o.title)||g.getPageTitle(g.getCurrentPage()),timestamp:Date.now(),userId:u.userId};return a.enableIdMapping&&(O.userKey=u.userKey),x(a.ignoreFields)||a.ignoreFields.forEach((e=>{A(O,e)})),x(e)?O:Object.assign(Object.assign({},O),e)}}}class ke{constructor(e){this.growingIO=e,this.main=(e,t)=>{var i,n;const s=Date.now(),{emitter:o,userStore:r,vdsConfig:a,platformConfig:l,dataStore:{eventHooks:g,lastVisitEvent:u,saveStorageInfo:d}}=this.growingIO;o.emit("minipLifecycle",{event:"App "+e,timestamp:s,params:null!==(i=t[0])&&void 0!==i?i:{}}),a.debug&&console.log("App:",e,s);const c=l.listeners.app;switch(o.emit("onComposeBefore",{event:"App "+e,params:null!==(n=t[0])&&void 0!==n?n:{}}),e){case c.appCreate:case c.appShow:if(x(u)&&t[0]){const{path:e="",query:i={}}=t[0];this.growingIO.dataStore.lastVisitEvent={path:e,query:F.stringify(i)}}this.parseScene(t),g.lastCloseTime?(Date.now()-g.lastCloseTime>g.keepAlive||g.lastScene&&g.scene!==g.lastScene)&&(r.sessionId="",g.currentPage.time=void 0,this.buildVisitEvent(t[0])):this.buildVisitEvent(t[0]);break;case c.appClose:g.lastScene=g.scene,g.lastCloseTime=Date.now(),d(),r.saveUserInfo(),this.buildCloseEvent(),this.growingIO.vdsConfig.forceLogin||this.growingIO.uploader.initiateRequest(!0)}},this.parseScene=e=>{var t;const{minipInstance:i,gioPlatform:n,emitter:s,dataStore:{eventHooks:o}}=this.growingIO,r=o.scene;let a;if("quickapp"===n){const{extra:e,type:t}=i.getAppSource();a=(null==e?void 0:e.scene)||t}else if(e.length>0){const i=e[0];(null===(t=null==i?void 0:i.query)||void 0===t?void 0:t.wxShoppingListScene)?a=i.query.wxShoppingListScene:(null==i?void 0:i.scene)?a=i.scene:o.scene="NA"}o.scene=a,a!==r&&s.emit("SCENE_UPDATE",{newScene:a,oldScene:r})},this.buildVisitEvent=e=>{const{dataStore:t}=this.growingIO,{eventContextBuilder:i,eventInterceptor:n}=t;n(Object.assign({eventType:"VISIT"},i({path:(null==e?void 0:e.path)||(null==e?void 0:e.p)||"",query:h(null==e?void 0:e.query)?F.stringify((null==e?void 0:e.query)||{}):(null==e?void 0:e.query)||(null==e?void 0:e.q)||""})))},this.buildCloseEvent=()=>{const{dataStore:{eventContextBuilder:e,eventInterceptor:t}}=this.growingIO;t(Object.assign({eventType:"APP_CLOSED"},e()))}}}class _e{constructor(e){this.growingIO=e,this.parsePage=(e,t)=>{var i;this.path=e.route||e.uri||e.__route__||(null===(i=null==e?void 0:e.$page)||void 0===i?void 0:i.fullPath)||"",x(t)?this.query=void 0:this.query=this.getQuery(t),this.time=Date.now(),this.title=this.settedTitle[this.path]||this.growingIO.minipInstance.getPageTitle(e||this.growingIO.minipInstance.getCurrentPage())},this.getQuery=e=>y(E(e||{})).filter((e=>"wxShoppingListScene"!==e)).map((t=>`${t}=${e[t]}`)).join("&"),this.saveShareId=e=>{(null==e?void 0:e.gioShareId)&&(this.queryShareId=e.gioShareId)},this.updateShareResult=(e,t)=>{const[i,n,s]=this.buildShareQuery(e,t);return t.path=J(i+(n?"?"+n:"")),t.attributes=s,t.query=n,t},this.updateAppMessageResult=this.updateShareResult,this.updateTimelineResult=this.updateShareResult,this.updateAddFavoritesResult=(e,t)=>{const[i,n]=this.buildShareQuery(e,t,!1);return t.path=J(i+(n?"?"+n:"")),t.query=n,t},this.query=void 0,this.settedTitle={},this.pageProps={}}buildShareQuery(e,t,i=!0){const{userStore:n}=e;let[s,o]=W(C(t,"path")?t.path:this.path);const r=F.parse(t.query||o||this.query||"")||{};if(!i)return[s,F.stringify(r),{}];E(r).forEach((e=>{(["gioPreShareId","gioShareId","suid"].includes(e)||e.toLowerCase().startsWith("utm_"))&&A(r,e)}));const a={gioShareId:U(),suid:n.uid},l={contentType:t.contentType||r.contentType,contentId:t.contentId||r.contentId,gioPreShareId:this.queryShareId};return P(a,((e,t)=>{e||A(a,t)})),[s,F.stringify(Object.assign(Object.assign({},r),a)),Object.assign(Object.assign({},a),l)]}}class Ae{constructor(e){this.growingIO=e,this.main=(e,t,i)=>{var n,s,o,r,a,l,g;const u=Date.now(),{emitter:d,minipInstance:c,plugins:h,vdsConfig:v,platformConfig:m,dataStore:{eventHooks:I,buildAppMessageEvent:f,buildTimelineEvent:y,buildAddFavorites:S},inPlugin:O}=this.growingIO,{currentPage:b,shareOut:w,toggleShareOut:T}=I;if(this.prevEvent[t]&&50>Date.now()-Number(this.prevEvent[t]))return;e||(e=c.getCurrentPage()),v.wepy&&(e.route=e.$is),e.route||(e.route=c.getCurrentPath(e));const C=e.route||e.uri||e.__route__||(null===(n=null==e?void 0:e.$page)||void 0===n?void 0:n.fullPath)||"";d.emit("minipLifecycle",{event:"Page "+t,timestamp:u,params:{page:e,args:i[0]}}),v.debug&&console.log("Page:",C,"#",t,u),this.prevEvent[t]=Date.now();const E=m.listeners.page;switch(d.emit("onComposeBefore",{page:e,event:"Page "+t,params:{page:e,args:i[0]}}),b.lastLifecycle=b.currentLifecycle,b.currentLifecycle=t,t===E.pageLoad&&(this.argQuery[C]=_(e,"options")||_(e,"__displayReporter.query")||_(e,"$page.query")||_(e,"$wx.__displayReporter.query")||i[0]||{},A(this.argQuery[C],"$taroTimestamp")),t){case E.pageShow:if(O)break;w&&I.currentPage.time||(b.parsePage(e,this.argQuery[C]),this.buildPageEvent()),T(!1),b.saveShareId(this.argQuery[C]),c.initImpression(c.getCurrentPage());break;case E.pageReady:v.taro&&z(v.taro)&&(null===(o=null===(s=this.growingIO.plugins)||void 0===s?void 0:s.gioTaroAdapter)||void 0===o||o.saveFullPage(document.body),c.initImpression(c.getCurrentPage()));break;case E.pageHide:case E.pageUnload:v.taro&&z(v.taro)||!(null===(r=null==h?void 0:h.gioImpressionTracking)||void 0===r?void 0:r.impressionObserver)||(null===(l=null===(a=null==h?void 0:h.gioImpressionTracking)||void 0===a?void 0:a.impressionObserver)||void 0===l||l.disconnect(),this.growingIO.plugins.gioImpressionTracking.impressionObserver=null);break;case E.shareApp:T(!0),v.followShare&&f(i);break;case E.shareTime:v.followShare&&y(i);break;case E.addFavorites:S(i);break;case E.tabTap:{const e=null===(g=null==h?void 0:h.gioEventAutoTracking)||void 0===g?void 0:g.buildTabClickEvent;v.autotrack&&e&&p(e)&&e(i[0]);break}}t===E.pageUnload&&(b.pageProps[C]=void 0)},this.buildPageEvent=()=>{const{minipInstance:e,dataStore:{lastPageEvent:t,eventContextBuilder:i,eventInterceptor:n,eventHooks:s}}=this.growingIO,{scene:o,currentPage:r}=s,a=Object.assign(Object.assign({eventType:"PAGE",referralPage:(null==t?void 0:t.path)||(null==t?void 0:t.p)||(o?`scn:${e.scnPrefix}${o}`:null)},i()),{timestamp:r.time});x(r.pageProps[a.path])||(a.attributes=r.pageProps[a.path]),n(a)},this.prevEvent={},this.argQuery={}}}class Ne{constructor(e){var t,i,n;this.growingIO=e,this.toggleShareOut=e=>{c(e)?this.shareOut=e:this.shareOut=!this.shareOut},this.isNormalFc=(e,t)=>p(t)&&"constructor"!==e,this.objectTraverse=(e,t)=>{Object.getOwnPropertyNames(e).forEach((i=>t(i,e))),C(e,"methods")&&Object.getOwnPropertyNames(e.methods).forEach((i=>{e[i]||t(i,e.methods)})),C(e,"lifetimes")&&Object.getOwnPropertyNames(e.lifetimes).forEach((i=>{e[i]||t(i,e.lifetimes)})),C(e,"pageLifetimes")&&Object.getOwnPropertyNames(e.pageLifetimes).forEach((i=>{e[i]||t(i,e.pageLifetimes)}))},this.supLifeFcs=(e,t)=>{v(this[t+"Handlers"])&&this[t+"Handlers"].forEach((t=>{p(e[t])||["onShareAppMessage","onShareTimeline"].includes(t)||(e[t]=()=>{})}))},this.lifeFcEffects=(e,t,i)=>{const n=this;return["onShareTimeline","onAddToFavorites"].includes(e)?function(){let s=t.apply(this,arguments);"onShareTimeline"===e&&n.growingIO.vdsConfig.followShare&&(s=n.currentPage.updateTimelineResult(n.growingIO,null!=s?s:{})),"onAddToFavorites"===e&&(s=n.currentPage.updateAddFavoritesResult(n.growingIO,null!=s?s:{}));const o=[].slice.call(arguments);return s&&o.push(s),n[`def${i}Cbs`][e].apply(this,o),s}:function(){return ce(this,arguments,void 0,(function*(){let s;try{"onShareAppMessage"===e&&(s=yield t.apply(this,arguments),n.growingIO.vdsConfig.followShare&&(s=n.currentPage.updateAppMessageResult(n.growingIO,null!=s?s:{})));const o=[].slice.call(arguments);s&&o.push(s),n[`def${i}Cbs`][e].apply(this,o)}catch(e){D(e,"error")}return"onShareAppMessage"!==e&&(s=t.apply(this,arguments)),n.growingIO.emitter.emit("minipLifecycle",{event:`${i} ${e}End`,timestamp:Date.now(),params:{instance:this,arguments:Array.from(arguments)}}),s}))}},this.customFcEffects=(e,t)=>{const i=this;return function(){var n,s;let o;try{let t=arguments[0]||{};C(t,"type")&&((null==t?void 0:t.currentTarget)||(null==t?void 0:t.target))||(t=arguments[arguments.length-1]),((null==t?void 0:t.currentTarget)||(null==t?void 0:t.target))&&i.actionEventTypes.includes(t.type)&&(p(i.actionEffects)||(i.actionEffects=(null===(s=null===(n=i.growingIO.plugins)||void 0===n?void 0:n.gioEventAutoTracking)||void 0===s?void 0:s.main)||function(){}),null==i||i.actionEffects(t,e))}catch(e){D(e,"error")}return o=t.apply(this,arguments),o}},this.appApplyProxy=(e,t)=>this.appHandlers.includes(e)?this.lifeFcEffects(e,t,"App"):this.autotrack?this.customFcEffects(e,t):t,this.pageApplyProxy=(e,t)=>this.pageHandlers.includes(e)?this.lifeFcEffects(e,t,"Page"):this.autotrack?this.customFcEffects(e,t):t,this.appOverriding=e=>(this.supLifeFcs(e,"app"),this.objectTraverse(e,((e,t)=>{this.isNormalFc(e,t[e])&&(t[e]=this.appApplyProxy(e,t[e]))})),e),this.pageOverriding=e=>(this.supLifeFcs(e,"page"),this.objectTraverse(e,((e,t)=>{this.isNormalFc(e,t[e])&&(t[e]=this.pageApplyProxy(e,t[e]))})),e),this.componentOverriding=e=>(e.methods||(e.methods={}),this.supLifeFcs(e.methods,"page"),this.objectTraverse(e.methods,((e,t)=>{this.isNormalFc(e,t[e])&&(t[e]=this.pageApplyProxy(e,t[e]))})),e),this.growingApp=e=>this.originalApp(this.appOverriding(e)),this.growingPage=e=>this.originalPage(this.pageOverriding(e)),this.growingComponent=e=>this.originalComponent(this.componentOverriding(e)),this.growingBehavior=e=>this.originalBehavior(this.componentOverriding(e)),this.nativeGrowing=(e=["App","Page","Component","Behavior"])=>{const t=this,{platformConfig:i}=this.growingIO,n=i.hooks;if(e.includes("App"))try{n.App&&!this.appHooked&&(App=function(){return t.growingApp(arguments[0])},this.appHooked=!0)}catch(e){}if(e.includes("Page"))try{n.Page&&!this.pageHooked&&(Page=function(){return t.growingPage(arguments[0])},this.pageHooked=!0)}catch(e){}if(e.includes("Component"))try{n.Component&&!this.componentHooked&&(Component=function(){return t.growingComponent(arguments[0])},this.componentHooked=!0)}catch(e){}if(e.includes("Behavior"))try{n.Behavior&&!this.behaviorHooked&&(Behavior=function(){return t.growingBehavior(arguments[0])},this.behaviorHooked=!0)}catch(e){}},this.initEventHooks=()=>{const e=this,{platformConfig:t,gioPlatform:i}=this.growingIO;this.appHandlers.forEach((t=>{this.defAppCbs[t]=function(){e.appEffects.main(t,arguments)}})),this.pageHandlers.forEach((t=>{this.defPageCbs[t]=function(){e.pageEffects.main(this,t,arguments)}})),t.canHook?this.nativeGrowing():"quickapp"===i&&(window.GioApp=function(){return e.appOverriding(arguments[0])},window.GioPage=function(){return e.pageOverriding(arguments[0])},window.GioComponent=function(){return e.pageOverriding(arguments[0])}),this.growingIO.App=R((()=>App)),this.growingIO.Page=R((()=>Page)),this.growingIO.Component=R((()=>Component)),this.growingIO.Behavior=R((()=>Behavior)),"quickapp"===i&&(this.growingIO.GioApp=window.GioApp,this.growingIO.GioPage=window.GioPage,this.growingIO.GioComponent=window.GioComponent)};const s=null===(t=this.growingIO)||void 0===t?void 0:t.platformConfig;this.autotrack=this.growingIO.vdsConfig.autotrack&&this.growingIO.plugins.gioEventAutoTracking,this.defAppCbs={},this.defPageCbs={},this.appHandlers=s.appHandlers,this.pageHandlers=s.pageHandlers,this.actionEventTypes=s.actionEventTypes,this.originalApp=s.originalApp,this.originalPage=s.originalPage,this.originalComponent=s.originalComponent,this.originalBehavior=null!==(i=s.originalBehavior)&&void 0!==i?i:function(){},this.appEffects=new ke(this.growingIO),this.pageEffects=new Ae(this.growingIO),this.currentPage=new _e(this.growingIO),this.shareOut=!1,this.keepAlive=null===(n=this.growingIO)||void 0===n?void 0:n.vdsConfig.keepAlive}}class xe extends class{constructor(n){this.growingIO=n,this.ALLOW_SETTING=Object.assign({},e,"saas"===this.growingIO.gioEnvironment?i:t),this.allowOptKeys=E(this.ALLOW_SETTING),this.initStorageInfo=()=>{const{minipInstance:e}=this.growingIO,t=Y();let i=t.gio_esid?t.gio_esid:e.getStorageSync(this.esidStorageName);i=h(i)&&!g(i)?i:{},this._esid={},E(i).forEach((e=>{this._esid[e]=Number.isNaN(Number(i[e]))||i[e]>=1e9||1>i[e]?1:i[e]})),k(i,this._esid)||e.setStorageSync(this.esidStorageName,this._esid);const n=t.gio_gsid?t.gio_gsid:Number.parseInt(e.getStorageSync(this.gsidStorageName),10);this._gsid=Number.isNaN(n)||n>=1e9||1>n?1:n,this._stid=this._gsid,n!==this._gsid&&e.setStorageSync(this.gsidStorageName,this._gsid)},this.saveStorageInfo=()=>{const{minipInstance:e}=this.growingIO;this._stid=this._gsid,ne(e,[{key:this.esidStorageName,value:this._esid},{key:this.gsidStorageName,value:this._gsid}])},this.initOptions=e=>{var t,i,n,s,o,r,g,u,d,c,h;const{projectId:p,dataSourceId:m,appId:I}=e,f={};this.allowOptKeys.forEach((t=>{const i=this.ALLOW_SETTING[t].type;(v(i)?i.includes(q(e[t])):q(e[t])===this.ALLOW_SETTING[t].type)?"ignoreFields"===t?f.ignoreFields=e.ignoreFields.filter((e=>a.includes(e))):"extraParams"===t?f.extraParams=e.extraParams.filter((e=>l.includes(e))):f[t]=e[t]:f[t]=this.ALLOW_SETTING[t].default})),f.uploadInterval=Math.round(f.uploadInterval),(Number.isNaN(f.uploadInterval)||0>f.uploadInterval||f.uploadInterval>2e3)&&(f.uploadInterval=1e3),this.growingIO.vdsConfig=Object.assign(Object.assign({},f),{projectId:p,dataSourceId:m,appId:I,performance:{monitor:null===(i=null===(t=f.performance)||void 0===t?void 0:t.monitor)||void 0===i||i,exception:null===(s=null===(n=f.performance)||void 0===n?void 0:n.exception)||void 0===s||s,network:null!==(r=null===(o=f.performance)||void 0===o?void 0:o.network)&&void 0!==r&&r}}),f.dataCollect||D("已关闭数据采集","info"),f.autotrack||D("已关闭无埋点","info"),this.growingIO.inPlugin&&(this.growingIO.vdsConfig.autotrack=!1);const{cml:y,uniVue:S,wepy:O,taro:b,remax:w}=f;"full"!==this.growingIO.gioFramework||y||S||O||b||w||(this.growingIO.platformConfig.canHook=!0),this.eventHooks=new Ne(this.growingIO),this.growingIO.inPlugin||this.eventHooks.initEventHooks();const{plugins:T}=this.growingIO;y&&(null===(g=null==T?void 0:T.gioChameleonAdapter)||void 0===g||g.main()),S&&(null===(u=null==T?void 0:T.gioUniAppAdapter)||void 0===u||u.main()),O&&(null===(d=null==T?void 0:T.gioWepyAdapter)||void 0===d||d.main()),b&&(null===(c=null==T?void 0:T.gioTaroAdapter)||void 0===c||c.main()),w&&(null===(h=null==T?void 0:T.gioRemaxAdapter)||void 0===h||h.main())},this.setOption=(e,t)=>{var i;const{vdsConfig:n,callError:s,uploader:o,emitter:r}=this.growingIO,a=u(e)&&this.allowOptKeys.includes(e),l=a&&typeof t===(null===(i=this.ALLOW_SETTING[e])||void 0===i?void 0:i.type);if(a&&l){if("dataCollect"===e&&!1===n.dataCollect&&!0===t){const e=setTimeout((()=>{this.sendVisit(),this.sendPage(),clearTimeout(e)}))}return n[e]=t,["host","scheme"].includes(e)&&(null==o||o.generateURL()),r.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),!0}return s("setOption > "+e),!1},this.getOption=e=>{const{vdsConfig:t,callError:i}=this.growingIO;return e&&C(t,O(e))?t[O(e)]:g(e)?Object.assign({},t):void i("getOption > "+e)},this.sendVisit=()=>{this.eventHooks.appEffects.buildVisitEvent(this.lastVisitEvent)},this.sendPage=()=>{this.eventHooks.pageEffects.buildPageEvent()},this.eventInterceptor=e=>{const{systemInfo:t,network:i}=this.growingIO.minipInstance;x(t)||x(i)?this.interceptEvents.push(e):x(this.interceptEvents)?this.eventConverter(e):([...this.interceptEvents,e].forEach((e=>{const t=Object.assign(Object.assign({},e),this.eventContextBuilder({path:e.path,query:e.query,timestamp:e.timestamp}));this.eventConverter(t)})),this.interceptEvents=[])},this.eventReleaseInspector=()=>{const{minipInstance:{systemInfo:e,network:t}}=this.growingIO;e&&t&&!x(this.interceptEvents)&&([...this.interceptEvents].forEach((e=>{const t=Object.assign(Object.assign({},e),this.eventContextBuilder({path:e.path,query:e.query,timestamp:e.timestamp}));this.eventConverter(t)})),this.interceptEvents=[])},this.buildAppMessageEvent=e=>{},this.buildTimelineEvent=e=>{},this.buildAddFavorites=e=>{},this.esidStorageName="_growing_esid_",this.gsidStorageName="_growing_gsid_",this.initStorageInfo(),this.eventContextBuilder=new Pe(this.growingIO).main,this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.generalProps={},this.interceptEvents=[],this.growingIO.emitter.on("onComposeAfter",(({composedEvent:e})=>{"VISIT"!==e.eventType&&"vst"!==e.t||(this.lastVisitEvent=e),"PAGE"!==e.eventType&&"page"!==e.t||(this.lastPageEvent=e)}))}get esid(){const e=Y(),t=Z(e);return!x(t)&&e.gio_esid?e.gio_esid:this._esid}set esid(e){const t={};E(e).forEach((i=>{t[i]=Number.isNaN(e[i])||e[i]>=1e9||1>e[i]?1:e[i]})),k(t,this._esid)||(this._esid=t,Y().gio_esid=this._esid)}get gsid(){const e=Y(),t=Z(e);return!x(t)&&e.gio_gsid?e.gio_gsid:this._gsid}set gsid(e){const t=Number.parseInt(e,10);this._gsid=Number.isNaN(t)||e>=1e9||1>e?1:e,Y().gio_gsid=this._gsid,10>this._gsid-this._stid||this.saveStorageInfo()}}{constructor(e){super(e),this.growingIO=e,this.eventConverter=e=>{var t;const{vdsConfig:i,dataStore:n,uploader:s}=this.growingIO;if(i.dataCollect){e.globalSequenceId=n.gsid;const i={};P(e,((e,t)=>{var n;if(!Ee[t]||x(e)&&0!==e||(i[Ee[t]]=e,"eventType"===t&&(i.t=Ce[e]||e)),"element"===t){const t={},s=null!==(n=m(e))&&void 0!==n?n:{};P(s,((e,i)=>{!Ee[i]||x(e)&&0!==e||(t[Ee[i]]=e)})),i.e=[t]}})),this.growingIO.dataStore.gsid+=1,null===(t=this.growingIO)||void 0===t||t.emitter.emit("onComposeAfter",{composedEvent:i}),s.commitRequest(i)}},this.buildAppMessageEvent=e=>{var t;const i=e[0];let n;2>e.length?1===e.length&&(n=i):n=e[1];const{dataStore:{eventContextBuilder:s,eventInterceptor:o,eventHooks:r}}=this.growingIO;o(Object.assign({eventType:"CUSTOM",eventName:"onShareAppMessage",pageShowTimestamp:r.currentPage.time,attributes:Object.assign(Object.assign(Object.assign({},i),{target:null===(t=null==i?void 0:i.target)||void 0===t?void 0:t.id,title:null==n?void 0:n.title,path:decodeURI((null==n?void 0:n.path)||"")}),null==n?void 0:n.attributes)},s()))},this.buildTimelineEvent=e=>{var t;const i=e[0];let n;2>e.length?1===e.length&&(n=i):n=e[1];const{dataStore:{eventContextBuilder:s,eventInterceptor:o,eventHooks:r}}=this.growingIO;o(Object.assign({eventType:"CUSTOM",eventName:"onShareTimeline",pageShowTimestamp:r.currentPage.time,attributes:Object.assign(Object.assign(Object.assign({},i),{target:null===(t=null==i?void 0:i.target)||void 0===t?void 0:t.id,title:null==n?void 0:n.title,path:decodeURI((null==n?void 0:n.path)||"")}),null==n?void 0:n.attributes)},s()))},this.buildAddFavorites=e=>{const t=e[0];let i;2>e.length?1===e.length&&(i=t):i=e[1];const{dataStore:{eventContextBuilder:n,eventInterceptor:s,eventHooks:o}}=this.growingIO;s(Object.assign({eventType:"CUSTOM",eventName:"onAddToFavorites",pageShowTimestamp:o.currentPage.time,attributes:Object.assign(Object.assign({},t),{title:null==i?void 0:i.title,path:decodeURI((null==i?void 0:i.path)||"")})},n()))}}}class qe extends class{constructor(e){this.growingIO=e,this.commitRequest=e=>{const t=Object.assign({},e),{vdsConfig:i}=this.growingIO;i.forceLogin?this.hoardingQueue.push(t):(this.requestQueue.push(t),this.initiateRequest())},this.initiateRequest=e=>{var t,i;const{plugins:n,vdsConfig:s}=this.growingIO;[...this.hoardingQueue,...this.requestQueue].length>0&&this.requestingNum<this.requestLimit&&((null===(t=null==s?void 0:s.tbConfig)||void 0===t?void 0:t.cloudFuncSend)?null===(i=null==n?void 0:n.gioTaobaoSendAdapter)||void 0===i||i.singleInvoke():e?this.batchInvoke():this.batchInvokeThrottle())},this.batchInvoke=()=>{var e,t;const{vdsConfig:i,plugins:n,emitter:s}=this.growingIO;let o=[...this.hoardingQueue,...this.requestQueue];o.length>50?(o=o.slice(0,50),this.hoardingQueue.length>50?this.hoardingQueue=this.hoardingQueue.slice(50):(this.hoardingQueue=[],this.requestQueue=this.requestQueue.slice(50-this.hoardingQueue.length))):(this.hoardingQueue=[],this.requestQueue=[]);let r=o.filter((e=>(this.retryIds[e.globalSequenceId||e.esid]||0)<=this.retryLimit));x(r)||(i.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(r,null,2)),s.emit("onSendBefore",{requestData:r}),(null===(e=null==i?void 0:i.tbConfig)||void 0===e?void 0:e.cloudAppId)?null===(t=null==n?void 0:n.gioTaobaoSendAdapter)||void 0===t||t.tbCloudAppInvoke(r):this.normalBatchInvoke(r))},this.batchInvokeThrottle=N(this.batchInvoke,this.growingIO.vdsConfig.uploadInterval,!1,!1),this.normalBatchInvoke=e=>{var t;const{minipInstance:i,vdsConfig:n,emitter:s,plugins:o,gioEnvironment:r}=this.growingIO;this.requestingNum+=1;const a={"content-type":"application/json;charset=UTF-8"};let l=[...e];const g=n.compress&&(null===(t=null==o?void 0:o.gioCompress)||void 0===t?void 0:t.compressToUTF16);"cdp"===r&&g&&(l=o.gioCompress.compressToUTF16(JSON.stringify(e)),a["X-Compress-Codec"]="1"),i.request({url:`${this.requestURL}?stm=${Date.now()}${"cdp"===r?"&compress="+(g?"1":"0"):""}`,header:a,method:"POST",data:l,timeout:this.requestTimeout,fail:t=>{[200,204].includes(t.code)||(v(e)?e.forEach((e=>{this.requestFailFn(e)})):this.requestFailFn(e),D("请求失败!"+JSON.stringify(t),"error"))},complete:e=>{this.requestingNum-=1,s.emit("onSendAfter",{result:e}),this.initiateRequest()}})},this.requestFailFn=e=>{if(this.retryIds[e.globalSequenceId||e.esid]||(this.retryIds[e.globalSequenceId||e.esid]=0),this.retryIds[e.globalSequenceId||e.esid]+=1,!this.requestQueue.some((t=>t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid))){let t=setTimeout((()=>{x(this.requestQueue)?(this.requestQueue.push(e),this.initiateRequest()):this.requestQueue.push(e),clearTimeout(t),t=null}),800)}},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=3,this.requestTimeout=5e3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.requestURL=""}}{constructor(e){super(e),this.growingIO=e;let{appId:t,projectId:i}=this.growingIO.vdsConfig;this.requestURL=`https://wxapi.growingio.com/projects/${i}/apps/${t}/collect`}}const je=new class extends class{constructor(){var e;this.init=e=>(D("Gio小程序SDK 初始化中...","info"),this.dataStore.initOptions(e),this.gioSDKInitialized=!0,this.vdsConfig.subpackage||(Y().__gio__=()=>this),null==this||this.initCallback(),this.emitter.emit("SDK_INITIALIZED",this),D("Gio小程序SDK 初始化完成！","success"),this.vdsConfig.forceLogin&&D("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),this.inPlugin&&this.dataStore.sendVisit(),!0),this.setDataCollect=e=>{this.setOption("dataCollect",!!e),this.notRecommended()},this.setAutotrack=e=>{this.setOption("autotrack",!!e),this.notRecommended()},this.enableDebug=e=>{this.setOption("debug",!!e),this.notRecommended()},this.setOption=(e,t)=>{if(s.includes(e)){const i=this.dataStore.setOption(e,t);return i&&o[e]&&D(`已${t?"开启":"关闭"}${o[e]}`,"info"),i}return D(`不存在可修改的配置项：${e}，请检查后重试!`,"warn"),!1},this.getDeviceId=()=>this.userStore.uid,this.getOption=e=>this.dataStore.getOption(e),this.getGioInfo=()=>{const{uid:e,userId:t,userKey:i,sessionId:n,gioId:s}=this.userStore,{projectId:o,appId:r,dataSourceId:a,dataCollect:l,enableIdMapping:g,extraParams:u,ignoreFields:d}=this.vdsConfig,c={gioappid:r,giocs1:t||"",gioplatform:this.platformConfig.platform,gioprojectid:o,gios:n,giou:e};return"cdp"===this.gioEnvironment&&(c.giodatacollect=l,c.giodatasourceid=a,c.gioid=s||"",g&&(c.giouserkey=i),x(u)||u.forEach((e=>{d.includes(e)||(c["gio"+e]=this.dataStore.lastVisitEvent[e])}))),F.stringify(c)},this.setLocation=(e,t)=>{const i={latitude:e,longitude:t},n=this.dataStore.locationData,s=e=>e>=-180&&180>=e;s(e)&&s(t)&&(n.latitude!==e||n.longitude!==t)&&(this.dataStore.locationData=i,this.dataStore.sendVisit())},this.setGeneralProps=e=>{h(e)&&!x(e)?(this.dataStore.generalProps=Object.assign(Object.assign({},this.dataStore.generalProps),e),E(this.dataStore.generalProps).forEach((e=>{[void 0,null].includes(this.dataStore.generalProps[e])&&(this.dataStore.generalProps[e]="")}))):this.callError("setGeneralProps")},this.clearGeneralProps=e=>{v(e)&&!x(e)?e.forEach((e=>{A(this.dataStore.generalProps,e)})):this.dataStore.generalProps={}},this.setPageAttributes=e=>{const{currentPage:t}=this.dataStore.eventHooks,i=this.minipInstance.getCurrentPath();["onLoad","attached"].includes(t.currentLifecycle)&&(t.pageProps[i]=te(e))},this.updateImpression=()=>{D("当前未集成半自动浏览插件，请集成插件后再调用 updateImpression!","warn")},this.notRecommended=()=>D("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info"),this.callError=(e,t=!0,i="参数不合法")=>D(`${t?"调用":"设置"} ${e} 失败，${i}!`,"warn"),this.utils=Object.assign(Object.assign(Object.assign({},j),se),{qs:F}),this.emitter={all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map((function(e){e(i)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,i)}))}},this.gioPlatform="my",this.gioFramework="tb",this.gioEnvironment="saas",this.sdkVersion="3.8.13";try{"quickapp"===this.gioPlatform||p(getApp)&&p(App)?this.inPlugin=!1:this.inPlugin=!0}catch(e){this.inPlugin=!0}this.inPlugin&&D("未检测到小程序实例，自动切换为插件模式!","info"),this.platformConfig=we,this.minipInstance=new Te(this),this.userStore=new Oe(this),this.plugins=new Se(this),this.plugins.innerPluginInit()}}{constructor(){super(),this.initCallback=()=>{this.uploader=new qe(this)},this.identify=(e,t)=>{if(this.vdsConfig.forceLogin){if(!oe(e)||t&&!oe(t))return void this.callError("identify");const i=O(e).slice(0,1e3),n=O(t).slice(0,1e3)||"";this.userStore.uid=i,this.uploader.hoardingQueue.forEach(((e,t)=>this.uploader.hoardingQueue[t].u=i)),this.dataStore.setOption("forceLogin",!1),this.uploader.initiateRequest();const s={openid:i};n&&(s.unionid=n),this.setVisitor(s)}else this.callError("identify",!1,"forceLogin 未开启")},this.setVisitor=e=>{var t;!x(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildVisitorVariable(e):this.callError("setVisitor")},this.setUser=e=>{var t;!x(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildPeopleVariable(e):this.callError("setUser")},this.setUserId=e=>{if(oe(e)){e=O(e).slice(0,1e3);const t=this.userStore.gioId,i=this.userStore.userId;this.userStore.userId=e,this.reissueLogic(i,e,t)}else this.callError("setUserId")},this.clearUserId=()=>{this.userStore.userId=void 0},this.setPage=e=>{var t;!x(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildPageLevelVariable(e):this.callError("setPage")},this.setEvar=e=>{var t;!x(e)&&h(e)?null===(t=this.plugins.gioCustomTracking)||void 0===t||t.buildConversionVariable(e):this.callError("setEvar")},this.track=(e,t)=>{var i,n;((null===(n=null===(i=this.plugins)||void 0===i?void 0:i.gioCustomTracking)||void 0===n?void 0:n.buildCustomEvent)||function(){})(e,Object.assign(Object.assign({},this.dataStore.generalProps),h(t)&&!x(t)?t:{}))},this.reissueLogic=(e,t,i)=>{i&&i!==t?(this.userStore.sessionId="",this.dataStore.sendVisit(),this.dataStore.sendPage()):e!==t&&this.dataStore.sendPage()},this.dataStore=new xe(this)}},Fe=function(){const e=arguments[0];if(u(e)&&n.includes(e)&&je[e]){const t=f(Array.from(arguments));if("init"===e){const e=re(je),i=ae(t),n=le(t),s=ge(t);if(e&&i&&n&&s){const{projectId:e,userOptions:t}=n,{appId:i}=s;return i||"quickapp"!==je.gioPlatform?je.init(Object.assign(Object.assign({},t),{projectId:e,appId:i})):(D("请填写AppId(packageName)!","error"),!1)}}else{if(je.gioSDKInitialized&&je.vdsConfig)return je[e](...t);D("SDK未初始化!","error")}}else r.includes(e)?D(`方法 ${O(e)} 已被弃用!`,"warn"):D(`不存在名为 ${O(e)} 的方法调用!`,"error")};ee().gio=Fe,ee().gioEnvironment="saas",ee().gioSDKVersion=je.sdkVersion;export{Fe as default};
