const t={autotrack:{type:"boolean",default:!0},cml:{type:"object",default:!1},comAsPage:{type:"boolean",default:!1},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},subpackage:{type:"boolean",default:!1},keepAlive:{type:"number",default:3e5},remax:{type:"object",default:!1},taro:{type:"object",default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},uniVue:{type:["object","function"],default:!1},version:{type:"string",default:"1.0.0"},wepy:{type:"function",default:!1}},e={compress:{type:"boolean",default:!0},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},gtouchHost:{type:"string",default:""},host:{type:"string",default:""},ignoreFields:{type:"array",default:[]},scheme:{type:"string",default:"https"},uploadInterval:{type:"number",default:1e3}},i={},n=["clearUserId","enableDebug","getGioInfo","getOption","identify","init","setAutotrack","setDataCollect","setOption","setUserId","track","setLocation","setTrackerHost","setTrackerScheme","setUserAttributes","registerPlugins","getDeviceId"],o=["autotrack","dataCollect","debug","host","scheme"],s={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式"},r=["setConfig","collectImp","setPlatformProfile","getLocation"],a=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],l=[...a,"appChannel","language","platformVersion"],g=t=>null==t||void 0===t,u=t=>"string"==typeof t,d=t=>"number"==typeof t,h=t=>"boolean"==typeof t,c=t=>"[object Object]"==={}.toString.call(t)&&!g(t),p=t=>"function"==typeof t,v=t=>Array.isArray(t)&&"[object Array]"==={}.toString.call(t),m=t=>v(t)?t[0]:void 0,f=t=>v(t)?t[t.length-1]:void 0,I=(t,e=1)=>v(t)&&d(e)?t.slice(e>0&&e<t.length?e:1,t.length):t,y=t=>{if(v(t)){let e=0;const i=[];for(const n of t)n&&(i[e++]=n);return i}return t},S=(t,e)=>{if(v(t)){const i=t.findIndex(e);return 0>i?void 0:t[i]}},w=t=>g(t)?"":""+t,O=(t,e)=>"string"==typeof t?t.split(e):t,b=t=>{if(u(t)){const e=O(t,"");return`${m(e).toLowerCase()}${I(e).join("")}`}return t},_=(t,e)=>t.slice(0,e.length)===e,C=(t,e)=>{const{length:i}=t;let n=i;n>i&&(n=i);const o=n;return n-=e.length,n>=0&&t.slice(n,o)===e},P=(t,e=" ")=>(_(t,e)&&(t=t.substring(1)),C(t,e)&&(t=t.substring(-1)),t),T={}.hasOwnProperty,E=(t,e)=>!g(t)&&T.call(t,e),A=t=>"object"==typeof t?Object.keys(t):[],k=(t,e)=>{A(t).forEach((i=>e(t[i],i)))},x=(t,e)=>{const i=A(t);if(!c(t)||!c(e)||i.length!==A(e).length)return!1;for(let n=0;n<i.length;n+=1){if(c(t[i[n]]))return x(t[i[n]],e[i[n]]);if(t[i[n]]!==e[i[n]])return!1}},j=(t,e,i)=>{let n=t;return c(t)?(e.split(".").forEach((t=>{n=n?n[t]:i})),n):i},q=(t,e)=>{if(!c(t))return!1;try{return Reflect.deleteProperty(t,e)}catch(t){return!1}},N=(t,e=250,i,n)=>{let o,s=0;return"boolean"!=typeof i&&(n=t,t=i,i=void 0),function(...r){let a=this,l=Date.now()-s;function g(){s=Date.now(),t.apply(a,r)}n&&!o&&g(),o&&clearTimeout(o),void 0===n&&l>e?g():!0!==i&&(o=setTimeout(n?function(){o=void 0}:g,void 0===n?e-l:e))}},H=t=>v(t)?0===t.length:c(t)?0===A(t).length:!t,L=t=>{const e=typeof t;return"object"===e&&v(t)?"array":e};var F=Object.freeze({__proto__:null,isNil:g,isString:u,isNumber:d,isBoolean:h,isObject:c,isFunction:p,isArray:v,fixed:(t,e)=>d(t)?t.toFixed(d(e)?e:2,10):t,head:m,last:f,drop:I,dropWhile:(t,e)=>v(t)?t.filter((t=>!e(t))):t,compact:y,find:S,toString:w,split:O,lowerFirst:b,upperFirst:t=>{if(u(t)){const e=O(t,"");return`${m(e).toUpperCase()}${I(e).join("")}`}return t},startsWith:_,endsWith:C,trim:P,hasOwnProperty:T,has:E,keys:A,forEach:k,isEqual:x,get:j,unset:q,throttle:N,isEmpty:H,typeOf:L});const B=(t,e)=>{console.log("%c[GrowingIO]："+t,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[e]||"")},D=t=>{try{return t()}catch(t){return}},U=t=>{const e={};return c(t)&&k(t,((t,i)=>{const n=w(i).slice(0,50);c(t)?e[n]=U(t):v(t)?(e[n]=t.slice(0,100),"cdp"===(global||$global).gioEnvironment&&(e[n]=e[n].join("||"))):e[n]=g(t)?"":w(t).slice(0,1e3)})),e},V=t=>u(t)?P(t).substring(0,100):t;var R=Object.freeze({__proto__:null,consoleText:B,niceTry:D,limitObject:U,limitString:V});const K=t=>u(t)&&t.length>0||d(t)&&t>0,$=t=>!t.vdsConfig&&!t.gioSDKInitialized||(B("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1),Q=t=>!!y(t)||(B('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", "你的应用 AppId", options); 进行初始化!',"error"),!1),G=t=>{const e=t[0];let i=f(t);return K(e)?(c(i)&&i||(i={}),{projectId:e,userOptions:i}):(B("SDK初始化失败，accountId 参数不合法!","error"),!1)},M=t=>{const e=t[1];let i=t[2];const n=f(t);return e&&u(e)?(i=(t=>(K(t)||(t="",B("检测到应用 AppId 未填写或不合法，将自动为您获取!")),t))(i),c(n)&&n.host?{dataSourceId:e,appId:i,cdpOptions:n}:(B("SDK初始化失败，未在配置中指定 host!","error"),!1)):(B("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)},W=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,z=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i;var J={},Z={}.hasOwnProperty;function X(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function Y(t){try{return encodeURIComponent(t)}catch(t){return null}}J.stringify=function(t,e){e=e||"";var i,n,o=[];for(n in"string"!=typeof e&&(e="?"),t)if(Z.call(t,n)){if((i=t[n])||null!=i&&!isNaN(i)||(i=""),n=Y(n),i=Y(i),null===n||null===i)continue;o.push(n+"="+i)}return o.length?e+o.join("&"):""},J.parse=function(t){for(var e,i=/([^=?#&]+)=?([^&]*)/g,n={};e=i.exec(t);){var o=X(e[1]),s=X(e[2]);null===o||null===s||o in n||(n[o]=s)}return n};const et=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),it=t=>t.pixelRatio?Math.round(t.screenWidth*t.pixelRatio):t.screenWidth,nt=(t,e)=>{if(t){const i=t.toLowerCase();return-1!==i.indexOf("android")?e+"-Android":-1!==i.indexOf("ios")?e+"-iOS":t}},ot=()=>{let t;return!t&&D((()=>swan))&&(t="swan"),!t&&D((()=>tt))&&(t="tt"),!t&&D((()=>qq))&&(t="qq"),!t&&D((()=>my))&&(t="my"),!t&&D((()=>ks))&&(t="ks"),!t&&D((()=>jd))&&(t="jd"),!t&&D((()=>wx))&&(t="wx"),t||S(A(global),(t=>w(t).toLowerCase().includes("quickapp")))&&(t="quickapp"),t},st=t=>A(t).filter((t=>t.indexOf("__sub")>-1&&t.indexOf("gio__")>-1)).sort(),rt=()=>{let t=D((()=>getApp({allowDefault:!0})));return t||(t=global||$global),t};class at{constructor(t){var e;this.growingIO=t,this.initUserInfo=()=>{const{minipInstance:t}=this.growingIO;this.uid=t.getStorageSync(this.uidStorageName)||et(),this.userId=t.getStorageSync(this.userIdStorageName),this.userKey=t.getStorageSync(this.userKeyStorageName),this.gioId=t.getStorageSync(this.gioIdStorageName)},this.syncUserInfo=()=>{const{minipInstance:t}=this.growingIO;t.setStorageSync(this.uidStorageName,this.uid),t.setStorageSync(this.userIdStorageName,this.userId),t.setStorageSync(this.userKeyStorageName,this.userKey),t.setStorageSync(this.gioIdStorageName,this.gioId)};const{inPlugin:i}=this.growingIO;this.uidStorageName=i?"_growing_plugin_uid_":"_growing_uid_",this.userIdStorageName=i?"_growing_plugin_userId_":"_growing_userId_",this.userKeyStorageName=i?"_growing_plugin_userKey_":"_growing_userKey_",this.gioIdStorageName=i?"_growing_plugin_gioId_":"_growing_gioId_",this._sessionId=et(),this._uid=void 0,this._userId=void 0,this._userKey=void 0,this._gioId=void 0,"quickapp"!==(null===(e=this.growingIO)||void 0===e?void 0:e.gioPlatform)&&this.initUserInfo()}get sessionId(){return this._sessionId||(this._sessionId=et()),this._sessionId}set sessionId(t){const e=this._sessionId;this._sessionId=t||et(),e!==this._sessionId&&this.growingIO.emitter.emit("SESSIONID_UPDATE",{newSessionId:this._sessionId,oldSessionId:e})}get uid(){return this._uid}set uid(t){const e=this._uid;this._uid=t,this.growingIO.minipInstance.setStorage(this.uidStorageName,this._uid),e!==this._uid&&this.growingIO.emitter.emit("UID_UPDATE",{newUId:t,oldUId:e})}get userId(){return this._userId}set userId(t){const e=this._userId;this._userId=t,this.growingIO.minipInstance.setStorage(this.userIdStorageName,this._userId),e!==this._userId&&this.growingIO.emitter.emit("USERID_UPDATE",{newUserId:t,oldUserId:e}),t&&(this.gioId=t)}get userKey(){return this._userKey}set userKey(t){const e=this._userKey;this._userKey=t,this.growingIO.minipInstance.setStorage(this.userKeyStorageName,this._userKey),e!==this._userKey&&this.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:t,oldUserKey:e})}get gioId(){return this._gioId}set gioId(t){const e=this._gioId;this._gioId=t,this.growingIO.minipInstance.setStorage(this.gioIdStorageName,this._gioId),e!==this._gioId&&this.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:t,oldGioId:e})}}let lt;var gt={name:"gioTaroAdapter",method:class{constructor(t){var e,i,n,o;this.growingIO=t,this.main=()=>{var t,e,i,n;this.taro||(this.taro=null===(e=null===(t=this.growingIO)||void 0===t?void 0:t.vdsConfig)||void 0===e?void 0:e.taro),this.vue||(this.vue=null===(n=null===(i=this.growingIO)||void 0===i?void 0:i.vdsConfig)||void 0===n?void 0:n.taroVue);const{Current:o,createComponent:s}=this.taro;!o&&s?this.proxyTaro2(this.taro):o&&!s?this.proxyTaro3(this.taro,this.vue):lt.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")},this.proxyTaro2=t=>{const e=this,i=t.createApp,n=t.createComponent;i&&(t.createApp=function(t){const n=i(t);return e.growingIO.dataStore.eventHooks.appOverriding(n),n}),n&&(t.createComponent=function(t,i){const o=n(t,i);return i?e.growingIO.dataStore.eventHooks.pageOverriding(o.methods):e.growingIO.dataStore.eventHooks.componentOverriding(o.methods),o})},this.proxyTaro3=(t,e)=>{const{eventHooks:i}=this.growingIO.dataStore;if(i.nativeGrowing(),e){console.log("Vue version: ",e.version);const t=Number.parseInt(lt.head(lt.split(e.version,".")),10);2===t?this.taro3Vue2Proxy(e):3===t?this.taro3Vue3Proxy(e):lt.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")}else this.taro3ReactProxy()},this.taro3ReactProxy=()=>{const t=document.__proto__.__proto__;Object.defineProperty(t,"dispatchEvent",{value:(t=>{const e=this;return function(){const i=this,n=arguments[0],o=i.__handlers[n.type];return Array.isArray(o)&&o.forEach(((t,i)=>{o[i]=e.growingIO.dataStore.eventHooks.customFcEffects(t.name,t)})),t.apply(this,arguments)}})(t.dispatchEvent),enumerable:!1,configurable:!0})},this.taro3Vue2Proxy=t=>{const{eventHooks:e}=this.growingIO.dataStore,i=(t,i,n)=>lt.isFunction(n)&&!e.pageHandlers.includes(i)?function(){e.customFcEffects(i,n).apply(this,arguments)}:n;t.mixin({beforeMount:function(){const t=this.$options.methods;lt.keys(t).forEach((t=>{Object.defineProperty(this,t,{value:i(0,t,this[t]),configurable:!0,writable:!0})}))}})},this.taro3Vue3Proxy=t=>{const{eventHooks:e}=this.growingIO.dataStore;t.mixin({beforeMount:function(){const t=(t,i)=>lt.isFunction(i)&&!e.pageHandlers.includes(t)?function(){return e.customFcEffects(t,i).apply(this,arguments)}:i;lt.keys(this).forEach((e=>{lt.isFunction(this[e])&&!["getOpenerEventChannel","$hasHook","$callHook","createSelectorQuery","createIntersectionObserver","selectAllComponents","selectComponent"].includes(e)&&(this[e]=t(e,this[e]))}));const i=this._.emit;this._.emit=function(){return(()=>{e.customFcEffects(arguments[0],(()=>{})).apply(this,arguments)})(),i.apply(this,arguments)}}})},this.saveFullPage=t=>{const e=t=>{t.forEach((t=>{var i;(null===(i=null==t?void 0:t.ctx)||void 0===i?void 0:i.route)?(this.growingIO.taro3VMs||(this.growingIO.taro3VMs={}),this.growingIO.taro3VMs[t.ctx.route]=t):Array.isArray(t.childNodes)&&e(t.childNodes)}))};e(t.childNodes)},lt=this.growingIO.utils,this.taro=null===(i=null===(e=this.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===i?void 0:i.taro,this.vue=null===(o=null===(n=this.growingIO)||void 0===n?void 0:n.vdsConfig)||void 0===o?void 0:o.taroVue}}};let ut;const dt={};function ht(t,e,i){var n=t;e.map((function(t,o){n[t]=o==e.length-1?i:n[t]||{},n=n[t]}))}ht(dt,["plugins","gioCustomTracking"],{name:"gioCustomTracking",method:class{constructor(t){this.growingIO=t,this.getValidResourceItem=t=>{if(t&&ut.isObject(t)&&t.id&&t.key){const e={id:ut.isString(t.id)?t.id:JSON.stringify(t.id),key:ut.isString(t.key)?t.key:JSON.stringify(t.key)};return t.attributes&&(e.attributes=t.attributes),e}},this.buildCustomEvent=(t,e,i)=>{var n;if(ut.isString(t)&&t.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,50}$/)){const{dataStore:{eventContextBuilder:o,eventInterceptor:s,eventHooks:r}}=this.growingIO;s(Object.assign({eventType:"CUSTOM",eventName:t,pageShowTimestamp:null===(n=null==r?void 0:r.currentPage)||void 0===n?void 0:n.time,attributes:ut.limitObject(ut.isObject(e)&&!ut.isEmpty(e)?e:void 0),resourceItem:ut.limitObject(this.getValidResourceItem(i))},o()))}else ut.consoleText("埋点事件格式不正确，事件名只能包含数字、字母和下划线，且不能以数字开头!","warn")},this.buildUserAttributesEvent=t=>{const{dataStore:{eventContextBuilder:e,eventInterceptor:i,lastVisitEvent:n}}=this.growingIO,o=Object.assign({eventType:"LOGIN_USER_ATTRIBUTES",attributes:ut.limitObject(t)},e());o.path||(o.path=n.path,o.query=n.query,o.title=n.title),i(o)},ut=this.growingIO.utils}}}),ht(dt,["plugins","gioTaroAdapter"],gt);class ct{constructor(t){this.growingIO=t,this.innerPluginInit=()=>{A(dt.plugins).forEach((t=>{const{name:e,method:i}=dt.plugins[t];this.pluginItems.find((t=>t.name===e))||this.pluginItems.push({name:b(e||t),method:i||(t=>{})})})),H(this.pluginItems)||this.installAll()},this.install=(t,e)=>{var i;const n=e||this.pluginItems.find((e=>e.name===t));if(null===(i=this.growingIO)||void 0===i?void 0:i.plugins[t])return B(`重复加载插件 ${t} 或插件重名，已跳过加载!`,"warn"),!1;if(!n)return B(`插件加载失败!不存在名为 ${t} 的插件!`,"error"),!1;try{return this.growingIO.plugins[t]=new n.method(this.growingIO),"cdp"===this.growingIO.gioEnvironment&&e&&B("加载插件："+t,"info"),!0}catch(t){return B("插件加载异常："+t,"error"),!1}},this.installAll=t=>{(t||this.pluginItems).forEach((e=>this.install(e.name,t?e:void 0)))},this.uninstall=t=>{var e;q(this.pluginItems,t);const i=q(null===(e=this.growingIO)||void 0===e?void 0:e.plugins,t);return i||B(`卸载插件 ${t} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((t=>this.uninstall(t.name)))},this.lifeError=(t,e)=>B(`插件执行错误 ${t.name} ${e}`,"error"),this.onComposeBefore=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onComposeBefore;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.onComposeAfter=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onComposeAfter;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.onSendBefore=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onSendBefore;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.onSendAfter=t=>{this.pluginItems.forEach((e=>{var i;const n=null===(i=this.growingIO.plugins[e.name])||void 0===i?void 0:i.onSendAfter;if(n&&p(n))try{n(t)}catch(t){this.lifeError(e,t)}}))},this.pluginItems=[],this.growingIO.emitter.on("onComposeBefore",this.onComposeBefore),this.growingIO.emitter.on("onComposeAfter",this.onComposeAfter),this.growingIO.emitter.on("onSendBefore",this.onSendBefore),this.growingIO.emitter.on("onSendAfter",this.onSendAfter)}}const pt={scnPrefix:"",appHandlers:["onLaunch","onShow","onHide","onError","onPageNotFound"],pageHandlers:["onLoad","onShow","onReady","onHide","onShareAppMessage","onTabItemTap"],componentHandlers:["created","attached","detached","onShareAppMessage","onTabItemTap","show","hide"],actionEventTypes:["onclick","tap","longpress","longTap","blur","change","submit","confirm","getuserinfo","getphonenumber","contact"],originalApp:D((()=>App)),originalPage:D((()=>Page)),originalComponent:D((()=>Component)),originalBehavior:D((()=>Behavior)),canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},listeners:{app:{appLaunch:"onLaunch",appShow:"onShow",appClose:"onHide",appError:"onError",appPageNotFound:"onPageNotFound"},page:{pageLoad:"onLoad",pageShow:"onShow",pageReady:"onReady",pageHide:"onHide",tabTap:"onTabItemTap",shareApp:"onShareAppMessage",comCreated:"created",comAttached:"attached",comDetached:"detached",comShow:"show",comHide:"hide"},actions:{click:["onclick","tap","longpress","longTap","getuserinfo","getphonenumber","contact"],change:["blur","change","confirm"],submit:["submit"]}}},vt=Object.assign(Object.assign({},pt),{listeners:Object.assign({},pt.listeners),name:"JingDong",platform:"jd",scnPrefix:"jd_"}),mt=Object.assign(Object.assign({},pt),{listeners:Object.assign({},pt.listeners),name:"KuaiShou",platform:"kuaishoup",scnPrefix:"ks_"}),ft=Object.assign(Object.assign({},pt),{listeners:Object.assign({},pt.listeners),name:"Alipay",platform:"alip",scnPrefix:"alip_",componentHandlers:["onInit","didMount","didUnmount"],hooks:Object.assign(Object.assign({},null==pt?void 0:pt.hooks),{Behavior:!1})});ft.listeners.page=Object.assign(Object.assign({},ft.listeners.page),{comCreated:"onInit",comAttached:"didMount",comDetached:"didUnmount"});const It=Object.assign(Object.assign({},pt),{listeners:Object.assign({},pt.listeners),name:"QQ",platform:"qq",scnPrefix:"qq_"}),yt=Object.assign(Object.assign({},pt),{listeners:Object.assign({},pt.listeners),name:"Baidu",platform:"baidup",scnPrefix:"baidup_"}),St=Object.assign(Object.assign({},pt),{listeners:Object.assign({},pt.listeners),name:"Bytedance",platform:"bytedance",scnPrefix:"bytedance_"}),wt=Object.assign(Object.assign({},pt),{listeners:Object.assign({},pt.listeners),name:"Weixin",platform:"MinP"});wt.pageHandlers=[...pt.pageHandlers,"onShareTimeline"],wt.componentHandlers=[...pt.componentHandlers,"onShareTimeline"],wt.listeners.page.shareTime="onShareTimeline";const Ot=ot(),bt=D((()=>{const t={jd:vt,ks:mt,my:ft,qq:It,swan:yt,tt:St,wx:wt}[Ot];return t.canHook=!1,t}));function _t(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))}class Ct{constructor(t){this.growingIO=t,this.minip=D((()=>{{let t;return t||(t=D((()=>swan))),t||(t=D((()=>my))),t||(t=D((()=>tt))),t||(t=D((()=>qq))),t||(t=D((()=>ks))),t||(t=D((()=>wx))),t}})),this.getAppId=()=>"",this.navigateTo=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.navigateTo(t)},this.switchTab=t=>{var e;null===(e=this.minip)||void 0===e||e.switchTab(t)},this.navigateToMiniProgram=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.navigateToMiniProgram(t)},this.onAppShow=t=>{var e;null===(e=this.minip)||void 0===e||e.onAppShow(t)},this.onAppHide=t=>{var e;null===(e=this.minip)||void 0===e||e.onAppHide(t)},this.getImageInfo=({src:t,success:e,fail:i,complete:n})=>{var o;return null===(o=this.minip)||void 0===o?void 0:o.getImageInfo({src:t,success:e,fail:i,complete:n})},this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"observeAll")},this.getCurrentPage=()=>D((()=>f(getCurrentPages())))||{},this.getCurrentPath=()=>{const t=this.getCurrentPage();return(null==t?void 0:t.route)||(null==t?void 0:t.uri)||(null==t?void 0:t.__route__)||""},this.getPageTitle=t=>{var e,i;return u(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.gioPageTitle)?V(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.gioPageTitle):""},this.getStorageSync=t=>{var e;return null===(e=this.minip)||void 0===e?void 0:e.getStorageSync(t)},this.getStorage=t=>new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getStorage({key:t,success:({data:t})=>e(t),fail:()=>e("")})})),this.setStorageSync=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync(t,e)},this.setStorage=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorage({key:t,data:e})},this.removeStorageSync=t=>{var e;null===(e=this.minip)||void 0===e||e.removeStorageSync(t)},this.removeStorage=t=>{var e;null===(e=this.minip)||void 0===e||e.removeStorage(t)},this.getNetworkType=()=>_t(this,void 0,void 0,(function*(){const t=this;return yield new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getNetworkType({success:i=>{t.network=i,e(i)},fail:()=>e(null)})}))})),this.request=({url:t,data:e,header:i,timeout:n,method:o,success:s,fail:r,complete:a})=>{var l;const g=null===(l=this.minip)||void 0===l?void 0:l.request({url:t,data:e,header:i,timeout:n,method:o,success:s,fail:r,complete:a}),u=setTimeout((()=>{null==g||g.abort(),clearTimeout(u)}),(n||1e4)+10);return g},this.getSystemInfo=()=>_t(this,void 0,void 0,(function*(){const t=this;return yield new Promise((e=>{var i;null===(i=this.minip)||void 0===i||i.getSystemInfo({success:i=>{t.systemInfo=i,e(i)},fail:()=>e(null)})}))})),this.getSetting=()=>new Promise((t=>{var e;null===(e=this.minip)||void 0===e||e.getSetting({success:t,fail:t})}));const{platformConfig:{platform:e,scnPrefix:i}}=this.growingIO;this.platform=e,this.scnPrefix=i,this.getNetworkType().then((()=>{var t;return null===(t=this.growingIO.dataStore)||void 0===t?void 0:t.eventReleaseInspector()})),this.getSystemInfo().then((()=>{var t;return null===(t=this.growingIO.dataStore)||void 0===t?void 0:t.eventReleaseInspector()}))}}const Pt=ot();var Tt={wx:class extends Ct{constructor(t){super(t),this.growingIO=t,this.getAppId=()=>{let t;return this.systemInfo||(this.systemInfo=wx.getSystemInfoSync()),((t,e)=>{const i=t=>t.replace(/\s+/g,""),n=t=>t.replace(/[vV]/g,""),o=i(n(this.systemInfo.SDKVersion)),s=i(n("2.2.2")),r=o.split("."),a=s.split(".");return""===m(r)&&r.unshift(0),""===m(a)&&a.unshift(0),(r.length>a.length?r:a).every(((t,e)=>Number.parseInt(r[e]||0,10)>=Number.parseInt(a[e]||0,10)))})()&&(t=wx.getAccountInfoSync().miniProgram.appId),t},this.getPageTitle=t=>{var e,i,n,o;let s="";try{if(s=u(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.gioPageTitle)?null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.gioPageTitle:"",0===s.length){const e=null===(o=null===(n=null===__wxConfig||void 0===__wxConfig?void 0:__wxConfig.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));s=(null==e?void 0:e.text)||""}if(0===s.length){const e=__wxConfig.page[t.route]||__wxConfig.page[t.route+".html"];s=e?e.window.navigationBarTitleText:__wxConfig.global.window.navigationBarTitleText}}catch(t){return""}return V(s)}}},swan:class extends Ct{constructor(t){super(t),this.growingIO=t,this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"selectAll")},this.getPageTitle=t=>{var e,i,n,o;let s="";try{s=u(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.gioPageTitle)?null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.gioPageTitle:"";const r=D((()=>JSON.parse(appConfig)))||{};if(0===s.length){const e=null===(o=null===(n=null==r?void 0:r.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));s=(null==e?void 0:e.text)||""}if(0===s.length){const e=r.page[t.route]||r.page[t.route+".html"];s=e?e.window.navigationBarTitleText:r.window.navigationBarTitleText}}catch(t){return""}return V(s)}}},my:class extends Ct{constructor(t){super(t),this.growingIO=t,this.getAppId=()=>{if(my.getAppIdSync){const{appId:t}=my.getAppIdSync();return t}return B("当前支付宝版本过低，无法获取AppId，请升级最新版本支付宝!","warn"),""},this.initImpression=t=>{var e,i;null===(i=null===(e=this.growingIO.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===i||i.main(t,"selectAll")},this.getStorageSync=t=>{const{data:e}=my.getStorageSync({key:t});return e},this.setStorageSync=(t,e)=>{var i;null===(i=this.minip)||void 0===i||i.setStorageSync({key:t,data:e})}}},qq:class extends Ct{constructor(t){super(t),this.growingIO=t,this.getAppId=()=>{var t;const e=qq.getAccountInfoSync();return null===(t=null==e?void 0:e.miniProgram)||void 0===t?void 0:t.appId},this.getPageTitle=t=>{var e,i,n,o;let s="";try{if(s=u(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.gioPageTitle)?null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.gioPageTitle:"",0===s.length){const e=null===(o=null===(n=null===__qqConfig||void 0===__qqConfig?void 0:__qqConfig.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));s=(null==e?void 0:e.text)||""}if(0===s.length){const e=__qqConfig.page[t.route]||__qqConfig.page[t.route+".html"];s=e?e.window.navigationBarTitleText:__qqConfig.global.window.navigationBarTitleText}}catch(t){return""}return V(s)}}},tt:class extends Ct{constructor(t){super(t),this.growingIO=t,this.getPageTitle=t=>{var e,i,n,o;let s="";try{if(s=u(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.gioPageTitle)?null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.gioPageTitle:"",0===s.length){const e=null===(o=null===(n=null===__ttConfig||void 0===__ttConfig?void 0:__ttConfig.tabBar)||void 0===n?void 0:n.list)||void 0===o?void 0:o.find((e=>e.pagePath===t.route||e.pagePath===t.route+".html"));s=(null==e?void 0:e.text)||""}if(0===s.length){const e=__ttConfig.page[t.route]||__ttConfig.page[t.route+".html"];s=e?e.window.navigationBarTitleText:__ttConfig.global.window.navigationBarTitleText}}catch(t){return""}return V(s)}}}}[Pt];class Et{constructor(t){this.growingIO=t,this.main=t=>{var e,i,n,o;const{sdkVersion:s,vdsConfig:r,platformConfig:a,minipInstance:l,userStore:g,dataStore:{eventHooks:u,locationData:d,lastVisitEvent:h}}=this.growingIO,{systemInfo:c={},network:p={}}=l,{brand:v,model:m,platform:f,language:I,version:y}=c,S={appChannel:"scn:"+(u.scene||"NA"),appVersion:r.version,dataSourceId:r.dataSourceId,deviceBrand:v,deviceId:g.uid,deviceModel:m,deviceType:nt(f,a.name),domain:r.appId||l.getAppId(),gioId:g.gioId,language:I,latitude:null==d?void 0:d.latitude,longitude:null==d?void 0:d.longitude,networkState:(null==p?void 0:p.networkType)||(null==p?void 0:p.type),operatingSystem:nt(f,a.name),path:(null===(e=u.currentPage)||void 0===e?void 0:e.path)?null===(i=u.currentPage)||void 0===i?void 0:i.path:h.path,platform:a.platform,platformVersion:a.name+(y?" "+y:""),query:(null===(n=u.currentPage)||void 0===n?void 0:n.path)?null===(o=u.currentPage)||void 0===o?void 0:o.query:h.query,screenHeight:(w=c,w.pixelRatio?Math.round(w.screenHeight*w.pixelRatio):w.screenHeight),screenWidth:it(c),sdkVersion:s,sessionId:g.sessionId,title:l.getPageTitle(l.getCurrentPage()),timestamp:Date.now(),userId:g.userId,userKey:g.userKey};var w;return H(r.ignoreFields)||r.ignoreFields.forEach((t=>{q(S,t)})),H(t)?S:Object.assign(Object.assign({},S),t)}}}const At=t=>{const e=t.split(/[\r\n]/);return(t=>{const e=[];if(t&&t.length>0)for(let i=0;i<t.length;i++){const n=t[i];if(e[0]=t[i-1],e[1]=n,/at /.test(n))break}if(e.some((t=>!t)))return;const i=e[0].split(/: ?/);if(!i||2>i.length)return;const n=e[1].match(/at (.*?) \((.*)\)/);return n&&n.length>=3?{key:i[0],error:i[1],function:n[1],page:n[2]}:void 0})(e)||(t=>{let e;if(t&&t.length>1){const i=t[1].split(";");if(i&&i.length>1){const n=i[1].match(/at ([^ ]+) page (.*) function/);e={key:t[0],error:i[0]},n&&n.length>2&&(e.page=n[1],e.function=n[2])}}return e})(e)||(t=>{if(t&&t.length>0)return{error:t.join("")}})(e)};class kt{constructor(t){this.growingIO=t,this.main=(t,e)=>{var i;const{userStore:n,vdsConfig:o,platformConfig:s,dataStore:{eventHooks:r,lastVisitEvent:a}}=this.growingIO;o.debug&&console.log("App:",t,Date.now());const l=s.listeners.app;if(!r.shareOut)switch(this.growingIO.emitter.emit("onComposeBefore",{event:t,params:null!==(i=e[0])&&void 0!==i?i:{}}),t){case l.appCreate:case l.appShow:if(H(a)&&e[0]){const{path:t="",query:i={}}=e[0];this.growingIO.dataStore.lastVisitEvent={path:t,query:J.stringify(i)}}this.parseScene(e),(!r.lastCloseTime||Date.now()-r.lastCloseTime>r.keepAlive||r.lastScene&&r.scene!==r.lastScene)&&(n.sessionId="",this.buildVisitEvent(e[0]));break;case l.appClose:r.lastScene=r.scene,r.lastCloseTime=Date.now(),n.syncUserInfo(),this.buildCloseEvent(),this.growingIO.uploader.initiateRequest(!0);break;case l.appError:case l.appPageNotFound:case l.appUnhandledRejection:e&&e.length>0&&u(e[0])&&this.buildErrorEvent(e[0])}},this.parseScene=t=>{var e;const{minipInstance:i,gioPlatform:n,emitter:o,dataStore:{eventHooks:s}}=this.growingIO,r=s.scene;let a;if("quickapp"===n){const{extra:t,type:e}=i.getAppSource();a=(null==t?void 0:t.scene)||e}else if(t.length>0){const i=t[0];(null===(e=null==i?void 0:i.query)||void 0===e?void 0:e.wxShoppingListScene)?a=i.query.wxShoppingListScene:(null==i?void 0:i.scene)?a=i.scene:s.scene="NA"}s.scene=a,a!==r&&o.emit("SCENE_UPDATE",{newScene:a,oldScene:r})},this.buildVisitEvent=t=>{const{dataStore:e}=this.growingIO,{eventContextBuilder:i,eventInterceptor:n}=e;n(Object.assign({eventType:"VISIT"},i({path:(null==t?void 0:t.path)||(null==t?void 0:t.p)||"",query:c(null==t?void 0:t.query)?J.stringify((null==t?void 0:t.query)||{}):(null==t?void 0:t.query)||(null==t?void 0:t.q)||""})))},this.buildCloseEvent=()=>{const{dataStore:{eventContextBuilder:t,eventInterceptor:e}}=this.growingIO;e(Object.assign({eventType:"APP_CLOSED"},t()))},this.buildErrorEvent=t=>{const{dataStore:{eventContextBuilder:e,eventInterceptor:i,eventHooks:n}}=this.growingIO;i(Object.assign({eventType:"CUSTOM",pageShowTimestamp:n.currentPage.time,eventName:"onError",attributes:At(t)},e()))}}}class xt{constructor(){this.parsePage=(t,e)=>{var i;this.path=t.route||t.uri||t.__route__||(null===(i=null==t?void 0:t.$page)||void 0===i?void 0:i.fullPath)||"",H(e)?this.query=void 0:this.query=this.getQuery(e),this.time=Date.now()},this.getQuery=t=>y(Object.keys(t||{})).filter((t=>"wxShoppingListScene"!==t)).map((e=>`${e}=${t[e]}`)).join("&"),this.updateShareResult=(t,e)=>{const{vdsConfig:i,currentPage:n,minipInstance:o,userStore:s}=t;if(null==i?void 0:i.followShare){const t=s.uid;e||(e={}),e.title||(e.title=o.getPageTitle(o.getCurrentPage()));const[i,r]=(t=>{if(u(t)){const e=t.indexOf("?");return-1!==e?[t.substring(0,e),t.substring(e+1)]:[t,""]}return["",""]})(E(e,"path")?e.path:n.path),a=J.parse(r||(E(e,"path")?e.query:n.query)||"")||{};E(e,"path")||A(a).forEach((t=>{(["gioPreShareId","gioShareId","suid"].includes(t)||t.toLowerCase().startsWith("utm_"))&&delete a[t]}));const[l,g]=this.buildShareQuery(a,t,e);e.query=l,e.path=(t=>u(t)?t.startsWith("/")?t:"/"+t:"")(i+"?"+l),e.attributes=g}return e},this.updateQueryShareId=t=>{t.gioShareId&&(this.queryShareId=t.gioShareId)},this.query=void 0}buildShareQuery(t,e,i){const n={gioShareId:et(),suid:e},o=Object.assign({},t,n),s=i.contentType||o.contentType,r=i.contentId||o.contentId;return s&&(n.contentType=s),r&&(n.contentId=r),this.queryShareId&&(n.gioPreShareId=this.queryShareId),[J.stringify(o),n]}}class jt{constructor(t){this.growingIO=t,this.main=(t,e,i)=>{var n,o,s,r,a,l,g,u;const{minipInstance:d,plugins:h,vdsConfig:c,platformConfig:v,dataStore:{eventHooks:m}}=this.growingIO,{currentPage:f,shareOut:I,toggleShareOut:y}=m;if(this.prevEvent[e]&&50>Date.now()-Number(this.prevEvent[e]))return;this.prevEvent[e]=Date.now(),c.wepy&&(t.route=t.$is),t.route||(t.route=d.getCurrentPath(t)),c.debug&&console.log("Page:",t.route,"#",e,Date.now());const S=v.listeners.page;this.growingIO.emitter.emit("onComposeBefore",{page:t,event:e,params:null!==(n=i[0])&&void 0!==n?n:{}});const w=t.route||t.uri||t.__route__||(null===(o=null==t?void 0:t.$page)||void 0===o?void 0:o.fullPath)||"";switch(e){case S.comShow:if(!c.comAsPage)break;case S.pageLoad:this.argQuery[w]=i[0]||j(t,"__displayReporter.query")||j(t,"$page.query")||j(t,"$wx.__displayReporter.query")||{};break;case S.pageShow:f.parsePage(t,this.argQuery[w]),I?y():this.buildPageEvent(),f.updateQueryShareId(this.argQuery[w]),d.initImpression(d.getCurrentPage());break;case S.pageReady:c.taro&&(t=>{const{Current:e,createComponent:i}=t;return!(!t||!e||i)})(c.taro)&&(null===(r=null===(s=this.growingIO.plugins)||void 0===s?void 0:s.gioTaroAdapter)||void 0===r||r.saveFullPage(document.body),d.initImpression(d.getCurrentPage()));break;case S.comHide:case S.pageHide:(null===(a=null==h?void 0:h.gioImpressionTracking)||void 0===a?void 0:a.impressionObserver)&&(null===(g=null===(l=null==h?void 0:h.gioImpressionTracking)||void 0===l?void 0:l.impressionObserver)||void 0===g||g.disconnect(),this.growingIO.plugins.gioImpressionTracking.impressionObserver=null);break;case S.shareApp:case S.shareTime:y(!0),c.followShare&&this.buildPageShareEvent(i);break;case S.tabTap:{const t=null===(u=null==h?void 0:h.gioEventAutoTracking)||void 0===u?void 0:u.buildTabClickEvent;c.autotrack&&t&&p(t)&&t(i[0]);break}}},this.buildPageEvent=()=>{const{minipInstance:t,dataStore:{lastPageEvent:e,eventContextBuilder:i,eventInterceptor:n,eventHooks:o}}=this.growingIO,{scene:s,currentPage:r}=o;n(Object.assign(Object.assign({eventType:"PAGE",referralPage:(null==e?void 0:e.path)||(null==e?void 0:e.p)||(s?`scn:${t.scnPrefix}${s}`:null)},i()),{timestamp:r.time}))},this.buildPageShareEvent=t=>{var e;let i,n;2>t.length?1===t.length&&(t[0].from?i=t[0]:t[0].title&&(n=t[0])):(i=t[0],n=t[1]);const{dataStore:{eventContextBuilder:o,eventInterceptor:s,eventHooks:r}}=this.growingIO;s(Object.assign({eventType:"CUSTOM",eventName:"onShareAppMessage",pageShowTimestamp:r.currentPage.time,attributes:Object.assign({from:null==i?void 0:i.from,target:null===(e=null==i?void 0:i.target)||void 0===e?void 0:e.id,title:null==n?void 0:n.title,path:decodeURI((null==n?void 0:n.path)||"")},null==n?void 0:n.attributes)},o()))},this.prevEvent={},this.argQuery={}}}class qt{constructor(t){var e,i,n;this.growingIO=t,this.toggleShareOut=t=>{h(t)?this.shareOut=t:this.shareOut=!this.shareOut},this.isNormalFc=(t,e)=>p(e)&&"constructor"!==t,this.objectTraverse=(t,e)=>{Object.getOwnPropertyNames(t).forEach((i=>e(i,t))),E(t,"methods")&&Object.getOwnPropertyNames(t.methods).forEach((i=>{t[i]||e(i,t.methods)})),E(t,"lifetimes")&&Object.getOwnPropertyNames(t.lifetimes).forEach((i=>{t[i]||e(i,t.lifetimes)})),E(t,"pageLifetimes")&&Object.getOwnPropertyNames(t.pageLifetimes).forEach((i=>{t[i]||e(i,t.pageLifetimes)}))},this.supLifeFcs=(t,e)=>{v(this[e+"Handlers"])&&this[e+"Handlers"].forEach((e=>{p(t[e])||["onShareAppMessage","onShareTimeline"].includes(e)||(t[e]=()=>{})}))},this.lifeFcEffects=(t,e,i)=>{const n=this;return function(){let o;try{["onShareAppMessage","onShareTimeline"].includes(t)&&(o=e.apply(this,arguments),n.growingIO.vdsConfig.followShare&&(o=n.currentPage.updateShareResult(Object.assign(Object.assign({},n),n.growingIO),o)));const s=[].slice.call(arguments);o&&s.push(o),n[`def${i}Cbs`][t].apply(this,s)}catch(t){B(t,"error")}return["onShareAppMessage","onShareTimeline"].includes(t)||(o=e.apply(this,arguments)),o}},this.customFcEffects=(t,e)=>{const i=this;return function(){var n,o;let s;try{let e=arguments[0]||{};E(e,"type")&&((null==e?void 0:e.currentTarget)||(null==e?void 0:e.target))||(e=arguments[arguments.length-1]),((null==e?void 0:e.currentTarget)||(null==e?void 0:e.target))&&i.actionEventTypes.includes(e.type)&&(p(i.actionEffects)||(i.actionEffects=(null===(o=null===(n=i.growingIO.plugins)||void 0===n?void 0:n.gioEventAutoTracking)||void 0===o?void 0:o.main)||function(){}),null==i||i.actionEffects(e,t))}catch(t){B(t,"error")}return s=e.apply(this,arguments),s}},this.appApplyProxy=(t,e)=>this.appHandlers.includes(t)?this.lifeFcEffects(t,e,"App"):this.customFcEffects(t,e),this.pageApplyProxy=(t,e)=>this.pageHandlers.includes(t)?this.lifeFcEffects(t,e,"Page"):this.customFcEffects(t,e),this.componentApplyProxy=(t,e)=>this.componentHandlers.includes(t)?this.lifeFcEffects(t,e,"Component"):this.customFcEffects(t,e),this.appOverriding=t=>(this.supLifeFcs(t,"app"),this.objectTraverse(t,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.appApplyProxy(t,e[t]))})),t),this.pageOverriding=t=>(this.supLifeFcs(t,"page"),this.objectTraverse(t,((t,e)=>{this.isNormalFc(t,e[t])&&(e[t]=this.pageApplyProxy(t,e[t]))})),t),this.componentOverriding=t=>{const{vdsConfig:{comAsPage:e}}=this.growingIO;return e&&("my"===this.growingIO.gioPlatform?this.supLifeFcs(t,"component"):(t.lifetimes||(t.lifetimes={}),this.supLifeFcs(t.lifetimes,"component"),t.pageLifetimes||(t.pageLifetimes={}),this.supLifeFcs(t.pageLifetimes,"component"))),this.objectTraverse(t,((t,i)=>{this.isNormalFc(t,i[t])&&(i[t]=e?this.componentApplyProxy(t,i[t]):this.pageApplyProxy(t,i[t]))})),t},this.growingApp=t=>this.originalApp(this.appOverriding(t)),this.growingPage=t=>this.originalPage(this.pageOverriding(t)),this.growingComponent=t=>this.originalComponent(this.componentOverriding(t)),this.growingBehavior=t=>this.originalBehavior(this.componentOverriding(t)),this.nativeGrowing=()=>{const t=this,{platformConfig:e}=this.growingIO,i=e.hooks;try{i.App&&!this.appHooked&&(App=function(){return t.growingApp(arguments[0])},this.appHooked=!0)}catch(t){}try{i.Page&&!this.pageHooked&&(Page=function(){return t.growingPage(arguments[0])},this.pageHooked=!0)}catch(t){}try{i.Component&&!this.componentHooked&&(Component=function(){return t.growingComponent(arguments[0])},this.componentHooked=!0)}catch(t){}try{i.Behavior&&!this.behaviorHooked&&(Behavior=function(){return t.growingBehavior(arguments[0])},this.behaviorHooked=!0)}catch(t){}},this.initEventHooks=()=>{const t=this,{platformConfig:e,gioPlatform:i}=this.growingIO;this.appHandlers.forEach((e=>{this.defAppCbs[e]=function(){t.appEffects.main(e,arguments)}})),this.pageHandlers.forEach((e=>{this.defPageCbs[e]=function(){t.pageEffects.main(this,e,arguments)}})),this.componentHandlers.forEach((e=>{this.defComponentCbs[e]=function(){t.pageEffects.main(this,e,arguments)}})),e.canHook?this.nativeGrowing():"quickapp"===i&&(window.GioApp=function(){return t.appOverriding(arguments[0])},window.GioPage=function(){return t.pageOverriding(arguments[0])},window.GioComponent=function(){return t.componentOverriding(arguments[0])}),this.growingIO.App=D((()=>App)),this.growingIO.Page=D((()=>Page)),this.growingIO.Component=D((()=>Component)),this.growingIO.Behavior=D((()=>Behavior)),"quickapp"===i&&(this.growingIO.GioApp=window.GioApp,this.growingIO.GioPage=window.GioPage,this.growingIO.GioComponent=window.GioComponent)};const o=null===(e=this.growingIO)||void 0===e?void 0:e.platformConfig;this.defAppCbs={},this.defPageCbs={},this.defComponentCbs={},this.appHandlers=o.appHandlers,this.pageHandlers=o.pageHandlers,this.componentHandlers=o.componentHandlers,this.actionEventTypes=o.actionEventTypes,this.originalApp=o.originalApp,this.originalPage=o.originalPage,this.originalComponent=o.originalComponent,this.originalBehavior=null!==(i=o.originalBehavior)&&void 0!==i?i:function(){},this.appEffects=new kt(this.growingIO),this.pageEffects=new jt(this.growingIO),this.currentPage=new xt,this.shareOut=!1,this.keepAlive=null===(n=this.growingIO)||void 0===n?void 0:n.vdsConfig.keepAlive}}class Nt extends class{constructor(n){this.growingIO=n,this.ALLOW_SETTING=Object.assign({},t,"saas"===this.growingIO.gioEnvironment?i:e),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.initStorageId=()=>{const t=rt();let e=t.gio_esid?t.gio_esid:this.growingIO.minipInstance.getStorageSync(this.esidStorageName);e=c(e)&&!g(e)?e:{},this._esid={},A(e).forEach((t=>{this._esid[t]=Number.isNaN(Number(e[t]))||e[t]>=1e9||1>e[t]?1:e[t]})),x(e,this._esid)||this.growingIO.minipInstance.setStorageSync(this.esidStorageName,this._esid);const i=t.gio_gsid?t.gio_gsid:Number.parseInt(this.growingIO.minipInstance.getStorageSync(this.gsidStorageName),10);this._gsid=Number.isNaN(i)||i>=1e9||1>i?1:i,i!==this._gsid&&this.growingIO.minipInstance.setStorageSync(this.gsidStorageName,this._gsid)},this.initOptions=t=>{var e,i,n,o,s;const{projectId:r,dataSourceId:g,appId:u}=t,d={};this.allowOptKeys.forEach((e=>{const i=this.ALLOW_SETTING[e].type;(v(i)?i.includes(L(t[e])):L(t[e])===this.ALLOW_SETTING[e].type)?"ignoreFields"===e?d.ignoreFields=t.ignoreFields.filter((t=>a.includes(t))):"extraParams"===e?d.extraParams=t.extraParams.filter((t=>l.includes(t))):d[e]=t[e]:d[e]=this.ALLOW_SETTING[e].default})),d.uploadInterval=Math.round(d.uploadInterval),(Number.isNaN(d.uploadInterval)||0>d.uploadInterval||d.uploadInterval>2e3)&&(d.uploadInterval=1e3),this.growingIO.vdsConfig=Object.assign(Object.assign({},d),{projectId:r,dataSourceId:g,appId:u}),this.growingIO.inPlugin&&(this.growingIO.vdsConfig.autotrack=!1),this.eventHooks=new qt(this.growingIO),this.growingIO.inPlugin||this.eventHooks.initEventHooks();const{plugins:h}=this.growingIO,{cml:c,uniVue:p,wepy:m,taro:f,remax:I}=d;c&&(null===(e=null==h?void 0:h.gioChameleonAdapter)||void 0===e||e.main()),p&&(null===(i=null==h?void 0:h.gioUniAppAdapter)||void 0===i||i.main()),m&&(null===(n=null==h?void 0:h.gioWepyAdapter)||void 0===n||n.main()),f&&(null===(o=null==h?void 0:h.gioTaroAdapter)||void 0===o||o.main()),I&&(null===(s=null==h?void 0:h.gioRemaxAdapter)||void 0===s||s.main())},this.setOption=(t,e)=>{var i;const{vdsConfig:n,callError:o,uploader:s,emitter:r}=this.growingIO,a=u(t)&&this.allowOptKeys.includes(t),l=a&&typeof e===(null===(i=this.ALLOW_SETTING[t])||void 0===i?void 0:i.type);if(a&&l){if("dataCollect"===t&&!1===n.dataCollect&&!0===e){const t=setTimeout((()=>{this.sendVisit(),this.sendPage(),clearTimeout(t)}))}return n[t]=e,["host","scheme"].includes(t)&&(null==s||s.generateURL()),r.emit("OPTION_CHANGE",{optionName:t,optionValue:e}),!0}return o("setOption > "+t),!1},this.getOption=t=>{const{vdsConfig:e,callError:i}=this.growingIO;return t&&E(e,w(t))?e[w(t)]:g(t)?Object.assign({},e):void i("getOption > "+t)},this.sendVisit=()=>{this.eventHooks.appEffects.buildVisitEvent(this.lastVisitEvent)},this.sendPage=()=>{this.eventHooks.pageEffects.buildPageEvent()},this.eventInterceptor=t=>{const{systemInfo:e,network:i}=this.growingIO.minipInstance;H(e)||H(i)?this.interceptEvents.push(t):H(this.interceptEvents)?this.eventConverter(t):([...this.interceptEvents,t].forEach((t=>{const e=Object.assign(Object.assign({},t),this.eventContextBuilder({path:t.path,query:t.query}));this.eventConverter(e)})),this.interceptEvents=[])},this.eventReleaseInspector=()=>{const{minipInstance:{systemInfo:t,network:e}}=this.growingIO;t&&e&&!H(this.interceptEvents)&&([...this.interceptEvents].forEach((t=>{const e=Object.assign(Object.assign({},t),this.eventContextBuilder({path:t.path,query:t.query}));this.eventConverter(e)})),this.interceptEvents=[])},this.esidStorageName="_growing_esid_",this.gsidStorageName="_growing_gsid_",this.initStorageId(),this.eventContextBuilder=new Et(this.growingIO).main,this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.interceptEvents=[],this.growingIO.emitter.on("onComposeAfter",(({composedEvent:t})=>{"VISIT"!==t.eventType&&"vst"!==t.t||(this.lastVisitEvent=t),"PAGE"!==t.eventType&&"page"!==t.t||(this.lastPageEvent=t)}))}get esid(){const t=rt(),e=st(t);return!H(e)&&t.gio_esid?t.gio_esid:this._esid}set esid(t){const e={};A(t).forEach((i=>{e[i]=Number.isNaN(t[i])||t[i]>=1e9||1>t[i]?1:t[i]})),x(t,e)||(this._esid=e,rt().gio_esid=this._esid,this.growingIO.minipInstance.setStorageSync(this.esidStorageName,this._esid))}get gsid(){const t=rt(),e=st(t);return!H(e)&&t.gio_gsid?t.gio_gsid:this._gsid}set gsid(t){const e=Number.parseInt(t,10);this._gsid=Number.isNaN(e)||t>=1e9||1>t?1:t,rt().gio_gsid=this._gsid,this.growingIO.minipInstance.setStorageSync(this.gsidStorageName,this._gsid)}}{constructor(t){super(t),this.growingIO=t,this.eventConverter=t=>{const{vdsConfig:e,dataStore:i,uploader:n}=this.growingIO;if(e.dataCollect){t.globalSequenceId=i.gsid,t.eventSequenceId=i.esid[t.eventType]||1;const e={};k(t,((t,i)=>{var n;if("element"===i){const i=null!==(n=m(t))&&void 0!==n?n:{};k(i,((t,i)=>{H(t)&&0!==t||(e[i]=t)}))}else H(t)&&0!==t||(e[i]=t)})),this.growingIO.dataStore.gsid+=1,this.growingIO.dataStore.esid=Object.assign(Object.assign({},this.growingIO.dataStore.esid),{[e.eventType]:(this.growingIO.dataStore.esid[e.eventType]||1)+1}),this.growingIO.emitter.emit("onComposeAfter",{composedEvent:e}),n.commitRequest(e)}}}}class Ht extends class{constructor(t){this.growingIO=t,this.commitRequest=t=>{const e=Object.assign({},t),{vdsConfig:i}=this.growingIO;i.forceLogin?this.hoardingQueue.push(e):(this.requestQueue.push(e),this.initiateRequest())},this.initiateRequest=t=>{var e,i;const{plugins:n,vdsConfig:o}=this.growingIO;[...this.hoardingQueue,...this.requestQueue].length>0&&this.requestingNum<this.requestLimit&&((null===(e=null==o?void 0:o.tbConfig)||void 0===e?void 0:e.cloudFuncSend)?null===(i=null==n?void 0:n.gioTaobaoSendAdapter)||void 0===i||i.singleInvoke():t?this.batchInvoke():this.batchInvokeThrottle())},this.batchInvoke=()=>{var t,e,i;const{vdsConfig:n,plugins:o,emitter:s}=this.growingIO;let r=[...this.hoardingQueue,...this.requestQueue];r.length>50?(r=r.slice(0,50),this.hoardingQueue.length>50?this.hoardingQueue=this.hoardingQueue.slice(50):(this.hoardingQueue=[],this.requestQueue=this.requestQueue.slice(50-this.hoardingQueue.length))):(this.hoardingQueue=[],this.requestQueue=[]);let a=r.filter((t=>(this.retryIds[t.globalSequenceId||t.esid]||0)<=this.retryLimit));if(H(a))return;n.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(a,null,2));const l={"content-type":"application/json;charset=UTF-8"};if(s.emit("onSendBefore",{requestData:a}),null===(t=null==n?void 0:n.tbConfig)||void 0===t?void 0:t.cloudAppId)null===(e=null==o?void 0:o.gioTaobaoSendAdapter)||void 0===e||e.tbCloudAppInvoke(a);else{let t=[...a];n.compress&&(null===(i=null==o?void 0:o.gioCompress)||void 0===i?void 0:i.compressToUTF16)&&(t=o.gioCompress.compressToUTF16(JSON.stringify(a)),l["X-Compress-Codec"]="1"),this.normalBatchInvoke({header:l,data:t})}},this.batchInvokeThrottle=N(this.batchInvoke,this.growingIO.vdsConfig.uploadInterval,!1,!1),this.normalBatchInvoke=({header:t,data:e})=>{this.requestingNum+=1,this.growingIO.minipInstance.request({url:`${this.requestURL}?stm=${Date.now()}`,header:t,method:"POST",data:e,timeout:this.requestTimeout,fail:t=>{[200,204].includes(t.code)||(v(e)?e.forEach((t=>{this.requestFailFn(t)})):this.requestFailFn(e),B("请求失败!"+JSON.stringify(t),"error"))},complete:t=>{this.requestingNum-=1,this.growingIO.emitter.emit("onSendAfter",{result:t}),this.initiateRequest()}})},this.requestFailFn=t=>{this.retryIds[t.globalSequenceId||t.esid]||(this.retryIds[t.globalSequenceId||t.esid]=0),this.retryIds[t.globalSequenceId||t.esid]+=1,this.requestQueue.some((e=>e.globalSequenceId===t.globalSequenceId&&e.esid===t.esid))||this.requestQueue.push(t)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=3,this.requestTimeout=5e3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.requestURL=""}}{constructor(t){super(t),this.growingIO=t,this.generateURL=()=>{let{scheme:t,host:e="",projectId:i}=this.growingIO.vdsConfig;t?C(w(t),"://")||(t+="://"):t="https://",_(e,"http")&&(e=e.substring(e.indexOf("://")+(C(w(t),"://")?4:1))),this.requestURL=`${t}${e}/v3/projects/${i}/collect`},this.generateURL()}}const Lt=new class extends class{constructor(){var t;this.init=t=>(B("Gio小程序SDK 初始化中...","info"),t.appId||(t.appId=this.minipInstance.getAppId()||t.projectId),this.dataStore.initOptions(t),this.gioSDKInitialized=!0,this.vdsConfig.subpackage||(rt().__gio__=this),null==this||this.initCallback(),this.emitter.emit("SDK_INITIALIZED",this),B("Gio小程序SDK 初始化完成！","success"),this.vdsConfig.forceLogin&&B("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),this.inPlugin&&this.dataStore.sendVisit(),!0),this.setDataCollect=t=>{this.setOption("dataCollect",!!t),this.notRecommended()},this.setAutotrack=t=>{this.setOption("autotrack",!!t),this.notRecommended()},this.enableDebug=t=>{this.setOption("debug",!!t),this.notRecommended()},this.setOption=(t,e)=>{if(o.includes(t)){const i=this.dataStore.setOption(t,e);return i&&s[t]&&B(`已${e?"开启":"关闭"}${s[t]}`,"info"),i}return B(`不存在可修改的配置项：${t}，请检查后重试!`,"warn"),!1},this.getDeviceId=()=>this.userStore.uid,this.getOption=t=>this.dataStore.getOption(t),this.getGioInfo=()=>{const{uid:t,userId:e,userKey:i,sessionId:n,gioId:o}=this.userStore,{projectId:s,appId:r,dataSourceId:a,dataCollect:l,enableIdMapping:g,extraParams:u,ignoreFields:d}=this.vdsConfig,h={gioappid:r,giocs1:e||"",gioplatform:this.platformConfig.platform,gioprojectid:s,gios:n,giou:t};return"cdp"===this.gioEnvironment&&(h.giodatacollect=l,h.giodatasourceid=a,h.gioid=o||"",g&&(h.giouserkey=i),H(u)||u.forEach((t=>{d.includes(t)||(h["gio"+t]=this.dataStore.lastVisitEvent[t])}))),J.stringify(h)},this.setLocation=(t,e)=>{const i={latitude:t,longitude:e},n=this.dataStore.locationData,o=t=>t>=-180&&180>=t;o(t)&&o(e)&&(n.latitude!==t||n.longitude!==e)&&(this.dataStore.locationData=i,this.dataStore.sendVisit())},this.notRecommended=()=>B("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info"),this.callError=(t,e=!0,i="参数不合法")=>B(`${e?"调用":"设置"} ${t} 失败，${i}!`,"warn"),this.utils=Object.assign(Object.assign(Object.assign({},F),R),{qs:J}),this.emitter={all:t=t||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map((function(t){t(i)})),(n=t.get("*"))&&n.slice().map((function(t){t(e,i)}))}},this.gioPlatform=ot(),this.gioEnvironment="cdp",this.sdkVersion="3.8.0";try{("quickapp"===this.gioPlatform||p(getApp)&&App)&&(this.inPlugin=!1)}catch(t){this.inPlugin=!0,B("未检测到小程序实例，自动切换为插件模式!","info")}this.platformConfig=bt,this.minipInstance=new Tt(this),this.userStore=new at(this),this.plugins=new ct(this),this.plugins.innerPluginInit()}}{constructor(){super(),this.registerPlugins=t=>{this.plugins.pluginItems=[...this.plugins.pluginItems,...t],this.plugins.installAll(t)},this.initCallback=()=>{this.uploader=new Ht(this)},this.setTrackerScheme=t=>{["http","https"].includes(t)?(this.dataStore.setOption("scheme",t),this.notRecommended()):this.callError("scheme",!1)},this.setTrackerHost=t=>{W.test(t)||z.test(t)?(this.dataStore.setOption("host",t),this.notRecommended()):this.callError("host",!1)},this.identify=t=>{if(this.vdsConfig.forceLogin){if(!K(t))return void this.callError("identify");const e=w(t).slice(0,1e3);this.userStore.uid=e,this.uploader.hoardingQueue.forEach(((t,i)=>this.uploader.hoardingQueue[i].deviceId=e)),this.dataStore.setOption("forceLogin",!1),this.uploader.initiateRequest(!0)}else this.callError("identify",!1,"forceLogin未开启")},this.setUserAttributes=t=>{var e,i;!H(t)&&c(t)?null===(i=null===(e=this.plugins)||void 0===e?void 0:e.gioCustomTracking)||void 0===i||i.buildUserAttributesEvent(t):this.callError("setUser")},this.setUserId=(t,e)=>{if(K(t)){const i=this.userStore.gioId;t=w(t).slice(0,1e3),e=w(e).slice(0,1e3),this.userStore.userId=t,this.vdsConfig.enableIdMapping&&(this.userStore.userKey=g(e)?"":e),this.reissueLogic(i,t)}else this.callError("setUserId")},this.clearUserId=()=>{this.userStore.userId=void 0,this.userStore.userKey=void 0},this.track=(t,e,i)=>{var n,o;((null===(o=null===(n=this.plugins)||void 0===n?void 0:n.gioCustomTracking)||void 0===o?void 0:o.buildCustomEvent)||function(){})(t,c(e)?e:{},i)},this.reissueLogic=(t,e)=>{t&&t!==e&&(this.userStore.sessionId="",this.dataStore.sendVisit()),t||t===e||this.dataStore.sendVisit()},this.dataStore=new Nt(this)}},Ft=function(){const t=arguments[0];if(u(t)&&n.includes(t)&&Lt[t]){const e=I(Array.from(arguments));if("init"===t){const t=$(Lt),i=Q(e),n=G(e),o=M(e);if(t&&i&&n&&o){const{projectId:t}=n,{dataSourceId:e,appId:i,cdpOptions:s}=o;return i||"quickapp"!==Lt.gioPlatform?Lt.init(Object.assign(Object.assign({},s),{projectId:t,dataSourceId:e,appId:i})):(B("请填写AppId(packageName)!","error"),!1)}}else if("registerPlugins"===t)Lt.registerPlugins(e[0]);else{if(Lt.gioSDKInitialized&&Lt.vdsConfig)return Lt[t](...e);B("SDK未初始化!","error")}}else r.includes(t)?B(`方法 ${w(t)} 已被弃用!`,"warn"):B(`不存在名为 ${w(t)} 的方法调用!`,"error")};(global||$global).gdp=Ft,(global||$global).gioEnvironment="cdp",(global||$global).gioSDKVersion=Lt.sdkVersion;export{Ft as default};
