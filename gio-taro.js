var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+n+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)};function i(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((i=i.apply(e,t||[])).next())}))}function r(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function o(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var a={autotrack:{type:"boolean",default:!0},cml:{type:"object",default:!1},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},followShare:{type:"boolean",default:!0},forceLogin:{type:"boolean",default:!1},subpackage:{type:"boolean",default:!1},keepAlive:{type:"number",default:3e5},remax:{type:["object","module"],default:!1},taro:{type:["object","module"],default:!1},taroVue:{type:["object","function"],default:!1},tbConfig:{type:"object",default:{cloudFuncSend:!1,cloudFuncName:"httpTunnel",cloudFuncHandler:"main",cloudAppId:void 0,path:void 0}},uniVue:{type:["object","function"],default:!1},version:{type:"string",default:"1.0.0"},wepy:{type:"function",default:!1}},s={compress:{type:"boolean",default:!0},enableIdMapping:{type:"boolean",default:!1},extraParams:{type:"array",default:[]},gtouchHost:{type:"string",default:"cdp.growingio.com"},host:{type:"string",default:"napi.growingio.com"},ignoreFields:{type:"array",default:[]},scheme:{type:"string",default:"https"},uploadInterval:{type:"number",default:1e3},performance:{type:"object",default:{monitor:!0,exception:!0}}},u={},c=["clearUserId","enableDebug","getGioInfo","getOption","identify","init","setAutotrack","setDataCollect","setOption","setUserId","track","setLocation","setGeneralProps","clearGeneralProps","setPageAttributes","updateImpression"];o(o([],c,!0),["setEvar","setPage","setUser","setVisitor"],!1);var l,g,d=o(o([],c,!0),["setTrackerHost","setTrackerScheme","setUserAttributes","registerPlugins","getDeviceId","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer"],!1),p=["autotrack","dataCollect","debug","host","scheme"],f={autotrack:"无埋点",dataCollect:"数据采集",debug:"调试模式"},v=["setConfig","collectImp","setPlatformProfile","getLocation"],h=["deviceBrand","deviceModel","deviceType","networkState","screenHeight","screenWidth","operatingSystem"],m=o(o([],h,!0),["appChannel","language","platformVersion"],!1),I=function(e){return["undefined","null"].includes(G(e))},y=function(e){return"string"===G(e)},S=function(e){return"number"===G(e)},w=function(e){return"boolean"===G(e)},O=function(e){return"[object Object]"==={}.toString.call(e)&&!I(e)},b=function(e){return["function","asyncfunction"].includes(G(e))},P=function(e){return Array.isArray(e)&&"array"===G(e)},_=function(e){try{return Array.from(e)[0]}catch(e){return}},T=function(e){try{var t=Array.from(e);return t[t.length-1]}catch(e){return}},k=function(e,t){return void 0===t&&(t=1),P(e)&&S(t)?e.slice(t>0?t:1,e.length):e},E=function(e){if(P(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!K(o)&&(n[t++]=o)}return n}return e},C=function(e,t){if(P(e)){var n=e.findIndex(t);return 0>n?void 0:e[n]}},A=function(e){return I(e)?"":"".concat(e)},x=function(e,t){return"string"===G(e)?e.split(t):e},N=function(e){if(y(e)){var t=x(e,"");return"".concat(_(t).toLowerCase()).concat(k(t).join(""))}return e},q=function(e,t){return e.slice(0,t.length)===t},H=function(e,t){var n=e.length,i=n;i>n&&(i=n);var r=i;return(i-=t.length)>=0&&e.slice(i,r)===t},j={}.hasOwnProperty,L=function(e,t){return!I(e)&&j.call(e,t)},D=function(e){return O(e)?Object.keys(e):[]},F=function(e,t){D(e).forEach((function(n){return t(e[n],n)}))},R=function(e,t){var n=D(e);return!(!O(e)||!O(t)||n.length!==D(t).length||n.map((function(n,i){return O(e[n])?R(e[n],t[n]):e[n]===t[n]})).includes(!1))},U=function(e,t,n){var i=e;return O(e)?(t.split(".").forEach((function(e){i=i?i[e]:n})),i):n},B=function(e,t){if(!O(e))return!1;try{if("string"===G(t))return delete e[t];if("array"===G(t))return t.map((function(t){return delete e[t]}));"object"===G(t)&&t.constructor===RegExp&&D(e).forEach((function(n){t.test(n)&&B(e,n)}))}catch(e){return!1}},V=function(e,t,n,i){var r;void 0===t&&(t=250);var o=0;return"boolean"!==G(n)&&(i=e,e=n,n=void 0),function(){for(var a=[],s=0;arguments.length>s;s++)a[s]=arguments[s];var u=this,c=Date.now()-o;function l(){o=Date.now(),e.apply(u,a)}i&&!r&&l(),r&&clearTimeout(r),void 0===i&&c>t?l():!0!==n&&(r=setTimeout(i?function(){r=void 0}:l,void 0===i?t-c:t))}},K=function(e){return P(e)?0===e.length:O(e)?0===D(e).length:!e},G=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},M=Object.freeze({__proto__:null,isNil:I,isString:y,isNumber:S,isBoolean:w,isObject:O,isRegExp:function(e){return"[object RegExp]"==={}.toString.call(e)},isFunction:b,isArray:P,isDate:function(e){return"date"===G(e)},fixed:function(e,t){return S(e)?Number(e.toFixed(S(t)?t:2)):y(e)&&"NaN"!==A(Number(e))?Number(Number(e).toFixed(S(t)?t:2)):e},head:_,last:T,drop:k,dropWhile:function(e,t){return P(e)?e.filter((function(e){return!t(e)})):e},compact:E,find:C,isEqualArray:function(e,t){return!(!P(e)||!P(t)||e.length!==t.length)&&e.every((function(e,n){return e===t[n]}))},toString:A,split:x,lowerFirst:N,upperFirst:function(e){if(y(e)){var t=x(e,"");return"".concat(_(t).toUpperCase()).concat(k(t).join(""))}return e},startsWith:q,endsWith:H,hasOwnProperty:j,has:L,keys:D,forEach:F,isEqual:R,get:U,unset:B,throttle:V,isEmpty:K,typeOf:G,formatDate:function(e){function t(e){return 10>e?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}}),Q=function(e,t){console.log("%c[GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},$=function(e){try{return e()}catch(e){return}},W=function(e){return y(e)?e.trim().substring(0,100):e},z=function(e,t){return y(e)&&!K(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():(Q("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},Z=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},J=function(e){return e.pixelRatio?Math.round(e.screenHeight*e.pixelRatio):e.screenHeight},Y=function(e){return e.pixelRatio?Math.round(e.screenWidth*e.pixelRatio):e.screenWidth},X=function(e,t){if(e){var n=e.toLowerCase();return-1!==n.indexOf("android")?"".concat(t,"-Android"):-1!==n.indexOf("ios")?"".concat(t,"-iOS"):e}},ee=function(e){if(y(e)){var t=e.indexOf("?");return-1!==t?[e.substring(0,t),e.substring(t+1)]:[e,""]}return["",""]},te=function(e){return y(e)?e.startsWith("/")?e:"/".concat(e):""},ne=function(e){return $((function(){switch(e){case"wx":return wx;case"my":return my;case"swan":return swan;case"tt":return tt;case"qq":return qq;case"ks":return ks;case"jd":return jd;default:var t=void 0;return t||(t=$((function(){return swan}))),t||(t=$((function(){return my}))),t||(t=$((function(){return tt}))),t||(t=$((function(){return qq}))),t||(t=$((function(){return ks}))),t||(t=$((function(){return jd}))),t||(t=$((function(){return wx}))),t}}))},ie=function(e){return $((function(){switch(e){case"wx":return __wxConfig;case"my":return __myConfig;case"swan":return appConfig;case"tt":return __ttConfig;case"qq":return __qqConfig;case"ks":return __ksConfig;case"jd":return __jdConfig;default:return}}))},re=function(){var e;return!e&&$((function(){return swan}))&&(e="swan"),!e&&$((function(){return tt}))&&(e="tt"),!e&&$((function(){return qq}))&&(e="qq"),!e&&$((function(){return my}))&&(e="my"),!e&&$((function(){return ks}))&&(e="ks"),!e&&$((function(){return jd}))&&(e="jd"),!e&&$((function(){return wx}))&&(e="wx"),e||C(D(global),(function(e){return A(e).toLowerCase().includes("quickapp")}))&&(e="quickapp"),e},oe=function(e){return D(e).filter((function(e){return e.indexOf("__sub")>-1&&e.indexOf("gio__")>-1})).sort()},ae=function(){var e=$((function(){return getApp({allowDefault:!0})}));return e||(e=se()),e},se=function(){var e;return null!==(e=$((function(){return $global})))&&void 0!==e?e:global},ue=function(e){var t={};return O(e)&&F(e,(function(e,n){var i=A(n).slice(0,100);O(e)?t[i]=ue(e):P(e)?(t[i]=e.slice(0,100),"cdp"===se().gioEnvironment?t[i]=t[i].join("||").slice(0,1e3):t[i]=A(t[i]).slice(0,1e3)):t[i]=I(e)?"":A(e).slice(0,1e3)})),t},ce=function(e,t){var n=function(){return t.map((function(t){return e.getStorageSync(t)}))};try{return e.minip.canIUse("batchGetStorageSync")?e.minip.batchGetStorageSync(t):n()}catch(e){return n()}},le=function(e,t){var n=function(){return t.map((function(t){var n=t.key,i=t.value;return e.setStorageSync(n,i)}))};try{return e.minip.canIUse("batchSetStorageSync")?e.minip.batchSetStorageSync(t):n()}catch(e){return n()}},ge=function(e){return D(e||{}).map((function(t){return t?"".concat(t,"=").concat(I(e[t])?"":e[t]):""})).join("&")},de=function(e){(q(e,"?")||q(e,"&"))&&(e=e.slice(1,e.length));var t={};return e.split("&").forEach((function(e){var n=e.split("=");n[0]&&(t[n[0]]=n[1])})),t},pe=Object.freeze({__proto__:null,consoleText:Q,niceTry:$,limitString:W,eventNameValidate:z,guid:Z,getScreenHeight:J,getScreenWidth:Y,getOS:X,compareVersion:function(e,t){void 0===e&&(e=""),void 0===t&&(t="");for(var n=function(e){return e.replace(/\s+/g,"")},i=function(e){return e.replace(/[vV]/g,"")},r=n(i(e)),o=n(i(t)),a=r.split("."),s=o.split("."),u=0;3>u;u++){var c=Number(a[u]),l=Number(s[u]);if(c>l)return 1;if(l>c)return-1;if(!isNaN(c)&&isNaN(l))return 1;if(isNaN(c)&&!isNaN(l))return-1}return 0},getVueVersion:function(e){if(e){var t=Number.parseInt(_(x(e.version,".")),10);return Number.isNaN(t)?0:t}return 0},splitPath:ee,normalPath:te,isTaro3:function(e){var t=e.Current,n=e.createComponent;return!(!e||!t||n)},getPlainMinip:ne,getPlainConfig:ie,getPlainPlatform:re,getSubKeys:oe,getAppInst:ae,getGlobal:se,limitObject:ue,batchGetStorageSync:ce,batchSetStorageSync:le,qsStringify:ge,qsParse:de,hashCode:function(e){var t=0;if(K(e)||"boolean"==typeof e)return t;for(var n=0;n<e.length;)t=(t<<5)-t+e.charCodeAt(n),t&=t,n++;return t}}),fe=function(e){return y(e)&&e.length>0||S(e)&&e>0},ve=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,he=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,me={name:"gioTaroAdapter",method:function(e){var t=this;this.growingIO=e,this.main=function(){var e,n,i,r;t.taro||(t.taro=null===(n=null===(e=t.growingIO)||void 0===e?void 0:e.vdsConfig)||void 0===n?void 0:n.taro),t.vue||(t.vue=null===(r=null===(i=t.growingIO)||void 0===i?void 0:i.vdsConfig)||void 0===r?void 0:r.taroVue);var o=t.taro,a=o.Current,s=o.createComponent;!a&&s?t.proxyTaro2(t.taro):a&&!s?t.proxyTaro3(t.taro,t.vue):l.consoleText("未获取到Taro实例或不支持的Taro版本，请检查!","error")},this.proxyTaro2=function(e){var n=t,i=e.createApp,r=e.createComponent;i&&(e.createApp=function(e){var t=i(e);return n.growingIO.dataStore.eventHooks.appOverriding(t),t}),r&&(e.createComponent=function(e,t){var i=r(e,t),o=t?"page":"component";switch(n.growingIO.gioPlatform){case"wx":case"qq":n.growingIO.dataStore.eventHooks["".concat(o,"Overriding")](i.methods);break;case"my":case"tt":case"jd":n.growingIO.dataStore.eventHooks["".concat(o,"Overriding")](i);break;case"swan":n.growingIO.dataStore.eventHooks["".concat(o,"Overriding")](i),n.growingIO.dataStore.eventHooks["".concat(o,"Overriding")](i.methods)}return i})},this.proxyTaro3=function(e,n){var i=t.growingIO.dataStore.eventHooks;if(n){console.log("Vue version: ",n.version);var r=Number.parseInt(l.head(l.split(n.version,".")),10);i.nativeGrowing(),2===r?t.taro3Vue2Proxy(n):3===r?t.taro3Vue3Proxy(n):l.consoleText("不支持的Vue版本，请使用 Vue2 或 Vue3!","error")}else i.nativeGrowing(["App"]),t.taro3ReactProxy(e)},this.taro3ReactProxy=function(e){var n,i,r,o=document.__proto__.__proto__,a=t,s=t.growingIO.dataStore.eventHooks,u=null===(n=null==e?void 0:e.hooks)||void 0===n?void 0:n.call;u?a.defineProperty(e.hooks,"call",(function(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];var n=Array.from(e),i=u.apply(this,n);if("modifyPageObject"===n[0]){var r=n[1];l.keys(r).forEach((function(e){s.pageHandlers.includes(e)&&(r[e]=s.lifeFcEffects(e,l.isFunction(r[e])?r[e]:function(){},"Page"))}))}return i})):(l.consoleText("Taro3实例获取失败，请检查初始化逻辑!","warn"),s.nativeGrowing(["Page"])),a.defineProperty(o,"addEventListener",(i=o.addEventListener,function(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];var n=e[1],r=a.growingIO.dataStore.eventHooks.customFcEffects(n.name,n);return a.taro3Listeners[n.name]=r,i.call(this,e[0],r,e[2])})),a.defineProperty(o,"removeEventListener",(r=o.removeEventListener,function(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];return r.call(this,e[0],a.taro3Listeners[e[1].name])}))},this.taro3Vue2Proxy=function(e){var n=t;e.mixin({beforeMount:function(){var e=this,t=this.$options.methods;l.keys(t).forEach((function(t){n.defineProperty(e,t,n.proxyMethods(t,e[t]))}));var i=this._setupState;l.isEmpty(i)||l.keys(i).forEach((function(e){n.defineProperty(i,e,n.proxyMethods(e,i[e]))}))}})},this.taro3Vue3Proxy=function(e){var n=t.growingIO.dataStore.eventHooks,i=t;e.mixin({beforeMount:function(){var e,t=this,r=function(e){return l.keys(e).forEach((function(e){i.defineProperty(t,e,i.proxyMethods(e,t[e]))}))},o=this.$options.methods;o&&r(o);var a=null===(e=null==this?void 0:this._)||void 0===e?void 0:e.setupState;a&&r(a);var s=this._.emit;this._.emit=function(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];return n.customFcEffects(e[0],(function(){})).apply(this,e),s.apply(this,e)}},mounted:function(){var e,t,n=null!==(t=null===(e=null==this?void 0:this._)||void 0===e?void 0:e.exposed)&&void 0!==t?t:{};if(i.exposedNames={},!l.isEmpty(n)){var r={};l.keys(n).forEach((function(e){l.isFunction(n[e])&&(i.exposedNames[n[e].name]=e,r[n[e].name]=n[e])})),i.traverseHook(this._.vnode.el,0)}}})},this.proxyMethods=function(e,n){var i=t.growingIO.dataStore.eventHooks;return l.isFunction(n)&&!i.pageHandlers.includes(e)?function(){for(var t=[],r=0;arguments.length>r;r++)t[r]=arguments[r];return i.customFcEffects(e,n).apply(this,t)}:n},this.defineProperty=function(e,t,n){Object.defineProperty(e,t,{writable:!0,enumerable:!0,configurable:!0,value:n})},this.traverseHook=function(e,n){t.veiAutoEventHook(e,n),e.childNodes&&l.isArray(e.childNodes)&&e.childNodes.forEach((function(e,n){t.traverseHook(e,n)}))},this.veiAutoEventHook=function(e,n){var i=t.growingIO.dataStore.eventHooks;e._vei&&l.keys(e._vei).forEach((function(r){if(i.actionEventTypes.includes(r)){var o=e._vei[r].value,a=void 0;if((l.startsWith("".concat(o),"function ($event)")||l.startsWith("".concat(o),"function($event)"))&&/return \$setup.[\w]+\(/.test("".concat(o))){var s="".concat(o).match(/return \$setup.[\w]+\(/)[0];s&&(a=s.replace("return $setup.","").replace("(",""))}a||(a="".concat(l.keys(t.exposedNames)[n],"#").concat(Object.values(t.exposedNames)[n])),t.defineProperty(e._vei[r],"value",t.proxyMethods(t.exposedNames[o.name]||o.name||a,o))}}))},this.saveFullPage=function(e){var n=function(e){e.forEach((function(e){var i;(null===(i=null==e?void 0:e.ctx)||void 0===i?void 0:i.route)?(t.growingIO.taro3VMs||(t.growingIO.taro3VMs={}),t.growingIO.taro3VMs[e.ctx.route]=e):l.isArray(e.childNodes)&&n(e.childNodes)}))};n(e.childNodes)};var n=this.growingIO,i=n.utils,r=n.vdsConfig,o=n.emitter,a=n.minipInstance,s=n.gioPlatform;l=i,this.taro=null==r?void 0:r.taro,this.vue=null==r?void 0:r.taroVue,this.exposedNames={},this.taro3Listeners={},o.on("minipLifecycle",(function(e){var n,i;"Page onReadyEnd"===e.event&&t.taro&&l.isTaro3(t.taro)&&(null===(i=null===(n=t.growingIO.plugins)||void 0===n?void 0:n.gioTaroAdapter)||void 0===i||i.saveFullPage(document.body),["swan","tt"].includes(s)||setTimeout((function(){return a.initImpression(a.getCurrentPage())}),0))}))}};const Ie={};function ye(e,t,n){var i=e;t.map((function(e,r){i[e]=r==t.length-1?n:i[e]||{},i=i[e]}))}ye(Ie,["plugins","gioCustomTracking"],{name:"gioCustomTracking",method:function(e){var t=this;this.growingIO=e,this.getValidResourceItem=function(e){if(e&&g.isObject(e)&&e.id&&e.key){var t={id:g.isString(e.id)?e.id:g.toString(e.id),key:g.isString(e.key)?e.key:g.toString(e.key)};return e.attributes&&(t.attributes=e.attributes),t}},this.getDynamicAttributes=function(e){return g.isNil(e)||g.keys(e).forEach((function(t){g.isFunction(e[t])?e[t]=e[t]():g.isArray(e[t])||(e[t]=g.toString(e[t]))})),e},this.buildCustomEvent=function(e,i,r){g.eventNameValidate(e,(function(){var o,a=t.growingIO.dataStore,s=a.eventContextBuilder,u=a.eventInterceptor,c=a.eventHooks;u(n({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null===(o=null==c?void 0:c.currentPage)||void 0===o?void 0:o.time,attributes:g.limitObject(t.getDynamicAttributes(g.isObject(i)&&!g.isEmpty(i)?i:void 0)),resourceItem:g.limitObject(t.getValidResourceItem(r))},s()))}))},this.buildUserAttributesEvent=function(e){var i=t.growingIO.dataStore,r=i.eventContextBuilder,o=i.eventInterceptor,a=i.lastVisitEvent,s=n({eventType:"LOGIN_USER_ATTRIBUTES",attributes:g.limitObject(e)},r());s.path||(s.path=a.path,s.query=a.query,s.title=a.title),o(s)},g=this.growingIO.utils}}),ye(Ie,["plugins","gioTaroAdapter"],me);var Se=function(e){var t=this;this.growingIO=e,this.innerPluginInit=function(){D(Ie.plugins).forEach((function(e){var n=Ie.plugins[e],i=n.name,r=n.method;t.pluginItems.find((function(e){return e.name===i}))||t.pluginItems.push({name:N(i||e),method:r||function(e){}})})),K(t.pluginItems)||t.installAll()},this.install=function(e,n,i){var r,o=n||t.pluginItems.find((function(t){return t.name===e}));if(null===(r=t.growingIO)||void 0===r?void 0:r.plugins[e])return Q("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!o)return Q("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return t.growingIO.plugins[e]=new o.method(t.growingIO,i),"cdp"===t.growingIO.gioEnvironment&&n&&Q("加载插件：".concat(e),"info"),!0}catch(e){return Q("插件加载异常：".concat(e),"error"),!1}},this.installAll=function(e){(e||t.pluginItems).forEach((function(n){return t.install(n.name,e?n:void 0,n.options)}))},this.uninstall=function(e){var n;B(t.pluginItems,e);var i=B(null===(n=t.growingIO)||void 0===n?void 0:n.plugins,e);return i||Q("卸载插件 ".concat(e," 失败!"),"error"),i},this.uninstallAll=function(){t.pluginItems.forEach((function(e){return t.uninstall(e.name)}))},this.lifeError=function(e,t){return Q("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.onComposeBefore=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onComposeBefore;if(r&&b(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.onComposeAfter=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onComposeAfter;if(r&&b(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.onSendBefore=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onSendBefore;if(r&&b(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.onSendAfter=function(e){t.pluginItems.forEach((function(n){var i,r=null===(i=t.growingIO.plugins[n.name])||void 0===i?void 0:i.onSendAfter;if(r&&b(r))try{r(e)}catch(e){t.lifeError(n,e)}}))},this.pluginItems=[],this.growingIO.emitter.on("onComposeBefore",this.onComposeBefore),this.growingIO.emitter.on("onComposeAfter",this.onComposeAfter),this.growingIO.emitter.on("onSendBefore",this.onSendBefore),this.growingIO.emitter.on("onSendAfter",this.onSendAfter)},we=function(){function e(e){var t,n=this;this.growingIO=e,this.initUserInfo=function(){var e,t=n.growingIO.minipInstance,i=[n.uidStorageName,n.userIdStorageName,n.userKeyStorageName,n.gioIdStorageName],r=null!==(e=ce(t,i))&&void 0!==e?e:[];["_uid","_userId","_userKey","_gioId"].forEach((function(e,t){n[e]=r[t],"_uid"!==e||n[e]||(n.uid=Z())}))},this.saveUserInfo=function(){var e=n.growingIO.minipInstance;le(e,[{key:n.uidStorageName,value:n.uid},{key:n.userIdStorageName,value:n.userId},{key:n.userKeyStorageName,value:n.userKey},{key:n.gioIdStorageName,value:n.gioId}])};var i=this.growingIO.inPlugin;this.uidStorageName=i?"_growing_plugin_uid_":"_growing_uid_",this.userIdStorageName=i?"_growing_plugin_userId_":"_growing_userId_",this.userKeyStorageName=i?"_growing_plugin_userKey_":"_growing_userKey_",this.gioIdStorageName=i?"_growing_plugin_gioId_":"_growing_gioId_",this._sessionId=Z(),this._uid=void 0,this._userId=void 0,this._userKey=void 0,this._gioId=void 0,"quickapp"!==(null===(t=this.growingIO)||void 0===t?void 0:t.gioPlatform)&&this.initUserInfo()}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId||(this._sessionId=Z()),this._sessionId},set:function(e){var t=this._sessionId;this._sessionId=e||Z(),t!==this._sessionId&&this.growingIO.emitter.emit("SESSIONID_UPDATE",{newSessionId:this._sessionId,oldSessionId:t})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},set:function(e){var t=this._uid;this._uid=e,t!==this._uid&&(this.growingIO.minipInstance.setStorage(this.uidStorageName,this._uid),this.growingIO.emitter.emit("UID_UPDATE",{newUId:e,oldUId:t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){var t=this._userId;this._userId=e,t!==this._userId&&(this.growingIO.minipInstance.setStorage(this.userIdStorageName,this._userId),this.growingIO.emitter.emit("USERID_UPDATE",{newUserId:e,oldUserId:t})),e&&(this.gioId=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userKey",{get:function(){return this._userKey},set:function(e){var t=this._userKey;this._userKey=e,t!==this._userKey&&(this.growingIO.minipInstance.setStorage(this.userKeyStorageName,this._userKey),this.growingIO.emitter.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gioId",{get:function(){return this._gioId},set:function(e){var t=this._gioId;this._gioId=e,t!==this._gioId&&(this.growingIO.minipInstance.setStorage(this.gioIdStorageName,this._gioId),this.growingIO.emitter.emit("GIOID_UPDATE",{newGioId:e,oldGioId:t}))},enumerable:!1,configurable:!0}),e}(),Oe={scnPrefix:"",appHandlers:["onLaunch","onShow","onHide","onError","onPageNotFound"],pageHandlers:["onLoad","onShow","onReady","onHide","onUnload","onShareAppMessage","onTabItemTap"],actionEventTypes:["onclick","tap","onTap","longpress","longTap","blur","change","onChange","submit","confirm","getuserinfo","getphonenumber","contact"],originalApp:$((function(){return App})),originalPage:$((function(){return Page})),originalComponent:$((function(){return Component})),originalBehavior:$((function(){return Behavior})),canHook:!0,hooks:{App:!0,Page:!0,Component:!0,Behavior:!0},listeners:{app:{appLaunch:"onLaunch",appShow:"onShow",appClose:"onHide"},page:{pageLoad:"onLoad",pageShow:"onShow",pageReady:"onReady",pageHide:"onHide",pageUnload:"onUnload",tabTap:"onTabItemTap",shareApp:"onShareAppMessage"},actions:{click:["onclick","tap","longpress","longTap","getuserinfo","getphonenumber","contact"],change:["blur","change","confirm"],submit:["submit"]}}},be=n(n({},Oe),{listeners:n({},Oe.listeners),name:"JingDong",platform:"jdp",scnPrefix:"jd_"}),Pe=n(n({},Oe),{listeners:n({},Oe.listeners),name:"KuaiShou",platform:"kuaishoup",scnPrefix:"ks_"}),_e=n(n({},Oe),{listeners:n({},Oe.listeners),name:"Alipay",platform:"alip",scnPrefix:"alip_",hooks:n(n({},null==Oe?void 0:Oe.hooks),{Behavior:!1})}),Te=n(n({},Oe),{listeners:n({},Oe.listeners),name:"QQ",platform:"qq",scnPrefix:"qq_"});Te.pageHandlers=o(o([],Oe.pageHandlers,!0),["onAddToFavorites"],!1),Te.listeners.page.addFavorites="onAddToFavorites";var ke=n(n({},Oe),{listeners:n({},Oe.listeners),name:"Baidu",platform:"baidup",scnPrefix:"baidup_"}),Ee=n(n({},Oe),{listeners:n({},Oe.listeners),name:"Bytedance",platform:"bytedance",scnPrefix:"bytedance_"}),Ce=n(n({},Oe),{listeners:n({},Oe.listeners),name:"Weixin",platform:"MinP"});Ce.pageHandlers=o(o([],Oe.pageHandlers,!0),["onShareTimeline","onAddToFavorites"],!1),Ce.listeners.page=n(n({},Oe.listeners.page),{shareTime:"onShareTimeline",addFavorites:"onAddToFavorites"});var Ae=re(),xe=$((function(){var e={jd:be,ks:Pe,my:_e,qq:Te,swan:ke,tt:Ee,wx:Ce}[Ae];return e.canHook=!1,e})),Ne=function(e){var t=this;this.growingIO=e,this.minip=ne("framework"),this.hookSetTitle=function(){var e,n=null===(e=t.minip)||void 0===e?void 0:e.setNavigationBarTitle,i=t;n&&Object.defineProperty(t.minip,"setNavigationBarTitle",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){var e=i.getCurrentPath(),t=(arguments[0]||{}).title;i.growingIO.dataStore.eventHooks.currentPage.settedTitle[e]=t}return n.apply(this,arguments)}})},this.navigateTo=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.navigateTo(e)},this.switchTab=function(e){var n;null===(n=t.minip)||void 0===n||n.switchTab(e)},this.navigateToMiniProgram=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.navigateToMiniProgram(e)},this.getImageInfo=function(e){var n,i=e.src,r=e.success,o=e.fail,a=e.complete;return null===(n=t.minip)||void 0===n?void 0:n.getImageInfo({src:i,success:r,fail:o,complete:a})},this.initImpression=function(e){var n,i;null===(i=null===(n=t.growingIO.plugins)||void 0===n?void 0:n.gioImpressionTracking)||void 0===i||i.main(e,"observeAll")},this.getCurrentPage=function(){return $((function(){return T(getCurrentPages())}))||{}},this.getCurrentPath=function(){var e=t.getCurrentPage();return(null==e?void 0:e.route)||(null==e?void 0:e.uri)||(null==e?void 0:e.__route__)||""},this.getPageTitle=function(e){var t,n,i="",r=ie(re());try{var o=(null==e?void 0:e.data)||e.$data||{};if(0===(i=y(null==o?void 0:o.gioPageTitle)?null==o?void 0:o.gioPageTitle:"").length){var a=r.page[e.route]||r.page["".concat(e.route,".html")];i=a?a.window.navigationBarTitleText:r.global.window.navigationBarTitleText}if(0===i.length){var s=null===(n=null===(t=null==r?void 0:r.tabBar)||void 0===t?void 0:t.list)||void 0===n?void 0:n.find((function(t){return t.pagePath===e.route||t.pagePath==="".concat(e.route,".html")}));i=(null==s?void 0:s.text)||""}}catch(e){return""}return W(i)},this.getStorageSync=function(e){var n;return null===(n=t.minip)||void 0===n?void 0:n.getStorageSync(e)},this.getStorage=function(e){return new Promise((function(n){var i;null===(i=t.minip)||void 0===i||i.getStorage({key:e,success:function(e){var t=e.data;return n(t)},fail:function(){return n("")}})}))},this.setStorageSync=function(e,n){var i;null===(i=t.minip)||void 0===i||i.setStorageSync(e,n)},this.setStorage=function(e,n){var i;null===(i=t.minip)||void 0===i||i.setStorage({key:e,data:n})},this.removeStorageSync=function(e){var n;null===(n=t.minip)||void 0===n||n.removeStorageSync(e)},this.removeStorage=function(e){var n;null===(n=t.minip)||void 0===n||n.removeStorage(e)},this.getNetworkType=function(){return i(t,void 0,void 0,(function(){var e,t=this;return r(this,(function(n){switch(n.label){case 0:return e=this,[4,new Promise((function(n){var i;null===(i=t.minip)||void 0===i||i.getNetworkType({success:function(t){e.network=t,n(t)},fail:function(){return n(null)}})}))];case 1:return[2,n.sent()]}}))}))},this.request=function(e){var n,i=e.url,r=e.data,o=e.header,a=e.timeout,s=e.method,u=e.success,c=e.fail,l=e.complete,g=null===(n=t.minip)||void 0===n?void 0:n.request({url:i,data:r,header:o,headers:o,timeout:a,method:s,success:u,fail:c,complete:l}),d=setTimeout((function(){null==g||g.abort(),clearTimeout(d),d=null}),(a||1e4)+10);return g},this.getSystemInfo=function(){return i(t,void 0,void 0,(function(){var e,t=this;return r(this,(function(n){switch(n.label){case 0:return e=this,[4,new Promise((function(n){var i;null===(i=t.minip)||void 0===i||i.getSystemInfo({success:function(t){e.systemInfo=t,n(t)},fail:function(){return n(null)}})}))];case 1:return[2,n.sent()]}}))}))},this.getSetting=function(){return new Promise((function(e){var n;null===(n=t.minip)||void 0===n||n.getSetting({success:e,fail:e})}))};var n=this.growingIO.platformConfig,o=n.platform,a=n.scnPrefix;this.platform=o,this.scnPrefix=a,this.getNetworkType().then((function(){var e;return null===(e=t.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()})),this.getSystemInfo().then((function(){var e;return null===(e=t.growingIO.dataStore)||void 0===e?void 0:e.eventReleaseInspector()}))},qe=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.hookSetTitle(),n}return t(n,e),n}(Ne),He=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.hookSetTitle(),n}return t(n,e),n}(Ne),je=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.hookSetTitle=function(){var e,t=null===(e=n.minip)||void 0===e?void 0:e.setNavigationBar,i=n;t&&Object.defineProperty(n.minip,"setNavigationBar",{writable:!0,enumerable:!0,configurable:!0,value:function(){if(i.growingIO.gioSDKInitialized){var e=i.getCurrentPath(),n=(arguments[0]||{}).title;i.growingIO.dataStore.eventHooks.currentPage.settedTitle[e]=n}return t.apply(this,arguments)}})},n.initImpression=function(e){var t,i;null===(i=null===(t=n.growingIO.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===i||i.main(e,"selectAll")},n.getStorageSync=function(e){return my.getStorageSync({key:e}).data},n.setStorageSync=function(e,t){var i;null===(i=n.minip)||void 0===i||i.setStorageSync({key:e,data:t})},n.hookSetTitle(),n}return t(n,e),n}(Ne),Le=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.hookSetTitle(),n}return t(n,e),n}(Ne),De=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.initImpression=function(e){var t,i;null===(i=null===(t=n.growingIO.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===i||i.main(e,"selectAll")},n.hookSetTitle(),n}return t(n,e),n}(Ne),Fe=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.hookSetTitle(),n}return t(n,e),n}(Ne),Re={wx:function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.hookSetTitle(),n}return t(n,e),n}(Ne),swan:De,my:je,qq:Le,tt:Fe,ks:He,jd:qe}[re()],Ue={},Be={}.hasOwnProperty;function Ve(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function Ke(e){try{return encodeURIComponent(e)}catch(e){return null}}Ue.stringify=function(e,t){t=t||"";var n,i,r=[];for(i in"string"!=typeof t&&(t="?"),e)if(Be.call(e,i)){if((n=e[i])||null!=n&&!isNaN(n)||(n=""),i=Ke(i),n=Ke(n),null===i||null===n)continue;r.push(i+"="+n)}return r.length?t+r.join("&"):""},Ue.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var r=Ve(t[1]),o=Ve(t[2]);null===r||null===o||r in i||(i[r]=o)}return i};var Ge=function(e){var t=this;this.growingIO=e,this.main=function(e){var i,r,o,a,s,u=t.growingIO,c=u.sdkVersion,l=u.vdsConfig,g=u.platformConfig,d=u.minipInstance,p=u.userStore,f=u.dataStore,v=f.scene,h=f.eventHooks,m=f.locationData,I=f.lastVisitEvent,y=d.systemInfo,S=void 0===y?{}:y,w=d.network,O=void 0===w?{}:w,b=S.brand,P=S.model,_=S.platform,T=S.language,k=S.version,E={appChannel:"scn:".concat(v||"NA"),appVersion:l.version,dataSourceId:l.dataSourceId,deviceBrand:b,deviceId:p.uid,deviceModel:P,deviceType:X(_,g.name),domain:l.appId,gioId:p.gioId,language:T,latitude:null==m?void 0:m.latitude,longitude:null==m?void 0:m.longitude,networkState:(null==O?void 0:O.networkType)||(null==O?void 0:O.type)||(null==O?void 0:O.subtype),operatingSystem:X(_,g.name),path:(null===(i=h.currentPage)||void 0===i?void 0:i.path)?null===(r=h.currentPage)||void 0===r?void 0:r.path:I.path,platform:g.platform,platformVersion:g.name+(k?" ".concat(k):""),query:(null===(o=h.currentPage)||void 0===o?void 0:o.path)?null===(a=h.currentPage)||void 0===a?void 0:a.query:I.query,screenHeight:J(S),screenWidth:Y(S),sdkVersion:c,sessionId:p.sessionId,title:(null===(s=h.currentPage)||void 0===s?void 0:s.title)||d.getPageTitle(d.getCurrentPage()),timestamp:Date.now(),userId:p.userId};return l.enableIdMapping&&(E.userKey=p.userKey),K(l.ignoreFields)||l.ignoreFields.forEach((function(e){B(E,e)})),K(e)?E:n(n({},E),e)}},Me=function(e){var t=this;this.growingIO=e,this.main=function(e,n){var i,r,o=Date.now(),a=t.growingIO,s=a.emitter,u=a.userStore,c=a.vdsConfig,l=a.platformConfig,g=a.uploader,d=a.dataStore,p=a.dataStore,f=p.keepAlive,v=p.lastCloseTime,h=p.eventHooks,m=p.saveStorageInfo;s.emit("minipLifecycle",{event:"App ".concat(e),timestamp:o,params:null!==(i=n[0])&&void 0!==i?i:{}}),c.debug&&console.log("App:",e,o);var I=l.listeners.app;switch(s.emit("onComposeBefore",{event:"App ".concat(e),params:null!==(r=n[0])&&void 0!==r?r:{}}),e){case I.appCreate:case I.appShow:var y=t.enterParamsParse(n[0]),S=y.path,w=y.query;v?(Date.now()-v>f||d.lastScene&&d.scene!==d.lastScene)&&(u.sessionId="",h.currentPage.time=void 0,t.buildVisitEvent({path:S,query:w})):(t.growingIO.dataStore.lastVisitEvent={path:S,query:w},t.buildVisitEvent({path:S,query:w}));break;case I.appClose:d.lastScene=d.scene,d.lastCloseTime=Date.now(),m(),u.saveUserInfo(),t.buildCloseEvent(),c.forceLogin||g.initiateRequest(!0)}},this.enterParamsParse=function(e){var n=t.growingIO,i=n.gioPlatform,r=n.minipInstance,o=n.dataStore,a="",s="",u=function(e,t){void 0===t&&(t={}),a=e,s=D(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join("&")};if("quickapp"!==i&&r.minip.canIUse("getEnterOptionsSync")){var c=r.minip.getEnterOptionsSync()||{},l=c.path,g=c.query,d=c.scene,p=c.referrerInfo,f=e.query||g;if(u(e.path||l,f),o.scene=e.scene||d,!K(p)&&O(null==p?void 0:p.extraData)){var v=[];F(p.extraData,(function(e,t){!L(f,t)&&["string","number","boolean"].includes(G(e))&&v.push("".concat(t,"=").concat(e))}));var h=v.join("&");s=s&&h?"".concat(s,"&").concat(h):s||h}}else u(l=e.path,g=e.query),t.parseScene(e);return{path:a,query:s}},this.parseScene=function(e){var n,i,r=t.growingIO,o=r.minipInstance,a=r.gioPlatform,s=r.dataStore;if("quickapp"===a){var u=o.getAppSource(),c=u.extra,l=u.type;i=(null==c?void 0:c.scene)||l}else K(e)||((null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.wxShoppingListScene)?i=e.query.wxShoppingListScene:(null==e?void 0:e.scene)?i=e.scene:s.scene="NA");s.scene=i},this.buildVisitEvent=function(e){var i=t.growingIO.dataStore,r=i.eventContextBuilder,o=i.eventInterceptor,a=(null==e?void 0:e.query)||(null==e?void 0:e.q)||"";o(n({eventType:"VISIT"},r({path:(null==e?void 0:e.path)||(null==e?void 0:e.p)||"",query:"string"===G(a)?a:ge(a)})))},this.buildCloseEvent=function(){var e=t.growingIO.dataStore,i=e.eventContextBuilder;(0,e.eventInterceptor)(n({eventType:"APP_CLOSED"},i()))}},Qe=function(){function e(e){var t=this;this.growingIO=e,this.parsePage=function(e,n){var i,r=e.route||e.uri||e.__route__||(null===(i=null==e?void 0:e.$page)||void 0===i?void 0:i.fullPath)||"";K(n)?t.query=void 0:t.query=t.getQuery(n),t.path!==r&&(t.time=Date.now()),t.path=r,t.title=t.settedTitle[t.path]||t.growingIO.minipInstance.getPageTitle(e||t.growingIO.minipInstance.getCurrentPage())},this.getQuery=function(e){var t=n({},e);return B(t,"wxShoppingListScene"),ge(t)},this.saveShareId=function(e){(null==e?void 0:e.gioShareId)&&(t.queryShareId=e.gioShareId)},this.updateShareResult=function(e,n){var i=t.buildShareQuery(e,n),r=i[0],o=i[1],a=i[2];return n.path=te(r+(o?"?".concat(o):"")),n.attributes=a,n.query=o,n},this.updateAppMessageResult=this.updateShareResult,this.updateTimelineResult=this.updateShareResult,this.updateAddFavoritesResult=function(e,n){var i=t.buildShareQuery(e,n,!1),r=i[0],o=i[1];return n.path=te(r+(o?"?".concat(o):"")),n.query=o,n},this.query=void 0,this.settedTitle={},this.pageProps={}}return e.prototype.buildShareQuery=function(e,t,i){var r,o,a;void 0===i&&(i=!0);var s=e.userStore,u=ee(null!==(r=t.path)&&void 0!==r?r:""),c=this.path,l={},g=L(t,"path");if(g&&(c=_(u),l=de(T(u))||{}),K(l)&&(l=de(null!==(o=t.query)&&void 0!==o?o:"")||{}),!g&&K(l)&&(l=de(null!==(a=this.query)&&void 0!==a?a:"")||{},E(D(l)).forEach((function(e){(["gioPreShareId","gioShareId","suid"].includes(e)||e.toLowerCase().startsWith("utm_"))&&B(l,e)}))),!i)return[c,ge(l),{}];var d={gioShareId:Z(),suid:s.uid},p={contentType:t.contentType||l.contentType,contentId:t.contentId||l.contentId,gioPreShareId:this.queryShareId};return F(d,(function(e,t){e||B(d,t)})),[c,ge(n(n({},l),d)),n(n({},d),p)]},e}(),$e=function(e){var t=this;this.growingIO=e,this.main=function(e,n,i){var r,o,a=Date.now(),s=t.growingIO,u=s.emitter,c=s.minipInstance,l=s.plugins,g=s.vdsConfig,d=s.platformConfig,p=s.dataStore,f=p.shareOut,v=p.eventHooks,h=p.toggleShareOut,m=p.buildAppMessageEvent,I=p.buildTimelineEvent,y=p.buildAddFavorites,S=s.inPlugin,w=v.currentPage;if(!t.prevEvent[n]||Date.now()-Number(t.prevEvent[n])>=50){e||(e=c.getCurrentPage()),g.wepy&&(e.route=e.$is),e.route||(e.route=c.getCurrentPath(e));var O=e.route||e.uri||e.__route__||(null===(r=null==e?void 0:e.$page)||void 0===r?void 0:r.fullPath)||"";u.emit("minipLifecycle",{event:"Page ".concat(n),timestamp:a,params:{page:e,args:i[0]}}),g.debug&&console.log("Page:",O,"#",n,a),t.prevEvent[n]=Date.now();var P=d.listeners.page;switch(u.emit("onComposeBefore",{page:e,event:"Page ".concat(n),params:{page:e,args:i[0]}}),w.lastLifecycle=w.currentLifecycle,w.currentLifecycle=n,n){case P.pageLoad:t.argQuery[O]=U(e,"options")||U(e,"__displayReporter.query")||U(e,"$page.query")||U(e,"$wx.__displayReporter.query")||i[0]||{},B(t.argQuery[O],"$taroTimestamp"),w.parsePage(e,t.argQuery[O]);break;case P.pageShow:if(S)break;f&&v.currentPage.time||(w.parsePage(e,t.argQuery[O]),v.currentPage.time=Date.now(),t.buildPageEvent()),h(!1),w.saveShareId(t.argQuery[O]);break;case P.pageHide:case P.pageUnload:break;case P.shareApp:h(!0),g.followShare&&m(i);break;case P.shareTime:g.followShare&&I(i);break;case P.addFavorites:y(i);break;case P.tabTap:var _=null===(o=null==l?void 0:l.gioEventAutoTracking)||void 0===o?void 0:o.buildTabClickEvent;g.autotrack&&_&&b(_)&&_(i[0])}n===P.pageUnload&&(w.pageProps[O]=void 0)}},this.buildPageEvent=function(){var e=t.growingIO,i=e.minipInstance,r=e.dataStore,o=r.scene,a=r.lastPageEvent,s=r.eventContextBuilder,u=r.eventInterceptor,c=r.eventHooks.currentPage,l=n(n({eventType:"PAGE",referralPage:(null==a?void 0:a.path)||(null==a?void 0:a.p)||(o?"scn:".concat(i.scnPrefix).concat(o):null)},s()),{timestamp:c.time});K(c.pageProps[l.path])||(l.attributes=c.pageProps[l.path]),u(l)},this.prevEvent={},this.argQuery={}},We=function(e){var t,o,a=this;this.growingIO=e,this.isNormalFc=function(e,t){return b(t)&&"constructor"!==e},this.objectTraverse=function(e,t){Object.getOwnPropertyNames(e).forEach((function(n){return t(n,e)})),L(e,"methods")&&Object.getOwnPropertyNames(e.methods).forEach((function(n){e[n]||t(n,e.methods)})),L(e,"lifetimes")&&Object.getOwnPropertyNames(e.lifetimes).forEach((function(n){e[n]||t(n,e.lifetimes)})),L(e,"pageLifetimes")&&Object.getOwnPropertyNames(e.pageLifetimes).forEach((function(n){e[n]||t(n,e.pageLifetimes)}))},this.supLifeFcs=function(e,t){P(a["".concat(t,"Handlers")])&&a["".concat(t,"Handlers")].forEach((function(t){b(e[t])||["onShareAppMessage","onShareTimeline"].includes(t)||(e[t]=function(){})}))},this.lifeFcEffects=function(e,t,o){var s=a;return["onShareTimeline","onAddToFavorites"].includes(e)?function(){for(var n=[],i=0;arguments.length>i;i++)n[i]=arguments[i];var r=t.apply(this,n);"onShareTimeline"===e&&s.growingIO.vdsConfig.followShare&&(r=s.currentPage.updateTimelineResult(s.growingIO,null!=r?r:{})),"onAddToFavorites"===e&&(r=s.currentPage.updateAddFavoritesResult(s.growingIO,null!=r?r:{}));var a=[].slice.call(n);return r&&a.push(r),s["def".concat(o,"Cbs")][e].apply(this,a),r}:function(){for(var a,u=[],c=0;arguments.length>c;c++)u[c]=arguments[c];return i(this,void 0,void 0,(function(){var c,l,g,d,p;return r(this,(function(f){switch(f.label){case 0:return f.trys.push([0,5,,6]),"onShareAppMessage"!==e?[3,4]:[4,t.apply(this,u)];case 1:return c=null!==(a=f.sent())&&void 0!==a?a:{},"promise"!==G(c.promise)?[3,3]:(l=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){return e=c,[2,new Promise((function(t){var i=setTimeout((function(){t(n({},e)),clearTimeout(i),i=void 0}),3e3);c.promise.then((function(r){t(n({},e=r)),clearTimeout(i),i=void 0}))}))]}))}))},g=[n({},c)],[4,l()]);case 2:c=n.apply(void 0,g.concat([f.sent()])),B(c,"promise"),f.label=3;case 3:s.growingIO.vdsConfig.followShare&&(c=s.currentPage.updateAppMessageResult(s.growingIO,null!=c?c:{})),f.label=4;case 4:return d=[].slice.call(u),c&&d.push(c),s["def".concat(o,"Cbs")][e].apply(this,d),[3,6];case 5:return p=f.sent(),Q(p,"error"),[3,6];case 6:return"onShareAppMessage"!==e&&(c=t.apply(this,u)),s.growingIO.emitter.emit("minipLifecycle",{event:"".concat(o," ").concat(e,"End"),timestamp:Date.now(),params:{instance:this,arguments:Array.from(u)}}),[2,c]}}))}))}},this.customFcEffects=function(e,t){var n=a;return function(){for(var i,r,o=[],a=0;arguments.length>a;a++)o[a]=arguments[a];if(n.growingIO.vdsConfig.autotrack&&n.growingIO.plugins.gioEventAutoTracking)try{var s=o[0]||{};L(s,"type")&&((null==s?void 0:s.currentTarget)||(null==s?void 0:s.target))||(s=o[o.length-1]),((null==s?void 0:s.currentTarget)||(null==s?void 0:s.target))&&n.actionEventTypes.includes(s.type)&&(b(n.actionEffects)||(n.actionEffects=(null===(r=null===(i=n.growingIO.plugins)||void 0===i?void 0:i.gioEventAutoTracking)||void 0===r?void 0:r.main)||function(){}),null==n||n.actionEffects(s,e))}catch(e){Q(e,"error")}return t.apply(this,o)}},this.appApplyProxy=function(e,t){return a.appHandlers.includes(e)?a.lifeFcEffects(e,t,"App"):a.customFcEffects(e,t)},this.pageApplyProxy=function(e,t){return a.pageHandlers.includes(e)?a.lifeFcEffects(e,t,"Page"):a.customFcEffects(e,t)},this.appOverriding=function(e){return a.supLifeFcs(e,"app"),a.objectTraverse(e,(function(e,t){a.isNormalFc(e,t[e])&&(t[e]=a.appApplyProxy(e,t[e]))})),e},this.pageOverriding=function(e){return a.supLifeFcs(e,"page"),a.objectTraverse(e,(function(e,t){a.isNormalFc(e,t[e])&&(t[e]=a.pageApplyProxy(e,t[e]))})),e},this.componentOverriding=function(e){return e.methods||(e.methods={}),a.supLifeFcs(e.methods,"page"),a.objectTraverse(e.methods,(function(e,t){a.isNormalFc(e,t[e])&&(t[e]=a.pageApplyProxy(e,t[e]))})),e},this.growingApp=function(e){return a.originalApp(a.appOverriding(e))},this.growingPage=function(e){return a.originalPage(a.pageOverriding(e))},this.growingComponent=function(e){return a.originalComponent(a.componentOverriding(e))},this.growingBehavior=function(e){return a.originalBehavior(a.componentOverriding(e))},this.nativeGrowing=function(e){void 0===e&&(e=["App","Page","Component","Behavior"]);var t=a,n=a.growingIO.platformConfig.hooks;if(e.includes("App"))try{n.App&&!a.appHooked&&(App=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingApp(e[0])},a.appHooked=!0)}catch(e){}if(e.includes("Page"))try{n.Page&&!a.pageHooked&&(Page=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingPage(e[0])},a.pageHooked=!0)}catch(e){}if(e.includes("Component"))try{n.Component&&!a.componentHooked&&(Component=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingComponent(e[0])},a.componentHooked=!0)}catch(e){}if(e.includes("Behavior"))try{n.Behavior&&!a.behaviorHooked&&(Behavior=function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return t.growingBehavior(e[0])},a.behaviorHooked=!0)}catch(e){}},this.initEventHooks=function(){var e=a,t=a.growingIO,n=t.platformConfig,i=t.gioPlatform;a.appHandlers.forEach((function(t){a.defAppCbs[t]=function(){for(var n=[],i=0;arguments.length>i;i++)n[i]=arguments[i];e.appEffects.main(t,n)}})),a.pageHandlers.forEach((function(t){a.defPageCbs[t]=function(){for(var n=[],i=0;arguments.length>i;i++)n[i]=arguments[i];e.pageEffects.main(this,t,n)}})),n.canHook?a.nativeGrowing():"quickapp"===i&&(window.GioApp=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.appOverriding(t[0])},window.GioPage=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.pageOverriding(t[0])},window.GioComponent=function(){for(var t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return e.pageOverriding(t[0])}),a.growingIO.App=$((function(){return App})),a.growingIO.Page=$((function(){return Page})),a.growingIO.Component=$((function(){return Component})),a.growingIO.Behavior=$((function(){return Behavior})),"quickapp"===i&&(a.growingIO.GioApp=window.GioApp,a.growingIO.GioPage=window.GioPage,a.growingIO.GioComponent=window.GioComponent)};var s=null===(t=this.growingIO)||void 0===t?void 0:t.platformConfig;this.defAppCbs={},this.defPageCbs={},this.appHandlers=s.appHandlers,this.pageHandlers=s.pageHandlers,this.actionEventTypes=s.actionEventTypes,this.originalApp=s.originalApp,this.originalPage=s.originalPage,this.originalComponent=s.originalComponent,this.originalBehavior=null!==(o=s.originalBehavior)&&void 0!==o?o:function(){},this.appEffects=new Me(this.growingIO),this.pageEffects=new $e(this.growingIO),this.currentPage=new Qe(this.growingIO)},ze=function(){function e(e){var t=this;this.growingIO=e,this.ALLOW_SETTING=Object.assign({},a,"saas"===this.growingIO.gioEnvironment?u:s),this.allowOptKeys=D(this.ALLOW_SETTING),this.initStorageInfo=function(){var e=t.growingIO.minipInstance,n=ae(),i=n.gio_esid?n.gio_esid:e.getStorageSync(t.esidStorageName);i=O(i)&&!I(i)?i:{},t._esid={},D(i).forEach((function(e){t._esid[e]=Number.isNaN(Number(i[e]))||i[e]>=1e9||1>i[e]?1:i[e]})),R(i,t._esid)||e.setStorageSync(t.esidStorageName,t._esid);var r=n.gio_gsid?n.gio_gsid:Number.parseInt(e.getStorageSync(t.gsidStorageName),10);t._gsid=Number.isNaN(r)||r>=1e9||1>r?1:r,t._stid=t._gsid,r!==t._gsid&&e.setStorageSync(t.gsidStorageName,t._gsid)},this.saveStorageInfo=function(){var e=t.growingIO.minipInstance;t._stid=t._gsid,le(e,[{key:t.esidStorageName,value:t._esid},{key:t.gsidStorageName,value:t._gsid}])},this.initOptions=function(e){var i,r,o,a,s,u,c,l,g,d,p,f=e.projectId,v=e.dataSourceId,I=e.appId,y={};t.allowOptKeys.forEach((function(n){var i=t.ALLOW_SETTING[n].type;(P(i)?i.includes(G(e[n])):G(e[n])===t.ALLOW_SETTING[n].type)?"ignoreFields"===n?y.ignoreFields=e.ignoreFields.filter((function(e){return h.includes(e)})):"extraParams"===n?y.extraParams=e.extraParams.filter((function(e){return m.includes(e)})):y[n]=e[n]:y[n]=t.ALLOW_SETTING[n].default})),y.uploadInterval=Math.round(y.uploadInterval),(Number.isNaN(y.uploadInterval)||0>y.uploadInterval||y.uploadInterval>2e3)&&(y.uploadInterval=1e3),t.growingIO.vdsConfig=n(n({},y),{projectId:f,dataSourceId:v,appId:I,performance:{monitor:null===(r=null===(i=y.performance)||void 0===i?void 0:i.monitor)||void 0===r||r,exception:null===(a=null===(o=y.performance)||void 0===o?void 0:o.exception)||void 0===a||a,network:null!==(u=null===(s=y.performance)||void 0===s?void 0:s.network)&&void 0!==u&&u}}),t.keepAlive=y.keepAlive,y.dataCollect||Q("已关闭数据采集","info"),y.autotrack||Q("已关闭无埋点","info"),t.growingIO.inPlugin&&(t.growingIO.vdsConfig.autotrack=!1);var S=y.cml,w=y.uniVue,O=y.wepy,b=y.taro,_=y.remax;"full"!==t.growingIO.gioFramework||S||w||O||b||_||(t.growingIO.platformConfig.canHook=!0),t.growingIO.inPlugin||t.eventHooks.initEventHooks();var T=t.growingIO.plugins;S&&(null===(c=null==T?void 0:T.gioChameleonAdapter)||void 0===c||c.main()),w&&(null===(l=null==T?void 0:T.gioUniAppAdapter)||void 0===l||l.main()),O&&(null===(g=null==T?void 0:T.gioWepyAdapter)||void 0===g||g.main()),b&&(null===(d=null==T?void 0:T.gioTaroAdapter)||void 0===d||d.main()),_&&(null===(p=null==T?void 0:T.gioRemaxAdapter)||void 0===p||p.main())},this.setOption=function(e,n){var i,r=t.growingIO,o=r.vdsConfig,a=r.callError,s=r.uploader,u=r.emitter,c=y(e)&&t.allowOptKeys.includes(e),l=c&&typeof n===(null===(i=t.ALLOW_SETTING[e])||void 0===i?void 0:i.type);if(c&&l){if("dataCollect"===e&&!1===o.dataCollect&&!0===n)var g=setTimeout((function(){var e=t.eventHooks.currentPage,n=e.path,i=e.settedTitle;t.eventHooks.currentPage.title=i[n]||t.growingIO.minipInstance.getPageTitle(t.growingIO.minipInstance.getCurrentPage()),t.sendVisit(),t.eventHooks.currentPage.time=Date.now(),t.sendPage(),clearTimeout(g),g=null}));return o[e]=n,["host","scheme"].includes(e)&&(null==s||s.generateURL()),u.emit("OPTION_CHANGE",{optionName:e,optionValue:n}),!0}return a("setOption > ".concat(e)),!1},this.getOption=function(e){var i=t.growingIO,r=i.vdsConfig,o=i.callError;return e&&L(r,A(e))?r[A(e)]:I(e)?n({},r):void o("getOption > ".concat(e))},this.toggleShareOut=function(e){w(e)?t.shareOut=e:t.shareOut=!t.shareOut},this.sendVisit=function(){t.eventHooks.appEffects.buildVisitEvent(t.lastVisitEvent)},this.sendPage=function(){t.eventHooks.pageEffects.buildPageEvent()},this.eventInterceptor=function(e){var i=t.growingIO.minipInstance,r=i.systemInfo,a=i.network;K(r)||K(a)?t.interceptEvents.push(e):K(t.interceptEvents)?t.eventConverter(e):(o(o([],t.interceptEvents,!0),[e],!1).forEach((function(e){var i=n(n({},e),t.eventContextBuilder({path:e.path,query:e.query,timestamp:e.timestamp}));t.eventConverter(i)})),t.interceptEvents=[])},this.eventReleaseInspector=function(){var e=t.growingIO.minipInstance,i=e.systemInfo,r=e.network;i&&r&&!K(t.interceptEvents)&&(o([],t.interceptEvents,!0).forEach((function(e){var i=n(n({},e),t.eventContextBuilder({path:e.path,query:e.query,timestamp:e.timestamp}));t.eventConverter(i)})),t.interceptEvents=[])},this.buildAppMessageEvent=function(e){},this.buildTimelineEvent=function(e){},this.buildAddFavorites=function(e){},this.esidStorageName="_growing_esid_",this.gsidStorageName="_growing_gsid_",this.initStorageInfo(),this.eventContextBuilder=new Ge(this.growingIO).main,this.eventHooks=new We(this.growingIO),this.shareOut=!1,this.lastVisitEvent={},this.lastPageEvent={},this.locationData={},this.generalProps={},this.interceptEvents=[],this.growingIO.emitter.on("onComposeAfter",(function(e){var n=e.composedEvent;"VISIT"!==n.eventType&&"vst"!==n.t||(t.lastVisitEvent=n),"PAGE"!==n.eventType&&"page"!==n.t||(t.lastPageEvent=n)}))}return Object.defineProperty(e.prototype,"esid",{get:function(){var e=ae(),t=oe(e);return!K(t)&&e.gio_esid?e.gio_esid:this._esid},set:function(e){var t={};D(e).forEach((function(n){t[n]=Number.isNaN(e[n])||e[n]>=1e9||1>e[n]?1:e[n]})),R(t,this._esid)||(this._esid=t,ae().gio_esid=this._esid)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gsid",{get:function(){var e=ae(),t=oe(e);return!K(t)&&e.gio_gsid?e.gio_gsid:this._gsid},set:function(e){var t=Number.parseInt(e,10);this._gsid=Number.isNaN(t)||e>=1e9||1>e?1:e,ae().gio_gsid=this._gsid,10>this._gsid-this._stid||this.saveStorageInfo()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},set:function(e){var t=this._scene;this._scene=e,t!==this._scene&&this.growingIO.emitter.emit("SCENE_UPDATE",{newScene:e,oldScene:t})},enumerable:!1,configurable:!0}),e}(),Ze=function(e){function i(t){var i=e.call(this,t)||this;return i.growingIO=t,i.eventConverter=function(e){var t,r=i.growingIO,o=r.vdsConfig,a=r.dataStore,s=r.uploader;if(o.dataCollect){e.globalSequenceId=a.gsid,e.eventSequenceId=a.esid[e.eventType]||1;var u={};F(e,(function(e,t){var n;if("element"===t){var i=null!==(n=_(e))&&void 0!==n?n:{};F(i,(function(e,t){K(e)&&0!==e||(u[t]=e)}))}else K(e)&&0!==e||(u[t]=e)})),i.growingIO.dataStore.gsid+=1,i.growingIO.dataStore.esid=n(n({},i.growingIO.dataStore.esid),((t={})[u.eventType]=(i.growingIO.dataStore.esid[u.eventType]||1)+1,t)),i.growingIO.emitter.emit("onComposeAfter",{composedEvent:u}),s.commitRequest(u)}},i.buildAppMessageEvent=function(e){var t,r,o=e[0];2>e.length?1===e.length&&(r=o):r=e[1];var a=i.growingIO.dataStore,s=a.eventContextBuilder,u=a.eventInterceptor,c=a.eventHooks.currentPage,l=((null==r?void 0:r.path)||"").split("?");u(n({eventType:"CUSTOM",eventName:"$mp_on_share",pageShowTimestamp:c.time,attributes:n({$from:o.from,$target:null===(t=null==o?void 0:o.target)||void 0===t?void 0:t.id,$share_title:null==r?void 0:r.title,$share_path:_(l),$share_query:l[1]},null==r?void 0:r.attributes)},s()))},i.buildTimelineEvent=function(e){var t,r,o=e[0];2>e.length?1===e.length&&(r=o):r=e[1];var a=i.growingIO.dataStore,s=a.eventContextBuilder,u=a.eventInterceptor,c=a.eventHooks.currentPage,l=((null==r?void 0:r.path)||"").split("?");u(n({eventType:"CUSTOM",eventName:"$mp_share_timeline",pageShowTimestamp:c.time,attributes:n({$target:null===(t=null==o?void 0:o.target)||void 0===t?void 0:t.id,$share_title:null==r?void 0:r.title,$share_path:_(l),$share_query:l[1]},null==r?void 0:r.attributes)},s()))},i.buildAddFavorites=function(e){var t,r=e[0];2>e.length?1===e.length&&(t=r):t=e[1];var o=i.growingIO.dataStore,a=o.eventContextBuilder,s=o.eventInterceptor,u=o.eventHooks.currentPage,c=((null==t?void 0:t.path)||"").split("?");s(n({eventType:"CUSTOM",eventName:"$mp_add_favorites",pageShowTimestamp:u.time,attributes:{$share_title:null==t?void 0:t.title,$share_path:_(c),$share_query:c[1]}},a()))},i.trackTimers={},i}return t(i,e),i}(ze),Je=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.generateURL=function(){var e=n.growingIO.vdsConfig,t=e.scheme,i=e.host,r=void 0===i?"":i,o=e.projectId;t&&q(t,"http")?H(A(t),"://")||(t="".concat(t,"://")):t="https://",r=r.replace("http://","").replace("https://",""),n.requestURL="".concat(t).concat(r,"/v3/projects/").concat(o,"/collect")},n.generateURL(),n}return t(n,e),n}((function(e){var t=this;this.growingIO=e,this.commitRequest=function(e){var i=n({},e);t.growingIO.vdsConfig.forceLogin?t.hoardingQueue.push(i):(t.requestQueue.push(i),t.initiateRequest())},this.initiateRequest=function(e){var n,i,r=t.growingIO,a=r.plugins,s=r.vdsConfig;o(o([],t.hoardingQueue,!0),t.requestQueue,!0).length>0&&t.requestingNum<t.requestLimit&&((null===(n=null==s?void 0:s.tbConfig)||void 0===n?void 0:n.cloudFuncSend)?null===(i=null==a?void 0:a.gioTaobaoSendAdapter)||void 0===i||i.singleInvoke():e?t.batchInvoke():t.batchInvokeThrottle())},this.batchInvoke=function(){var e,n,i=t.growingIO,r=i.vdsConfig,a=i.plugins,s=i.emitter,u=o(o([],t.hoardingQueue,!0),t.requestQueue,!0);u.length>50?(u=u.slice(0,50),t.hoardingQueue.length>50?t.hoardingQueue=t.hoardingQueue.slice(50):(t.hoardingQueue=[],t.requestQueue=t.requestQueue.slice(50-t.hoardingQueue.length))):(t.hoardingQueue=[],t.requestQueue=[]);var c=u.filter((function(e){return(t.retryIds[e.globalSequenceId||e.esid]||0)<=t.retryLimit}));K(c)||(r.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(c,null,2)),s.emit("onSendBefore",{requestData:c}),(null===(e=null==r?void 0:r.tbConfig)||void 0===e?void 0:e.cloudAppId)?null===(n=null==a?void 0:a.gioTaobaoSendAdapter)||void 0===n||n.tbCloudAppInvoke(c):t.normalBatchInvoke(c))},this.batchInvokeThrottle=V(this.batchInvoke,this.growingIO.vdsConfig.uploadInterval,!1,!1),this.normalBatchInvoke=function(e){var n,i=t.growingIO,r=i.minipInstance,a=i.vdsConfig,s=i.emitter,u=i.plugins,c=i.gioEnvironment;t.requestingNum+=1;var l={"content-type":"jdp"===r.platform?"application/json":"application/json;charset=UTF-8"},g=o([],e,!0),d=a.compress&&(null===(n=null==u?void 0:u.gioCompress)||void 0===n?void 0:n.compressToUTF16);"cdp"===c&&d&&(g=u.gioCompress.compressToUTF16(JSON.stringify(e)),l["X-Compress-Codec"]="1"),r.request({url:"".concat(t.requestURL,"?stm=").concat(Date.now()).concat("cdp"===c?"&compress="+(d?"1":"0"):""),header:l,method:"POST",data:g,timeout:t.requestTimeout,fail:function(n){[200,204].includes(n.code)||(P(e)?e.forEach((function(e){t.requestFailFn(e)})):t.requestFailFn(e),Q("请求失败!".concat(JSON.stringify(n)),"error"))},complete:function(e){t.requestingNum-=1,s.emit("onSendAfter",{result:e}),t.initiateRequest()}})},this.requestFailFn=function(e){if(t.retryIds[e.globalSequenceId||e.esid]||(t.retryIds[e.globalSequenceId||e.esid]=0),t.retryIds[e.globalSequenceId||e.esid]+=1,!t.requestQueue.some((function(t){return t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid})))var n=setTimeout((function(){K(t.requestQueue)?(t.requestQueue.push(e),t.initiateRequest()):t.requestQueue.push(e),clearTimeout(n),n=null}),800)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=3,this.requestTimeout=5e3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.requestURL=""})),Ye=new(function(e){function i(){var t,i,r=this;return(r=e.call(this)||this).registerPlugins=function(e){r.plugins.pluginItems=o(o([],r.plugins.pluginItems,!0),e,!0),r.plugins.installAll(e)},r.initCallback=function(){r.uploader=new Je(r),r.vdsConfig.enableIdMapping||(r.userStore.userKey="")},r.setTrackerScheme=function(e){["http","https"].includes(e)?(r.dataStore.setOption("scheme",e),r.notRecommended()):r.callError("scheme",!1)},r.setTrackerHost=function(e){ve.test(e)||he.test(e)?(r.dataStore.setOption("host",e),r.notRecommended()):r.callError("host",!1)},r.identify=function(e){if(r.vdsConfig.forceLogin){if(!fe(e))return void r.callError("identify");var t=A(e).slice(0,1e3);r.userStore.uid=t,r.uploader.hoardingQueue.forEach((function(e,n){return r.uploader.hoardingQueue[n].deviceId=t})),r.dataStore.setOption("forceLogin",!1),r.uploader.initiateRequest(!0)}else r.callError("identify",!1,"forceLogin未开启")},r.setUserAttributes=function(e){var t,n;!K(e)&&O(e)?null===(n=null===(t=r.plugins)||void 0===t?void 0:t.gioCustomTracking)||void 0===n||n.buildUserAttributesEvent(e):r.callError("setUserAttributes")},r.setUserId=function(e,t){if(fe(e)){var n=r.userStore.gioId;e=A(e).slice(0,1e3),t=A(t).slice(0,1e3),r.userStore.userId=e,r.vdsConfig.enableIdMapping&&(r.userStore.userKey=I(t)?"":t),r.reissueLogic(n,e)}else r.callError("setUserId")},r.clearUserId=function(){r.userStore.userId=void 0,r.userStore.userKey=void 0},r.track=function(e,t,i){var o,a;((null===(a=null===(o=r.plugins)||void 0===o?void 0:o.gioCustomTracking)||void 0===a?void 0:a.buildCustomEvent)||function(){})(e,n(n({},r.dataStore.generalProps),O(t)&&!K(t)?t:{}),i)},r.reissueLogic=function(e,t){e&&e!==t&&(r.userStore.sessionId="",r.dataStore.sendVisit()),e||e===t||r.dataStore.sendVisit()},r.trackTimerStart=function(e){return!!r.vdsConfig.dataCollect&&z(e,(function(){var t=Z();return r.dataStore.trackTimers[t]={eventName:e,leng:0,start:+Date.now()},t}))},r.trackTimerPause=function(e){if(e&&r.dataStore.trackTimers[e]){var t=r.dataStore.trackTimers[e];return t.start&&(t.leng=t.leng+(+Date.now()-t.start)),t.start=0,!0}return!1},r.trackTimerResume=function(e){if(e&&r.dataStore.trackTimers[e]){var t=r.dataStore.trackTimers[e];return 0===t.start&&(t.start=+Date.now()),!0}return!1},r.trackTimerEnd=function(e,t){if(r.vdsConfig.dataCollect){if(e&&r.dataStore.trackTimers[e]){var i=r.dataStore.trackTimers[e];if(0!==i.start){var o=+Date.now()-i.start;i.leng=o>0?i.leng+o:0}return r.track(i.eventName,n(n({},t),{event_duration:i.leng>864e5?0:i.leng/1e3})),r.removeTimer(e),!0}return Q("未查找到对应的计时器，请检查!","error"),!1}return!1},r.removeTimer=function(e){return!(!e||!r.dataStore.trackTimers[e]||(delete r.dataStore.trackTimers[e],0))},r.clearTrackTimer=function(){r.dataStore.trackTimers={}},r.dataStore=new Ze(r),b(null===(t=r.minipInstance.minip)||void 0===t?void 0:t.onAppHide)&&r.minipInstance.minip.onAppHide((function(){F(r.dataStore.trackTimers,(function(e){e.start&&(e.leng=e.leng+(+Date.now()-e.start))}))})),b(null===(i=r.minipInstance.minip)||void 0===i?void 0:i.onAppShow)&&r.minipInstance.minip.onAppShow((function(){F(r.dataStore.trackTimers,(function(e){e.start&&(e.start=+Date.now())}))})),r.emitter.on("OPTION_CHANGE",(function(e){var t=e.optionName,n=e.optionValue;"dataCollect"===t&&!1===n&&r.clearTrackTimer()})),r}return t(i,e),i}((function(){var e,t=this;this.init=function(e){return Q("Gio小程序SDK 初始化中...","info"),t.dataStore.initOptions(e),t.gioSDKInitialized=!0,t.vdsConfig.subpackage||(ae().__gio__=function(){return t}),null==t||t.initCallback(),t.emitter.emit("SDK_INITIALIZED",t),Q("Gio小程序SDK 初始化完成！","success"),t.vdsConfig.forceLogin&&Q("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),t.inPlugin&&t.dataStore.sendVisit(),!0},this.setDataCollect=function(e){t.setOption("dataCollect",!!e),t.notRecommended()},this.setAutotrack=function(e){t.setOption("autotrack",!!e),t.notRecommended()},this.enableDebug=function(e){t.setOption("debug",!!e),t.notRecommended()},this.setOption=function(e,n){if(p.includes(e)){var i=t.dataStore.setOption(e,n);return i&&f[e]&&Q("已".concat(n?"开启":"关闭").concat(f[e]),"info"),i}return Q("不存在可修改的配置项：".concat(e,"，请检查后重试!"),"warn"),!1},this.getDeviceId=function(){return t.userStore.uid},this.getOption=function(e){return t.dataStore.getOption(e)},this.getGioInfo=function(){var e=t.userStore,n=e.uid,i=e.userId,r=e.userKey,o=e.sessionId,a=e.gioId,s=t.vdsConfig,u=s.projectId,c=s.appId,l=s.dataSourceId,g=s.dataCollect,d=s.enableIdMapping,p=s.extraParams,f=s.ignoreFields,v={gioappid:c,giocs1:i||"",gioplatform:t.platformConfig.platform,gioprojectid:u,gios:o,giou:n};return"cdp"===t.gioEnvironment&&(v.giodatacollect=g,v.giodatasourceid=l,v.gioid=a||"",d&&(v.giouserkey=r),K(p)||p.forEach((function(e){f.includes(e)||(v["gio".concat(e)]=t.dataStore.lastVisitEvent[e])}))),Ue.stringify(v)},this.setLocation=function(e,n){var i={latitude:e,longitude:n},r=t.dataStore.locationData,o=function(e){return e>=-180&&180>=e};o(e)&&o(n)&&(r.latitude!==e||r.longitude!==n)&&(t.dataStore.locationData=i,t.dataStore.sendVisit())},this.setGeneralProps=function(e){O(e)&&!K(e)?(t.dataStore.generalProps=n(n({},t.dataStore.generalProps),e),D(t.dataStore.generalProps).forEach((function(e){[void 0,null].includes(t.dataStore.generalProps[e])&&(t.dataStore.generalProps[e]="")}))):t.callError("setGeneralProps")},this.clearGeneralProps=function(e){P(e)&&!K(e)?e.forEach((function(e){B(t.dataStore.generalProps,e)})):t.dataStore.generalProps={}},this.setPageAttributes=function(e){var n=t.dataStore.eventHooks.currentPage,i=t.minipInstance.getCurrentPath();["onLoad","attached"].includes(n.currentLifecycle)&&(n.pageProps[i]=ue(e))},this.updateImpression=function(){Q("当前未集成半自动浏览插件，请集成插件后再调用 updateImpression!","warn")},this.notRecommended=function(){return Q("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info")},this.callError=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),Q("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},this.utils=n(n(n({},M),pe),{qs:Ue}),this.emitter={all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map((function(e){e(n)})),(i=e.get("*"))&&i.slice().map((function(e){e(t,n)}))}},this.gioPlatform=re(),this.gioFramework="taro",this.gioEnvironment="cdp",this.sdkVersion="3.8.17";try{"quickapp"===this.gioPlatform||b(getApp)&&b(App)?this.inPlugin=!1:this.inPlugin=!0}catch(e){this.inPlugin=!0}this.inPlugin&&Q("未检测到小程序实例，自动切换为插件模式!","info"),this.platformConfig=xe,this.minipInstance=new Re(this),this.userStore=new we(this),this.plugins=new Se(this),this.plugins.innerPluginInit()}))),Xe=function(){var e,t=arguments[0];if(y(t)&&d.includes(t)&&Ye[t]){var i=k(Array.from(arguments));if("init"===t){var r=!(e=Ye).vdsConfig&&!e.gioSDKInitialized||(Q("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1),o=function(e){return!!E(e)||(Q('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", "你的应用 AppId", options); 进行初始化!',"error"),!1)}(i),a=function(e){var t=e[0],n=T(e);return fe(t)?(O(n)&&n||(n={}),{projectId:t,userOptions:n}):(Q("SDK初始化失败，accountId 参数不合法!","error"),!1)}(i),s=function(e){var t=e[1],n=e[2],i=T(e);return t&&y(t)?fe(n)?{dataSourceId:t,appId:n,cdpOptions:i}:(Q("SDK初始化失败，appId 参数不合法!","error"),!1):(Q("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)}(i);if(r&&o&&a&&s){var u=a.projectId,c=s.dataSourceId,l=s.appId,g=s.cdpOptions;return Ye.init(n(n({},g),{projectId:u,dataSourceId:c,appId:l}))}}else if("registerPlugins"===t)Ye.registerPlugins(i[0]);else{if(Ye.gioSDKInitialized&&Ye.vdsConfig)return Ye[t].apply(Ye,i);Q("SDK未初始化!","error")}}else v.includes(t)?Q("方法 ".concat(A(t)," 已被弃用!"),"warn"):Q("不存在名为 ".concat(A(t)," 的方法调用!"),"error")};se().gdp=Xe,se().gioEnvironment="cdp",se().gioSDKVersion=Ye.sdkVersion;export{Xe as default};
