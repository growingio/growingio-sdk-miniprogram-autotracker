let e;var t={name:"gioEventAutoTracking",method:class{constructor(t){this.growingIO=t,this.main=(t,n)=>{var i,a;const{remaxVMs:o,dataStore:{eventHooks:r},vdsConfig:s,platformConfig:l,plugins:g,emitter:d}=this.growingIO;if(!s.autotrack||!n||r.shareOut||e.get(t,"currentTarget.dataset.growingIgnore")||e.get(t,"target.dataset.growingIgnore")||!e.get(t,"target.dataset.growingTrack")&&"autoplay"===e.get(t,"detail.source")||t.type===(null===(i=this.prevEvent)||void 0===i?void 0:i.type)&&10>Math.abs(Number(t.timeStamp)-Number(null===(a=this.prevEvent)||void 0===a?void 0:a.timeStamp)))return;if(this.prevEvent=t,"__e"===n&&s.uniVue&&(n=null==g?void 0:g.gioUniAppAdapter.getHandlerName(t)),["#eh","eh"].includes(n)&&s.taro)return;if(["_cmlEventProxy","onclick","blurEvent","handleDetail"].includes(n)&&s.cml)return;n.indexOf("$$REMAX_METHOD")>-1&&o&&(n=null==g?void 0:g.gioRemaxAdapter.getHandlerName(n)),s.debug&&console.log("Actionï¼š",t.type,Date.now()),d.emit("onComposeBefore",{event:n,params:null!=t?t:{}});const u=l.listeners.actions;u.click.includes(t.type)?this.buildClickEvent(t,n):u.change.includes(t.type)?this.buildChangeEvent(t,n):u.submit.includes(t.type)&&this.buildSubmitEvent(t,n)},this.getNodeXpath=(e,t)=>{const{gioPlatform:n,vdsConfig:i}=this.growingIO;let a=(e.currentTarget||e.target).id;if((!a||"swan"===n&&/^_[0-9a-f]+/.test(a)||(e=>{const{Current:t,createComponent:n}=e;return!(!e||!t||n)})(i.taro)&&/^_n_[0-9]+$/.test(a))&&(a=""),!i.octopus||(t=e.handler,/^bound .*/.test(t)&&(t=t.replace("bound ","")),/^t[0-9]+$/.test(a)&&(a=""),a&&!t&&(t="anonymousFunc"),a||t))return`${a}#${t}`},this.buildClickEvent=(t,n)=>{var i,a;const o=this.getNodeXpath(t,n);if(o){const{dataStore:{eventContextBuilder:n,eventInterceptor:r,eventHooks:s},gioEnvironment:l}=this.growingIO,g=t.currentTarget||t.target;let d;e.has(null==g?void 0:g.dataset,"index")&&(d=Number.parseInt(g.dataset.index,10),Number.isNaN(d)&&(d=-1)),r(Object.assign({eventType:"saas"===l&&t.type.includes("long")?"lngprss":"VIEW_CLICK",pageShowTimestamp:s.currentPage.time,element:[{xpath:o,index:d,textValue:null===(i=null==g?void 0:g.dataset)||void 0===i?void 0:i.title,hyperlink:null===(a=null==g?void 0:g.dataset)||void 0===a?void 0:a.src}]},n()))}},this.buildTabClickEvent=t=>{const{dataStore:{eventContextBuilder:n,eventInterceptor:i,eventHooks:a}}=this.growingIO;i(Object.assign({eventType:"VIEW_CLICK",pageShowTimestamp:a.currentPage.time,element:[{xpath:"#onTabItemTap",textValue:t.text,index:t.index,hyperlink:e.toString(t.pagePath)}]},n()))},this.buildChangeEvent=(t,n)=>{var i,a;const o=this.getNodeXpath(t,n);if(o){const{dataStore:{eventContextBuilder:n,eventInterceptor:r,eventHooks:s}}=this.growingIO,l=t.currentTarget||t.target,g=Object.assign({eventType:"VIEW_CHANGE",pageShowTimestamp:s.currentPage.time,element:{xpath:o}},n()),d=e.get(t,"detail.value")||e.get(t,"target.attr.value");((null===(i=null==l?void 0:l.dataset)||void 0===i?void 0:i.growingTrack)||(null===(a=null==l?void 0:l.dataset)||void 0===a?void 0:a.growingtrack))&&(e.isNil(d)||(g.element.textValue=e.toString(d))),g.element=[g.element],r(g)}},this.buildSubmitEvent=(e,t)=>{const n=this.getNodeXpath(e,t);if(n){const{dataStore:{eventContextBuilder:e,eventInterceptor:t,eventHooks:i}}=this.growingIO;t(Object.assign({eventType:"FORM_SUBMIT",pageShowTimestamp:i.currentPage.time,element:[{xpath:n}]},e()))}},e=this.growingIO.utils,this.prevEvent={}}}};export{t as default};
